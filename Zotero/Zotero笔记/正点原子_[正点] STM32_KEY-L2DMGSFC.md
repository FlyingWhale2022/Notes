# [正点] STM32F103 战舰开发指南-HAL库版本_V1.3
> [!info]+ <center>Metadata</center>
> 
> |<div style="width: 5em">Key</div>|Value|
> |--:|:--|
> |文献类型|document|
> |标题|[正点] STM32F103 战舰开发指南-HAL库版本_V1.3|
> |短标题||
> |作者|[[正点原子]]|
> |期刊名称||
> |DOI||
> |存档位置||
> |馆藏目录||
> |索书号||
> |版权||
> |分类|[[stm32]]|
> |条目链接|[My Library](zotero://select/library/items/L2DMGSFC)|
> |PDF 附件|[STM32F103 战舰开发指南V1.3.pdf](zotero://open-pdf/library/items/JFGTX7CT)|
> |关联文献|[[正点原子_OLED实验_KEY-IAQWYYKC]]、 [[正点原子_STM32 启动文件_KEY-Q4ANDURF]]、 [[野火_[野火]《STM32_KEY-YDX94YM2]]|
> ^Metadata

> [!example]- <center>本文标签</center>
> 
> `$=dv.current().file.tags`

> [!quote]- <center>Abstract</center>
> 
> 这个相比于“精英版的HAL库”更加详细一点，视频里用的是这个

> [!tldr]- <center>隐藏信息</center>
> 
> itemType:: document
> title:: [正点] STM32F103 战舰开发指南-HAL库版本_V1.3
> shortTitle:: 
> creators:: [[正点原子]]
> publicationTitle:: 
> journalAbbreviation:: 
> volume:: 
> issue:: 
> pages:: 
> language:: zh
> DOI:: 
> ISSN:: 
> url:: 
> archive:: 
> archiveLocation:: 
> libraryCatalog:: 
> callNumber:: 
> rights:: 
> extra:: 🏷️ /reading、📒、📝 标题、📝 重点
> collection:: [[stm32]]
> tags:: #reading 
> related:: [[正点原子_OLED实验_KEY-IAQWYYKC]]、 [[正点原子_STM32 启动文件_KEY-Q4ANDURF]]、 [[野火_[野火]《STM32_KEY-YDX94YM2]]
> itemLink:: [My Library](zotero://select/library/items/L2DMGSFC)
> pdfLink:: [STM32F103 战舰开发指南V1.3.pdf](zotero://open-pdf/library/items/JFGTX7CT)
> qnkey:: 正点原子_[正点] STM32_KEY-L2DMGSFC
> date:: NaN
> dateY:: undefined
> dateAdded:: 2024-01-10
> dateModified:: 2024-03-01
> 
> abstract:: 这个相比于“精英版的HAL库”更加详细一点，视频里用的是这个


%--------------ω--------------%

## ✏️ 笔记区

> [!WARNING]+ <center>🐣 总结</center>  
>
>🎯 研究问题::  
>🔎 研究背景::  
>🚀 研究方法::  
>🐔 研究思路::  
>📺 主要内容::  
>🎉 研究结论::  
>🗝️ 创新点::  
>💩 研究局限::  
>🐾 研究展望::  
>✏️ 备注::  

> [!inbox]- <center>📫 导入时间</center>
>
> ⏰ importDate:: 2024-03-02

%--------------ω--------------%

## 📝 注释笔记 JFGTX7CT

> <span style="font-size: 15px;color: gray">📍 undefined-正点原子-[正点] STM32F103 战舰开发指南-HAL库版本_V1.3</span>

^KEYrefTitle

> <span class="image#e56eee">null</span>学习要求 ([p20](zotero://open-pdf/library/items/JFGTX7CT?page=20&annotation=H6ZVWSTX))

^KEYH6ZVWSTX

> <span class="highlight" style="background-color: #e56eee">对于一些较难的知识点，我们只需要知 道怎么用就可以了，并不需要详细研究具体实现过程，比如文件系统、图片解码、USB 协议栈、OS 实现原理等；</span>
> 
> 学习要求 ([p20](zotero://open-pdf/library/items/JFGTX7CT?page=20&annotation=NXFX6MCD))

^KEYNXFX6MCD

> <span class="highlight" style="background-color: #f19837">第一篇 基础篇</span> ([p21](zotero://open-pdf/library/items/JFGTX7CT?page=21&annotation=BQWVNQGU))
> 
> 🏷️ #📝/标题

^KEYBQWVNQGU

> <span class="highlight" style="background-color: #f19837">第一章 本书学习方法</span> ([p22](zotero://open-pdf/library/items/JFGTX7CT?page=22&annotation=J7YQ9SUG))
> 
> 🏷️ #📝/标题

^KEYJ7YQ9SUG

> <span class="highlight" style="background-color: #f19837">1.1 本书学习顺序</span> ([p22](zotero://open-pdf/library/items/JFGTX7CT?page=22&annotation=NHUB5PJZ))
> 
> 🏷️ #📝/标题

^KEYNHUB5PJZ

> <span class="highlight" style="background-color: #e56eee">将硬件介绍独立成一个文档《战舰 V4 硬件参考手册.pdf》，本书着重介绍软件知识。</span>
> 
> 硬件介绍独立成一个文档《战舰 V4 硬件参考手册.pdf》 ([p22](zotero://open-pdf/library/items/JFGTX7CT?page=22&annotation=GMJ6EM8F))

^KEYGMJ6EM8F

> <span class="highlight" style="background-color: #f19837">1.2 本书参考资料</span> ([p22](zotero://open-pdf/library/items/JFGTX7CT?page=22&annotation=G4UB427L))
> 
> 🏷️ #📝/标题

^KEYG4UB427L

> <span class="image#e56eee">null</span>参考资料 ([p22](zotero://open-pdf/library/items/JFGTX7CT?page=22&annotation=MI6MGXU5))

^KEYMI6MGXU5

> <span class="highlight" style="background-color: #f19837">1.3 本书编写规范</span> ([p22](zotero://open-pdf/library/items/JFGTX7CT?page=22&annotation=CKE8TSNH))
> 
> 🏷️ #📝/标题

^KEYCKE8TSNH

> <span class="highlight" style="background-color: #f19837">1.4 本书代码规范</span> ([p23](zotero://open-pdf/library/items/JFGTX7CT?page=23&annotation=DTF9DKIC))
> 
> 🏷️ #📝/标题

^KEYDTF9DKIC

> <span class="highlight" style="background-color: #e56eee">总结几个规范的关键点： 1，所有函数/变量名字非特殊情况，一般使用小写字母； 2，注释风格使用 doxgen 风格，除屏蔽外，一律使用 /* */ 方式进行注释； 3，TAB 键统一使用 4 个空格对齐，不使用默认的方式进行对齐； 4，每两个函数之间，一般有且只有一个空行； 5，相对独立的程序块之间，使用一个空行隔开； 6，全局变量命名一般用 g_开头，全局指针命名一般用 p_开头； 7，if、for、while、do、case、switch、default 等语句单独占一行，一般无论有多少行执行语 句，都要用加括号：{}。</span>
> 
> 代码规范 ([p23](zotero://open-pdf/library/items/JFGTX7CT?page=23&annotation=RKZNER9A))

^KEYRKZNER9A

> <span class="highlight" style="background-color: #f19837">1.5 例程资源说明</span> ([p23](zotero://open-pdf/library/items/JFGTX7CT?page=23&annotation=TJ2GMD8V))
> 
> 🏷️ #📝/标题

^KEYTJ2GMD8V

> <span class="highlight" style="background-color: #f19837">1.6 学习资料查找</span> ([p24](zotero://open-pdf/library/items/JFGTX7CT?page=24&annotation=XNYUP2DZ))
> 
> 🏷️ #📝/标题

^KEYXNYUP2DZ

> <span class="highlight" style="background-color: #f19837">1.7 给初学者的建议</span> ([p26](zotero://open-pdf/library/items/JFGTX7CT?page=26&annotation=MS2GXYAG))
> 
> 🏷️ #📝/标题

^KEYMS2GXYAG

> <span class="highlight" style="background-color: #e56eee">学习 STM32 千万不能浮躁，更加不能骄傲，初学者学习 STM32 会遇到很多问题和难点， 这个时候千万不能浮躁，不要带情绪，一定要静下心来，缕清思路，逐一攻克。</span> ([p26](zotero://open-pdf/library/items/JFGTX7CT?page=26&annotation=N6MBQDES))

^KEYN6MBQDES

> <span class="highlight" style="background-color: #f19837">第二章 STM32 简介</span> ([p28](zotero://open-pdf/library/items/JFGTX7CT?page=28&annotation=BZLREBCJ))
> 
> 🏷️ #📝/标题

^KEYBZLREBCJ

> <span class="highlight" style="background-color: #f19837">2.1 初识 STM32</span> ([p28](zotero://open-pdf/library/items/JFGTX7CT?page=28&annotation=C7QFRRSY))
> 
> 🏷️ #📝/标题

^KEYC7QFRRSY

> <span class="highlight" style="background-color: #e56eee">最少仅 2 个 IO 口即可实现仿真调试</span> ([p28](zotero://open-pdf/library/items/JFGTX7CT?page=28&annotation=Q2D7GEUR))

^KEYQ2D7GEUR

> <span class="highlight" style="background-color: #f19837">2.2 STM32F103 资源简介</span> ([p29](zotero://open-pdf/library/items/JFGTX7CT?page=29&annotation=IJUEYLRK))
> 
> 🏷️ #📝/标题

^KEYIJUEYLRK

> <span class="highlight" style="background-color: #f19837">2.3 STM32F103 设计选型</span> ([p29](zotero://open-pdf/library/items/JFGTX7CT?page=29&annotation=W2C7TLQ3))
> 
> 🏷️ #📝/标题

^KEYW2C7TLQ3

> <span class="highlight" style="background-color: #f19837">2.3.1 STM32 系列</span> ([p29](zotero://open-pdf/library/items/JFGTX7CT?page=29&annotation=NQYNNRHW))
> 
> 🏷️ #📝/标题

^KEYNQYNNRHW

> <span class="highlight" style="background-color: #e56eee">STM32 主要分两大块，MCU 和 MPU，MCU 就是我们常见的 STM32 微控制 器，不能跑 Linux，而 MPU 则是 ST 在 19 年才推出的微处理器，可以跑 Linux</span> ([p30](zotero://open-pdf/library/items/JFGTX7CT?page=30&annotation=9YSN6SXZ))

^KEY9YSN6SXZ

> <span class="highlight" style="background-color: #e56eee">STM32 MCU 提供了包括：基础入门、混合信号、高性能、超低功耗和无线等 5 方面应用 的产品型号</span> ([p30](zotero://open-pdf/library/items/JFGTX7CT?page=30&annotation=SJKPRYC7))

^KEYSJKPRYC7

> <span class="highlight" style="background-color: #f19837">2.3.2 STM32 命名</span> ([p30](zotero://open-pdf/library/items/JFGTX7CT?page=30&annotation=GWM76DPR))
> 
> 🏷️ #📝/标题

^KEYGWM76DPR

> <span class="highlight" style="background-color: #e56eee">如图所示，STM32 的产品名字里面包含了：家族、类别、特定功能、引脚数、闪存容量、</span> ([p30](zotero://open-pdf/library/items/JFGTX7CT?page=30&annotation=B4EMZ7BG))

^KEYB4EMZ7BG

> <span class="highlight" style="background-color: #e56eee">封装、温度范围等重要信息</span> ([p31](zotero://open-pdf/library/items/JFGTX7CT?page=31&annotation=N5F68HEV))

^KEYN5F68HEV

> <span class="highlight" style="background-color: #f19837">2.3.3 STM32 选型</span> ([p31](zotero://open-pdf/library/items/JFGTX7CT?page=31&annotation=5RTJ4Z9T))

^KEY5RTJ4Z9T

> <span class="highlight" style="background-color: #e56eee">由高到低原则</span> ([p31](zotero://open-pdf/library/items/JFGTX7CT?page=31&annotation=3PFC2DNH))
> 
> 🏷️ #📝/重点

^KEY3PFC2DNH

> <span class="highlight" style="background-color: #e56eee">由大到小原则</span> ([p31](zotero://open-pdf/library/items/JFGTX7CT?page=31&annotation=JAU8MYIT))
> 
> 🏷️ #📝/重点

^KEYJAU8MYIT

> <span class="highlight" style="background-color: #f19837">2.3.4 STM32 设计</span> ([p31](zotero://open-pdf/library/items/JFGTX7CT?page=31&annotation=D85SEYTS))
> 
> 🏷️ #📝/标题

^KEYD85SEYTS

> <span class="highlight" style="background-color: #e56eee">STM32F103 数据 手册，里面对 STM32F103 的 IO 定义和说明有非常详细的描述</span> ([p31](zotero://open-pdf/library/items/JFGTX7CT?page=31&annotation=KC8IBX2U))
> 
> 🏷️ #📝/重点

^KEYKC8IBX2U

> <span class="image#e56eee">null</span>数据手册各章节内容概要 ([p32](zotero://open-pdf/library/items/JFGTX7CT?page=32&annotation=A37KAP46))

^KEYA37KAP46

> <span class="highlight" style="background-color: #e56eee">最重要的莫过于引脚定义这一章节 了</span> ([p32](zotero://open-pdf/library/items/JFGTX7CT?page=32&annotation=FG89VCQ8))
> 
> 🏷️ #📝/重点

^KEYFG89VCQ8

> <span class="highlight" style="background-color: #e56eee">STM32F103ZET6 引脚定义如表 2.3.4.2 所示</span> ([p32](zotero://open-pdf/library/items/JFGTX7CT?page=32&annotation=INZL96X4))
> 
> 🏷️ #📝/重点

^KEYINZL96X4

> <span class="image#e56eee">null</span>引脚定义表具体说明 ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=79EF69LX))

^KEY79EF69LX

> <span class="highlight" style="background-color: #e56eee">最小系统就是保证 MCU 正常运行的最低要求，一般是指 MCU 的供电、复位、晶振、BOOT 等部分。</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=LLRMR36E))
> 
> 🏷️ #📝/重点

^KEYLLRMR36E

> <span class="highlight" style="background-color: #e56eee">VDD/VSS</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=L978S6WY))
> 
> 🏷️ #📝/重点

^KEYL978S6WY

> <span class="highlight" style="background-color: #e56eee">给 STM32 供电</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=2KZ6VXR5))
> 
> 🏷️ #📝/重点

^KEY2KZ6VXR5

> <span class="highlight" style="background-color: #e56eee">VDDA/VSSA</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=P5UE3L8Z))
> 
> 🏷️ #📝/重点

^KEYP5UE3L8Z

> <span class="highlight" style="background-color: #e56eee">给 STM32 内部模拟部分供电</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=DZ9GYH3R))
> 
> 🏷️ #📝/重点

^KEYDZ9GYH3R

> <span class="highlight" style="background-color: #e56eee">VREF+/VREF-</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=CC5QFCYY))
> 
> 🏷️ #📝/重点

^KEYCC5QFCYY

> <span class="highlight" style="background-color: #e56eee">给 STM32 内部 ADC/DAC 提供参考电压</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=IDAR8PYW))
> 
> 🏷️ #📝/重点

^KEYIDAR8PYW

> <span class="highlight" style="background-color: #e56eee">VBAT</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=WNTZUS44))
> 
> 🏷️ #📝/重点

^KEYWNTZUS44

> <span class="highlight" style="background-color: #e56eee">给 RTC 和后备区域供电</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=MC4VC7ZI))
> 
> 🏷️ #📝/重点

^KEYMC4VC7ZI

> <span class="highlight" style="background-color: #e56eee">一般 VBAT 接电池，用于断电维持 RTC 工作，如不需要，直接将 VBAT 接 VDD 即可</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=DJ2TBVUJ))
> 
> 🏷️ #📝/重点

^KEYDJ2TBVUJ

> <span class="highlight" style="background-color: #e56eee">NRST</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=48GBMDAT))
> 
> 🏷️ #📝/重点

^KEY48GBMDAT

> <span class="highlight" style="background-color: #e56eee">用于复位 STM32，低电平复位</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=L5T8S9W2))
> 
> 🏷️ #📝/重点

^KEYL5T8S9W2

> <span class="highlight" style="background-color: #e56eee">BOOT0/BOOT1</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=CXPR6GJD))
> 
> 🏷️ #📝/重点

^KEYCXPR6GJD

> <span class="highlight" style="background-color: #e56eee">启动选择引脚</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=TTYIBMEY))
> 
> 🏷️ #📝/重点

^KEYTTYIBMEY

> <span class="highlight" style="background-color: #e56eee">OSC_IN / OSC_OUT</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=Y4VUU3SR))
> 
> 🏷️ #📝/重点

^KEYY4VUU3SR

> <span class="highlight" style="background-color: #e56eee">外部 HSE 晶振引脚</span> ([p33](zotero://open-pdf/library/items/JFGTX7CT?page=33&annotation=PPCGCKWU))
> 
> 🏷️ #📝/重点

^KEYPPCGCKWU

> <span class="highlight" style="background-color: #e56eee">OSC32_IN / OSC32_OUT</span> ([p34](zotero://open-pdf/library/items/JFGTX7CT?page=34&annotation=F7CIDMIF))
> 
> 🏷️ #📝/重点

^KEYF7CIDMIF

> <span class="highlight" style="background-color: #e56eee">外部 LSE 晶振引脚</span> ([p34](zotero://open-pdf/library/items/JFGTX7CT?page=34&annotation=8J5Z2DD3))
> 
> 🏷️ #📝/重点

^KEY8J5Z2DD3

> <span class="highlight" style="background-color: #e56eee">SWCLK/SWDIO</span> ([p34](zotero://open-pdf/library/items/JFGTX7CT?page=34&annotation=XIJZJPFP))
> 
> 🏷️ #📝/重点

^KEYXIJZJPFP

> <span class="highlight" style="background-color: #e56eee">SWD 调试引脚，用于调试 STM32 程序</span>
> 
> SWD：Serial Wire Debug，即串行线调试 ([p34](zotero://open-pdf/library/items/JFGTX7CT?page=34&annotation=JTC2XH9K))
> 
> 🏷️ #📝/重点

^KEYJTC2XH9K

> <span class="highlight" style="background-color: #e56eee">遵循： 先分配特定外设 IO，再分配通用 IO，最后微调的原则</span> ([p34](zotero://open-pdf/library/items/JFGTX7CT?page=34&annotation=AJAKTRQA))
> 
> 🏷️ #📝/重点

^KEYAJAKTRQA

> <span class="image#e56eee">null</span>特定外设IO口分配 ([p34](zotero://open-pdf/library/items/JFGTX7CT?page=34&annotation=37V2JZ3C))

^KEY37V2JZ3C

> <span class="highlight" style="background-color: #f19837">第三章 开发环境搭建</span> ([p35](zotero://open-pdf/library/items/JFGTX7CT?page=35&annotation=UJ62QVSL))
> 
> 🏷️ #📝/标题

^KEYUJ62QVSL

> <span class="highlight" style="background-color: #f19837">3.1 常用开发工具简介</span> ([p35](zotero://open-pdf/library/items/JFGTX7CT?page=35&annotation=HDDSX8W7))
> 
> 🏷️ #📝/标题

^KEYHDDSX8W7

> <span class="highlight" style="background-color: #f19837">3.2 MDK 安装</span> ([p35](zotero://open-pdf/library/items/JFGTX7CT?page=35&annotation=BI5BFB8J))
> 
> 🏷️ #📝/标题

^KEYBI5BFB8J

> <span class="highlight" style="background-color: #f19837">3.3 仿真器驱动安装</span> ([p36](zotero://open-pdf/library/items/JFGTX7CT?page=36&annotation=VGBR8L5A))
> 
> 🏷️ #📝/标题

^KEYVGBR8L5A

> <span class="highlight" style="background-color: #e56eee">DAP 仿真器（CMSIS-DAP Debugger），DAP 仿真器在 MDK 下是免驱动的（无需安装 驱动），即插即用，非常方便。</span> ([p36](zotero://open-pdf/library/items/JFGTX7CT?page=36&annotation=KA85E9U4))
> 
> 🏷️ #📝/重点

^KEYKA85E9U4

> <span class="highlight" style="background-color: #f19837">3.4 CH340 USB 虚拟串口驱动安装</span> ([p36](zotero://open-pdf/library/items/JFGTX7CT?page=36&annotation=WHFXL6S7))
> 
> 🏷️ #📝/标题

^KEYWHFXL6S7

> <span class="highlight" style="background-color: #e56eee">安装 CH340 USB 虚拟串口驱动，以便我们使用电脑通过 USB 和 STM32 进行串口通信。</span>
> 
> CH340 USB虚拟串口驱动的作用 ([p36](zotero://open-pdf/library/items/JFGTX7CT?page=36&annotation=XXSU5QAA))
> 
> 🏷️ #📝/重点

^KEYXXSU5QAA

> <span class="highlight" style="background-color: #f19837">第四章 STM32 初体验</span> ([p38](zotero://open-pdf/library/items/JFGTX7CT?page=38&annotation=5F6I2U8Y))
> 
> 🏷️ #📝/重点

^KEY5F6I2U8Y

> <span class="highlight" style="background-color: #f19837">4.1 使用 MDK5 编译例程</span> ([p38](zotero://open-pdf/library/items/JFGTX7CT?page=38&annotation=BDHRLA63))
> 
> 🏷️ #📝/重点

^KEYBDHRLA63

> <span class="highlight" style="background-color: #e56eee">① 是编译按钮，表示编译当前工程项目文件，如果之前已经编译过了，则只会编译有改动 的文件。所以一般第一次会比较耗时间，后续因为只编译改动文件，从而大大缩短了编 译时间。该按钮可以通过 F7 快捷键进行操作。 ② 是重新编译当前工程所有文件按钮，工程代码较多时全部重新编译会耗费比较多的时 间，建议少用</span>
> 
> build（编译）和 rebuild（重编译）的区别。 ([p40](zotero://open-pdf/library/items/JFGTX7CT?page=40&annotation=238X27QQ))
> 
> 🏷️ #📝/重点

^KEY238X27QQ

> <span class="highlight" style="background-color: #e56eee">图中： Code：表示代码大小，占用 5442 字节。 RO-Data：表示只读数据所占的空间大小，一般是指 const 修饰的数据大小。 RW-Data：表示有初值（且非 0）的可读写数据所占的空间大小，它同时占用 FLASH（存 放其初始值）和 RAM 空间。 ZI-Data：表示初始化为 0 的可读写数据所占空间大小，它只占用 RAM 空间。 因此图 4.1.6 的提示信息表示：代码总大小（Porgram Size）为：FLASH 占用 5832 字节（Code + RO + RW），SRAM 占用 1928 字节（RW + ZI）；成功创建了 Hex 文件（可执行文件，放在 Output 目录下）；编译 0 错误，0 警告；编译耗时 2 秒钟。</span>
> 
> 编译提示信息 ([p40](zotero://open-pdf/library/items/JFGTX7CT?page=40&annotation=AVFILY45))
> 
> 🏷️ #📝/重点

^KEYAVFILY45

> <span class="highlight" style="background-color: #e56eee">Output 文件夹下除了.hex 文件还有很多其他文件（.axf、.htm、.dep、.lnp、.o、.d、.lst 等）， 这些文件是编译过程所产生的中间文件</span> ([p41](zotero://open-pdf/library/items/JFGTX7CT?page=41&annotation=ZFT4S93G))
> 
> 🏷️ #📝/重点

^KEYZFT4S93G

> <span class="highlight" style="background-color: #f19837">4.2 使用串口下载程序</span> ([p41](zotero://open-pdf/library/items/JFGTX7CT?page=41&annotation=PF2WASJ4))
> 
> 🏷️ #📝/标题

^KEYPF2WASJ4

> <span class="highlight" style="background-color: #e56eee">推荐使用 SWD 下载</span> ([p41](zotero://open-pdf/library/items/JFGTX7CT?page=41&annotation=MFXFZSF9))
> 
> 🏷️ #📝/重点

^KEYMFXFZSF9

> <span class="highlight" style="background-color: #e56eee">ST LINK、 CMSIS、DAP</span>
> 
> 这些是仿真器 ([p41](zotero://open-pdf/library/items/JFGTX7CT?page=41&annotation=DSSMKF94))
> 
> 🏷️ #📝/重点

^KEYDSSMKF94

> <span class="highlight" style="background-color: #e56eee">表中 BOOT0 和 BOOT1 是 STM32 芯片上面的两个引脚，用于控制 STM32 的启动方式</span>
> 
> BOOT0和BOOT1控制STM32是启动方式 ([p41](zotero://open-pdf/library/items/JFGTX7CT?page=41&annotation=3BSB7RSL))
> 
> 🏷️ #📝/重点

^KEY3BSB7RSL

> <span class="highlight" style="background-color: #e56eee">下面，我们就一步步教大家如何在实验平台上利用 USB 串口来下载代码。</span> ([p42](zotero://open-pdf/library/items/JFGTX7CT?page=42&annotation=KQ2GM8BH))
> 
> 🏷️ #📝/重点

^KEYKQ2GM8BH

> <span class="highlight" style="background-color: #e56eee">a) ①处的 USB_UART 通过 USB 线连接电脑，实现 USB 转串口，同时支持给开发板供 电。 b) 确保电源灯②亮起（蓝色），如果不亮检查供电和电源开关③是否按下？ c) 确保 P4 端子的 RXD 和 PA9（STM32 的 TXD），TXD 和 PA10(STM32 的 RXD)通过 跳线帽连接起来（标号④），这样我们就把 CH340C 和 STM32 的串口 1 连接上了。 d) ⑤处的 BOOT 设置为 BOOT0（简称 B0）和 BOOT1（简称 B1）都接 GND（一键下载 电路自动控制，待会介绍）。</span>
> 
> 利用串口下载代码流程 ([p42](zotero://open-pdf/library/items/JFGTX7CT?page=42&annotation=VZ9QJQ3Q))
> 
> 🏷️ #📝/重点

^KEYVZ9QJQ3Q

> <span class="highlight" style="background-color: #e56eee">一键下载电路</span>
> 
> 一键下载电路的作用：简化下载和运行程序的流程 ([p43](zotero://open-pdf/library/items/JFGTX7CT?page=43&annotation=TI6ZCCG2))
> 
> 🏷️ #📝/重点

^KEYTI6ZCCG2

> <span class="highlight" style="background-color: #e56eee">串口程序下载需要用到：ATK-XISP 这个上位机软件。这个软件可以实现对 STM32F1 到 STM32H7 等系列芯片的串口编程。</span> ([p43](zotero://open-pdf/library/items/JFGTX7CT?page=43&annotation=9V4KD4K5))
> 
> 🏷️ #📝/重点

^KEY9V4KD4K5

> <span class="highlight" style="background-color: #f19837">4.3 使用 DAP 下载与调试程序</span> ([p44](zotero://open-pdf/library/items/JFGTX7CT?page=44&annotation=CVLPA9IG))
> 
> 🏷️ #📝/标题

^KEYCVLPA9IG

> <span class="highlight" style="background-color: #f19837">4.3.1 使用 DAP 下载程序</span> ([p45](zotero://open-pdf/library/items/JFGTX7CT?page=45&annotation=YS7I69YF))
> 
> 🏷️ #📝/标题

^KEYYS7I69YF

> <span class="highlight" style="background-color: #e56eee">Options for Target</span> ([p45](zotero://open-pdf/library/items/JFGTX7CT?page=45&annotation=Z98I7SHI))
> 
> 🏷️ #📝/重点

^KEYZ98I7SHI

> <span class="highlight" style="background-color: #e56eee">选择仿真工具</span> ([p45](zotero://open-pdf/library/items/JFGTX7CT?page=45&annotation=ZL84SWCE))
> 
> 🏷️ #📝/重点

^KEYZL84SWCE

> <span class="highlight" style="background-color: #e56eee">直接运行到 main 函数</span> ([p45](zotero://open-pdf/library/items/JFGTX7CT?page=45&annotation=959M9FW5))
> 
> 🏷️ #📝/重点

^KEY959M9FW5

> <span class="highlight" style="background-color: #e56eee">表示 MDK 找到了 ATK CMSIS-DAP 仿真器</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=C54DJSUT))
> 
> 🏷️ #📝/重点

^KEYC54DJSUT

> <span class="highlight" style="background-color: #e56eee">设置接口方式，这里选择 SW</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=FL32H8QS))
> 
> 🏷️ #📝/重点

^KEYFL32H8QS

> <span class="highlight" style="background-color: #e56eee">表示 MDK 通过仿真器的 SW 接口找到了目标芯片</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=PECL84M7))
> 
> 🏷️ #📝/重点

^KEYPECL84M7

> <span class="highlight" style="background-color: #e56eee">设置下载时的目标编程器</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=TZ7L3N8F))
> 
> 🏷️ #📝/重点

^KEYTZ7L3N8F

> <span class="highlight" style="background-color: #e56eee">FLASH 算法设置</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=6NEUVH5I))
> 
> 🏷️ #📝/重点

^KEY6NEUVH5I

> <span class="highlight" style="background-color: #e56eee">自动设置 flash 算法</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=QL5QTXU8))
> 
> 🏷️ #📝/重点

^KEYQL5QTXU8

> <span class="highlight" style="background-color: #e56eee">选中 Reset and Run 选项，以实现在编程后自动运行</span> ([p46](zotero://open-pdf/library/items/JFGTX7CT?page=46&annotation=368SAIGE))
> 
> 🏷️ #📝/重点

^KEY368SAIGE

> <span class="highlight" style="background-color: #f19837">4.3.2 使用 DAP 仿真调试程序</span> ([p47](zotero://open-pdf/library/items/JFGTX7CT?page=47&annotation=BQIIHBM9))
> 
> 🏷️ #📝/标题

^KEYBQIIHBM9

> <span class="highlight" style="background-color: #e56eee">开始/停止仿真按钮</span> ([p47](zotero://open-pdf/library/items/JFGTX7CT?page=47&annotation=9PLW7F5N))
> 
> 🏷️ #📝/重点

^KEY9PLW7F5N

> <span class="image#e56eee">null</span>仿真窗口介绍 ([p47](zotero://open-pdf/library/items/JFGTX7CT?page=47&annotation=HB8SNN3H))

^KEYHB8SNN3H

> <span class="highlight" style="background-color: #e56eee">Register：寄存器窗口</span> ([p47](zotero://open-pdf/library/items/JFGTX7CT?page=47&annotation=GS45QL4W))
> 
> 🏷️ #📝/重点

^KEYGS45QL4W

> <span class="highlight" style="background-color: #e56eee">该选项卡一般用于查看程序运行时间，或者比较高级的 bug 查找（涉及到分析 R0~R14 数据是否异常了）</span> ([p47](zotero://open-pdf/library/items/JFGTX7CT?page=47&annotation=DCIH4NYA))
> 
> 🏷️ #📝/重点

^KEYDCIH4NYA

> <span class="highlight" style="background-color: #e56eee">Disassembly：反汇编窗口</span> ([p47](zotero://open-pdf/library/items/JFGTX7CT?page=47&annotation=MTP5YIIP))
> 
> 🏷️ #📝/重点

^KEYMTP5YIIP

> <span class="highlight" style="background-color: #e56eee">代码窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=TPFUSNRW))
> 
> 🏷️ #📝/重点

^KEYTPFUSNRW

> <span class="highlight" style="background-color: #e56eee">黄色的三角形表示将要执行的代码，绿色的三角形 表示当前光标所在代码</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=E2UXWS6R))
> 
> 🏷️ #📝/重点

^KEYE2UXWS6R

> <span class="highlight" style="background-color: #e56eee">Call Stack + Locals：调用关系&局部变量窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=7HNBN3MK))
> 
> 🏷️ #📝/重点

^KEY7HNBN3MK

> <span class="highlight" style="background-color: #e56eee">通过该窗口可以查看函数调用关系，以 及函数的局部变量</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=8T5HS5GF))
> 
> 🏷️ #📝/重点

^KEY8T5HS5GF

> <span class="image#e56eee">null</span>Debug工具条介绍 ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=WKII4X7L))

^KEYWKII4X7L

> <span class="highlight" style="background-color: #e56eee">其功能等同于硬件上按复位按钮。</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=QHDVYWJ6))
> 
> 🏷️ #📝/重点

^KEYQHDVYWJ6

> <span class="highlight" style="background-color: #e56eee">该按钮用来快速执行到断点处</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=CNQERWBI))
> 
> 🏷️ #📝/重点

^KEYCNQERWBI

> <span class="highlight" style="background-color: #e56eee">通过按该按钮，就可以使程序停止 下来，进入到单步调试状态</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=W993ZH9J))
> 
> 🏷️ #📝/重点

^KEYW993ZH9J

> <span class="highlight" style="background-color: #e56eee">实现执行到某个函数里面去的功能</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=7LE6LZ9X))
> 
> 🏷️ #📝/重点

^KEY7LE6LZ9X

> <span class="highlight" style="background-color: #e56eee">在碰到有函数的地方，通过该按钮就可以单步执行过这个函数</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=M3R8VFTT))
> 
> 🏷️ #📝/重点

^KEYM3R8VFTT

> <span class="highlight" style="background-color: #e56eee">是在进入了函数单步调试的时候，有时候可能不必再执行该函数的剩余 部分了，通过该按钮就可以一步执行完该函数的余部分，并跳出函数，回到函数被调用的位置。</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=JRJ4FTEC))
> 
> 🏷️ #📝/重点

^KEYJRJ4FTEC

> <span class="highlight" style="background-color: #e56eee">该按钮可以迅速的使程序运行到光标处</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=4WLVE9M3))
> 
> 🏷️ #📝/重点

^KEY4WLVE9M3

> <span class="highlight" style="background-color: #e56eee">查看汇编代码</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=QUGIU8BK))
> 
> 🏷️ #📝/重点

^KEYQUGIU8BK

> <span class="highlight" style="background-color: #e56eee">显示调用关系&局部变量窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=RPLWAQ85))
> 
> 🏷️ #📝/重点

^KEYRPLWAQ85

> <span class="highlight" style="background-color: #e56eee">提供 2 个观察窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=BDIR5463))
> 
> 🏷️ #📝/重点

^KEYBDIR5463

> <span class="highlight" style="background-color: #e56eee">弹出一个显示变量的窗 口，输入你所想要观察的变量/表达式，即可查看其值</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=9XBYCYAG))
> 
> 🏷️ #📝/重点

^KEY9XBYCYAG

> <span class="highlight" style="background-color: #e56eee">提供 4 个内存查看窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=W8TCSUMZ))
> 
> 🏷️ #📝/重点

^KEYW8TCSUMZ

> <span class="highlight" style="background-color: #e56eee">可以在里面输入你要查看的内存地址，然后观察这一片内存的变化情况。</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=T865G7XA))
> 
> 🏷️ #📝/重点

^KEYT865G7XA

> <span class="highlight" style="background-color: #e56eee">提供 4 个串口打印窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=4J9V9ZN6))
> 
> 🏷️ #📝/重点

^KEY4J9V9ZN6

> <span class="highlight" style="background-color: #e56eee">用来显示从串口打印出来的内容。</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=U6STXCBY))
> 
> 🏷️ #📝/重点

^KEYU6STXCBY

> <span class="highlight" style="background-color: #e56eee">有 6 个选项</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=XPXW2XS5))
> 
> 🏷️ #📝/重点

^KEYXPXW2XS5

> <span class="highlight" style="background-color: #e56eee">逻辑分析 窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=JJMUUW7X))
> 
> 🏷️ #📝/重点

^KEYJJMUUW7X

> <span class="highlight" style="background-color: #e56eee">观察这 些 IO 口的电平变化情况</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=NHM8H5UE))
> 
> 🏷️ #📝/重点

^KEYNHM8H5UE

> <span class="highlight" style="background-color: #e56eee">提供各种外设寄存器的查看窗口</span> ([p48](zotero://open-pdf/library/items/JFGTX7CT?page=48&annotation=DUNXM236))
> 
> 🏷️ #📝/重点

^KEYDUNXM236

> <span class="highlight" style="background-color: #e56eee">某些全局变量，我们在程序还没运行到其所在文件的时候，MDK 仿真时可能不 会显示其值（如提示：cannot evaluate），当我们运行到其所在文件，并实际使用到的时候，此时 就会显示其值出来了！</span> ([p50](zotero://open-pdf/library/items/JFGTX7CT?page=50&annotation=L5FLT7HE))
> 
> 🏷️ #📝/重点

^KEYL5FLT7HE

> <span class="highlight" style="background-color: #e56eee">此时，我们可以从 Call Stack + Locals 窗口看到函数的调用关系，其原则是：从下往上看， 即下一个函数调用了上一个函数</span>
> 
> 通过窗口查看函数调用关系时，要从下往上看。 ([p51](zotero://open-pdf/library/items/JFGTX7CT?page=51&annotation=ZMK5ZSVD))
> 
> 🏷️ #📝/重点

^KEYZMK5ZSVD

> <span class="highlight" style="background-color: #f19837">4.3.3 仿真调试注意事项</span> ([p51](zotero://open-pdf/library/items/JFGTX7CT?page=51&annotation=ZANNX65K))
> 
> 🏷️ #📝/标题

^KEYZANNX65K

> <span class="highlight" style="background-color: #e56eee">由于 MDK5.23 以后对中文支持不是很好，具体现象是：在仿真的时候，当有断点未清 除时点击 结束仿真，会出现如图 4.3.3.1 所示的报错：</span>
> 
> 仿真结束前将所有设置的断点都清除掉 ([p51](zotero://open-pdf/library/items/JFGTX7CT?page=51&annotation=XNKN3I2K))
> 
> 🏷️ #📝/重点

^KEYXNKN3I2K

> <span class="highlight" style="background-color: #e56eee">a，仿真结束前将所有设置的断点都清除掉</span> ([p51](zotero://open-pdf/library/items/JFGTX7CT?page=51&annotation=Y6GPA9LY))
> 
> 🏷️ #📝/重点

^KEYY6GPA9LY

> <span class="highlight" style="background-color: #e56eee">b，将工程路径改 浅，并改成全英文路径</span> ([p51](zotero://open-pdf/library/items/JFGTX7CT?page=51&annotation=WPYWDZGP))
> 
> 🏷️ #📝/重点

^KEYWPYWDZGP

> <span class="highlight" style="background-color: #e56eee">只要整个路径不超过 10 个汉字，一般就不会报错</span> ([p51](zotero://open-pdf/library/items/JFGTX7CT?page=51&annotation=UE75VQBD))
> 
> 🏷️ #📝/重点

^KEYUE75VQBD

> <span class="highlight" style="background-color: #e56eee">先根据代码运行的实际现象 分析问题，确定最可能出问题的地方，然后在相应的位置放置断点，查看变量，查看寄 存器，分析运行状态和预期结果是否一致？从而找到问题原因，解决 bug。</span>
> 
> 如何调试代码 ([p52](zotero://open-pdf/library/items/JFGTX7CT?page=52&annotation=2VWUGKQV))
> 
> 🏷️ #📝/重点

^KEY2VWUGKQV

> <span class="highlight" style="background-color: #f19837">4.4 MDK5 使用技巧</span> ([p52](zotero://open-pdf/library/items/JFGTX7CT?page=52&annotation=NQ2QNYNF))
> 
> 🏷️ #📝/标题

^KEYNQ2QNYNF

> <span class="highlight" style="background-color: #f19837">4.4.1 文本美化</span> ([p52](zotero://open-pdf/library/items/JFGTX7CT?page=52&annotation=PYSC3CE8))
> 
> 🏷️ #📝/标题

^KEYPYSC3CE8

> <span class="highlight" style="background-color: #e56eee">点击 (配置对话框)</span> ([p52](zotero://open-pdf/library/items/JFGTX7CT?page=52&annotation=U7ZTBB8V))
> 
> 🏷️ #📝/重点

^KEYU7ZTBB8V

> <span class="highlight" style="background-color: #e56eee">设置代码编辑器字体</span> ([p53](zotero://open-pdf/library/items/JFGTX7CT?page=53&annotation=YWKW9Y4R))
> 
> 🏷️ #📝/重点

^KEYYWKW9Y4R

> <span class="highlight" style="background-color: #e56eee">设置编辑器的空格可见</span> ([p53](zotero://open-pdf/library/items/JFGTX7CT?page=53&annotation=36L8BHZL))
> 
> 🏷️ #📝/重点

^KEY36L8BHZL

> <span class="highlight" style="background-color: #e56eee">所有空格使用“.”替代，TAB 使用“→”替代</span> ([p53](zotero://open-pdf/library/items/JFGTX7CT?page=53&annotation=GFJ5MLUU))
> 
> 🏷️ #📝/重点

^KEYGFJ5MLUU

> <span class="highlight" style="background-color: #e56eee">设置 C/C++文件，TAB 键的大小为 4 个字符，且字符使用空格替代</span> ([p53](zotero://open-pdf/library/items/JFGTX7CT?page=53&annotation=Z64TRNYS))
> 
> 🏷️ #📝/重点

^KEYZ64TRNYS

> <span class="highlight" style="background-color: #e56eee">Colors & Fonts 选项卡</span> ([p53](zotero://open-pdf/library/items/JFGTX7CT?page=53&annotation=DJXEYV2X))
> 
> 🏷️ #📝/重点

^KEYDJXEYV2X

> <span class="highlight" style="background-color: #e56eee">C/C++ Editor Files</span> ([p53](zotero://open-pdf/library/items/JFGTX7CT?page=53&annotation=5IYH9FES))
> 
> 🏷️ #📝/重点

^KEY5IYH9FES

> <span class="highlight" style="background-color: #e56eee">点击 User Keywords 选项卡，设置用户定义关键字，以便用户自定义关键字也显示 对应的颜色（对应图 4.4.1.3 中的 User Keyword/Lable 颜色）</span>
> 
> 使用户自定义关键字也显示对应颜色 ([p54](zotero://open-pdf/library/items/JFGTX7CT?page=54&annotation=UM2PKEX6))
> 
> 🏷️ #📝/重点

^KEYUM2PKEX6

> <span class="highlight" style="background-color: #f19837">4.4.2 语法检测&代码提示</span> ([p54](zotero://open-pdf/library/items/JFGTX7CT?page=54&annotation=GVFGU8KL))
> 
> 🏷️ #📝/标题

^KEYGVFGU8KL

> <span class="highlight" style="background-color: #e56eee">打开配置对话框，选择 Text Completion</span> ([p54](zotero://open-pdf/library/items/JFGTX7CT?page=54&annotation=RQWC8EJA))
> 
> 🏷️ #📝/重点

^KEYRQWC8EJA

> <span class="highlight" style="background-color: #e56eee">Strut / Class Members，用于开启结构体/类成员提示功能</span> ([p55](zotero://open-pdf/library/items/JFGTX7CT?page=55&annotation=IJBYJB3H))
> 
> 🏷️ #📝/重点

^KEYIJBYJB3H

> <span class="highlight" style="background-color: #e56eee">Function Parameters，用于开启函数参数提示功能</span> ([p55](zotero://open-pdf/library/items/JFGTX7CT?page=55&annotation=M39BDALS))
> 
> 🏷️ #📝/重点

^KEYM39BDALS

> <span class="highlight" style="background-color: #e56eee">Symbols after xx characters，用于开启代码提示功能，即在输入多少个字符以后，提示匹配 的内容（比如函数名字、结构体名字、变量名字等），这里默认设置 3 个字符以后，就开始提示。</span> ([p55](zotero://open-pdf/library/items/JFGTX7CT?page=55&annotation=QVVR483I))
> 
> 🏷️ #📝/重点

^KEYQVVR483I

> <span class="highlight" style="background-color: #e56eee">ENTER/TAB as fill-up character，使用回车和 TAB 键填充字符。</span> ([p55](zotero://open-pdf/library/items/JFGTX7CT?page=55&annotation=7JGTU2G6))
> 
> 🏷️ #📝/重点

^KEY7JGTU2G6

> <span class="highlight" style="background-color: #e56eee">Dynamic Syntax Checking，则用于开启动态语法检测</span> ([p55](zotero://open-pdf/library/items/JFGTX7CT?page=55&annotation=9CA4HAJ9))
> 
> 🏷️ #📝/重点

^KEY9CA4HAJ9

> <span class="highlight" style="background-color: #e56eee">语法动态检测这个功能，有的时候会误报</span> ([p55](zotero://open-pdf/library/items/JFGTX7CT?page=55&annotation=55JJSSEB))
> 
> 🏷️ #📝/重点

^KEY55JJSSEB

> <span class="highlight" style="background-color: #f19837">4.4.3 代码编辑技巧</span> ([p56](zotero://open-pdf/library/items/JFGTX7CT?page=56&annotation=49CLM4MQ))
> 
> 🏷️ #📝/标题

^KEY49CLM4MQ

> <span class="highlight" style="background-color: #e56eee">MDK 的 TAB 键支持块操作。也就 是可以让一片代码整体右移固定的几个位，也可以通过 SHIFT+TAB 键整体左移固定的几个位。</span> ([p56](zotero://open-pdf/library/items/JFGTX7CT?page=56&annotation=VGM32H9Z))
> 
> 🏷️ #📝/重点

^KEYVGM32H9Z

> <span class="highlight" style="background-color: #e56eee">Go to Definition Of</span> ([p58](zotero://open-pdf/library/items/JFGTX7CT?page=58&annotation=IIFK5BAG))
> 
> 🏷️ #📝/重点

^KEYIIFK5BAG

> <span class="highlight" style="background-color: #e56eee">注意要先在 Options for Target 的 Output 选项卡里面勾选 Browse Information 选项，再编译，再定位，否则无法定位！）</span> ([p58](zotero://open-pdf/library/items/JFGTX7CT?page=58&annotation=VWEPLFX5))
> 
> 🏷️ #📝/重点

^KEYVWEPLFX5

> <span class="highlight" style="background-color: #e56eee">第一个是快速打开头文件。</span> ([p60](zotero://open-pdf/library/items/JFGTX7CT?page=60&annotation=JBQG39SM))
> 
> 🏷️ #📝/重点

^KEYJBQG39SM

> <span class="highlight" style="background-color: #e56eee">第二个小技巧是查找替换功能。</span> ([p60](zotero://open-pdf/library/items/JFGTX7CT?page=60&annotation=WXEZNABR))
> 
> 🏷️ #📝/重点

^KEYWXEZNABR

> <span class="highlight" style="background-color: #e56eee">查找替换的快捷键是“CTRL+H”</span> ([p60](zotero://open-pdf/library/items/JFGTX7CT?page=60&annotation=F4LMDZG4))
> 
> 🏷️ #📝/重点

^KEYF4LMDZG4

> <span class="highlight" style="background-color: #e56eee">第三个小技巧是跨文件查找功能</span> ([p60](zotero://open-pdf/library/items/JFGTX7CT?page=60&annotation=7EBU6X6V))
> 
> 🏷️ #📝/重点

^KEY7EBU6X6V

> <span class="highlight" style="background-color: #e56eee">点击 IDE 上面的</span> ([p60](zotero://open-pdf/library/items/JFGTX7CT?page=60&annotation=D568JK7S))
> 
> 🏷️ #📝/重点

^KEYD568JK7S

> <span class="highlight" style="background-color: #f19837">第五章 STM32 基础知识入门</span> ([p62](zotero://open-pdf/library/items/JFGTX7CT?page=62&annotation=ZVVTC23Y))
> 
> 🏷️ #📝/标题

^KEYZVVTC23Y

> <span class="highlight" style="background-color: #f19837">5.1 C 语言基础知识复习</span> ([p62](zotero://open-pdf/library/items/JFGTX7CT?page=62&annotation=8YVCRYKD))
> 
> 🏷️ #📝/标题

^KEY8YVCRYKD

> <span class="highlight" style="background-color: #f19837">5.1.1 位操作</span> ([p62](zotero://open-pdf/library/items/JFGTX7CT?page=62&annotation=N277J94H))
> 
> 🏷️ #📝/标题

^KEYN277J94H

> <span class="highlight" style="background-color: #e56eee">用&操作符进行清零操作， 然后用|操作符设值。</span>
> 
> 先清零，再设值，不管以前该位是 1 还是 0 ([p62](zotero://open-pdf/library/items/JFGTX7CT?page=62&annotation=FV56L24C))
> 
> 🏷️ #📝/重点

^KEYFV56L24C

> <span class="highlight" style="background-color: #e56eee">将 CTRL 寄存器的第 1 位（从 0 开始算起）设置为 1</span>
> 
> “1 << 1”中：
> 
> 第一个 “1” 表示设置为 1 ；
> 
> 第一个 “1” 表示第 1 位（从 0 开始）。
> 
> 1 << 2 ：即将第 2 位设置为 1
> 
> 注意：实现该功能需要联合操作符 | 使用 ([p62](zotero://open-pdf/library/items/JFGTX7CT?page=62&annotation=SST5JY78))
> 
> 🏷️ #📝/重点

^KEYSST5JY78

> <span class="highlight" style="background-color: #e56eee">常用于清除某一个/某几个位。</span>
> 
> 注意：需要与前面的 & 操作符联用 ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=LGMGB4PB))
> 
> 🏷️ #📝/重点

^KEYLGMGB4PB

> <span class="highlight" style="background-color: #e56eee">^按位异或操作使用技巧</span>
> 
> 异或操作：相同为0，不同为1 ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=DINH465W))
> 
> 🏷️ #📝/重点

^KEYDINH465W

> <span class="highlight" style="background-color: #e56eee">非常适合用于控制某个位翻转</span>
> 
> 当你执行 \`GPIOB->ODR ^= 1 << 5;\` 操作时，假设GPIOB->ODR 的值为 \`10110010\`（假设为8位二进制数）。
> 
> 现在，让我们来看一下这个操作是如何执行的：
> 
> 1\. 创建一个只有特定位上为1的二进制数：\`1 << 5\`。这将产生一个二进制数 \`00100000\`。
> 
> 2\. 执行按位异或操作：将 \`GPIOB->ODR\` 的值与 \`00100000\` 进行按位异或。
> 
> 3\. 异或操作的结果为： \`10110010 ^ 00100000 = 10010010\`。
> 
> 这个操作只翻转了 \`GPIOB->ODR\` 寄存器的第5位，其他位的值保持不变。 ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=B6NGTHWQ))
> 
> 🏷️ #📝/重点

^KEYB6NGTHWQ

> <span class="highlight" style="background-color: #e56eee">执行一次该代码，就会使 PB5 的输出状态翻转一次</span> ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=5S3M7S7T))
> 
> 🏷️ #📝/重点

^KEY5S3M7S7T

> <span class="highlight" style="background-color: #f19837">5.1.2 define 宏定义</span>
> 
> 关于预处理的知识，查看obsidian文档——“预处理命令” ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=SY46ZGBZ))
> 
> 🏷️ #📝/标题

^KEYSY46ZGBZ

> <span class="highlight" style="background-color: #f19837">5.1.3 ifdef 条件编译</span> ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=VERJ7WXT))
> 
> 🏷️ #📝/标题

^KEYVERJ7WXT

> <span class="highlight" style="background-color: #e56eee">当标识符已经被定义过(一般是用#define 命令定义)，则对程序段 1 进行编译， 否则编译程序段 2。 其中#else 部分也可以没有</span> ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=2SQ492LH))
> 
> 🏷️ #📝/重点

^KEY2SQ492LH

> <span class="highlight" style="background-color: #f19837">5.1.4 extern 外部申明</span> ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=MSKSGU9C))
> 
> 🏷️ #📝/标题

^KEYMSKSGU9C

> <span class="highlight" style="background-color: #e56eee">C 语言中 extern 可以置于变量或者函数前，以表示变量或者函数的定义在别的文件中，提示编 译器遇到此变量和函数时在其他模块中寻找其定义。</span> ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=6JLJ4RKT))
> 
> 🏷️ #📝/重点

^KEY6JLJ4RKT

> <span class="highlight" style="background-color: #e56eee">对于 extern 申明变量可以多 次，但定义只有一次。</span> ([p63](zotero://open-pdf/library/items/JFGTX7CT?page=63&annotation=BDQ33GH4))
> 
> 🏷️ #📝/重点

^KEYBDQ33GH4

> <span class="highlight" style="background-color: #f19837">5.1.5 typedef 类型别名</span> ([p64](zotero://open-pdf/library/items/JFGTX7CT?page=64&annotation=L3ZFFS8B))
> 
> 🏷️ #📝/标题

^KEYL3ZFFS8B

> <span class="highlight" style="background-color: #e56eee">typedef 用于为现有类型创建一个新的名字，或称为类型别名</span> ([p64](zotero://open-pdf/library/items/JFGTX7CT?page=64&annotation=2V7EVNVD))
> 
> 🏷️ #📝/重点

^KEY2V7EVNVD

> <span class="highlight" style="background-color: #f19837">5.1.6 结构体</span> ([p64](zotero://open-pdf/library/items/JFGTX7CT?page=64&annotation=PK2VZ2F3))
> 
> 🏷️ #📝/标题

^KEYPK2VZ2F3

> <span class="highlight" style="background-color: #e56eee">在以后的开发过程中，如果你的变量定义过多， 如果某几个变量是用来描述某一个对象，你可以考虑将这些变量定义在结构体中，这样也许可 以提高你的代码的可读性。</span>
> 
> 结构体的作用 ([p65](zotero://open-pdf/library/items/JFGTX7CT?page=65&annotation=P4ZCHSKJ))
> 
> 🏷️ #📝/重点

^KEYP4ZCHSKJ

> <span class="highlight" style="background-color: #f19837">5.1.7 指针</span> ([p65](zotero://open-pdf/library/items/JFGTX7CT?page=65&annotation=7M9W3RE7))
> 
> 🏷️ #📝/标题

^KEY7M9W3RE7

> <span class="highlight" style="background-color: #f19837">5.2 寄存器基础知识</span> ([p66](zotero://open-pdf/library/items/JFGTX7CT?page=66&annotation=H29C3BFC))
> 
> 🏷️ #📝/标题

^KEYH29C3BFC

> <span class="highlight" style="background-color: #e56eee">把寄存器当成一些控制开关，控制包括内核及外设的各种状态。</span> ([p66](zotero://open-pdf/library/items/JFGTX7CT?page=66&annotation=QPTENUBE))
> 
> 🏷️ #📝/重点

^KEYQPTENUBE

> <span class="highlight" style="background-color: #e56eee">对于 STM32 来说， 其寄存器是 32 位的，一个 32 位的寄存器，可能会有 32 个控制功能，相当于 32 个开关</span> ([p66](zotero://open-pdf/library/items/JFGTX7CT?page=66&annotation=ITHQEVE7))
> 
> 🏷️ #📝/重点

^KEYITHQEVE7

> <span class="image#e56eee">null</span>寄存器分类：
> 
> 内核寄存器
> 
> 外设寄存器 ([p66](zotero://open-pdf/library/items/JFGTX7CT?page=66&annotation=YZGRED39))

^KEYYZGRED39

> <span class="highlight" style="background-color: #e56eee">内核寄存器，我们一般只需要关心中断控制寄存器和 SysTick 寄存器即可</span> ([p66](zotero://open-pdf/library/items/JFGTX7CT?page=66&annotation=G7SZ69WH))
> 
> 🏷️ #📝/重点

^KEYG7SZ69WH

> <span class="highlight" style="background-color: #e56eee">(*(unsigned int *))(0X40010C0C) = 0XFFFF;</span>
> 
> 这行代码是针对嵌入式系统中的内存地址进行的操作。它使用了类型转换和指针解引用的方式来将一个特定地址处的内存值设置为一个给定的值。
> 
> 让我们逐步解释：
> 
>  \`(unsigned int *)\`：这是一个类型转换操作符，将一个地址转换为指向无符号整数（unsigned int）的指针。这种转换告诉编译器，我们希望将地址视为一个指向无符号整数的指针。
> 
> \`(0X40010C0C)\`：这是一个十六进制数，表示一个特定的内存地址。在嵌入式系统中，这样的地址通常用于访问外设的寄存器或内存映射的特定区域。
> 
> \`*(unsigned int *)\`：这是一个指针解引用操作符，它将指针所指向的内存位置的值取出。
> 
> \`= 0XFFFF;\`：这是一个赋值操作符，将给定的值（0XFFFF，十进制为65535）赋给指针所指向的内存位置。
> 
> 因此，整个操作的含义是将地址为0X40010C0C的内存位置的值设置为0XFFFF，这通常用于直接操作硬件寄存器或者进行内存映射操作。 ([p67](zotero://open-pdf/library/items/JFGTX7CT?page=67&annotation=C99WPL63))
> 
> 🏷️ #📝/重点

^KEYC99WPL63

> <span class="highlight" style="background-color: #f19837">5.3 STM32F103 系统架构</span> ([p67](zotero://open-pdf/library/items/JFGTX7CT?page=67&annotation=3PEMY65S))
> 
> 🏷️ #📝/标题

^KEY3PEMY65S

> <span class="highlight" style="background-color: #e56eee">STM32F103 是 ST 公司基于 ARM 授权 Cortex M3 内核而设计的一款芯片</span> ([p67](zotero://open-pdf/library/items/JFGTX7CT?page=67&annotation=KQNJSSXQ))
> 
> 🏷️ #📝/重点

^KEYKQNJSSXQ

> <span class="highlight" style="background-color: #f19837">5.3.1 Cortex M3 内核 & 芯片</span> ([p67](zotero://open-pdf/library/items/JFGTX7CT?page=67&annotation=SXQI5DQM))
> 
> 🏷️ #📝/标题

^KEYSXQI5DQM

> <span class="highlight" style="background-color: #e56eee">ARM公司提供CM3内核和调试系统，其他的东西（外设（IIC、SPI、UART、 TIM等）、存储器（SRAM、FLASH等）、I/O等）由芯片制造商设计开发。</span> ([p67](zotero://open-pdf/library/items/JFGTX7CT?page=67&annotation=HBLPUJBJ))
> 
> 🏷️ #📝/重点

^KEYHBLPUJBJ

> <span class="highlight" style="background-color: #f19837">5.3.2 STM32 系统架构</span> ([p67](zotero://open-pdf/library/items/JFGTX7CT?page=67&annotation=WFBVBZHE))
> 
> 🏷️ #📝/标题

^KEYWFBVBZHE

> <span class="highlight" style="background-color: #e56eee">STM32F103的系统主要由：四个驱动单元（可以主动发起通信，图中①区域）和四个被动 单元（只能被驱动工作，图中②区域）组成，如表5.3.2.1所示：</span> ([p68](zotero://open-pdf/library/items/JFGTX7CT?page=68&annotation=A5T978T6))
> 
> 🏷️ #📝/重点

^KEYA5T978T6

> <span class="highlight" style="background-color: #e56eee">这里的驱动/被动单元都是指连接了总线矩阵的部分，未连接总线矩阵的部分，则不算作驱 动/被驱动单元。</span> ([p68](zotero://open-pdf/library/items/JFGTX7CT?page=68&annotation=GWV294XF))
> 
> 🏷️ #📝/重点

^KEYGWV294XF

> <span class="highlight" style="background-color: #e56eee">Cortex M3内核的指令总线，连接闪存指令接口（如：FLASH），用于获取指令</span> ([p68](zotero://open-pdf/library/items/JFGTX7CT?page=68&annotation=GPI5U4M8))
> 
> 🏷️ #📝/重点

^KEYGPI5U4M8

> <span class="highlight" style="background-color: #e56eee">被排除在驱动单元之外。</span> ([p68](zotero://open-pdf/library/items/JFGTX7CT?page=68&annotation=MRTVFR25))
> 
> 🏷️ #📝/重点

^KEYMRTVFR25

> <span class="highlight" style="background-color: #e56eee">Cortex M3内核的数据总线，连接闪存存储器数据接口（如：SRAM、FLASH等），用 于各种数据访问，如常量、变量等。</span> ([p68](zotero://open-pdf/library/items/JFGTX7CT?page=68&annotation=A3C67RJK))
> 
> 🏷️ #📝/重点

^KEYA3C67RJK

> <span class="highlight" style="background-color: #e56eee">Cortex M3内核的系统总线，连接所有外设（如：GPIO、SPI、IIC、TIM等），用于控 制各种外设工作，如配置各种外设相关寄存器等。</span> ([p68](zotero://open-pdf/library/items/JFGTX7CT?page=68&annotation=HALN29QL))
> 
> 🏷️ #📝/重点

^KEYHALN29QL

> <span class="highlight" style="background-color: #e56eee">可以实现数据的自动搬运，整个过程不需要CPU处理。</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=LDV4235E))
> 
> 🏷️ #📝/重点

^KEYLDV4235E

> <span class="highlight" style="background-color: #e56eee">，可以大大节省CPU</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=LSGIBRKI))
> 
> 🏷️ #📝/重点

^KEYLSGIBRKI

> <span class="highlight" style="background-color: #e56eee">可以实现内存到外设、 外设到内存、内存到内存的数据传输。</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=BF88B2UT))
> 
> 🏷️ #📝/重点

^KEYBF88B2UT

> <span class="highlight" style="background-color: #e56eee">内部FLASH即单片机的硬盘，用于代码/数据存储</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=NF2KLFHV))
> 
> 🏷️ #📝/重点

^KEYNF2KLFHV

> <span class="highlight" style="background-color: #e56eee">内部SRAM即单片机的内存，用于数据存储</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=FMPT9RDX))
> 
> 🏷️ #📝/重点

^KEYFMPT9RDX

> <span class="highlight" style="background-color: #e56eee">实际上就是一个外部总线接口，可以用来访问外部SRAM、 NAND/NOR FLASH、LCD等</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=9ILYRU8Z))
> 
> 🏷️ #📝/重点

^KEY9ILYRU8Z

> <span class="highlight" style="background-color: #e56eee">AHB总线速度最大为 72Mhz，APB2总线速度最大也是72Mhz，但是APB1总线速度最大只能是36Mhz。</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=JSWG5CWX))
> 
> 🏷️ #📝/重点

^KEYJSWG5CWX

> <span class="highlight" style="background-color: #e56eee">挂载了STM32内部绝大部分外设。</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=28WJAMEE))
> 
> 🏷️ #📝/重点

^KEY28WJAMEE

> <span class="highlight" style="background-color: #e56eee">保证各 个总线之间的有序访问</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=9JA3XW8P))
> 
> 🏷️ #📝/重点

^KEY9JA3XW8P

> <span class="highlight" style="background-color: #f19837">5.3.3 存储器映射</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=QH6SMX8F))
> 
> 🏷️ #📝/标题

^KEYQH6SMX8F

> <span class="highlight" style="background-color: #e56eee">存储器本身是没有地址信息的，我们对存储器分配地址的过程就叫存储器映射。</span> ([p69](zotero://open-pdf/library/items/JFGTX7CT?page=69&annotation=INR6DWGB))
> 
> 🏷️ #📝/重点

^KEYINR6DWGB

> <span class="image#e56eee">null</span>存储器映射图 ([p70](zotero://open-pdf/library/items/JFGTX7CT?page=70&annotation=L8H6L2N5))

^KEYL8H6L2N5

> <span class="highlight" style="background-color: #e56eee">ST将4GB空间分成8个块，每个块512MB</span> ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=9SXEX7AW))
> 
> 🏷️ #📝/重点

^KEY9SXEX7AW

> <span class="image#e56eee">null</span>存储块功能及地址范围 ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=FBWXSNMH))

^KEYFBWXSNMH

> <span class="highlight" style="background-color: #e56eee">第一个块是Block 0，用于存储代码，即FLASH 空间</span> ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=M78ZVEMC))
> 
> 🏷️ #📝/重点

^KEYM78ZVEMC

> <span class="image#e56eee">null</span>存储块0的功能划分 ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=PGBKPAFD))

^KEYPGBKPAFD

> <span class="highlight" style="background-color: #e56eee">STM32的出厂固化BootLoader 非常精简，整个BootLoder只占了2KB FLASH空间。</span> ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=3Z3CML96))
> 
> 🏷️ #📝/重点

^KEY3Z3CML96

> <span class="highlight" style="background-color: #e56eee">第二个块是Block 1，用于存储数据，即SRAM空间</span> ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=23N7KKMK))
> 
> 🏷️ #📝/重点

^KEY23N7KKMK

> <span class="image#e56eee">null</span>存储块1的功能划分 ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=WDTFS2X7))

^KEYWDTFS2X7

> <span class="highlight" style="background-color: #e56eee">仅 使 用 了 64KB 大 小</span> ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=4LCEXLIE))
> 
> 🏷️ #📝/重点

^KEY4LCEXLIE

> <span class="highlight" style="background-color: #e56eee">第三个块是Block 2，用于外设访问</span> ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=DZVBMW8E))
> 
> 🏷️ #📝/重点

^KEYDZVBMW8E

> <span class="image#e56eee">null</span>存储块2的功能划分 ([p71](zotero://open-pdf/library/items/JFGTX7CT?page=71&annotation=PRECNBTG))

^KEYPRECNBTG

> <span class="highlight" style="background-color: #f19837">5.3.4 寄存器映射</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=P6BSJPWD))
> 
> 🏷️ #📝/标题

^KEYP6BSJPWD

> <span class="highlight" style="background-color: #e56eee">给寄存器的地址命名的过程就叫寄存器映射。</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=EZ64PCP3))
> 
> 🏷️ #📝/重点

^KEYEZ64PCP3

> <span class="image#e56eee">null</span>寄存器描述解读 ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=GAYZAIQW))

^KEYGAYZAIQW

> <span class="highlight" style="background-color: #e56eee">寄存器名字</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=4SRB9ZAL))
> 
> 🏷️ #📝/重点

^KEY4SRB9ZAL

> <span class="highlight" style="background-color: #e56eee">x可以从A~E，说明有5个这样的寄存器</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=VYUMN5KH))
> 
> 🏷️ #📝/重点

^KEYVYUMN5KH

> <span class="highlight" style="background-color: #e56eee">寄存器偏移量及复位值</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=92FFR3QG))
> 
> 🏷️ #📝/重点

^KEY92FFR3QG

> <span class="highlight" style="background-color: #e56eee">地址偏移量表示相对该外设基地址的偏移</span>
> 
> 这里的外设基地址是指GPIOB的地址 ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=EZSZLW7M))
> 
> 🏷️ #📝/重点

^KEYEZSZLW7M

> <span class="highlight" style="background-color: #e56eee">复位值表示该寄存器在系统复位后的默认值</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=WF2EXGKG))
> 
> 🏷️ #📝/重点

^KEYWF2EXGKG

> <span class="highlight" style="background-color: #e56eee">寄存器位表</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=K27EBQEG))
> 
> 🏷️ #📝/重点

^KEYK27EBQEG

> <span class="highlight" style="background-color: #e56eee">描述寄存器每一个位的作用</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=MECR4AZG))
> 
> 🏷️ #📝/重点

^KEYMECR4AZG

> <span class="highlight" style="background-color: #e56eee">rw表示该寄存器可读写（r，可读取；w，可写入）。</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=IXJK8IY6))
> 
> 🏷️ #📝/重点

^KEYIXJK8IY6

> <span class="highlight" style="background-color: #e56eee">位功能描述</span> ([p72](zotero://open-pdf/library/items/JFGTX7CT?page=72&annotation=5NYDWM6G))
> 
> 🏷️ #📝/重点

^KEY5NYDWM6G

> <span class="highlight" style="background-color: #e56eee">描述寄存器每个位的功能</span> ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=42WE2MTZ))
> 
> 🏷️ #📝/重点

^KEY42WE2MTZ

> <span class="highlight" style="background-color: #e56eee">#define GPIOB_ODR *(unsigned int *)(0x40010C0C)</span>
> 
> 寄存器映射操作 ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=38LFPG6I))
> 
> 🏷️ #📝/重点

^KEY38LFPG6I

> <span class="highlight" style="background-color: #e56eee">这个宏定义过程就可以称之为寄存 器的映射。</span> ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=AXBB9TJM))
> 
> 🏷️ #📝/重点

^KEYAXBB9TJM

> <span class="highlight" style="background-color: #e56eee">stm32f103xe.h 里面使用结构体方式对 STM32F103 的寄存器做了详细映射</span> ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=DK2B9AXP))
> 
> 🏷️ #📝/重点

^KEYDK2B9AXP

> <span class="highlight" style="background-color: #e56eee">具体某个寄存器地 址，由三个参数决定：1、总线基地址（BUS_BASE_ADDR）；2，外设基于总线基地址的偏移 量（PERIPH_OFFSET）；3，寄存器相对外设基地址的偏移量（REG_OFFSET）。可以表示为： 寄存器地址 = BUS_BASE_ADDR + PERIPH_OFFSET + REG_OFFSET</span>
> 
> 寄存器地址计算方法 ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=EJ3FUVW9))
> 
> 🏷️ #📝/重点

^KEYEJ3FUVW9

> <span class="highlight" style="background-color: #e56eee">有三个总线（APB1、APB2和AHB）</span> ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=KUT3BPB8))
> 
> 🏷️ #📝/重点

^KEYKUT3BPB8

> <span class="highlight" style="background-color: #e56eee">上表中APB1的基地址，也叫外设基地址</span>
> 
> APB1、APB2、AHB都是总线，其基地址叫做总线基地址。
> 
> 特别的，APB1总线基地址有一个别称叫做外设基地址，这个经常会和另一个真正的外设基地址混淆，所以把这个别称忽略。 ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=QTDCLATE))
> 
> 🏷️ #📝/重点

^KEYQTDCLATE

> <span class="highlight" style="background-color: #e56eee">注意：AHB的总线基地址是0X4001 8000，从该基地址到0X4002 0000，只挂了SDIO一个外 设，后续的AHB外设基地址都大于等于0X4002 0000。为了方便计算，我们可以将AHB的总线基 地址改成：0X4002 0000，而SDIO则单独定义一个基地址给他即可。</span>
> 
> 这里解释了为什么AHB的总线基地址改为：0X40020000 ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=XTJZBHFE))
> 
> 🏷️ #📝/重点

^KEYXTJZBHFE

> <span class="highlight" style="background-color: #e56eee">上表的偏移量，就是外设基于APB2总线基地址的偏移量（PERIPH_OFFSET）</span>
> 
> 要注意这个偏移量是相对于哪个的偏移 ([p73](zotero://open-pdf/library/items/JFGTX7CT?page=73&annotation=8NAD44F5))
> 
> 🏷️ #📝/重点

^KEY8NAD44F5

> <span class="highlight" style="background-color: #e56eee">上表的偏移量，就是寄存器基于外设基地址的偏移量（REG_OFFSET）</span>
> 
> 要注意这个偏移量是相对于哪个的偏移 ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=BDWK9ECC))
> 
> 🏷️ #📝/重点

^KEYBDWK9ECC

> <span class="highlight" style="background-color: #e56eee">STM32F103所有寄存器映射都在stm32f103xe.h里面完成，包括各种基地址定义、结构体定 义、外设寄存器映射、寄存器位定义（占了绝大部分）等</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=T44MGJ9T))
> 
> 🏷️ #📝/重点

^KEYT44MGJ9T

> <span class="image#e56eee">null</span>stm32f103xe.h文件主要组成部分 ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=Y4UCJLUW))

^KEYY4UCJLUW

> <span class="highlight" style="background-color: #e56eee">中断编号定义</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=I4H89L5C))
> 
> 🏷️ #📝/重点

^KEYI4H89L5C

> <span class="highlight" style="background-color: #e56eee">外设寄存器结 构体类型定义</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=L56NAC63))
> 
> 🏷️ #📝/重点

^KEYL56NAC63

> <span class="highlight" style="background-color: #e56eee">寄存器映射</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=5VKCXLJY))
> 
> 🏷️ #📝/重点

^KEY5VKCXLJY

> <span class="highlight" style="background-color: #e56eee">寄存器位定义</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=LVKU82I6))
> 
> 🏷️ #📝/重点

^KEYLVKU82I6

> <span class="highlight" style="background-color: #e56eee">外设判定</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=7I8TUURM))
> 
> 🏷️ #📝/重点

^KEY7I8TUURM

> <span class="highlight" style="background-color: #e56eee">外设寄存器结构体类型定义和寄 存器映射</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=6RQD6HAC))
> 
> 🏷️ #📝/重点

^KEY6RQD6HAC

> <span class="highlight" style="background-color: #e56eee">1， 外设寄存器结构体类型定义 2， 外设基地址定义 3， 寄存器映射（通过将外设基地址强制转换为外设结构体类型指针即可）</span>
> 
> 为什么能够利用结构体来批量实现寄存器映射？
> 
> 1、结构体中的成员变量在内存中是连续存放的，而某一个外设对应的寄存器地址也是连续无间隔的；
> 
> 2、寄存器都是32位的； ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=W7QLQEQ3))
> 
> 🏷️ #📝/重点

^KEYW7QLQEQ3

> <span class="highlight" style="background-color: #e56eee">寄存器结构体类型定义</span> ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=HLWGX9KR))
> 
> 🏷️ #📝/重点

^KEYHLWGX9KR

> <span class="highlight" style="background-color: #e56eee">__IO uint32_t CRL;</span>
> 
> \`__IO\`：这是一个宏定义，通常用于指示编译器不要对这个变量进行优化，以确保对其进行读写操作时能够与硬件的实际状态保持同步。这在嵌入式系统中非常重要，因为这些变量通常代表了与外部硬件相关的寄存器。
> 
>  \`uint32_t\`：这是一个无符号32位整数的数据类型，通常用于在嵌入式系统中表示32位的寄存器值。
> 
>  \`CRL\`：这是一个变量名，代表了一个特定的寄存器或寄存器组。在这里，它可能是用于表示某个特定的控制寄存器或控制寄存器组。 ([p74](zotero://open-pdf/library/items/JFGTX7CT?page=74&annotation=6MFG2UFB))
> 
> 🏷️ #📝/重点

^KEY6MFG2UFB

> <span class="highlight" style="background-color: #e56eee">GPIO外设基地址定义如下</span>
> 
> 将外设基地址强制转换为外设结构体类型指针 ([p75](zotero://open-pdf/library/items/JFGTX7CT?page=75&annotation=F7XSW44L))
> 
> 🏷️ #📝/重点

^KEYF7XSW44L

> <span class="highlight" style="background-color: #e56eee">GPIO外设寄存器映射定义如下</span> ([p75](zotero://open-pdf/library/items/JFGTX7CT?page=75&annotation=4TNPX3GK))
> 
> 🏷️ #📝/重点

^KEY4TNPX3GK

> <span class="highlight" style="background-color: #e56eee">包括两个核心知识点：1，结构体地址自增；2，地址强制转换；</span> ([p75](zotero://open-pdf/library/items/JFGTX7CT?page=75&annotation=2PNQVXP6))
> 
> 🏷️ #📝/重点

^KEY2PNQVXP6

> <span class="highlight" style="background-color: #f19837">第六章 新建寄存器版本 MDK 工程</span> ([p76](zotero://open-pdf/library/items/JFGTX7CT?page=76&annotation=U9HPDV8N))
> 
> 🏷️ #📝/标题

^KEYU9HPDV8N

> <span class="highlight" style="background-color: #f19837">6.1 新建寄存器版本 MDK 工程</span> ([p76](zotero://open-pdf/library/items/JFGTX7CT?page=76&annotation=RBB54J2Y))
> 
> 🏷️ #📝/标题

^KEYRBB54J2Y

> <span class="highlight" style="background-color: #e56eee">STM32Cube 官方固件包</span> ([p76](zotero://open-pdf/library/items/JFGTX7CT?page=76&annotation=4IG83CP5))
> 
> 🏷️ #📝/重点

^KEY4IG83CP5

> <span class="highlight" style="background-color: #f19837">6.1.1 新建工程文件夹</span> ([p76](zotero://open-pdf/library/items/JFGTX7CT?page=76&annotation=U7B68AMR))
> 
> 🏷️ #📝/标题

^KEYU7B68AMR

> <span class="image#e56eee">null</span>各工程文件夹的作用 ([p76](zotero://open-pdf/library/items/JFGTX7CT?page=76&annotation=IE377L6W))

^KEYIE377L6W

> <span class="highlight" style="background-color: #e56eee">Drivers 文件夹</span> ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=CCEA5SSA))
> 
> 🏷️ #📝/重点

^KEYCCEA5SSA

> <span class="highlight" style="background-color: #e56eee">该文件夹用于存放与硬件相关的驱动层文件</span> ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=IUISIYSD))
> 
> 🏷️ #📝/重点

^KEYIUISIYSD

> <span class="highlight" style="background-color: #e56eee">BSP 文件夹，用于存放正点原子提供的板级支持包驱动代码</span>
> 
> 板级支持包驱动代码：即开发板上外设的驱动代码。
> 
> 开发板上外设有：led、蜂鸣器、按键等 ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=SVUY8UHW))
> 
> 🏷️ #📝/重点

^KEYSVUY8UHW

> <span class="highlight" style="background-color: #e56eee">CMSIS 文件夹，用于存放 CMSIS 底层代码（ARM 和 ST 提供）</span>
> 
> CMSIS 文件夹里面有什么文件以及文件的作用，参考HAL库的“基于CMSIS应用程序文件描述” ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=IP6BAAQN))
> 
> 🏷️ #📝/重点

^KEYIP6BAAQN

> <span class="highlight" style="background-color: #e56eee">SYSTEM 文件夹，用于存放正点原子提供的系统级核心驱动代码</span>
> 
> 用于初始化stm32系统的代码，比如：延时、通信等。
> 
> 这里要前面的“板级驱动”代码区分开来，一个是针对stm32的驱动代码，一个是针对开发板上外设的驱动代码 ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=NPTM74HN))
> 
> 🏷️ #📝/重点

^KEYNPTM74HN

> <span class="highlight" style="background-color: #e56eee">Middlewares 文件夹</span> ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=52QCJETE))
> 
> 🏷️ #📝/重点

^KEY52QCJETE

> <span class="highlight" style="background-color: #e56eee">该文件夹用于存放正点原子和其他第三方提供的中间层代码（组件/Lib 等）</span> ([p77](zotero://open-pdf/library/items/JFGTX7CT?page=77&annotation=MBN5VHHJ))
> 
> 🏷️ #📝/重点

^KEYMBN5VHHJ

> <span class="highlight" style="background-color: #e56eee">Output 文件夹</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=UYKGBSAL))
> 
> 🏷️ #📝/重点

^KEYUYKGBSAL

> <span class="highlight" style="background-color: #e56eee">该文件夹用于存放编译器编译工程输出的中间文件，比如：.hex、.bin、.o 文件等等。</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=2KTRMPVY))
> 
> 🏷️ #📝/重点

^KEY2KTRMPVY

> <span class="highlight" style="background-color: #e56eee">Projects 文件夹</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=G2MTK8WW))
> 
> 🏷️ #📝/重点

^KEYG2MTK8WW

> <span class="highlight" style="background-color: #e56eee">该文件夹用于存放编译器（MDK、IAR 等）工程文件</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=L6PEK9GU))
> 
> 🏷️ #📝/重点

^KEYL6PEK9GU

> <span class="highlight" style="background-color: #e56eee">User 文件夹</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=ZHTYY2ZG))
> 
> 🏷️ #📝/重点

^KEYZHTYY2ZG

> <span class="highlight" style="background-color: #e56eee">该文件夹用于存放用户编写的代码</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=XSRGDPDP))
> 
> 🏷️ #📝/重点

^KEYXSRGDPDP

> <span class="highlight" style="background-color: #f19837">6.1.2 新建一个工程框架</span> ([p78](zotero://open-pdf/library/items/JFGTX7CT?page=78&annotation=GLYRA3GE))
> 
> 🏷️ #📝/标题

^KEYGLYRA3GE

> <span class="image#e56eee">null</span> ([p80](zotero://open-pdf/library/items/JFGTX7CT?page=80&annotation=EWZIE7KJ))

^KEYEWZIE7KJ

> <span class="highlight" style="background-color: #e56eee">会把输出在 Listings 和 Objects 文件夹的内容，统一改为输出到 Output 文件夹 （通过魔术棒设置）</span>
> 
> 所以删除了这两个文件夹 ([p80](zotero://open-pdf/library/items/JFGTX7CT?page=80&annotation=R8NJHDLA))
> 
> 🏷️ #📝/重点

^KEYR8NJHDLA

> <span class="highlight" style="background-color: #f19837">6.1.3 添加文件</span> ([p80](zotero://open-pdf/library/items/JFGTX7CT?page=80&annotation=T49ZH9B5))
> 
> 🏷️ #📝/标题

^KEYT49ZH9B5

> <span class="highlight" style="background-color: #e56eee">1. 设置工程名和分组名</span> ([p80](zotero://open-pdf/library/items/JFGTX7CT?page=80&annotation=ZM6AL8N9))
> 
> 🏷️ #📝/重点

^KEYZM6AL8N9

> <span class="highlight" style="background-color: #e56eee">并设置四个分组： Startup（存放启动文件）、User（存放 main.c 等用户代码）、Drivers/SYSTEM（存放系统级驱 动代码）、Readme（存放工程说明文件）</span>
> 
> 设置分组 ([p81](zotero://open-pdf/library/items/JFGTX7CT?page=81&annotation=JPXI6REH))
> 
> 🏷️ #📝/重点

^KEYJPXI6REH

> <span class="highlight" style="background-color: #e56eee">由于 MDK 分组不支持多级目录，因此我们将路径也带入分组命名里面，以便区 分。如：User 分组对应 User 文件夹里面的源码，Drivers/SYSTEM 分组，对应 Drivers/SYSTEM 文件夹里面的源码，Drivers/BSP 分组对应 Drivers/BSP 文件夹里面的源码等</span> ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=8VSDAKQ8))
> 
> 🏷️ #📝/重点

^KEY8VSDAKQ8

> <span class="highlight" style="background-color: #e56eee">添加启动文件</span> ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=JU7NJRY6))
> 
> 🏷️ #📝/重点

^KEYJU7NJRY6

> <span class="highlight" style="background-color: #e56eee">其主要作用包括：1、堆栈（SP）的初始化； 2、初始化程序计数器（PC）；3、设置向量表异常事件的入口地址；4、调用 main 函数等</span> ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=X84FAB5U))
> 
> 🏷️ #📝/重点

^KEYX84FAB5U

> <span class="highlight" style="background-color: #e56eee">对于 STM32F103 来说有 4 个启动文件可选</span> ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=3EXASBGD))
> 
> 🏷️ #📝/重点

^KEY3EXASBGD

> <span class="highlight" style="background-color: #e56eee">startup_stm32f103xe.s</span>
> 
> 这里解释了“xe”的含义 ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=JPZ7FJYS))
> 
> 🏷️ #📝/重点

^KEYJPZ7FJYS

> <span class="highlight" style="background-color: #e56eee">开发板使用的是 STM32F103ZET6，对应的启动文 件为：startup_stm32f103xe.s</span> ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=4QVHHDKW))
> 
> 🏷️ #📝/重点

^KEY4QVHHDKW

> <span class="highlight" style="background-color: #e56eee">对 startup_stm32f103xe.s 做了 2 处修改</span> ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=R7WTXQR8))
> 
> 🏷️ #📝/重点

^KEYR7WTXQR8

> <span class="highlight" style="background-color: #e56eee">Heap_Size 改成 0</span>
> 
> 堆的大小设置为 0 。 ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=U7L29E9I))
> 
> 🏷️ #📝/重点

^KEYU7L29E9I

> <span class="highlight" style="background-color: #e56eee">寄存器代码不需要调用 SystemInit 函数，因此修改 Reset_Handler 函数，去掉 SystemInit 调用，源码如下</span>
> 
> HAL 库版本提供了SystemInit 函数，所以不要去掉。 ([p82](zotero://open-pdf/library/items/JFGTX7CT?page=82&annotation=6P84FTBB))
> 
> 🏷️ #📝/重点

^KEY6P84FTBB

> <span class="highlight" style="background-color: #e56eee">添加 SYSTEM 源码</span> ([p83](zotero://open-pdf/library/items/JFGTX7CT?page=83&annotation=U879ILEU))
> 
> 🏷️ #📝/重点

^KEYU879ILEU

> <span class="highlight" style="background-color: #e56eee">6.1.4 魔术棒设置</span> ([p84](zotero://open-pdf/library/items/JFGTX7CT?page=84&annotation=H8YZ9IBK))
> 
> 🏷️ #📝/重点

^KEYH8YZ9IBK

> <span class="highlight" style="background-color: #e56eee">设置 Target 选项卡</span> ([p84](zotero://open-pdf/library/items/JFGTX7CT?page=84&annotation=6X2AAJ54))
> 
> 🏷️ #📝/重点

^KEY6X2AAJ54

> <span class="highlight" style="background-color: #e56eee">设置芯片所使用的外部晶振频率为 8Mhz，选择 ARM Compiler 版本为：Use default compiler version 5（即 AC5 编译器）</span> ([p85](zotero://open-pdf/library/items/JFGTX7CT?page=85&annotation=ABKHHG73))
> 
> 🏷️ #📝/重点

^KEYABKHHG73

> <span class="highlight" style="background-color: #e56eee">设置 Output 选项卡</span> ([p85](zotero://open-pdf/library/items/JFGTX7CT?page=85&annotation=QJXDUK9Q))
> 
> 🏷️ #📝/重点

^KEYQJXDUK9Q

> <span class="highlight" style="background-color: #e56eee">勾选：Browse Information，用于输出浏览信息，这样就可以使用 go to definition 查看函数/变量的定义</span> ([p85](zotero://open-pdf/library/items/JFGTX7CT?page=85&annotation=7VIQBHC9))
> 
> 🏷️ #📝/重点

^KEY7VIQBHC9

> <span class="highlight" style="background-color: #e56eee">设置 Listing 选项卡</span> ([p86](zotero://open-pdf/library/items/JFGTX7CT?page=86&annotation=CMVCPFXL))
> 
> 🏷️ #📝/重点

^KEYCMVCPFXL

> <span class="highlight" style="background-color: #e56eee">经过 Output 和 Listing 这两步设置，原来存储在 Objects 和 Listings 文件夹的内容（中间文 件）就都改为输出到 Output 文件夹了</span>
> 
> 改变中间件的输出路径 ([p86](zotero://open-pdf/library/items/JFGTX7CT?page=86&annotation=AKC7ZF4V))
> 
> 🏷️ #📝/重点

^KEYAKC7ZF4V

> <span class="highlight" style="background-color: #e56eee">设置 C/C++选项卡</span> ([p86](zotero://open-pdf/library/items/JFGTX7CT?page=86&annotation=AZW8I76D))
> 
> 🏷️ #📝/重点

^KEYAZW8I76D

> <span class="highlight" style="background-color: #e56eee">设置了全局宏定义：STM32F103xE</span> ([p86](zotero://open-pdf/library/items/JFGTX7CT?page=86&annotation=P2G8R7MA))
> 
> 🏷️ #📝/重点

^KEYP2G8R7MA

> <span class="highlight" style="background-color: #e56eee">在 stm32f1xx.h 里 面会用到该宏定义</span> ([p86](zotero://open-pdf/library/items/JFGTX7CT?page=86&annotation=Z4XUG2A3))
> 
> 🏷️ #📝/重点

^KEYZ4XUG2A3

> <span class="highlight" style="background-color: #e56eee">相对路径</span> ([p87](zotero://open-pdf/library/items/JFGTX7CT?page=87&annotation=3XEVWVAG))
> 
> 🏷️ #📝/重点

^KEY3XEVWVAG

> <span class="highlight" style="background-color: #e56eee">只需要在头文件包含路径里面指定一个文件夹，那么该文件夹下的其他文件夹里面的源 码，如果全部是使用相对路径，则无需再设置头文件包含路径了</span>
> 
> 这个指定的文件夹即默认文件夹，即指 MDK 工程所在的文件夹，即.uvprojx 文件所在文件夹 ([p87](zotero://open-pdf/library/items/JFGTX7CT?page=87&annotation=7X73KQXR))
> 
> 🏷️ #📝/重点

^KEY7X73KQXR

> <span class="highlight" style="background-color: #e56eee">1，默认路径就是指 MDK 工程所在的路径，即.uvprojx 文件所在路径（文件夹） 2，“./”表示当前目录（相对当前路径，也可以写做“.\”） 3，“../”表示当前目录的上一层目录（也可以写做“..\”）</span> ([p87](zotero://open-pdf/library/items/JFGTX7CT?page=87&annotation=VWTB44IP))
> 
> 🏷️ #📝/重点

^KEYVWTB44IP

> <span class="highlight" style="background-color: #e56eee">null</span>
> 
> 这个图有错误，MDK 工程所在的文件夹应该是 “MDK-ARM” ([p87](zotero://open-pdf/library/items/JFGTX7CT?page=87&annotation=D9TYRMTQ))

^KEYD9TYRMTQ

> <span class="highlight" style="background-color: #e56eee">设置 Debug 选项卡</span> ([p88](zotero://open-pdf/library/items/JFGTX7CT?page=88&annotation=6W9W6W7A))
> 
> 🏷️ #📝/重点

^KEY6W9W6W7A

> <span class="highlight" style="background-color: #e56eee">选择使用：CMSIS-DAP 仿真器，使用 SW 模式，并设置最大时钟频率为 10Mhz， 以得到最高下载速度</span> ([p88](zotero://open-pdf/library/items/JFGTX7CT?page=88&annotation=W8ZV7F7M))
> 
> 🏷️ #📝/重点

^KEYW8ZV7F7M

> <span class="highlight" style="background-color: #e56eee">设置 Utilities 选项卡</span> ([p88](zotero://open-pdf/library/items/JFGTX7CT?page=88&annotation=77R74BHU))
> 
> 🏷️ #📝/重点

^KEY77R74BHU

> <span class="highlight" style="background-color: #f19837">6.1.5 添加 main.c，并编写代码</span> ([p89](zotero://open-pdf/library/items/JFGTX7CT?page=89&annotation=3TGAMJQV))
> 
> 🏷️ #📝/标题

^KEY3TGAMJQV

> <span class="highlight" style="background-color: #f19837">6.2 下载验证</span> ([p90](zotero://open-pdf/library/items/JFGTX7CT?page=90&annotation=EVYPHXUS))
> 
> 🏷️ #📝/标题

^KEYEVYPHXUS

> <span class="highlight" style="background-color: #f19837">第七章 认识 HAL 库</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=PZFMGX9N))
> 
> 🏷️ #📝/标题

^KEYPZFMGX9N

> <span class="highlight" style="background-color: #e56eee">硬件抽象层</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=E2GTH2TI))
> 
> 🏷️ #📝/重点

^KEYE2GTH2TI

> <span class="highlight" style="background-color: #e56eee">HAL 库将大 部分寄存器的操作封装成了函数</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=P942IMQD))
> 
> 🏷️ #📝/重点

^KEYP942IMQD

> <span class="highlight" style="background-color: #f19837">7.1 初识 STM32 HAL 库</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=R37PHYG2))
> 
> 🏷️ #📝/标题

^KEYR37PHYG2

> <span class="highlight" style="background-color: #e56eee">利用 HAL 库固件包里封装好的 c 语言编写的驱 动文件，来实现对 STM32 内部和外围电器元件的控制的过程</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=QF2WY46M))
> 
> 🏷️ #📝/重点

^KEYQF2WY46M

> <span class="highlight" style="background-color: #f19837">7.1.1 CMSIS 标准</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=SL76VVH2))
> 
> 🏷️ #📝/标题

^KEYSL76VVH2

> <span class="highlight" style="background-color: #e56eee">软件接口标准化的标准 CMSIS</span> ([p92](zotero://open-pdf/library/items/JFGTX7CT?page=92&annotation=2FV4FTP9))

^KEY2FV4FTP9

> <span class="image#e56eee">null</span>CMSIS 应用程序框图 ([p93](zotero://open-pdf/library/items/JFGTX7CT?page=93&annotation=WCWHW8SD))

^KEYWCWHW8SD

> <span class="image#e56eee">null</span>这是 HAL 库相比于标准库多出来的地方 ([p93](zotero://open-pdf/library/items/JFGTX7CT?page=93&annotation=UUVVKK3Z))

^KEYUUVVKK3Z

> <span class="image#e56eee">null</span>HAL 库和标准库都具备核心层 ([p93](zotero://open-pdf/library/items/JFGTX7CT?page=93&annotation=BQ3GLHMH))

^KEYBQ3GLHMH

> <span class="highlight" style="background-color: #f19837">7.1.2 HAL 库简介</span> ([p93](zotero://open-pdf/library/items/JFGTX7CT?page=93&annotation=5NGILYZW))
> 
> 🏷️ #📝/标题

^KEY5NGILYZW

> <span class="highlight" style="background-color: #e56eee">标准外设库仍然接近于寄存器操 作，主要就是将一些基本的寄存器操作封装成了 C 函数。开发者仍需要关注所使用的外设是在 哪个总线之上，具体寄存器的配置等底层信息。</span> ([p94](zotero://open-pdf/library/items/JFGTX7CT?page=94&annotation=FSHGYJ2N))

^KEYFSHGYJ2N

> <span class="highlight" style="background-color: #e56eee">HAL 是 Hardware Abstraction Layer 的缩写，即硬件抽象层。</span> ([p94](zotero://open-pdf/library/items/JFGTX7CT?page=94&annotation=VNZK2JYB))

^KEYVNZK2JYB

> <span class="highlight" style="background-color: #e56eee">HAL 库仍是 ST 未来主推的库</span> ([p94](zotero://open-pdf/library/items/JFGTX7CT?page=94&annotation=FP9QXH2U))
> 
> 🏷️ #📝/重点

^KEYFP9QXH2U

> <span class="highlight" style="background-color: #e56eee">LL 库（Low Layer）目前与 HAL 库捆绑发布，它设计为比 HAL 库更接近于硬件底层的操 作，代码更轻量级，代码执行效率更高的库函数组件，可以完全独立于 HAL 库来使用，但 LL 库不匹配复杂的外设，如 USB 等。</span> ([p94](zotero://open-pdf/library/items/JFGTX7CT?page=94&annotation=TTWNRB3P))

^KEYTTWNRB3P

> <span class="highlight" style="background-color: #e56eee">混合使用，和 HAL 库结合使用</span> ([p95](zotero://open-pdf/library/items/JFGTX7CT?page=95&annotation=DB7HNW4A))
> 
> 🏷️ #📝/重点

^KEYDB7HNW4A

> <span class="highlight" style="background-color: #e56eee">HAL 库更倾向于外设通用化</span> ([p95](zotero://open-pdf/library/items/JFGTX7CT?page=95&annotation=48WQNXZC))
> 
> 🏷️ #📝/重点

^KEY48WQNXZC

> <span class="highlight" style="background-color: #e56eee">LL 倾 向于最简单的寄存器操作</span> ([p95](zotero://open-pdf/library/items/JFGTX7CT?page=95&annotation=R4GGNQT3))
> 
> 🏷️ #📝/重点

^KEYR4GGNQT3

> <span class="highlight" style="background-color: #f19837">7.1.3 HAL 库能做什么</span> ([p95](zotero://open-pdf/library/items/JFGTX7CT?page=95&annotation=WUPHPAWT))
> 
> 🏷️ #📝/标题

^KEYWUPHPAWT

> <span class="highlight" style="background-color: #f19837">7.2 HAL 库驱动包</span> ([p95](zotero://open-pdf/library/items/JFGTX7CT?page=95&annotation=TGCJPHE4))
> 
> 🏷️ #📝/标题

^KEYTGCJPHE4

> <span class="highlight" style="background-color: #f19837">7.2.1 如何获取 HAL 库固件包</span> ([p96](zotero://open-pdf/library/items/JFGTX7CT?page=96&annotation=LIVAHIYA))
> 
> 🏷️ #📝/标题

^KEYLIVAHIYA

> <span class="highlight" style="background-color: #e56eee">图形配置工具 STM32CubeMX</span> ([p96](zotero://open-pdf/library/items/JFGTX7CT?page=96&annotation=Z7SAM9HS))
> 
> 🏷️ #📝/重点

^KEYZ7SAM9HS

> <span class="highlight" style="background-color: #e56eee">STM32Cube 固件包</span> ([p96](zotero://open-pdf/library/items/JFGTX7CT?page=96&annotation=74QF4979))
> 
> 🏷️ #📝/重点

^KEY74QF4979

> <span class="highlight" style="background-color: #f19837">7.2.2 STM32Cube 固件包分析</span> ([p97](zotero://open-pdf/library/items/JFGTX7CT?page=97&annotation=UBATK3ZX))
> 
> 🏷️ #📝/标题

^KEYUBATK3ZX

> <span class="highlight" style="background-color: #e56eee">对于 Documentation 文件夹，里面是一个 STM32CubeF1 英文说明文档</span> ([p97](zotero://open-pdf/library/items/JFGTX7CT?page=97&annotation=XXXZYMTP))
> 
> 🏷️ #📝/重点

^KEYXXXZYMTP

> <span class="highlight" style="background-color: #e56eee">Drivers 文件夹包含 BSP，CMSIS 和 STM32F1xx_HAL_Driver 三个子文件夹。</span> ([p97](zotero://open-pdf/library/items/JFGTX7CT?page=97&annotation=UXQTI8MA))

^KEYUXQTI8MA

> <span class="highlight" style="background-color: #e56eee">每一种开发板对应一个文件夹。例如触摸屏，LCD，SRAM</span> ([p97](zotero://open-pdf/library/items/JFGTX7CT?page=97&annotation=4ZSJLUC5))
> 
> 🏷️ #📝/重点

^KEY4ZSJLUC5

> <span class="highlight" style="background-color: #e56eee">不同开发板可能不能直接使用</span> ([p97](zotero://open-pdf/library/items/JFGTX7CT?page=97&annotation=A9SVTG2N))
> 
> 🏷️ #📝/重点

^KEYA9SVTG2N

> <span class="highlight" style="background-color: #e56eee">符合 CMSIS 标准的软件抽象层组件相关文件</span> ([p97](zotero://open-pdf/library/items/JFGTX7CT?page=97&annotation=GLWFY5L5))
> 
> 🏷️ #📝/重点

^KEYGLWFY5L5

> <span class="highlight" style="background-color: #e56eee">它包含了所有的 STM32F1xx 系列 HAL 库 头文件和源文件。它的作用是屏蔽了复杂的硬件寄存器操作，统 一了外设的接口函数。该文件夹包含 Src 和 Inc 两个子文件夹， 其中 Src 子文件夹存放的是.c 源文件，Inc 子文件夹存放的是与之 对应的.h 头文件。</span>
> 
> 提供了统一的外设接口 ([p98](zotero://open-pdf/library/items/JFGTX7CT?page=98&annotation=GEFZTX5P))
> 
> 🏷️ #📝/重点

^KEYGEFZTX5P

> <span class="highlight" style="background-color: #e56eee">ST 文件夹下面存放的是 STM32 相关的 一些文件，包括 STemWin 和 USB 库等。Third_Party 文件夹是第三方中间件</span> ([p98](zotero://open-pdf/library/items/JFGTX7CT?page=98&annotation=JBU7YM4T))
> 
> 🏷️ #📝/重点

^KEYJBU7YM4T

> <span class="highlight" style="background-color: #e56eee">该文件夹存放的是 ST 官方的开发板的适配例程</span> ([p98](zotero://open-pdf/library/items/JFGTX7CT?page=98&annotation=AHLSPH8M))
> 
> 🏷️ #📝/重点

^KEYAHLSPH8M

> <span class="highlight" style="background-color: #e56eee">该文件夹是一些公用组件</span> ([p98](zotero://open-pdf/library/items/JFGTX7CT?page=98&annotation=IR5M52A5))
> 
> 🏷️ #📝/重点

^KEYIR5M52A5

> <span class="highlight" style="background-color: #f19837">7.2.3 CMSIS 文件夹关键文件</span> ([p98](zotero://open-pdf/library/items/JFGTX7CT?page=98&annotation=E3IABWTS))
> 
> 🏷️ #📝/标题

^KEYE3IABWTS

> <span class="highlight" style="background-color: #e56eee">CMSIS 为软件包的内容制定了标准，包括文件目录的命名和内容构成</span> ([p99](zotero://open-pdf/library/items/JFGTX7CT?page=99&annotation=3VBZM5UB))
> 
> 🏷️ #📝/重点

^KEY3VBZM5UB

> <span class="highlight" style="background-color: #e56eee">它的目录结构完全按照 CMSIS 标准执行，仅仅是作了部分 删减。</span> ([p99](zotero://open-pdf/library/items/JFGTX7CT?page=99&annotation=JS9KU7FE))
> 
> 🏷️ #📝/重点

^KEYJS9KU7FE

> <span class="highlight" style="background-color: #e56eee">CMSIS 文件夹中的 Device 和 Include 这两个文件夹中的文件是我们工程中最常用到的。</span> ([p99](zotero://open-pdf/library/items/JFGTX7CT?page=99&annotation=GYI3Q8RW))
> 
> 🏷️ #📝/重点

^KEYGYI3Q8RW

> <span class="highlight" style="background-color: #e56eee">Device 文件夹关键文件介绍</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=WHIIH739))
> 
> 🏷️ #📝/重点

^KEYWHIIH739

> <span class="highlight" style="background-color: #e56eee">stm32f1xx.h</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=54YTZW8M))
> 
> 🏷️ #📝/重点

^KEY54YTZW8M

> <span class="highlight" style="background-color: #e56eee">包含了很多条件定义和常用的枚举变量类型，与宏定义配合， 选择性包含某一特定的 STM32F1 系列芯片的头文件。这个文 件使我们在使用 STM32F1 系列的不同型号芯片时，不需要每 次都修改工程头文件，只需要修改宏定义并增加特定型号芯 片的头文件即可快速选择使用不同类型的 F1 芯片。</span>
> 
> 可以理解为存放一些芯片的信息 ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=PCF79VVQ))
> 
> 🏷️ #📝/重点

^KEYPCF79VVQ

> <span class="highlight" style="background-color: #e56eee">stm32f103xg.h</span>
> 
> 要和“stm32f1xx.h”文件区分开来 ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=8X899FP8))
> 
> 🏷️ #📝/重点

^KEY8X899FP8

> <span class="highlight" style="background-color: #e56eee">这 个文件的主要作用是定义声明寄存器以及封装内存操作，以 结构体和宏定义标识符的形式。</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=2BY6RTFB))
> 
> 🏷️ #📝/重点

^KEY2BY6RTFB

> <span class="highlight" style="background-color: #e56eee">startup_stm32f103xe.s</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=IGHE3I3Y))
> 
> 🏷️ #📝/重点

^KEYIGHE3I3Y

> <span class="highlight" style="background-color: #e56eee">启动文件的作用主要是进行堆栈的初始化，中断向 量表以及中断函数定义等。启动文件有一个很重要的作用就 是系统复位后引导进入 main 函数。</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=IAH6T6JC))
> 
> 🏷️ #📝/重点

^KEYIAH6T6JC

> <span class="highlight" style="background-color: #e56eee">system_stm32f1xx.h system_stm32f1xx.c</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=A7ND7UMM))
> 
> 🏷️ #📝/重点

^KEYA7ND7UMM

> <span class="highlight" style="background-color: #e56eee">主要是声明和定义系统初始化函数 SystemInit 以及系统时钟 更新函数 SystemCoreClockUpdate。</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=HGSHZ4WW))
> 
> 🏷️ #📝/重点

^KEYHGSHZ4WW

> <span class="highlight" style="background-color: #e56eee">SystemInit 函数的作用是 进行时钟系统的一些初始化操作以及中断向量表偏移地址设 置，但它并没有设置具体的时钟值，这是与标准库的最大区 别</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=72D7I7XV))
> 
> 🏷️ #📝/重点

^KEY72D7I7XV

> <span class="highlight" style="background-color: #e56eee">在启动文件 startup_stm32103xe.s 中会设置系统复位后，直接调用 SystemInit 函数进行系统初始化。</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=4HFI234B))
> 
> 🏷️ #📝/重点

^KEY4HFI234B

> <span class="highlight" style="background-color: #e56eee">SystemCoreClockUpdate 函数是在 系统时钟配置进行修改后，调用这个函数来更新 SystemCoreClock 的值</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=C5UZ7LYD))
> 
> 🏷️ #📝/重点

^KEYC5UZ7LYD

> <span class="highlight" style="background-color: #e56eee">变量 SystemCoreClock 是一个全局变 量</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=5UXEPKLA))
> 
> 🏷️ #📝/重点

^KEY5UXEPKLA

> <span class="highlight" style="background-color: #e56eee">Include 文件夹存放了符合 CMSIS 标准的 Cortex-M 内核头文件。</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=QMDR8F8U))
> 
> 🏷️ #📝/重点

^KEYQMDR8F8U

> <span class="highlight" style="background-color: #e56eee">cmsis_armcc.h、cmsis_armclang.h、cmsis_compiler.h、cmsis_version.h、 core_cm3.h 和 mpu_armv7.h</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=2WRLI3DN))

^KEY2WRLI3DN

> <span class="highlight" style="background-color: #e56eee">core_cm3.h 是内核底层的文件</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=YMUJ7YVY))
> 
> 🏷️ #📝/重点

^KEYYMUJ7YVY

> <span class="highlight" style="background-color: #e56eee">包含一些 AMR 内核指令，如软件复 位，开关中断等功能。</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=3YI3GZWK))
> 
> 🏷️ #📝/重点

^KEY3YI3GZWK

> <span class="highlight" style="background-color: #e56eee">它包含了一个重要 的头文件 stdint.h。</span>
> 
> 这个包含是指include这个头文件 ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=RA3A8D55))
> 
> 🏷️ #📝/重点

^KEYRA3A8D55

> <span class="highlight" style="background-color: #f19837">7.2.4 stdint.h 简介</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=VS4L93VN))
> 
> 🏷️ #📝/标题

^KEYVS4L93VN

> <span class="highlight" style="background-color: #e56eee">stdint.h 是从 c99 中引进的一个标准 C 库的文件</span> ([p100](zotero://open-pdf/library/items/JFGTX7CT?page=100&annotation=Y4PPJCJR))
> 
> 🏷️ #📝/重点

^KEYY4PPJCJR

> <span class="highlight" style="background-color: #e56eee">stdint.h 的作用就是提供了类型定义</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=BYM22SHQ))
> 
> 🏷️ #📝/重点

^KEYBYM22SHQ

> <span class="image#e56eee">null</span>留意这些类型定义：
> 
> uint8_t
> 
> uint16_t
> 
> uint32_t ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=QVGHJGHJ))

^KEYQVGHJGHJ

> <span class="highlight" style="background-color: #f19837">7.3 HAL 库框架结构</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=G47PKCKS))
> 
> 🏷️ #📝/标题

^KEYG47PKCKS

> <span class="highlight" style="background-color: #f19837">7.3.1 HAL 库文件夹结构</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=LFGR73XW))
> 
> 🏷️ #📝/标题

^KEYLFGR73XW

> <span class="highlight" style="background-color: #e56eee">Src（Source 的简写）文件夹存放是所有外设的驱动 程序源码，Inc（Include 的简写）文件夹存放的是对应源码的头文件</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=83EW7KEP))
> 
> 🏷️ #📝/重点

^KEY83EW7KEP

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_开头的是 HAL 库</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=MDIWVIME))
> 
> 🏷️ #📝/重点

^KEYMDIWVIME

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_ll_开头的文件是 LL 库</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=3T7S645G))
> 
> 🏷️ #📝/重点

^KEY3T7S645G

> <span class="highlight" style="background-color: #f19837">7.3.2 HAL 库文件介绍</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=QQY2TIY6))
> 
> 🏷️ #📝/标题

^KEYQQY2TIY6

> <span class="highlight" style="background-color: #e56eee">sm32f1xx_hal.c stm32f1xx_hal.h</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=K7L8S8RV))
> 
> 🏷️ #📝/重点

^KEYK7L8S8RV

> <span class="highlight" style="background-color: #e56eee">初始化 HAL 库，（比如 HAL_Init,HAL_DeInit,HAL_Delay 等），主要实现 HLA 库的初始化、系统滴答，HAL 库延 时函数、IO 重映射和 DBGMCU 功能。</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=7YZLQWTQ))
> 
> 🏷️ #📝/重点

^KEY7YZLQWTQ

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_conf.h</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=URWNXBIS))
> 
> 🏷️ #📝/重点

^KEYURWNXBIS

> <span class="highlight" style="background-color: #e56eee">HAL 的用户配置文件，stm32f1xx_hal.h 引用了这个文 件，用来对 HAL 库进行裁剪。</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=5YSZP5WR))
> 
> 🏷️ #📝/重点

^KEY5YSZP5WR

> <span class="highlight" style="background-color: #e56eee">由于 Hal 库的很多配置都 是通过预编译的条件宏来决定是否使用这一 HAL 库的功</span> ([p101](zotero://open-pdf/library/items/JFGTX7CT?page=101&annotation=SWMWBKWV))
> 
> 🏷️ #📝/重点

^KEYSWMWBKWV

> <span class="highlight" style="background-color: #e56eee">无需修改库函数的源码，通过使能/不使能一些宏来实现 库函数的裁剪。</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=N7PTJAHP))
> 
> 🏷️ #📝/重点

^KEYN7PTJAHP

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_def.h</span>
> 
> 通用数据类型定义 ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=XUX5NJ6Z))
> 
> 🏷️ #📝/重点

^KEYXUX5NJ6Z

> <span class="highlight" style="background-color: #e56eee">通用 HAL 库资源定义，包含 HAL 的通用数据类型定义， 声明、枚举，结构体和宏定义。</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=DX7MALCK))
> 
> 🏷️ #📝/重点

^KEYDX7MALCK

> <span class="highlight" style="background-color: #e56eee">函数操作结果返 回值类型 HAL_StatusTypeDef 就是在这个文件中定义的</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=PMR5AB3Q))
> 
> 🏷️ #📝/重点

^KEYPMR5AB3Q

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_cortex.h stm32f1xx_hal_cortex.c</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=VZ6SWN5Y))
> 
> 🏷️ #📝/重点

^KEYVZ6SWN5Y

> <span class="highlight" style="background-color: #e56eee">它是一些 Cortex 内核通用函数声明和定义</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=4XY7IAU6))
> 
> 🏷️ #📝/重点

^KEY4XY7IAU6

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_ppp.c stm32f1xx_hal_ppp.h</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=QMW2RL4A))
> 
> 🏷️ #📝/重点

^KEYQMW2RL4A

> <span class="highlight" style="background-color: #e56eee">外设驱动函数</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=42HJN6LA))
> 
> 🏷️ #📝/重点

^KEY42HJN6LA

> <span class="highlight" style="background-color: #e56eee">ppp 代表一类外设</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=SKLLM8CC))
> 
> 🏷️ #📝/重点

^KEYSKLLM8CC

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_ppp_ex.c stm32f1xx_hal_ppp_ex.h</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=QDJ5MYUC))
> 
> 🏷️ #📝/重点

^KEYQDJ5MYUC

> <span class="highlight" style="background-color: #e56eee">外设特殊功能的 API 文件，作为标准外设驱动的功能补充 和扩展。</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=X4JFVJH7))
> 
> 🏷️ #📝/重点

^KEYX4JFVJH7

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_II_ppp.c stm32f1xx_II_ppp..h</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=S8XYR3LK))
> 
> 🏷️ #📝/重点

^KEYS8XYR3LK

> <span class="highlight" style="background-color: #e56eee">LL 库文件，在一些复杂外设中实现底层功能</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=W7JKUT5D))
> 
> 🏷️ #📝/重点

^KEYW7JKUT5D

> <span class="highlight" style="background-color: #e56eee">外设句柄 PPP_HandleTypedef</span>
> 
> 外设句柄：通常是一个指向外部设备的结构体或对象的指针或引用。
> 
> 外设句柄命名格式：PPP_HandleTypedef
> 
> 举个例子：“UART_HandleTypeDef* huart” 是一个外设句柄。其中“UART_HandleTypeDef” 是一个结构体，里面包含了关于 UART 控制操作，“huart” 是指向该结构体的指针 ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=BVU58SY2))
> 
> 🏷️ #📝/重点

^KEYBVU58SY2

> <span class="highlight" style="background-color: #e56eee">初始化/反初始化函数</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=UWTVHWPJ))
> 
> 🏷️ #📝/重点

^KEYUWTVHWPJ

> <span class="highlight" style="background-color: #e56eee">外设读写函数</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=4VP6DL7J))
> 
> 🏷️ #📝/重点

^KEY4VP6DL7J

> <span class="highlight" style="background-color: #e56eee">控制函数</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=S8J976UM))
> 
> 🏷️ #📝/重点

^KEYS8J976UM

> <span class="highlight" style="background-color: #e56eee">状态和错误</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=T89E5MRV))
> 
> 🏷️ #📝/重点

^KEYT89E5MRV

> <span class="highlight" style="background-color: #e56eee">定义好的结构体将参数一次性传给所需函数</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=PIWSUBDE))
> 
> 🏷️ #📝/重点

^KEYPIWSUBDE

> <span class="highlight" style="background-color: #e56eee">配置和初始化用的结构体</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=AIEA5KDQ))
> 
> 🏷️ #📝/重点

^KEYAIEA5KDQ

> <span class="highlight" style="background-color: #e56eee">PPP_InitTypeDef</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=IBB4BJRG))
> 
> 🏷️ #📝/重点

^KEYIBB4BJRG

> <span class="highlight" style="background-color: #e56eee">PPP_ConfTypeDef</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=UJWUIYBK))
> 
> 🏷️ #📝/重点

^KEYUJWUIYBK

> <span class="highlight" style="background-color: #e56eee">特殊处理的结构体</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=ILX2DUV8))
> 
> 🏷️ #📝/重点

^KEYILX2DUV8

> <span class="highlight" style="background-color: #e56eee">“Process”</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=MBLGXZ8L))
> 
> 🏷️ #📝/重点

^KEYMBLGXZ8L

> <span class="highlight" style="background-color: #e56eee">外设句柄结构体</span> ([p102](zotero://open-pdf/library/items/JFGTX7CT?page=102&annotation=KQDSTG5K))
> 
> 🏷️ #📝/重点

^KEYKQDSTG5K

> <span class="highlight" style="background-color: #e56eee">但 对 于 SYSTICK/NVIC/RCC/FLASH/GPIO 这 些 内 核 外 设 或 共 享 资 源 ， 不 使 用 PPP_HandleTypedef 这类外设句柄进行控制，如 The HAL_GPIO_Init()只需要初始化的 GPIO 编 号和具体的初始化参数。</span> ([p103](zotero://open-pdf/library/items/JFGTX7CT?page=103&annotation=ZCCELDSL))
> 
> 🏷️ #📝/重点

^KEYZCCELDSL

> <span class="highlight" style="background-color: #e56eee">这部分允许用户重定义，并在其中实现用户自定义的 功能</span> ([p103](zotero://open-pdf/library/items/JFGTX7CT?page=103&annotation=K8F4KGWT))
> 
> 🏷️ #📝/重点

^KEYK8F4KGWT

> <span class="highlight" style="background-color: #e56eee">由 HAL_PPP_Init()这个 API 调用，主要在这个 函数中实现外设对应的 GPIO、时钟、DMA， 和中断开启的配置和操作</span> ([p103](zotero://open-pdf/library/items/JFGTX7CT?page=103&annotation=TZSBFECN))
> 
> 🏷️ #📝/重点

^KEYTZSBFECN

> <span class="highlight" style="background-color: #e56eee">由外设中断 或 DMA 中断调用</span> ([p103](zotero://open-pdf/library/items/JFGTX7CT?page=103&annotation=MXVCZE7Y))
> 
> 🏷️ #📝/重点

^KEYMXVCZE7Y

> <span class="highlight" style="background-color: #e56eee">中断中发生的错误，用于作错误处理</span> ([p103](zotero://open-pdf/library/items/JFGTX7CT?page=103&annotation=HRHHCK8L))
> 
> 🏷️ #📝/重点

^KEYHRHHCK8L

> <span class="image#e56eee">null</span>hal库帮助文档的API描述 ([p104](zotero://open-pdf/library/items/JFGTX7CT?page=104&annotation=MMU8JEJH))

^KEYMMU8JEJH

> <span class="highlight" style="background-color: #f19837">7.4 如何使用 HAL 库</span> ([p105](zotero://open-pdf/library/items/JFGTX7CT?page=105&annotation=YTURXUWE))
> 
> 🏷️ #📝/标题

^KEYYTURXUWE

> <span class="highlight" style="background-color: #f19837">7.4.1 学会用 HAL 库组织开发工具链</span> ([p105](zotero://open-pdf/library/items/JFGTX7CT?page=105&annotation=ZLYGJ4PJ))
> 
> 🏷️ #📝/标题

^KEYZLYGJ4PJ

> <span class="highlight" style="background-color: #e56eee">ST 提供芯片使用手册《STM32F1xx 参考手册.pdf》 告诉我们使用某一外设功能时如何具体地去操作每一个用到的寄存器的细节</span> ([p105](zotero://open-pdf/library/items/JFGTX7CT?page=105&annotation=FT4IDKFQ))
> 
> 🏷️ #📝/重点

^KEYFT4IDKFQ

> <span class="highlight" style="background-color: #e56eee">基于 CMSIS 的一个 HAL 库应用程序文件结构</span> ([p105](zotero://open-pdf/library/items/JFGTX7CT?page=105&annotation=AABVYCAH))
> 
> 🏷️ #📝/重点

^KEYAABVYCAH

> <span class="image#e56eee">null</span>基于CMSIS应用程序文件描述 ([p105](zotero://open-pdf/library/items/JFGTX7CT?page=105&annotation=CJD3BY6C))

^KEYCJD3BY6C

> <span class="highlight" style="background-color: #e56eee">基于 CMSIS 应用程序文件描述</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=9DIIWYYK))
> 
> 🏷️ #📝/重点

^KEY9DIIWYYK

> <span class="highlight" style="background-color: #f19837">7.4.2 HAL 库的用户配置文件</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=4XVI9L48))
> 
> 🏷️ #📝/标题

^KEY4XVI9L48

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_hal_conf.h 用于裁剪 HAL 库和定义一些变量</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=WQQ2N7VK))
> 
> 🏷️ #📝/重点

^KEYWQQ2N7VK

> <span class="highlight" style="background-color: #e56eee">（1）配置外部高速晶振的频率。</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=972DPMEF))
> 
> 🏷️ #📝/重点

^KEY972DPMEF

> <span class="highlight" style="background-color: #e56eee">根据我们板子外部焊接的晶振频率来修改，源码在 78 行开始，官方默认是 25M。</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=NR594PW4))
> 
> 🏷️ #📝/重点

^KEYNR594PW4

> <span class="highlight" style="background-color: #e56eee">（2）还有一个参数就是外部低速晶振频率</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=WW7AWUCC))
> 
> 🏷️ #📝/重点

^KEYWW7AWUCC

> <span class="highlight" style="background-color: #e56eee">（3）用户配置文件可以用来选择使能何种外设</span> ([p106](zotero://open-pdf/library/items/JFGTX7CT?page=106&annotation=UPTE2U4Q))
> 
> 🏷️ #📝/重点

^KEYUPTE2U4Q

> <span class="highlight" style="background-color: #e56eee">这是一个条件编译符，与#endif 配合使用。这里的要表达的意思是，只要工程中定义了 HAL_GPIO_MODULE_ENABLED 这个宏，就会包含 stm32f1xx_hal_gpio.h 这个头文件到 我们的工程，同时 stm32f1xx_hal_gpio.c 中的#ifdef 到#endif 之间的程序（116 行到 579 行）就 会参与编译，否则不编译。所以只要我们屏蔽了 stm32f1xx_hal_conf.h 文件 49 行的宏，GPIO 的驱动代码就不被编译。也就起到选择使能何种外设的功能，其他外设同理。使用时定义，否 则不定义。这样就可以在不修改源码的前提下方便地裁剪 HAL 库代码的体积了</span>
> 
> 讲述了通过注释宏从而达到裁剪外设功能的目的。当没有定义指定的宏时，就不会包含相应的头文件，相关的代码就不会被编译。 ([p107](zotero://open-pdf/library/items/JFGTX7CT?page=107&annotation=T7482JYD))
> 
> 🏷️ #📝/重点

^KEYT7482JYD

> <span class="highlight" style="background-color: #e56eee">#define HAL_MODULE_ENABLED 它决定了《stm32f1xx_hal.c》中的第 47~587 行的代码是否能使用，也是根据条件编译来 实现的。其中包含 HAL_Init()、HAL_Delay()、HAL_GetTick()这些其它驱动函数可能需要引用 的函数，所以这个宏也是必须要定义的。</span> ([p107](zotero://open-pdf/library/items/JFGTX7CT?page=107&annotation=37P2M6RY))
> 
> 🏷️ #📝/重点

^KEY37P2M6RY

> <span class="highlight" style="background-color: #e56eee">通过屏蔽外设的宏的方法来选择使能何种外设</span> ([p107](zotero://open-pdf/library/items/JFGTX7CT?page=107&annotation=EWIAHE3A))
> 
> 🏷️ #📝/重点

^KEYEWIAHE3A

> <span class="highlight" style="background-color: #e56eee">正点原子的例程选择另 外一种方法，就是工程中只保留需要的 stm32f1xx_hal_ppp.c，不需要的不添加到工程里</span> ([p107](zotero://open-pdf/library/items/JFGTX7CT?page=107&annotation=PAUZJ7BY))
> 
> 🏷️ #📝/重点

^KEYPAUZJ7BY

> <span class="highlight" style="background-color: #e56eee">#define TICK_INT_PRIORITY ((uint32_t)0x0F)</span> ([p107](zotero://open-pdf/library/items/JFGTX7CT?page=107&annotation=C7KJ9G49))
> 
> 🏷️ #📝/重点

^KEYC7KJ9G49

> <span class="highlight" style="background-color: #e56eee">滴答定时器的中断优先级一定要 比这些中断高</span> ([p107](zotero://open-pdf/library/items/JFGTX7CT?page=107&annotation=IPYJQYPQ))
> 
> 🏷️ #📝/重点

^KEYIPYJQYPQ

> <span class="highlight" style="background-color: #e56eee">总的来说断言功能就是，在 HAL 库中，如果定义了 USE_FULL_ASSERT 这个宏，那么 所有的 HAL 库函数将会检查函数的形参是否正确。如果错误将会调用 assert_failed()这个函 数，程序就会停留在这里，用户可以定位到出错的函数。这个功能实际上是在芯片上运行的时 候的增加错误提示信息的功能，属于调试功能的一部分，实际我们的编译器就可以帮助定位到 参数错误的问题并提示信息。</span> ([p108](zotero://open-pdf/library/items/JFGTX7CT?page=108&annotation=CJFYUB76))
> 
> 🏷️ #📝/重点

^KEYCJFYUB76

> <span class="highlight" style="background-color: #f19837">7.4.3 stm32f1xx_hal.c 文件</span> ([p108](zotero://open-pdf/library/items/JFGTX7CT?page=108&annotation=GITADXJS))
> 
> 🏷️ #📝/标题

^KEYGITADXJS

> <span class="highlight" style="background-color: #e56eee">HAL_Init()函数</span> ([p108](zotero://open-pdf/library/items/JFGTX7CT?page=108&annotation=425SET8D))
> 
> 🏷️ #📝/重点

^KEY425SET8D

> <span class="highlight" style="background-color: #e56eee">使能 Flash 的预取缓冲器</span> ([p108](zotero://open-pdf/library/items/JFGTX7CT?page=108&annotation=ZAYZLJTR))
> 
> 🏷️ #📝/重点

^KEYZAYZLJTR

> <span class="highlight" style="background-color: #e56eee">设置 NVIC 优先级分组为 4</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=SCIACKMH))
> 
> 🏷️ #📝/重点

^KEYSCIACKMH

> <span class="highlight" style="background-color: #e56eee">配置滴答定时器每 1ms 产生一个中断</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=M4B7XI65))
> 
> 🏷️ #📝/重点

^KEYM4B7XI65

> <span class="highlight" style="background-color: #e56eee">在这个阶段，系统时钟还没有配置好，因此系统还是默认使用内部高速时钟源 HSI 在跑 程序。对于 F1 来说，HSI 的主频是 8MHZ。所以如果用户不配置系统时钟的话，那么系统将 会使用 HSI 作为系统时钟源。</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=LF9QM2HM))
> 
> 🏷️ #📝/重点

^KEYLF9QM2HM

> <span class="highlight" style="background-color: #e56eee">调用 HAL_MspInit 函数初始化底层硬件</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=VMQZMENC))
> 
> 🏷️ #📝/重点

^KEYVMQZMENC

> <span class="highlight" style="background-color: #e56eee">正点原子的 HAL 库例程中的中断优先级分组设置为分组 2</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=W5IP83TB))
> 
> 🏷️ #📝/重点

^KEYW5IP83TB

> <span class="highlight" style="background-color: #e56eee">HAL_DeInit ()函数</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=JBVF72SK))
> 
> 🏷️ #📝/重点

^KEYJBVF72SK

> <span class="highlight" style="background-color: #e56eee">复位了 APB1、APB2 的时钟。</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=WFKMWH6I))
> 
> 🏷️ #📝/重点

^KEYWFKMWH6I

> <span class="highlight" style="background-color: #e56eee">调用 HAL_MspDeInit 函数，对底层硬件初始化进行复位。</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=29AMHNG7))
> 
> 🏷️ #📝/重点

^KEY29AMHNG7

> <span class="highlight" style="background-color: #e56eee">HAL_InitTick ()函数</span> ([p109](zotero://open-pdf/library/items/JFGTX7CT?page=109&annotation=XSWN3BJR))
> 
> 🏷️ #📝/重点

^KEYXSWN3BJR

> <span class="highlight" style="background-color: #e56eee">初始化滴答定时器的时钟基准</span> ([p110](zotero://open-pdf/library/items/JFGTX7CT?page=110&annotation=JWYZY3B6))
> 
> 🏷️ #📝/重点

^KEYJWYZY3B6

> <span class="highlight" style="background-color: #e56eee">配置滴答定时器 1ms 产生一次中断。</span> ([p110](zotero://open-pdf/library/items/JFGTX7CT?page=110&annotation=AKW2QUNT))
> 
> 🏷️ #📝/重点

^KEYAKW2QUNT

> <span class="highlight" style="background-color: #e56eee">配置滴答定时器的中断优先级。</span> ([p110](zotero://open-pdf/library/items/JFGTX7CT?page=110&annotation=XAIPR3V9))
> 
> 🏷️ #📝/重点

^KEYXAIPR3V9

> <span class="highlight" style="background-color: #e56eee">该函数是__weak 修饰的函数，如果在关联工程中的其它地方没有定义__weak 后面的 函数，这里是 HAL_InitTick()，则使用此处的定义，否则就使用其它地方定义好的函数功能。</span>
> 
> __weak修饰的函数的特点 ([p110](zotero://open-pdf/library/items/JFGTX7CT?page=110&annotation=TE35RXD6))
> 
> 🏷️ #📝/重点

^KEYTE35RXD6

> <span class="highlight" style="background-color: #e56eee">滴答定时器相关的函数</span> ([p110](zotero://open-pdf/library/items/JFGTX7CT?page=110&annotation=79F3KBE6))
> 
> 🏷️ #📝/重点

^KEY79F3KBE6

> <span class="highlight" style="background-color: #e56eee">HAL 库版本相关的函数</span> ([p111](zotero://open-pdf/library/items/JFGTX7CT?page=111&annotation=Z4K3DJ3K))
> 
> 🏷️ #📝/重点

^KEYZ4K3DJ3K

> <span class="highlight" style="background-color: #e56eee">调试功能相关函数</span> ([p112](zotero://open-pdf/library/items/JFGTX7CT?page=112&annotation=5RMD3CHQ))
> 
> 🏷️ #📝/重点

^KEY5RMD3CHQ

> <span class="highlight" style="background-color: #f19837">7.4.4 HAL 库中断处理</span> ([p112](zotero://open-pdf/library/items/JFGTX7CT?page=112&annotation=M478ZHNI))
> 
> 🏷️ #📝/标题

^KEYM478ZHNI

> <span class="highlight" style="background-color: #e56eee">设置外设的控制句柄结构体 PPP_HandleType 和初始化 PPP_InitType 结构体的参数，然后调用 HAL 库对应这个驱动的初始 化 HAL_PPP_Init()，由于这个 API 中有针对外设初始化细节的接口 Hal_PPP_Mspinit()，我们需 要重新实现这个函数并完成外设时钟、IO 等细节差异的设置，完成各细节处理后，使用 HAL_NVIC_SetPriority()、HAL_NVIC_EnableIRQ()来使能我们的外设中断；</span> ([p112](zotero://open-pdf/library/items/JFGTX7CT?page=112&annotation=SWMYUCEP))
> 
> 🏷️ #📝/重点

^KEYSWMYUCEP

> <span class="highlight" style="background-color: #e56eee">定义中断处理函数 PPP_IRQHandler，并在中断函数中调用 HAL_ppp_function_IRQHandler() 来判断和处理中断标记；HAL 库中断处理完成后，根据对应中的调用我们需要自定义的中断回 调接口 HAL_PPP_ProcessCpltCallback();如串口接收函数 HAL_UART_RxCpltCallback()，我们在 这个函数中实现我们对串口接收数据想做的处理;</span> ([p112](zotero://open-pdf/library/items/JFGTX7CT?page=112&annotation=LGL4BTFF))
> 
> 🏷️ #📝/重点

^KEYLGL4BTFF

> <span class="highlight" style="background-color: #f19837">7.4.5 正点原子对 HAL 库用法的个性化修改</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=I25H8RWR))
> 
> 🏷️ #📝/标题

^KEYI25H8RWR

> <span class="highlight" style="background-color: #e56eee">将中断处理函数独立到每个外设中，便于独立驱动；同类型的外设驱动处理函数不使用 HAL 回调函数接口处理操作而直接在中断函数中处理判断对应中断；</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=AMVYZ2TT))
> 
> 🏷️ #📝/重点

^KEYAMVYZ2TT

> <span class="highlight" style="background-color: #e56eee">使用 delay.c 中的延时函数取 代 Hal_Delay();取消原来 HAL 库的 Systick 延时设置。</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=3WG35KBR))
> 
> 🏷️ #📝/重点

^KEY3WG35KBR

> <span class="highlight" style="background-color: #f19837">7.5 HAL 库使用注意事项</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=7QL28H6L))
> 
> 🏷️ #📝/标题

^KEY7QL28H6L

> <span class="highlight" style="background-color: #e56eee">把我们需要编写的软件和第三方的库分开 成相互独立的文件</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=KIPPA274))
> 
> 🏷️ #📝/重点

^KEYKIPPA274

> <span class="highlight" style="background-color: #e56eee">注意 HAL 库的执行效率</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=6UFEQBG6))
> 
> 🏷️ #📝/重点

^KEY6UFEQBG6

> <span class="highlight" style="background-color: #e56eee">使用 delay.c 中的延时函数取代 Hal_Delay();取消原来 HAL 库的 Systick 延 时设置</span> ([p113](zotero://open-pdf/library/items/JFGTX7CT?page=113&annotation=7FZJ9XDY))
> 
> 🏷️ #📝/重点

^KEY7FZJ9XDY

> <span class="highlight" style="background-color: #f19837">第八章 新建 HAL 版本 MDK 工程</span> ([p114](zotero://open-pdf/library/items/JFGTX7CT?page=114&annotation=HCKP2K3E))
> 
> 🏷️ #📝/标题

^KEYHCKP2K3E

> <span class="highlight" style="background-color: #f19837">8.1 新建 HAL 库版本 MDK 工程</span> ([p114](zotero://open-pdf/library/items/JFGTX7CT?page=114&annotation=MCKRHNKB))
> 
> 🏷️ #📝/标题

^KEYMCKRHNKB

> <span class="highlight" style="background-color: #f19837">8.1.1 新建工程文件夹</span> ([p114](zotero://open-pdf/library/items/JFGTX7CT?page=114&annotation=7AHC7NFP))
> 
> 🏷️ #📝/标题

^KEY7AHC7NFP

> <span class="highlight" style="background-color: #e56eee">工程根文件目录下还有一个名为 keilkill.bat 的可执行文件，双击便可执行。其 作用是删除编译器编译后的中间文件，减少工程占用的硬盘空间，方便我们打包。</span> ([p115](zotero://open-pdf/library/items/JFGTX7CT?page=115&annotation=PCCVU44P))
> 
> 🏷️ #📝/重点

^KEYPCCVU44P

> <span class="highlight" style="background-color: #e56eee">Drivers 文件夹</span> ([p115](zotero://open-pdf/library/items/JFGTX7CT?page=115&annotation=7Z5UAG5P))
> 
> 🏷️ #📝/重点

^KEY7Z5UAG5P

> <span class="highlight" style="background-color: #e56eee">BSP 文件夹，用于存放正点原子提供的板级支持包驱动代码</span> ([p115](zotero://open-pdf/library/items/JFGTX7CT?page=115&annotation=TIGHU48W))
> 
> 🏷️ #📝/重点

^KEYTIGHU48W

> <span class="highlight" style="background-color: #e56eee">SYSTEM 文件夹，用于存放正点原子提供的系统级核心驱动代码，sys.c/h,usart.c/h,delay.c/h</span> ([p115](zotero://open-pdf/library/items/JFGTX7CT?page=115&annotation=J5XJ2YCX))
> 
> 🏷️ #📝/重点

^KEYJ5XJ2YCX

> <span class="highlight" style="background-color: #e56eee">CMSIS 文件夹，用于存放 CMSIS 底层代码</span> ([p115](zotero://open-pdf/library/items/JFGTX7CT?page=115&annotation=VU7ZBM9K))
> 
> 🏷️ #📝/重点

^KEYVU7ZBM9K

> <span class="highlight" style="background-color: #e56eee">打开目录“CMSIS\Device\ ST\STM32F1xx”，其中的 Include 文件夹</span> ([p115](zotero://open-pdf/library/items/JFGTX7CT?page=115&annotation=UVDRB5U9))
> 
> 🏷️ #📝/重点

^KEYUVDRB5U9

> <span class="highlight" style="background-color: #e56eee">Source 文件夹下的 Templates 文件夹</span> ([p116](zotero://open-pdf/library/items/JFGTX7CT?page=116&annotation=CSFL8CV2))
> 
> 🏷️ #📝/重点

^KEYCSFL8CV2

> <span class="highlight" style="background-color: #e56eee">arm 文件夹存放的是启动文件</span> ([p116](zotero://open-pdf/library/items/JFGTX7CT?page=116&annotation=M8E4QWFC))
> 
> 🏷️ #📝/重点

^KEYM8E4QWFC

> <span class="highlight" style="background-color: #e56eee">CMSIS 文件夹下的 Include 文件夹</span> ([p116](zotero://open-pdf/library/items/JFGTX7CT?page=116&annotation=HLF5PC6N))
> 
> 🏷️ #📝/重点

^KEYHLF5PC6N

> <span class="highlight" style="background-color: #e56eee">Middlewares 文件夹</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=4FQHDFMH))
> 
> 🏷️ #📝/重点

^KEY4FQHDFMH

> <span class="highlight" style="background-color: #e56eee">Middlewares 文件夹用于存放正点原子提供的中间层组件文件和第三方中间层文件</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=2XDFPHI8))
> 
> 🏷️ #📝/重点

^KEY2XDFPHI8

> <span class="highlight" style="background-color: #e56eee">Output 文件夹</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=M5MQCWK9))
> 
> 🏷️ #📝/重点

^KEYM5MQCWK9

> <span class="highlight" style="background-color: #e56eee">Output 文件夹用于存放编译器编译工程输出的中间文件，比如：.hex、.bin、.o 文件等</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=KBRBV35S))
> 
> 🏷️ #📝/重点

^KEYKBRBV35S

> <span class="highlight" style="background-color: #e56eee">Projects 文件夹</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=4UXELIZ5))
> 
> 🏷️ #📝/重点

^KEY4UXELIZ5

> <span class="highlight" style="background-color: #e56eee">User 文件夹</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=ICD6AP35))
> 
> 🏷️ #📝/重点

^KEYICD6AP35

> <span class="highlight" style="background-color: #e56eee">User 文件夹用于存放 HAL 库用户配置文件、main.c、中断处理文件，以及配置文件 stm32f1xx_hal_conf.h。</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=YAW3V85V))
> 
> 🏷️ #📝/重点

^KEYYAW3V85V

> <span class="highlight" style="background-color: #e56eee">stm32f1xx_it.c、 stm32f1xx_it.h、stm32f1xx_hal_conf.h</span> ([p117](zotero://open-pdf/library/items/JFGTX7CT?page=117&annotation=MNI7J76Q))
> 
> 🏷️ #📝/重点

^KEYMNI7J76Q

> <span class="highlight" style="background-color: #f19837">8.1.2 新建一个工程框架</span> ([p118](zotero://open-pdf/library/items/JFGTX7CT?page=118&annotation=DI2YUIA3))
> 
> 🏷️ #📝/标题

^KEYDI2YUIA3

> <span class="highlight" style="background-color: #e56eee">还需要把自己需要用到的文件添加到工程里面</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=CIWHYAQR))
> 
> 🏷️ #📝/重点

^KEYCIWHYAQR

> <span class="highlight" style="background-color: #e56eee">并没有关联到工程里面</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=HRBEXJY4))
> 
> 🏷️ #📝/重点

^KEYHRBEXJY4

> <span class="highlight" style="background-color: #e56eee">atk_f103.uvprojx 是工程文件，非常关键，不能轻易删除</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=AFGU2K49))
> 
> 🏷️ #📝/重点

^KEYAFGU2K49

> <span class="highlight" style="background-color: #e56eee">把 Listings 和 Objects 文件夹删除</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=QLXCIHKB))
> 
> 🏷️ #📝/重点

^KEYQLXCIHKB

> <span class="highlight" style="background-color: #e56eee">编译中间文件存放到 Output 文件夹</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=TH42CIMR))
> 
> 🏷️ #📝/重点

^KEYTH42CIMR

> <span class="highlight" style="background-color: #f19837">8.1.3 添加文件</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=2AG578US))
> 
> 🏷️ #📝/标题

^KEY2AG578US

> <span class="highlight" style="background-color: #e56eee">设置工程名和分组名</span> ([p120](zotero://open-pdf/library/items/JFGTX7CT?page=120&annotation=22JP72N9))
> 
> 🏷️ #📝/重点

^KEY22JP72N9

> <span class="highlight" style="background-color: #e56eee">添加启动文件</span> ([p122](zotero://open-pdf/library/items/JFGTX7CT?page=122&annotation=9AVUVB52))
> 
> 🏷️ #📝/重点

^KEY9AVUVB52

> <span class="highlight" style="background-color: #e56eee">3. 添加 User 源码</span> ([p123](zotero://open-pdf/library/items/JFGTX7CT?page=123&annotation=QP779LBX))
> 
> 🏷️ #📝/重点

^KEYQP779LBX

> <span class="highlight" style="background-color: #e56eee">4. 添加 SYSTEM 源码</span> ([p124](zotero://open-pdf/library/items/JFGTX7CT?page=124&annotation=RBLS4FJA))
> 
> 🏷️ #📝/重点

^KEYRBLS4FJA

> <span class="highlight" style="background-color: #e56eee">添加 STM32F1xx_HAL_Driver 源码</span> ([p124](zotero://open-pdf/library/items/JFGTX7CT?page=124&annotation=Q6YDZMK4))
> 
> 🏷️ #📝/重点

^KEYQ6YDZMK4

> <span class="highlight" style="background-color: #f19837">8.1.4 魔术棒设置</span> ([p126](zotero://open-pdf/library/items/JFGTX7CT?page=126&annotation=KVKHTSVN))
> 
> 🏷️ #📝/标题

^KEYKVKHTSVN

> <span class="highlight" style="background-color: #e56eee">1. 设置 Target 选项卡</span> ([p126](zotero://open-pdf/library/items/JFGTX7CT?page=126&annotation=DTR78UT3))
> 
> 🏷️ #📝/重点

^KEYDTR78UT3

> <span class="highlight" style="background-color: #e56eee">2. 设置 Output 选项卡</span> ([p127](zotero://open-pdf/library/items/JFGTX7CT?page=127&annotation=6J8496WN))
> 
> 🏷️ #📝/重点

^KEY6J8496WN

> <span class="highlight" style="background-color: #e56eee">3. 设置 Listing 选项卡</span> ([p127](zotero://open-pdf/library/items/JFGTX7CT?page=127&annotation=V3CSI9FT))
> 
> 🏷️ #📝/重点

^KEYV3CSI9FT

> <span class="highlight" style="background-color: #e56eee">4. 设置 C/C++选项卡</span> ([p127](zotero://open-pdf/library/items/JFGTX7CT?page=127&annotation=GKY97CB6))
> 
> 🏷️ #📝/重点

^KEYGKY97CB6

> <span class="highlight" style="background-color: #e56eee">5. 设置 Debug 选项卡</span> ([p129](zotero://open-pdf/library/items/JFGTX7CT?page=129&annotation=W65Y2ZQE))
> 
> 🏷️ #📝/重点

^KEYW65Y2ZQE

> <span class="highlight" style="background-color: #e56eee">6. 设置 Utilities 选项卡</span> ([p130](zotero://open-pdf/library/items/JFGTX7CT?page=130&annotation=SPGYSCJ3))
> 
> 🏷️ #📝/重点

^KEYSPGYSCJ3

> <span class="highlight" style="background-color: #f19837">8.1.5 添加 main.c，并编写代码</span> ([p130](zotero://open-pdf/library/items/JFGTX7CT?page=130&annotation=TPW6DHF8))
> 
> 🏷️ #📝/标题

^KEYTPW6DHF8

> <span class="highlight" style="background-color: #f19837">8.2 下载验证</span> ([p132](zotero://open-pdf/library/items/JFGTX7CT?page=132&annotation=AGEXFHI6))
> 
> 🏷️ #📝/标题

^KEYAGEXFHI6

> <span class="highlight" style="background-color: #e56eee">启动过程是指从 STM32 芯片上电复位执 行的第一条指令开始，到执行用户编写的 main 函数这之间的过程。</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=U3VU4ZHE))
> 
> 🏷️ #📝/重点

^KEYU3VU4ZHE

> <span class="highlight" style="background-color: #f19837">9.1 启动模式</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=EALC5UJ6))
> 
> 🏷️ #📝/标题

^KEYEALC5UJ6

> <span class="highlight" style="background-color: #e56eee">从地址 0x0000 0000 处取出堆栈指针 MSP 的初始值，该值就是栈顶地址。</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=VVKQ4T9M))

^KEYVVKQ4T9M

> <span class="highlight" style="background-color: #e56eee">CM3 内核做的第一件事就是读取下列两个 32 位整数的值： （1）从地址 0x0000 0000 处取出堆栈指针 MSP 的初始值，该值就是栈顶地址。 （2）从地址 0x0000 0004 处取出程序计数器指针 PC 的初始值，该值指向复位后执行的第 一条指令。</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=DP28HQVK))
> 
> 🏷️ #📝/重点

^KEYDP28HQVK

> <span class="highlight" style="background-color: #e56eee">从地址 0x0000 0004 处取出程序计数器指针 PC 的初始值，该值指向复位后执行的第 一条指令。</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=YY3KXCHV))

^KEYYY3KXCHV

> <span class="highlight" style="background-color: #e56eee">事实上，0x0000 0000 和 0x0000 0004 两个的地址可以被重映射到其他的地址空 间。</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=KLYAZD72))
> 
> 🏷️ #📝/重点

^KEYKLYAZD72

> <span class="highlight" style="background-color: #e56eee">CPU 会从 PC 寄存器指向的地址空间取出的第 1 条指令开始执行程序，就是开始 执行复位中断服务程序 Reset_Handler。</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=FJKX8YGB))
> 
> 🏷️ #📝/重点

^KEYFJKX8YGB

> <span class="highlight" style="background-color: #e56eee">将 0x0000 0000 和 0x0000 0004 两个地址重映射到其他 的地址空间，就是启动模式选择</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=NFJGFGRX))
> 
> 🏷️ #📝/重点

^KEYNFJGFGRX

> <span class="image#e56eee">null</span>启动模式选择表 ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=ALB5N9A7))

^KEYALB5N9A7

> <span class="highlight" style="background-color: #e56eee">（1）内部 FLASH 启动方式</span> ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=RAN5Z3CY))
> 
> 🏷️ #📝/重点

^KEYRAN5Z3CY

> <span class="highlight" style="background-color: #e56eee">0x00000000 和 0x00000004 地址被映射到 内部 FLASH 的首地址 0x08000000 和 0x08000004。</span>
> 
> 意味着处理器在访问逻辑地址0x00000000和0x00000004时，实际上访问的是内部FLASH的物理地址0x08000000和0x08000004处的内容 ([p133](zotero://open-pdf/library/items/JFGTX7CT?page=133&annotation=HAECTAHB))
> 
> 🏷️ #📝/重点

^KEYHAECTAHB

> <span class="highlight" style="background-color: #e56eee">（2）内部 SRAM 启动方式</span> ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=FFDGYCR8))
> 
> 🏷️ #📝/重点

^KEYFFDGYCR8

> <span class="highlight" style="background-color: #e56eee">0x00000000 和 0x00000004 被映射到内部 SRAM 的首地址 0x20000000 和 0x20000004，内核从 SRAM 空间获取内容进行自举</span>
> 
> 自举特指处理器在启动时从某个固定地址加载并执行的初始化代码，以引导整个系统的运行。 ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=MV4Y4PAM))
> 
> 🏷️ #📝/重点

^KEYMV4Y4PAM

> <span class="highlight" style="background-color: #e56eee">在实际应用中，由启动文件 starttup_stm32f103xe.s 决定了 0x00000000 和 0x00000004 地址存储什么内容，链接时，由分散加载文件(sct)决定这些内容的绝 对地址，即分配到内部 FLASH 还是内部 SRAM。</span>
> 
> 在starttup_stm32f103xe.s中，
> 
> DCD     __initial_sp       ; Top of Stack
> 
> DCD     Reset_Handler  ; Reset Handler
> 
> 这两行代码决定着0x00000000 和 0x00000004分别存放着栈顶指针和复位处理函数的入口地址。
> 
> 但0x00000000 和 0x00000004只是逻辑地址，逻辑上处理器从0x00000000处开始访问，但实际访问的物理地址可能不是这里，是由分散加载文件(sct)决定的。 ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=LY2M2FV5))
> 
> 🏷️ #📝/重点

^KEYLY2M2FV5

> <span class="highlight" style="background-color: #e56eee">（3）系统存储器启动方式</span> ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=I8QDJ544))
> 
> 🏷️ #📝/重点

^KEYI8QDJ544

> <span class="highlight" style="background-color: #e56eee">从系统存储器的 0x1FFFF000 及 0x1FFFF004 获取 MSP 及 PC 值进行自举</span> ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=Y8PVMY96))
> 
> 🏷️ #📝/重点

^KEYY8PVMY96

> <span class="highlight" style="background-color: #f19837">9.2 启动文件分析</span>
> 
> 详细讲述见文档：“STM32 启动文件浅析_V1.2” ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=4AZEBYLT))
> 
> 🏷️ #📝/标题

^KEY4AZEBYLT

> <span class="highlight" style="background-color: #f19837">9.2.1 启动文件中的一些指令</span> ([p134](zotero://open-pdf/library/items/JFGTX7CT?page=134&annotation=644V64QV))
> 
> 🏷️ #📝/标题

^KEY644V64QV

> <span class="highlight" style="background-color: #f19837">9.2.2 启动文件代码讲解</span> ([p136](zotero://open-pdf/library/items/JFGTX7CT?page=136&annotation=2RTUEN94))
> 
> 🏷️ #📝/标题

^KEY2RTUEN94

> <span class="highlight" style="background-color: #e56eee">如果没有定义__MICROLIB，实际的情况就是我们没有定义__MICROLIB，所以使用默认 的 C 库运行。那么堆栈的初始化由 C 库函数__main 来完成。</span> ([p140](zotero://open-pdf/library/items/JFGTX7CT?page=140&annotation=36NL39QN))
> 
> 🏷️ #📝/重点

^KEY36NL39QN

> <span class="highlight" style="background-color: #f19837">9.2.3 系统启动流程</span> ([p140](zotero://open-pdf/library/items/JFGTX7CT?page=140&annotation=EU3K24BT))
> 
> 🏷️ #📝/标题

^KEYEU3K24BT

> <span class="highlight" style="background-color: #f19837">9.3 map 文件分析</span> ([p142](zotero://open-pdf/library/items/JFGTX7CT?page=142&annotation=TZUPZUU4))
> 
> 🏷️ #📝/标题

^KEYTZUPZUU4

> <span class="highlight" style="background-color: #f19837">9.3.1 MDK 编译生成文件简介</span> ([p142](zotero://open-pdf/library/items/JFGTX7CT?page=142&annotation=NSDYS7R4))
> 
> 🏷️ #📝/标题

^KEYNSDYS7R4

> <span class="highlight" style="background-color: #f19837">.3.2 map 文件分析</span> ([p143](zotero://open-pdf/library/items/JFGTX7CT?page=143&annotation=5LHVI92Y))
> 
> 🏷️ #📝/标题

^KEY5LHVI92Y

> <span class="highlight" style="background-color: #f19837">第十章 STM32CubeMX 简介</span> ([p147](zotero://open-pdf/library/items/JFGTX7CT?page=147&annotation=T5FKKXS2))
> 
> 🏷️ #📝/标题

^KEYT5FKKXS2

> <span class="highlight" style="background-color: #f19837">10.1 STM32CubeMX 的作用</span> ([p147](zotero://open-pdf/library/items/JFGTX7CT?page=147&annotation=6IJYPF7X))
> 
> 🏷️ #📝/标题

^KEY6IJYPF7X

> <span class="highlight" style="background-color: #e56eee">STM32Cube 包 含 STM32CubeMX 图形工具和 STM32Cube 库两个部分，使用 STM32CubeMX 配置生成的代 码，是基于 STM32Cube 库的</span> ([p147](zotero://open-pdf/library/items/JFGTX7CT?page=147&annotation=MUNQJ3DE))
> 
> 🏷️ #📝/重点

^KEYMUNQJ3DE

> <span class="highlight" style="background-color: #f19837">10.2 安装 STM32CubeMX</span> ([p148](zotero://open-pdf/library/items/JFGTX7CT?page=148&annotation=I92CYSZX))
> 
> 🏷️ #📝/标题

^KEYI92CYSZX

> <span class="highlight" style="background-color: #f19837">10.2.1 安装 JAVA 环境</span> ([p148](zotero://open-pdf/library/items/JFGTX7CT?page=148&annotation=QVLPRH3I))
> 
> 🏷️ #📝/标题

^KEYQVLPRH3I

> <span class="highlight" style="background-color: #f19837">版本 10.2.2 安装 STM32CubeMX 在安装了 Java 运行环境之后，接下来我们安装 STM32CubeMX 图形化工具。该软件可以 直接从光盘复制，目录为：A 盘→6，软件资料→1，软件→STM32CubeMX，也可以直接从 ST</span> ([p148](zotero://open-pdf/library/items/JFGTX7CT?page=148&annotation=DAZSV2R9))
> 
> 🏷️ #📝/标题

^KEYDAZSV2R9

> <span class="highlight" style="background-color: #f19837">10.3 使用 STM32CubeMX 新建工程</span> ([p151](zotero://open-pdf/library/items/JFGTX7CT?page=151&annotation=GGUGZ2DL))
> 
> 🏷️ #📝/标题

^KEYGGUGZ2DL

> <span class="highlight" style="background-color: #f19837">10.3.1 打开 STM32CubeMX</span> ([p151](zotero://open-pdf/library/items/JFGTX7CT?page=151&annotation=RKJJUIYR))
> 
> 🏷️ #📝/标题

^KEYRKJJUIYR

> <span class="highlight" style="background-color: #f19837">10.3.2 下载和关联的 STM32Cube 固件包</span> ([p152](zotero://open-pdf/library/items/JFGTX7CT?page=152&annotation=EX9F2RW6))
> 
> 🏷️ #📝/标题

^KEYEX9F2RW6

> <span class="highlight" style="background-color: #e56eee">点击 Help->Manage embedded software packages</span> ([p152](zotero://open-pdf/library/items/JFGTX7CT?page=152&annotation=FE4VYSUS))
> 
> 🏷️ #📝/重点

^KEYFE4VYSUS

> <span class="highlight" style="background-color: #e56eee">选择安装驱动包的方式</span> ([p152](zotero://open-pdf/library/items/JFGTX7CT?page=152&annotation=DGCYXNBT))
> 
> 🏷️ #📝/重点

^KEYDGCYXNBT

> <span class="highlight" style="background-color: #e56eee">方式一：从网络下载安装</span> ([p152](zotero://open-pdf/library/items/JFGTX7CT?page=152&annotation=IMBHAQY5))
> 
> 🏷️ #📝/重点

^KEYIMBHAQY5

> <span class="highlight" style="background-color: #e56eee">因 为我们的教程源码使用的固件包是 1.8.3 版本的，所以我们勾选 1.8.3 版本</span> ([p152](zotero://open-pdf/library/items/JFGTX7CT?page=152&annotation=BJ382ZIQ))
> 
> 🏷️ #📝/重点

^KEYBJ382ZIQ

> <span class="highlight" style="background-color: #e56eee">方法二：不通过网络</span> ([p152](zotero://open-pdf/library/items/JFGTX7CT?page=152&annotation=LRCNZ2YK))
> 
> 🏷️ #📝/重点

^KEYLRCNZ2YK

> <span class="highlight" style="background-color: #f19837">10.3.3 新建工程</span> ([p155](zotero://open-pdf/library/items/JFGTX7CT?page=155&annotation=8BC5VPGF))
> 
> 🏷️ #📝/标题

^KEY8BC5VPGF

> <span class="image#e56eee">null</span>STM32CubeMX配置工程步骤 ([p155](zotero://open-pdf/library/items/JFGTX7CT?page=155&annotation=IAXURAR6))

^KEYIAXURAR6

> <span class="highlight" style="background-color: #e56eee">工程初步建立</span> ([p155](zotero://open-pdf/library/items/JFGTX7CT?page=155&annotation=RW4MD9CK))
> 
> 🏷️ #📝/重点

^KEYRW4MD9CK

> <span class="highlight" style="background-color: #e56eee">2 HSE 和 LSE 时钟源设置</span> ([p157](zotero://open-pdf/library/items/JFGTX7CT?page=157&annotation=5KR9VW8L))
> 
> 🏷️ #📝/重点

^KEY5KR9VW8L

> <span class="highlight" style="background-color: #e56eee">选择了 Crystal/Ceramic Resonator，表示外部晶振作为 它们的时钟源。</span>
> 
> 晶振的材料为“晶振或者陶瓷” ([p157](zotero://open-pdf/library/items/JFGTX7CT?page=157&annotation=K455VIMJ))
> 
> 🏷️ #📝/重点

^KEYK455VIMJ

> <span class="highlight" style="background-color: #e56eee">3 时钟系统（时钟树）配置</span> ([p158](zotero://open-pdf/library/items/JFGTX7CT?page=158&annotation=QXRFPIC9))
> 
> 🏷️ #📝/重点

^KEYQXRFPIC9

> <span class="highlight" style="background-color: #e56eee">点击 Clock Configuration 选项卡即可进入时钟系统配置栏</span> ([p158](zotero://open-pdf/library/items/JFGTX7CT?page=158&annotation=T352VJUE))
> 
> 🏷️ #📝/重点

^KEYT352VJUE

> <span class="highlight" style="background-color: #e56eee">配置的主要是外部晶振大小，分频系数，倍频系数以及选 择器。</span> ([p158](zotero://open-pdf/library/items/JFGTX7CT?page=158&annotation=U5JZ5IWY))
> 
> 🏷️ #📝/重点

^KEYU5JZ5IWY

> <span class="highlight" style="background-color: #e56eee">在图 10.3.3.9 的“HCLK(MHz)”位置，实际上是可以编辑的。 我们直接输入我们要的主频，这里是 72Mzh，按回车键，CubeMX 会帮我们提供一种设置主频 和其它时钟的建议</span> ([p160](zotero://open-pdf/library/items/JFGTX7CT?page=160&annotation=C8PEHSQA))
> 
> 🏷️ #📝/重点

^KEYC8PEHSQA

> <span class="highlight" style="background-color: #e56eee">4 GPIO 功能引脚配置</span> ([p160](zotero://open-pdf/library/items/JFGTX7CT?page=160&annotation=X9RD4W9N))
> 
> 🏷️ #📝/重点

^KEYX9RD4W9N

> <span class="highlight" style="background-color: #e56eee">引脚从灰色变成 绿色，标识该管脚已经启用。</span> ([p161](zotero://open-pdf/library/items/JFGTX7CT?page=161&annotation=WNW79J5B))
> 
> 🏷️ #📝/重点

^KEYWNW79J5B

> <span class="highlight" style="background-color: #e56eee">配置完 IO 口功能之后，还要配置 IO 口的速度， 上下拉等参数。这些参数我们通过 System Core 下的 GPIO 选项进行配置</span> ([p161](zotero://open-pdf/library/items/JFGTX7CT?page=161&annotation=I2VWRCJR))
> 
> 🏷️ #📝/重点

^KEYI2VWRCJR

> <span class="highlight" style="background-color: #e56eee">GPIO output level 是 IO 的初始值</span> ([p162](zotero://open-pdf/library/items/JFGTX7CT?page=162&annotation=SWFLHNU2))
> 
> 🏷️ #📝/重点

^KEYSWFLHNU2

> <span class="highlight" style="background-color: #e56eee">5 配置 Debug 选项</span> ([p162](zotero://open-pdf/library/items/JFGTX7CT?page=162&annotation=LRBFYKCX))
> 
> 🏷️ #📝/重点

^KEYLRBFYKCX

> <span class="highlight" style="background-color: #e56eee">要把 Debug 选项打开</span> ([p162](zotero://open-pdf/library/items/JFGTX7CT?page=162&annotation=QYN9F4FU))
> 
> 🏷️ #📝/重点

^KEYQYN9F4FU

> <span class="highlight" style="background-color: #e56eee">6 生成工程源码</span> ([p163](zotero://open-pdf/library/items/JFGTX7CT?page=163&annotation=ECD3WHRH))
> 
> 🏷️ #📝/重点

^KEYECD3WHRH

> <span class="highlight" style="background-color: #e56eee">勾选 Generate peripheral initialization as a pair of ‘.c/.h’files per peripheral，勾选这个选项的话将会将每个外设单 独分开成一组.c、.h 文件</span> ([p164](zotero://open-pdf/library/items/JFGTX7CT?page=164&annotation=B9GBHF3V))
> 
> 🏷️ #📝/重点

^KEYB9GBHF3V

> <span class="highlight" style="background-color: #e56eee">7 用户程序</span> ([p166](zotero://open-pdf/library/items/JFGTX7CT?page=166&annotation=6YCMEXM3))
> 
> 🏷️ #📝/重点

^KEY6YCMEXM3

> <span class="highlight" style="background-color: #e56eee">大家需要注意，STM32CubeMX 生成的 main.c 文件中，有很多地方有“/* USER CODE BEGIN X */”和“/* USER CODE END X */”格式的注释，我们在这些注释的 BEGIN 和 END 之间编写代码，那么重新生成工程之后，这些代码会保留而不会被覆盖</span> ([p167](zotero://open-pdf/library/items/JFGTX7CT?page=167&annotation=L77QXRHR))
> 
> 🏷️ #📝/重点

^KEYL77QXRHR

> <span class="highlight" style="background-color: #f19837">10.4 STM32CubeMX 新建工程使用建议</span> ([p167](zotero://open-pdf/library/items/JFGTX7CT?page=167&annotation=J858AHWR))
> 
> 🏷️ #📝/标题

^KEYJ858AHWR

> <span class="highlight" style="background-color: #e56eee">工程文件夹路径、文件名不要带任何中文及中文字符</span> ([p167](zotero://open-pdf/library/items/JFGTX7CT?page=167&annotation=D3X7XKBU))
> 
> 🏷️ #📝/重点

^KEYD3X7XKBU

> <span class="highlight" style="background-color: #f19837">第十一章 STM32 时钟配置</span> ([p169](zotero://open-pdf/library/items/JFGTX7CT?page=169&annotation=Y2NPWDMC))
> 
> 🏷️ #📝/标题

^KEYY2NPWDMC

> <span class="highlight" style="background-color: #f19837">11.1 认识时钟树</span> ([p169](zotero://open-pdf/library/items/JFGTX7CT?page=169&annotation=XZYT7NNZ))
> 
> 🏷️ #📝/标题

^KEYXZYT7NNZ

> <span class="image#e56eee">null</span>STM32F1时钟系统图 ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=DUA5HV6V))

^KEYDUA5HV6V

> <span class="highlight" style="background-color: #e56eee">A 部分表示其它电路需要的输入源时钟信号</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=6XYEIAMZ))
> 
> 🏷️ #📝/重点

^KEY6XYEIAMZ

> <span class="highlight" style="background-color: #e56eee">B 为一个特殊的振荡电路“PLL”，由几个部分构成</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=GDPC7EZS))
> 
> 🏷️ #📝/重点

^KEYGDPC7EZS

> <span class="highlight" style="background-color: #e56eee">C 为我们重点需要关注的 MCU 内的主时钟“SYSCLK”</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=X9XUJYK4))
> 
> 🏷️ #📝/重点

^KEYX9XUJYK4

> <span class="highlight" style="background-color: #e56eee">AHB 预分频器将 SYSCLK 分频或不分 频后分发给其它外设进行处理，包括到 F 部分的 Cortex-M 内核系统的时钟</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=KX6FZM53))
> 
> 🏷️ #📝/重点

^KEYKX6FZM53

> <span class="highlight" style="background-color: #e56eee">D、E 部分别为定 时器等外设的时钟源 APB1/APB2</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=8T9HBRKC))
> 
> 🏷️ #📝/重点

^KEY8T9HBRKC

> <span class="highlight" style="background-color: #e56eee">G 是 STM32 的时钟输出功能</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=YFANKIIR))
> 
> 🏷️ #📝/重点

^KEYYFANKIIR

> <span class="highlight" style="background-color: #f19837">11.1.1 时钟源</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=SVKF6P3X))
> 
> 🏷️ #📝/标题

^KEYSVKF6P3X

> <span class="highlight" style="background-color: #e56eee">对于 STM32F1，输入时钟源（Input Clock）主要包括 HSI，HSE，LSI，LSE。</span>
> 
> “H”和“L”为高速和低速
> 
> “E”和“I”为外部和内部 ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=T4Q6W9D9))
> 
> 🏷️ #📝/重点

^KEYT4Q6W9D9

> <span class="highlight" style="background-color: #e56eee">分为高速时钟源和低速时钟源</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=R6TBLFA7))
> 
> 🏷️ #📝/重点

^KEYR6TBLFA7

> <span class="highlight" style="background-color: #e56eee">HSI、HSE 高速时钟，LSI 和 LSE 是低 速时钟</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=IUASGB2E))
> 
> 🏷️ #📝/重点

^KEYIUASGB2E

> <span class="highlight" style="background-color: #e56eee">分为外部时钟源和内部时钟源</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=Z5K9JSLD))
> 
> 🏷️ #📝/重点

^KEYZ5K9JSLD

> <span class="highlight" style="background-color: #e56eee">外部时钟源就是从外部通过接晶振的方式获 取时钟源，其中 HSE 和 LSE 是外部时钟源</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=GIJY5KVJ))
> 
> 🏷️ #📝/重点

^KEYGIJY5KVJ

> <span class="highlight" style="background-color: #e56eee">其他是内部时钟源，芯片上电即可产生，不需要 借助外部电路。</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=AGSDI8S3))
> 
> 🏷️ #📝/重点

^KEYAGSDI8S3

> <span class="highlight" style="background-color: #e56eee">2 个外部时钟源</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=JAJVHZKM))
> 
> 🏷️ #📝/重点

^KEYJAJVHZKM

> <span class="highlight" style="background-color: #e56eee">高速外部振荡器 HSE</span> ([p170](zotero://open-pdf/library/items/JFGTX7CT?page=170&annotation=QQC5C9TM))
> 
> 🏷️ #📝/重点

^KEYQQC5C9TM

> <span class="highlight" style="background-color: #e56eee">低速外部振荡器 LSE</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=VK7KS4PM))
> 
> 🏷️ #📝/重点

^KEYVK7KS4PM

> <span class="highlight" style="background-color: #e56eee">主要作用于 RTC 的时钟源</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=7LR869DA))
> 
> 🏷️ #📝/重点

^KEY7LR869DA

> <span class="highlight" style="background-color: #e56eee">2 个内部时钟源：</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=WFKRAYIB))
> 
> 🏷️ #📝/重点

^KEYWFKRAYIB

> <span class="highlight" style="background-color: #e56eee">高速内部振荡器 HSI</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=QJC7U2RL))
> 
> 🏷️ #📝/重点

^KEYQJC7U2RL

> <span class="highlight" style="background-color: #e56eee">低速内部振荡器 LSI</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=57Z7PIVT))
> 
> 🏷️ #📝/重点

^KEY57Z7PIVT

> <span class="highlight" style="background-color: #e56eee">可作为独立看门狗的时钟源</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=UQYF7EIM))
> 
> 🏷️ #📝/重点

^KEYUQYF7EIM

> <span class="highlight" style="background-color: #e56eee">芯片上电时默认由内部的 HSI 时钟启动，如果用户进行了硬件和软件的配置，芯片才会根 据用户配置调试尝试切换到对应的外部时钟</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=G6JUEHQ4))
> 
> 🏷️ #📝/重点

^KEYG6JUEHQ4

> <span class="highlight" style="background-color: #f19837">11.1.2 锁相环 PLL</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=Z955U58J))
> 
> 🏷️ #📝/标题

^KEYZ955U58J

> <span class="highlight" style="background-color: #e56eee">在 STM32 主控中，锁相环的作用主要有 两个部分：输入时钟净化和倍频。</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=3EL2CAJ9))
> 
> 🏷️ #📝/重点

^KEY3EL2CAJ9

> <span class="highlight" style="background-color: #e56eee">锁相环的输出也可以作为芯片系统的时钟源。</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=ADQFU3KW))
> 
> 🏷️ #📝/重点

^KEYADQFU3KW

> <span class="highlight" style="background-color: #e56eee">PLLXTPRE：HSE 分频器</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=G2MNL3TV))
> 
> 🏷️ #📝/重点

^KEYG2MNL3TV

> <span class="highlight" style="background-color: #e56eee">经过 HSE 分频器处理后的输出振荡时钟信号比直接输入的时钟信号更稳定</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=Q52KSPFE))
> 
> 🏷️ #📝/重点

^KEYQ52KSPFE

> <span class="highlight" style="background-color: #e56eee">PLLSRC：PLL 输入时钟源</span> ([p171](zotero://open-pdf/library/items/JFGTX7CT?page=171&annotation=VLV3FA5E))
> 
> 🏷️ #📝/重点

^KEYVLV3FA5E

> <span class="highlight" style="background-color: #e56eee">PLLMUL：PLL 倍频系数</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=96FXNJRH))
> 
> 🏷️ #📝/重点

^KEY96FXNJRH

> <span class="highlight" style="background-color: #e56eee">ST 设置它的 有效倍频范围为 2~16 倍</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=PXM92AM5))
> 
> 🏷️ #📝/重点

^KEYPXM92AM5

> <span class="highlight" style="background-color: #f19837">11.1.3 系统时钟 SYSCLK</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=KU5EKYID))
> 
> 🏷️ #📝/标题

^KEYKU5EKYID

> <span class="highlight" style="background-color: #e56eee">STM32 的系统时钟 SYSCLK 为整个芯片提供了时序信号。</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=XJU3NAAY))
> 
> 🏷️ #📝/重点

^KEYXJU3NAAY

> <span class="highlight" style="background-color: #e56eee">时钟频率越高，指令的执行速度越快</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=EWJFVC5I))
> 
> 🏷️ #📝/重点

^KEYEWJFVC5I

> <span class="highlight" style="background-color: #e56eee">它可以为 HSI、PLLCLK、HSE 中的一个，通过 CFGR 的位 SW[1:0]设置</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=R9LIB672))
> 
> 🏷️ #📝/重点

^KEYR9LIB672

> <span class="highlight" style="background-color: #e56eee">AHB、APB1、APB2、内核时钟等时钟通过系统时钟分频得到。</span> ([p172](zotero://open-pdf/library/items/JFGTX7CT?page=172&annotation=JUD38GMC))
> 
> 🏷️ #📝/重点

^KEYJUD38GMC

> <span class="highlight" style="background-color: #e56eee">系统时钟来到标号 D 的 AHB 预分频器，其中可 选择的分频系数为 1，2，4，8，16，32，64，128，256</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=YTFKW4GY))
> 
> 🏷️ #📝/重点

^KEYYTFKW4GY

> <span class="highlight" style="background-color: #e56eee">APB1 总线时钟，由 HCLK 经过标号 E 的低速 APB1 预分频器得到，分频因子可以选择 1， 2，4，8，16</span>
> 
> HCLK为系统时钟SYSCLK经过AHB预分频器得到的时钟。即AHB总线时钟 ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=UZANUCEU))
> 
> 🏷️ #📝/重点

^KEYUZANUCEU

> <span class="highlight" style="background-color: #e56eee">APB1 总线时钟为 36M</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=LQVIFZ7K))
> 
> 🏷️ #📝/重点

^KEYLQVIFZ7K

> <span class="highlight" style="background-color: #e56eee">由于 APB1 是低速总线 时钟，所以 APB1 总线最高频率为 36MHz，片上低速的外设就挂载在该总线上</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=H7KA74N8))
> 
> 🏷️ #📝/重点

^KEYH7KA74N8

> <span class="highlight" style="background-color: #e56eee">APB2 总线时钟，由 HCLK 经过标号 F 的高速 APB2 预分频器得到，分频因子可以选择 1， 2，4，8，16</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=RG2MU6AH))
> 
> 🏷️ #📝/重点

^KEYRG2MU6AH

> <span class="highlight" style="background-color: #e56eee">APB2 总线时钟频率为 72M</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=WGP2LQAV))
> 
> 🏷️ #📝/重点

^KEYWGP2LQAV

> <span class="highlight" style="background-color: #e56eee">其中标号 G 是 ADC 的预分频器在后面 ADC 实验中详细说明。</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=X6LYZFIE))
> 
> 🏷️ #📝/重点

^KEYX6LYZFIE

> <span class="highlight" style="background-color: #e56eee">AHB 总线时钟直接作为 SDIO、FSMC、AHB 总线、Cortex 内核、存储器和 DMA 的 HCLK 时钟，并作为 Cortex 内核自由运行时钟 FCLK。</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=R9VA7MB6))
> 
> 🏷️ #📝/重点

^KEYR9VA7MB6

> <span class="highlight" style="background-color: #e56eee">标号 H 是 USBCLK，是一个通用串行接口时钟，时钟来源于 PLLCLK。</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=9HZ5XHPE))
> 
> 🏷️ #📝/重点

^KEY9HZ5XHPE

> <span class="highlight" style="background-color: #e56eee">该时钟源只能从 PLL 输出端获取</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=SW7J8AM7))
> 
> 🏷️ #📝/重点

^KEYSW7J8AM7

> <span class="highlight" style="background-color: #e56eee">当需要使用 USB 模块时，PLL 必 须使能，并且时钟频率配置为 48MHz 或 72MHz。</span> ([p173](zotero://open-pdf/library/items/JFGTX7CT?page=173&annotation=JVBDA4HV))
> 
> 🏷️ #📝/重点

^KEYJVBDA4HV

> <span class="highlight" style="background-color: #e56eee">标号 I 是 MCO 输出内部时钟，STM32 的一个时钟输出 IO(PA8)</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=3AS9B5DB))
> 
> 🏷️ #📝/重点

^KEY3AS9B5DB

> <span class="highlight" style="background-color: #e56eee">可以用来 给外部其他系统提供时钟源。</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=WCB4ZK3D))
> 
> 🏷️ #📝/重点

^KEYWCB4ZK3D

> <span class="highlight" style="background-color: #e56eee">标号 J 是 RTC 定时器</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=NI3NDPEN))
> 
> 🏷️ #📝/重点

^KEYNI3NDPEN

> <span class="highlight" style="background-color: #f19837">11.1.4 时钟信号输出 MCO</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=Z6TG4A5T))
> 
> 🏷️ #📝/标题

^KEYZ6TG4A5T

> <span class="highlight" style="background-color: #f19837">11.2 如何修改主频</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=D3C2C7NG))
> 
> 🏷️ #📝/标题

^KEYD3C2C7NG

> <span class="highlight" style="background-color: #e56eee">默认的情况下（比如：串口 IAP 时或者是未初始化时钟时），使用的是内部 8M 的 HSI 作为时钟源</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=C85HUG7I))
> 
> 🏷️ #📝/重点

^KEYC85HUG7I

> <span class="highlight" style="background-color: #e56eee">72MHz 是官方推荐使 用的最高的稳定时钟频率</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=QAQ9ZTFC))
> 
> 🏷️ #📝/重点

^KEYQAQ9ZTFC

> <span class="highlight" style="background-color: #f19837">1.2.1 STM32F1 时钟系统配置</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=I3WBEJ86))
> 
> 🏷️ #📝/标题

^KEYI3WBEJ86

> <span class="highlight" style="background-color: #e56eee">第 1 步：配置 HSE_VALUE</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=9W9IZVQD))
> 
> 🏷️ #📝/重点

^KEY9W9IZVQD

> <span class="highlight" style="background-color: #e56eee">第 2 步：调用 SystemInit 函数</span> ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=SWAKXDW7))
> 
> 🏷️ #📝/重点

^KEYSWAKXDW7

> <span class="highlight" style="background-color: #e56eee">在系统启动之后，程序会先执行 SystemInit 函数，进行 系统一些初始化配置。</span>
> 
> stm32的启动过程：
> 
> 从0x00000000取出堆栈指针MSP的值
> 
> 从0x00000004取出程序指针PC的值，该指针指向复位中断处理程序（如下），故CPU开始处理这段程序的内容。 ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=2DA8XFZ8))
> 
> 🏷️ #📝/重点

^KEY2DA8XFZ8

> <span class="image#e56eee">null</span>这一段是“复位中断处理程序”，这里先调用“SystemInit函数”，再调用“__main函数”。 ([p174](zotero://open-pdf/library/items/JFGTX7CT?page=174&annotation=P2IPBYKB))

^KEYP2IPBYKB

> <span class="highlight" style="background-color: #e56eee">system_stm32f1xx.c 文件下定义的 SystemInit 程序</span> ([p175](zotero://open-pdf/library/items/JFGTX7CT?page=175&annotation=NL9GB5MV))
> 
> 🏷️ #📝/重点

^KEYNL9GB5MV

> <span class="highlight" style="background-color: #e56eee">从上面代码可以看出，SystemInit 主要做了如下两个方面工作： 1) 外部存储器配置 2) 中断向量表地址配置</span> ([p175](zotero://open-pdf/library/items/JFGTX7CT?page=175&annotation=DLVIRKH8))
> 
> 🏷️ #📝/重点

^KEYDLVIRKH8

> <span class="highlight" style="background-color: #e56eee">是可以把一些重要的初始化放到 SystemInit 这里，在 main 函 数运行前就把重要的一些初始化配置好</span> ([p175](zotero://open-pdf/library/items/JFGTX7CT?page=175&annotation=ITXTZSPZ))
> 
> 🏷️ #📝/重点

^KEYITXTZSPZ

> <span class="highlight" style="background-color: #e56eee">HAL 库的 SystemInit 函数并没有任何时钟相关配置，所以后续的初始化步骤，我们还必须 编写自己的时钟配置函数。</span> ([p175](zotero://open-pdf/library/items/JFGTX7CT?page=175&annotation=CAWIX4AK))
> 
> 🏷️ #📝/重点

^KEYCAWIX4AK

> <span class="highlight" style="background-color: #e56eee">第 3 步：在 main 函数里调用用户编写的时钟设置函数</span> ([p175](zotero://open-pdf/library/items/JFGTX7CT?page=175&annotation=CQE7K7PX))
> 
> 🏷️ #📝/重点

^KEYCQE7K7PX

> <span class="highlight" style="background-color: #e56eee">plln: PLL 倍频系数(PLL 倍频), 取值范围: 2~16</span> ([p175](zotero://open-pdf/library/items/JFGTX7CT?page=175&annotation=ZL6CVU8E))
> 
> 🏷️ #📝/重点

^KEYZL6CVU8E

> <span class="highlight" style="background-color: #e56eee">函数 sys_stm32_clock_init 就是用户的时钟系统配置函数</span>
> 
> 自定义函数 ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=QINXJG89))
> 
> 🏷️ #📝/重点

^KEYQINXJG89

> <span class="highlight" style="background-color: #e56eee">配置时钟源相关参数：调用函数 HAL_RCC_OscConfig()</span>
> 
> "Osc"是"Oscillator"的缩写，指的是系统中用于产生时钟信号的振荡器。
> 
> 这个函数是hal库函数，用来选择时钟源并配置 PLL。我们需要给出的是该函数的参数，这个参数包含着时钟源的配置信息。
> 
> 这个参数是结构体 RCC_OscInitTypeDef 类型指针，指向一个结构体，通过修改结构体成员变量的值从而完成配置。 ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=V8Q48GJS))
> 
> 🏷️ #📝/重点

^KEYV8Q48GJS

> <span class="highlight" style="background-color: #e56eee">配 置 系 统 时 钟 源 以 及 SYSCLK 、 AHB 、 APB1 和 APB2 的 分 频 系 数 ： 调 用 函 数 HAL_RCC_ClockConfig()。</span>
> 
> 注意“时钟源”和“系统时钟源”的区别：
> 
> 时钟源是指：HSE LSE HSI LSI
> 
> 系统时钟源是指：HSE HSI PLL ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=VP7F3ZRP))
> 
> 🏷️ #📝/重点

^KEYVP7F3ZRP

> <span class="highlight" style="background-color: #e56eee">使能并选择 HSE 作为 PLL 时钟源，配置 PLL1</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=3RIEGZPU))
> 
> 🏷️ #📝/重点

^KEY3RIEGZPU

> <span class="highlight" style="background-color: #e56eee">HAL_RCC_OscConfig</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=THSRT2HQ))
> 
> 🏷️ #📝/重点

^KEYTHSRT2HQ

> <span class="highlight" style="background-color: #e56eee">只有一个形参</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=XLBB3DHP))
> 
> 🏷️ #📝/重点

^KEYXLBB3DHP

> <span class="highlight" style="background-color: #e56eee">结构体 RCC_OscInitTypeDef 类型指针</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=LN7BFRRW))
> 
> 🏷️ #📝/重点

^KEYLN7BFRRW

> <span class="highlight" style="background-color: #e56eee">前面几个参数主要是用来选择配置的振荡器类型</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=KU835CBE))
> 
> 🏷️ #📝/重点

^KEYKU835CBE

> <span class="highlight" style="background-color: #e56eee">PLL</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=G484IUID))
> 
> 🏷️ #📝/重点

^KEYG484IUID

> <span class="highlight" style="background-color: #e56eee">RCC_PLLInitTypeDef</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=J5N23RZN))
> 
> 🏷️ #📝/重点

^KEYJ5N23RZN

> <span class="highlight" style="background-color: #e56eee">作用是配置 PLL 相关参数</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=FKKMKZSX))
> 
> 🏷️ #📝/重点

^KEYFKKMKZSX

> <span class="highlight" style="background-color: #e56eee">设置 PLL 时钟源以及 相关分频倍频参数。</span> ([p176](zotero://open-pdf/library/items/JFGTX7CT?page=176&annotation=XKD6D5YN))
> 
> 🏷️ #📝/重点

^KEYXKD6D5YN

> <span class="highlight" style="background-color: #e56eee">配置内容</span> ([p177](zotero://open-pdf/library/items/JFGTX7CT?page=177&annotation=ESBUSJU6))
> 
> 🏷️ #📝/重点

^KEYESBUSJU6

> <span class="highlight" style="background-color: #e56eee">配置系统时钟源，以及 SYSCLK、AHB、APB1 和 APB2 相关参数</span> ([p177](zotero://open-pdf/library/items/JFGTX7CT?page=177&annotation=8SASF54U))
> 
> 🏷️ #📝/重点

^KEY8SASF54U

> <span class="highlight" style="background-color: #e56eee">HAL_RCC_ClockConfig</span> ([p177](zotero://open-pdf/library/items/JFGTX7CT?page=177&annotation=WMDAWS8Z))
> 
> 🏷️ #📝/重点

^KEYWMDAWS8Z

> <span class="highlight" style="background-color: #e56eee">结构体 RCC_ClkInitTypeDef 类型指 针变量，用于设置 SYSCLK 时钟源以及 SYSCLK、AHB、APB1 和 APB2 的分频系数</span> ([p177](zotero://open-pdf/library/items/JFGTX7CT?page=177&annotation=XACS5E74))
> 
> 🏷️ #📝/重点

^KEYXACS5E74

> <span class="highlight" style="background-color: #e56eee">第二个 形参 FLatency 用于设置 FLASH 延迟。</span> ([p177](zotero://open-pdf/library/items/JFGTX7CT?page=177&annotation=8MJQ2R6W))
> 
> 🏷️ #📝/重点

^KEY8MJQ2R6W

> <span class="image#e56eee">null</span>通过这种方式选择多个要配置的时钟 ([p177](zotero://open-pdf/library/items/JFGTX7CT?page=177&annotation=ZZ37EVKZ))

^KEYZZ37EVKZ

> <span class="highlight" style="background-color: #e56eee">RCC_PLL_MUL9</span>
> 
> PLL倍频系数为9 ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=3UUURKSC))
> 
> 🏷️ #📝/重点

^KEY3UUURKSC

> <span class="highlight" style="background-color: #e56eee">为了使 FLASH 读写正确（因为 72Mhz 的时钟比 Flash 的操作速度 24Mhz 要快得多，操作速度不匹配 容易导致 Flash 操作失败），所以需要设置延时时间。</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=Q5N4TEE9))
> 
> 🏷️ #📝/重点

^KEYQ5N4TEE9

> <span class="highlight" style="background-color: #e56eee">2WS</span>
> 
> 两个等待状态 ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=LA8S3TGL))
> 
> 🏷️ #📝/重点

^KEYLA8S3TGL

> <span class="highlight" style="background-color: #f19837">11.2.2 STM32F1 时钟使能和配置</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=XQEYEREX))
> 
> 🏷️ #📝/标题

^KEYXQEYEREX

> <span class="highlight" style="background-color: #e56eee">如果在使用外设之前 没有使能外设时钟，这个外设是不可能正常运行的</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=WTU3QNPR))
> 
> 🏷️ #📝/重点

^KEYWTU3QNPR

> <span class="highlight" style="background-color: #e56eee">外设时钟使能是在 RCC 相关寄 存器中配置的</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=9WGQJ8XK))
> 
> 🏷️ #📝/重点

^KEY9WGQJ8XK

> <span class="highlight" style="background-color: #e56eee">外设时钟使能操作</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=HPRBS886))
> 
> 🏷️ #📝/重点

^KEYHPRBS886

> <span class="highlight" style="background-color: #e56eee">STM32F1xx_hal_rcc.h 定义的</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=8Y3DWS9Q))
> 
> 🏷️ #📝/重点

^KEY8Y3DWS9Q

> <span class="highlight" style="background-color: #e56eee">外设时钟使能在 HAL 库中都是通过宏定义标识 符来实现的</span> ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=DRMU8RSV))
> 
> 🏷️ #📝/重点

^KEYDRMU8RSV

> <span class="highlight" style="background-color: #e56eee">设置寄存器 RCC->APB2ENR 的相关位为 1，至于是哪个位，是由宏定 义标识符 RCC_APB2ENR_IOPAEN 的值决定的</span>
> 
> 需要根据代码看出操作哪个寄存器，寄存器的哪个位 ([p178](zotero://open-pdf/library/items/JFGTX7CT?page=178&annotation=VBTDPR43))
> 
> 🏷️ #📝/重点

^KEYVBTDPR43

> <span class="highlight" style="background-color: #e56eee">0x00000001<<2</span>
> 
> 这里错误，应该是：0x00000001<<0 ([p179](zotero://open-pdf/library/items/JFGTX7CT?page=179&annotation=L2933XA8))
> 
> 🏷️ #📝/重点

^KEYL2933XA8

> <span class="highlight" style="background-color: #e56eee">位 2 为 1</span>
> 
> 应该是：位 0 为 1 ([p179](zotero://open-pdf/library/items/JFGTX7CT?page=179&annotation=BFCPILR4))
> 
> 🏷️ #📝/重点

^KEYBFCPILR4

> <span class="highlight" style="background-color: #e56eee">调用宏定义标识符就可以实现 GPIOA 时钟使能。</span> ([p179](zotero://open-pdf/library/items/JFGTX7CT?page=179&annotation=FJHQ89CN))
> 
> 🏷️ #📝/重点

^KEYFJHQ89CN

> <span class="highlight" style="background-color: #e56eee">几个常用使能外设时钟的宏定义标识符使用方法</span> ([p179](zotero://open-pdf/library/items/JFGTX7CT?page=179&annotation=VNNKG8E4))
> 
> 🏷️ #📝/重点

^KEYVNNKG8E4

> <span class="highlight" style="background-color: #e56eee">禁止外设时钟</span> ([p179](zotero://open-pdf/library/items/JFGTX7CT?page=179&annotation=TP9Z5Z9B))
> 
> 🏷️ #📝/重点

^KEYTP9Z5Z9B

> <span class="highlight" style="background-color: #e56eee">宏定义标识符__HAL_RCC_GPIOA_CLK_DISABLE()的作用是设置 RCC->APB2ENR 寄存器的位 2 为 0，也就是禁止 GPIOA 时钟。</span> ([p179](zotero://open-pdf/library/items/JFGTX7CT?page=179&annotation=WGPLES76))
> 
> 🏷️ #📝/重点

^KEYWGPLES76

> <span class="highlight" style="background-color: #f19837">第十二章 SYSTEM 文件夹介绍</span> ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=UMT86VKL))
> 
> 🏷️ #📝/标题

^KEYUMT86VKL

> <span class="highlight" style="background-color: #e56eee">底层核心驱动函数</span> ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=WPACB65G))
> 
> 🏷️ #📝/重点

^KEYWPACB65G

> <span class="highlight" style="background-color: #f19837">12.1 deley 文件夹代码介绍</span> ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=NWV5MV9G))
> 
> 🏷️ #📝/标题

^KEYNWV5MV9G

> <span class="highlight" style="background-color: #e56eee">两个文件用来实现系统的延时功能， 其中包含 7 个函数： void delay_osschedlock(void); void delay_osschedunlock(void); void delay_ostimedly(uint32_t ticks); void SysTick_Handler(void); void delay_init(uint16_t sysclk); void delay_us(uint32_t nus); void delay_ms(uint16_t nms); 前面 4 个函数，仅在支持操作系统（OS）的时候，需要</span> ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=W74Y27XZ))
> 
> 🏷️ #📝/重点

^KEYW74Y27XZ

> <span class="highlight" style="background-color: #e56eee">CM3 内核处理器，内部包 含了一个 SysTick 定时器，SysTick 是一个 24 位的向下递减的计数定时器，当计数值减到 0 时， 将从 RELOAD 寄存器中自动重装载定时初值，开始新一轮计数。只要不把它在 SysTick 控制及 状态寄存器中的使能位清除，就永不停息</span>
> 
> 滴答定时器 ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=KZLXMTHN))
> 
> 🏷️ #📝/重点

^KEYKZLXMTHN

> <span class="highlight" style="background-color: #e56eee">ucos 下 systick 不能再被随意更改</span>
> 
> ucos是操作系统 ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=HZ6B6SX7))
> 
> 🏷️ #📝/重点

^KEYHZ6B6SX7

> <span class="highlight" style="background-color: #e56eee">时钟摘取法</span> ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=TWWK9S9P))
> 
> 🏷️ #📝/重点

^KEYTWWK9S9P

> <span class="highlight" style="background-color: #e56eee">这就是实现 delay 和操作系统共用 SysTick 定时器的原理</span>
> 
> 简单来说，delay是通过计数来实现计时的 ([p180](zotero://open-pdf/library/items/JFGTX7CT?page=180&annotation=TP6ZSMIJ))
> 
> 🏷️ #📝/重点

^KEYTP6ZSMIJ

> <span class="highlight" style="background-color: #f19837">12.1.1 操作系统支持宏定义及相关函数</span> ([p181](zotero://open-pdf/library/items/JFGTX7CT?page=181&annotation=ZWFDWABC))
> 
> 🏷️ #📝/标题

^KEYZWFDWABC

> <span class="highlight" style="background-color: #e56eee">当需要 delay_ms 和 delay_us 支持操作系统（OS）的时候，我们需要用到 3 个宏定义和 4 个 函数，宏定义及函数代码如下：</span>
> 
> 不需要了解 ([p181](zotero://open-pdf/library/items/JFGTX7CT?page=181&annotation=VJMJNF7D))
> 
> 🏷️ #📝/重点

^KEYVJMJNF7D

> <span class="highlight" style="background-color: #f19837">12.1.2 delay_init 函数</span>
> 
> 不需要了解 ([p182](zotero://open-pdf/library/items/JFGTX7CT?page=182&annotation=P4PVMU2D))
> 
> 🏷️ #📝/标题

^KEYP4PVMU2D

> <span class="highlight" style="background-color: #f19837">12.1.3 delay_us 函数</span> ([p183](zotero://open-pdf/library/items/JFGTX7CT?page=183&annotation=C8JXGS9Y))
> 
> 🏷️ #📝/标题

^KEYC8JXGS9Y

> <span class="highlight" style="background-color: #f19837">12.1.4 delay_ms 函数</span> ([p184](zotero://open-pdf/library/items/JFGTX7CT?page=184&annotation=KZSLBCBJ))
> 
> 🏷️ #📝/标题

^KEYKZSLBCBJ

> <span class="highlight" style="background-color: #f19837">12.1.5 HAL 库延时函数 HAL_Delay</span> ([p185](zotero://open-pdf/library/items/JFGTX7CT?page=185&annotation=NBJ58ZBD))
> 
> 🏷️ #📝/标题

^KEYNBJ58ZBD

> <span class="highlight" style="background-color: #e56eee">HAL 库提供的延时函数，只能实现简单的毫秒级别延时，没有实现 us 级别延时。</span> ([p185](zotero://open-pdf/library/items/JFGTX7CT?page=185&annotation=KB4FA59Q))
> 
> 🏷️ #📝/重点

^KEYKB4FA59Q

> <span class="highlight" style="background-color: #e56eee">HAL 库的延时函数在中断服务函数中使用 HAL_Delay 会引起混乱</span> ([p185](zotero://open-pdf/library/items/JFGTX7CT?page=185&annotation=W65GS3DM))
> 
> 🏷️ #📝/重点

^KEYW65GS3DM

> <span class="highlight" style="background-color: #e56eee">因为它是通过中断方式实现，而 Systick 的中断优先级是最低的，所以 在中断中运行 HAL_Delay 会导致延时出现严重误差</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=TBJ6C663))
> 
> 🏷️ #📝/重点

^KEYTBJ6C663

> <span class="highlight" style="background-color: #e56eee">不使用操作系统(OS)的情况下，我们 禁用了 Systick 中断，会导致部分 HAL 库函数无法超时退出</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=G4U34VZT))
> 
> 🏷️ #📝/重点

^KEYG4U34VZT

> <span class="highlight" style="background-color: #f19837">12.2 sys 文件夹代码介绍</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=AQVMVSEM))
> 
> 🏷️ #📝/标题

^KEYAQVMVSEM

> <span class="highlight" style="background-color: #e56eee">sys 文件夹内包含了 sys.c 和 sys.h 两个文件</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=I25QRGAW))
> 
> 🏷️ #📝/重点

^KEYI25QRGAW

> <span class="highlight" style="background-color: #e56eee">sys_nvic_set_vector_table 函数主要是设置中断向量表偏移地址， sys_standby 函数用于进入待机模式，sys_soft_reset 函数用于系统软复位，sys_stm32_clock_init 函数是系统时钟初始化函数</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=97CGDWUH))
> 
> 🏷️ #📝/重点

^KEY97CGDWUH

> <span class="highlight" style="background-color: #f19837">12.3 usart 文件夹代码介绍</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=RBV72LHS))
> 
> 🏷️ #📝/标题

^KEYRBV72LHS

> <span class="highlight" style="background-color: #f19837">12.3.1 printf 函数支持</span> ([p186](zotero://open-pdf/library/items/JFGTX7CT?page=186&annotation=8JIINMB4))
> 
> 🏷️ #📝/标题

^KEY8JIINMB4

> <span class="highlight" style="background-color: #e56eee">使用半主机模式必须使用仿真器调试。</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=5HSET28H))
> 
> 🏷️ #📝/重点

^KEY5HSET28H

> <span class="highlight" style="background-color: #e56eee">printf 对字符 ch 处理后写入 文件 f，最后使用 fputc 将文件 f 输出到显示设备。</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=WTI8I55L))
> 
> 🏷️ #📝/重点

^KEYWTI8I55L

> <span class="highlight" style="background-color: #e56eee">把 printf 调用的 fputc 函数重新实现</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=M3W8LU5U))
> 
> 🏷️ #📝/重点

^KEYM3W8LU5U

> <span class="highlight" style="background-color: #e56eee">要避免半主机模式</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=TQXIFU5Z))
> 
> 🏷️ #📝/重点

^KEYTQXIFU5Z

> <span class="highlight" style="background-color: #e56eee">使用微库编写程 序要注意其与默认 C 库之间存在的一些差异，如 main()函数不能声明带参数，也无须返回；不 支持 stdio，除了无缓冲的 stdin、stdout 和 syderr</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=9SMNFUNM))
> 
> 🏷️ #📝/重点

^KEY9SMNFUNM

> <span class="highlight" style="background-color: #e56eee">重新实现 fputc 的功能即可将每个传给 fputc 函数的字符 ch 重定向到串口 1，如果这 时接上串口调试助手的话，可以看到串口的数据。</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=6NJTI9HT))
> 
> 🏷️ #📝/重点

^KEY6NJTI9HT

> <span class="highlight" style="background-color: #e56eee">如果不想使用微库，那就要用到我们提到的第二种方法：取消 ARM 的半主机工 作模式；只需在代码中添加不使用半主机的声明即可</span> ([p187](zotero://open-pdf/library/items/JFGTX7CT?page=187&annotation=YIPDTGZN))
> 
> 🏷️ #📝/重点

^KEYYIPDTGZN

> <span class="highlight" style="background-color: #f19837">第二篇 入门篇</span> ([p189](zotero://open-pdf/library/items/JFGTX7CT?page=189&annotation=XNIE5HNY))
> 
> 🏷️ #📝/标题

^KEYXNIE5HNY

> <span class="highlight" style="background-color: #f19837">第十三章 跑马灯实验</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=RLQLSQGG))
> 
> 🏷️ #📝/标题

^KEYRLQLSQGG

> <span class="highlight" style="background-color: #f19837">13.1 STM32F1 GPIO 简介</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=9XS67YUY))
> 
> 🏷️ #📝/标题

^KEY9XS67YUY

> <span class="highlight" style="background-color: #e56eee">每组 16 个 IO 口</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=BRGDHHEK))
> 
> 🏷️ #📝/重点

^KEYBRGDHHEK

> <span class="highlight" style="background-color: #e56eee">144 脚</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=EWHS6B2P))
> 
> 🏷️ #📝/重点

^KEYEWHS6B2P

> <span class="highlight" style="background-color: #e56eee">GPIOA、GPIOB、GPIOC、 GPIOD、GPIOE、GPIOF 和 GPIOG 七组 GPIO 口</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=NS7VEFDF))
> 
> 🏷️ #📝/重点

^KEYNS7VEFDF

> <span class="highlight" style="background-color: #e56eee">STM32F103 的绝大部分 IO 口，都兼容 5V</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=F8FHW62N))
> 
> 🏷️ #📝/重点

^KEYF8FHW62N

> <span class="highlight" style="background-color: #f19837">13.1.1 GPIO 功能模式</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=DCPWQBRZ))
> 
> 🏷️ #📝/标题

^KEYDCPWQBRZ

> <span class="highlight" style="background-color: #e56eee">GPIO 有八种工作模式，分别是： 1、输入浮空 2、输入上拉 3、输入下拉 4、模拟功能 5、开漏输出 6、推挽输出 7、开漏式复用功能 8、推挽式复用功能</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=MESV4J9I))
> 
> 🏷️ #📝/重点

^KEYMESV4J9I

> <span class="highlight" style="background-color: #f19837">13.1.2 GPIO 基本结构分析</span> ([p190](zotero://open-pdf/library/items/JFGTX7CT?page=190&annotation=YMSFLEKI))
> 
> 🏷️ #📝/标题

^KEYYMSFLEKI

> <span class="image#e56eee">null</span>GPIO基本结构图 ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=VRKWY8EM))

^KEYVRKWY8EM

> <span class="highlight" style="background-color: #e56eee">① 保护二极管</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=EU2QVQ3E))
> 
> 🏷️ #📝/重点

^KEYEU2QVQ3E

> <span class="highlight" style="background-color: #e56eee">保护二极管共有两个，用于保护引脚外部过高或过低的电压输入。</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=XCAQP8QA))
> 
> 🏷️ #📝/重点

^KEYXCAQP8QA

> <span class="highlight" style="background-color: #e56eee">② 上拉、下拉电阻</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=DNSWZULL))
> 
> 🏷️ #📝/重点

^KEYDNSWZULL

> <span class="highlight" style="background-color: #e56eee">它们阻值大概在 30~50K 欧之间，可以通过上、下两个对应的开关控制，这两个开关由寄 存器控制。</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=RD5W44JS))
> 
> 🏷️ #📝/重点

^KEYRD5W44JS

> <span class="highlight" style="background-color: #e56eee">当引脚外部的器件没有干扰引脚的电压时，即没有外部的上、下拉电压，引脚的电 平由引脚内部上、下拉决定</span>
> 
> 当没有外部的上下拉电压时，引脚的电平由内部的上下拉决定； ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=NGWHQCZ6))
> 
> 🏷️ #📝/重点

^KEYNGWHQCZ6

> <span class="highlight" style="background-color: #e56eee">开启内部上拉电阻工作，引脚电平为高，开启内部下拉电阻工作， 则引脚电平为低</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=AE6FVTFQ))
> 
> 🏷️ #📝/重点

^KEYAE6FVTFQ

> <span class="highlight" style="background-color: #e56eee">如果内部上、下拉电阻都不开启，这种情况就是我们所说的浮空模式。 浮空模式下，引脚的电平是不可确定的。引脚的电平可以由外部的上、下拉电平决定</span>
> 
> 浮空模式，引脚的电平由外部的上下拉电平决定。 ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=5SSU3NSY))
> 
> 🏷️ #📝/重点

^KEY5SSU3NSY

> <span class="highlight" style="background-color: #e56eee">STM32 的内部上拉是一种“弱上拉”，这样的上拉电流很弱，如果有要求大电流还是 得外部上拉</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=I6KXJAJL))
> 
> 🏷️ #📝/重点

^KEYI6KXJAJL

> <span class="highlight" style="background-color: #e56eee">③ 施密特触发器</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=XNG5H489))
> 
> 🏷️ #📝/重点

^KEYXNG5H489

> <span class="highlight" style="background-color: #e56eee">对于标准施密特触发器，当输入电压高于正向阈值电压，输出为高；当输入电压低于负向 阈值电压，输出为低；当输入在正负向阈值电压之间，输出不改变</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=8EDRV99B))
> 
> 🏷️ #📝/重点

^KEY8EDRV99B

> <span class="highlight" style="background-color: #e56eee">施密特触发器是一种双稳态多谐振荡器</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=IZW6FL3V))
> 
> 🏷️ #📝/重点

^KEYIZW6FL3V

> <span class="highlight" style="background-color: #e56eee">施密特触发器可作为波形整形电路</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=FAKP7XFS))
> 
> 🏷️ #📝/重点

^KEYFAKP7XFS

> <span class="highlight" style="background-color: #e56eee">可用于抗干扰</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=9JCUPVXK))
> 
> 🏷️ #📝/重点

^KEY9JCUPVXK

> <span class="highlight" style="background-color: #e56eee">以及在闭回路正回授/负回授配 置中用于实现多谐振荡器。</span> ([p191](zotero://open-pdf/library/items/JFGTX7CT?page=191&annotation=XXC845D9))
> 
> 🏷️ #📝/重点

^KEYXXC845D9

> <span class="highlight" style="background-color: #e56eee">④ P-MOS 管和 N-MOS 管</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=DCQR9Z4W))
> 
> 🏷️ #📝/重点

^KEYDCQR9Z4W

> <span class="highlight" style="background-color: #e56eee">这个结构控制 GPIO 的开漏输出和推挽输出两种模式</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=QG4GQ36U))
> 
> 🏷️ #📝/重点

^KEYQG4GQ36U

> <span class="highlight" style="background-color: #e56eee">输入浮空</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=QWSDTZPF))
> 
> 🏷️ #📝/重点

^KEYQWSDTZPF

> <span class="highlight" style="background-color: #e56eee">上拉/下拉电阻为断开状态，施密特触发器打开，输出被禁止</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=LE5ZZ3WG))
> 
> 🏷️ #📝/重点

^KEYLE5ZZ3WG

> <span class="highlight" style="background-color: #e56eee">输入浮空模 式下，IO 口的电平完全是由外部电路决定</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=T9DM6K4Z))
> 
> 🏷️ #📝/重点

^KEYT9DM6K4Z

> <span class="highlight" style="background-color: #e56eee">输入上拉</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=4MU2LRV5))
> 
> 🏷️ #📝/重点

^KEY4MU2LRV5

> <span class="highlight" style="background-color: #e56eee">上拉电阻导通，施密特触发器打开，输出被禁止</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=IZUTSWHL))
> 
> 🏷️ #📝/重点

^KEYIZUTSWHL

> <span class="highlight" style="background-color: #e56eee">需要外部上拉电阻的 时候，可以使用内部上拉电阻</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=ECVS76D5))
> 
> 🏷️ #📝/重点

^KEYECVS76D5

> <span class="highlight" style="background-color: #e56eee">但是内部上拉电阻的阻值较大， 所以只是“弱上拉”，不适合做电流型驱动</span> ([p192](zotero://open-pdf/library/items/JFGTX7CT?page=192&annotation=RWK2W4I7))
> 
> 🏷️ #📝/重点

^KEYRWK2W4I7

> <span class="highlight" style="background-color: #e56eee">输入下拉</span> ([p193](zotero://open-pdf/library/items/JFGTX7CT?page=193&annotation=G949XRTQ))
> 
> 🏷️ #📝/重点

^KEYG949XRTQ

> <span class="highlight" style="background-color: #e56eee">拉电阻导通，施密特触发器打开，输出被禁止</span> ([p193](zotero://open-pdf/library/items/JFGTX7CT?page=193&annotation=74KK2J9T))
> 
> 🏷️ #📝/重点

^KEY74KK2J9T

> <span class="highlight" style="background-color: #e56eee">需要外部下拉电阻 的时候，可以使用内部下拉电阻</span> ([p193](zotero://open-pdf/library/items/JFGTX7CT?page=193&annotation=PMCUAM7T))
> 
> 🏷️ #📝/重点

^KEYPMCUAM7T

> <span class="highlight" style="background-color: #e56eee">内部下拉电阻的阻值较 大，所以不适合做电流型驱动</span> ([p193](zotero://open-pdf/library/items/JFGTX7CT?page=193&annotation=4LWZW276))
> 
> 🏷️ #📝/重点

^KEY4LWZW276

> <span class="highlight" style="background-color: #e56eee">模拟功能</span> ([p193](zotero://open-pdf/library/items/JFGTX7CT?page=193&annotation=WYLJPCI5))
> 
> 🏷️ #📝/重点

^KEYWYLJPCI5

> <span class="highlight" style="background-color: #e56eee">上下拉电阻断开，施密特触发器关闭，双 MOS 管也关闭。其他外设可以通过模 拟通道输入输出。</span> ([p193](zotero://open-pdf/library/items/JFGTX7CT?page=193&annotation=GMN66FN7))
> 
> 🏷️ #📝/重点

^KEYGMN66FN7

> <span class="highlight" style="background-color: #e56eee">开漏输出</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=F9AIB7LD))
> 
> 🏷️ #📝/重点

^KEYF9AIB7LD

> <span class="highlight" style="background-color: #e56eee">从结果上看它只能输出低 电平 Vss 或者高阻态</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=VBZI2FJW))
> 
> 🏷️ #📝/重点

^KEYVBZI2FJW

> <span class="highlight" style="background-color: #e56eee">开漏输出模式下 P-MOS 一直在截止状态，即不导通</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=UJJW7R6I))
> 
> 🏷️ #📝/重点

^KEYUJJW7R6I

> <span class="highlight" style="background-color: #e56eee">输出数据寄存器的逻辑 0 经过 “输出控制”的取反操作后，输出逻辑 1 到 N-MOS 管的栅极，这时 N-MOS 管就会导通， 使得 IO 引脚连接到 VSS，即输出低电平</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=AL5A6FPI))
> 
> 🏷️ #📝/重点

^KEYAL5A6FPI

> <span class="highlight" style="background-color: #e56eee">只能通过接芯片外部上拉电阻的方式，实现开漏输出模式下输出高电平</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=2QC92ATK))
> 
> 🏷️ #📝/重点

^KEY2QC92ATK

> <span class="highlight" style="background-color: #e56eee">在开漏输出模式下，施密特触发器是工作的，所以 IO 口引脚的电平状态会被采集到输入数 据寄存器中，如果对输入数据寄存器进行读访问可以得到 IO 口的状态。也就是说开漏输出模式 下，我们可以读取 IO 引脚状态。</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=KP2CC8TE))
> 
> 🏷️ #📝/重点

^KEYKP2CC8TE

> <span class="highlight" style="background-color: #e56eee">推挽输出</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=KWQD49QA))
> 
> 🏷️ #📝/重点

^KEYKWQD49QA

> <span class="highlight" style="background-color: #e56eee">从结果上看它会输出低电平 VSS 或者高电平 VDD</span> ([p194](zotero://open-pdf/library/items/JFGTX7CT?page=194&annotation=5LBY8YXI))
> 
> 🏷️ #📝/重点

^KEY5LBY8YXI

> <span class="highlight" style="background-color: #e56eee">推挽输出模式下，P-MOS 管和 N-MOS 管同一时间只能有一个管是导通 的。</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=EGP7DXCC))
> 
> 🏷️ #📝/重点

^KEYEGP7DXCC

> <span class="highlight" style="background-color: #e56eee">在推挽输出模式下，施密特触发器也是打开的，我们可以读取 IO 口的电平状态</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=W2A8U2GD))
> 
> 🏷️ #📝/重点

^KEYW2A8U2GD

> <span class="highlight" style="background-color: #e56eee">于推挽输出模式下输出高电平时，是直接连接 VDD，所以驱动能力较强，可以做电流 型驱动，驱动电流最大可达 25mA，但是芯片的总电流有限，所以并不建议这样用，最好还 是使用芯片外部的电源。</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=5KDGBBZ7))
> 
> 🏷️ #📝/重点

^KEY5KDGBBZ7

> <span class="highlight" style="background-color: #e56eee">开漏式复用功能</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=T6L2S9BU))
> 
> 🏷️ #📝/重点

^KEYT6L2S9BU

> <span class="highlight" style="background-color: #e56eee">一个 IO 口可以是通用的 IO 口功能，还可以是其他外设的特殊功能引脚， 这就是 IO 口的复用功能</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=9MG3PTZ7))
> 
> 🏷️ #📝/重点

^KEY9MG3PTZ7

> <span class="highlight" style="background-color: #e56eee">一个 IO 口可以是多个外设的功能引脚，我们需要选择作为其中一个 外设的功能引脚。当选择复用功能时，引脚的状态是由对应的外设控制，而不是输出数据寄存 器</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=IKIS7BMG))
> 
> 🏷️ #📝/重点

^KEYIKIS7BMG

> <span class="highlight" style="background-color: #e56eee">另外在开漏式复用功能模式下，施密特触发器也是打开的，我们可以读取 IO 口的电平状 态，同时外设可以读取 IO 口的信息。</span> ([p195](zotero://open-pdf/library/items/JFGTX7CT?page=195&annotation=X97XDITQ))
> 
> 🏷️ #📝/重点

^KEYX97XDITQ

> <span class="highlight" style="background-color: #e56eee">推挽式复用功能</span> ([p196](zotero://open-pdf/library/items/JFGTX7CT?page=196&annotation=PBP2DMAU))
> 
> 🏷️ #📝/重点

^KEYPBP2DMAU

> <span class="highlight" style="background-color: #f19837">13.1.3 GPIO 寄存器介绍</span> ([p196](zotero://open-pdf/library/items/JFGTX7CT?page=196&annotation=59THCIKN))
> 
> 🏷️ #📝/标题

^KEY59THCIKN

> <span class="highlight" style="background-color: #e56eee">有 7 个 32 位寄存器控制</span> ([p196](zotero://open-pdf/library/items/JFGTX7CT?page=196&annotation=H3HCC48V))
> 
> 🏷️ #📝/重点

^KEYH3HCC48V

> <span class="highlight" style="background-color: #e56eee">2 个 32 位端口配置寄存器（CRL 和 CRH） 2 个 32 位端口数据寄存器（IDR 和 ODR） 1 个 32 位端口置位/复位寄存器 (BSRR) 1 个 16 位端口复位寄存器（BRR） 1 个 32 位端口锁定寄存器 (LCKR)</span> ([p196](zotero://open-pdf/library/items/JFGTX7CT?page=196&annotation=LW5PPFBH))
> 
> 🏷️ #📝/重点

^KEYLW5PPFBH

> <span class="highlight" style="background-color: #e56eee">端口配置寄存器（GPIOx_CRL 和 GPIO_x_CRH）</span> ([p197](zotero://open-pdf/library/items/JFGTX7CT?page=197&annotation=9GSGLPN6))
> 
> 🏷️ #📝/重点

^KEY9GSGLPN6

> <span class="highlight" style="background-color: #e56eee">CRL 控制端口的低八位，CRH 控制端口的 高八位</span> ([p197](zotero://open-pdf/library/items/JFGTX7CT?page=197&annotation=JIWWKZCY))
> 
> 🏷️ #📝/重点

^KEYJIWWKZCY

> <span class="highlight" style="background-color: #e56eee">寄存器的作用是控制 GPIO 口的工作模式和工作速度</span> ([p197](zotero://open-pdf/library/items/JFGTX7CT?page=197&annotation=J7KYRLIN))
> 
> 🏷️ #📝/重点

^KEYJ7KYRLIN

> <span class="highlight" style="background-color: #e56eee">每组 GPIO 下有 16 个 IO 口，一个寄存器共 32 位，每 4 个位控制 1 个 IO，所以才需要两 个寄存器完成</span> ([p197](zotero://open-pdf/library/items/JFGTX7CT?page=197&annotation=EINST67G))
> 
> 🏷️ #📝/重点

^KEYEINST67G

> <span class="image#e56eee">null</span>该寄存器决定着 IO 口是上拉和下拉，为 0 时为下拉，为 1 时为上拉 ([p198](zotero://open-pdf/library/items/JFGTX7CT?page=198&annotation=IC8DA6YG))

^KEYIC8DA6YG

> <span class="highlight" style="background-color: #e56eee">端口输出数据寄存器（ODR）</span> ([p198](zotero://open-pdf/library/items/JFGTX7CT?page=198&annotation=X3MJV8Z6))
> 
> 🏷️ #📝/重点

^KEYX3MJV8Z6

> <span class="highlight" style="background-color: #e56eee">用于控制 GPIOx 的输出高电平或者低电平</span> ([p198](zotero://open-pdf/library/items/JFGTX7CT?page=198&annotation=VGYPEBG7))
> 
> 🏷️ #📝/重点

^KEYVGYPEBG7

> <span class="highlight" style="background-color: #e56eee">该寄存器低 16 位有效，分别对应每一组 GPIO 的 16 个引脚。</span> ([p198](zotero://open-pdf/library/items/JFGTX7CT?page=198&annotation=H76LB47X))
> 
> 🏷️ #📝/重点

^KEYH76LB47X

> <span class="highlight" style="background-color: #e56eee">端口置位/复位寄存器（BSRR</span> ([p198](zotero://open-pdf/library/items/JFGTX7CT?page=198&annotation=I5UK2DSH))
> 
> 🏷️ #📝/重点

^KEYI5UK2DSH

> <span class="highlight" style="background-color: #e56eee">该寄存器也用于控制 GPIOx 的输出高电平或者低电平</span> ([p198](zotero://open-pdf/library/items/JFGTX7CT?page=198&annotation=4E76FGSM))
> 
> 🏷️ #📝/重点

^KEY4E76FGSM

> <span class="highlight" style="background-color: #e56eee">BSRR 是只写权限，而 ODR 是可读可写权限</span> ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=EPSIIHPP))
> 
> 🏷️ #📝/重点

^KEYEPSIIHPP

> <span class="highlight" style="background-color: #e56eee">BSRR 寄存器 32 位有效，对于低 16 位（015），我们往相应的位写 1(BSy=1)，那么对应的 IO 口会输出高电平，往相应的位写 0(BSy=0)， 对 IO 口没有任何影响，高 16 位（16-31）作用刚好相反，对相应的位写 1(BRy=1)会输出低电 平，写 0(BRy=0)没有任何影响，y=0~15。</span> ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=YYWIGG4M))
> 
> 🏷️ #📝/重点

^KEYYYWIGG4M

> <span class="highlight" style="background-color: #e56eee">对于 BSRR 寄存器</span> ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=UG4UXHQA))
> 
> 🏷️ #📝/重点

^KEYUG4UXHQA

> <span class="highlight" style="background-color: #e56eee">我们要设置 某个 IO 口电平，只需要相关位设置为 1 即可。</span> ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=ZCWCDT9D))
> 
> 🏷️ #📝/重点

^KEYZCWCDT9D

> <span class="highlight" style="background-color: #e56eee">ODR 寄存器，我们要设置某个 IO 口电平， 我们首先需要读出来 ODR 寄存器的值，然后对整个 ODR 寄存器重新赋值来达到设置某个或者 某些 IO 口的目的，而 BSRR 寄存器直接设置即可</span> ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=84LAA5Z2))
> 
> 🏷️ #📝/重点

^KEY84LAA5Z2

> <span class="highlight" style="background-color: #e56eee">BSRR 寄存器还有一个好处，就是 BSRR 寄存器改变引脚状态的时候，不会被中断打断，而 ODR 寄 存器有被中断打断的风险。</span>
> 
> 推荐使用 BSRR 寄存器 ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=6B4ZG3WP))
> 
> 🏷️ #📝/重点

^KEY6B4ZG3WP

> <span class="highlight" style="background-color: #f19837">13.2 硬件设计</span> ([p199](zotero://open-pdf/library/items/JFGTX7CT?page=199&annotation=6Z6ZEFL5))
> 
> 🏷️ #📝/标题

^KEY6Z6ZEFL5

> <span class="highlight" style="background-color: #f19837">13.3 程序设计</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=W98APPF3))
> 
> 🏷️ #📝/标题

^KEYW98APPF3

> <span class="highlight" style="background-color: #f19837">13.3.1 GPIO 的 HAL 库驱动分析</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=XMYKWS56))
> 
> 🏷️ #📝/标题

^KEYXMYKWS56

> <span class="highlight" style="background-color: #e56eee">HAL_GPIO_Init 函数</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=VSPRAQHD))
> 
> 🏷️ #📝/重点

^KEYVSPRAQHD

> <span class="highlight" style="background-color: #e56eee">形参 1 是端口号</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=3AR5GEHN))
> 
> 🏷️ #📝/重点

^KEY3AR5GEHN

> <span class="highlight" style="background-color: #e56eee">形参 2 是 GPIO_InitTypeDef 类型的结构体变量</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=QKGYC27J))
> 
> 🏷️ #📝/重点

^KEYQKGYC27J

> <span class="highlight" style="background-color: #e56eee">成员 Pin 表示引脚号，范围：GPIO_PIN_0 到 GPIO_PIN_15</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=4NAHZIXB))
> 
> 🏷️ #📝/重点

^KEY4NAHZIXB

> <span class="highlight" style="background-color: #e56eee">成员 Mode 是 GPIO 的模式选择</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=36BXDAC7))
> 
> 🏷️ #📝/重点

^KEY36BXDAC7

> <span class="highlight" style="background-color: #e56eee">成员 Pull 用于配置上下拉电阻</span> ([p200](zotero://open-pdf/library/items/JFGTX7CT?page=200&annotation=QLJ38H26))
> 
> 🏷️ #📝/重点

^KEYQLJ38H26

> <span class="highlight" style="background-color: #e56eee">成员 Speed 用于配置 GPIO 的速度</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=S8BEX3MD))
> 
> 🏷️ #📝/重点

^KEYS8BEX3MD

> <span class="highlight" style="background-color: #e56eee">HAL 库的 EXTI 外部中断的设置功能整合到此函数里面，而不是单独独立一个文件</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=4AL9PK9Y))
> 
> 🏷️ #📝/重点

^KEY4AL9PK9Y

> <span class="highlight" style="background-color: #e56eee">HAL_GPIO_WritePin 函数</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=596KRT3M))
> 
> 🏷️ #📝/重点

^KEY596KRT3M

> <span class="highlight" style="background-color: #e56eee">是 GPIO 口的写引脚函数</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=GJH3NSIR))
> 
> 🏷️ #📝/重点

^KEYGJH3NSIR

> <span class="highlight" style="background-color: #e56eee">BSRR 寄存器</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=5S8YJ6JQ))
> 
> 🏷️ #📝/重点

^KEY5S8YJ6JQ

> <span class="highlight" style="background-color: #e56eee">是要设置输出的状态，是枚举型有两个选择：GPIO_PIN_SET 表示高电平， GPIO_PIN_RESET 表示低电平。</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=IM4A36DF))
> 
> 🏷️ #📝/重点

^KEYIM4A36DF

> <span class="highlight" style="background-color: #e56eee">HAL_GPIO_TogglePin 函数</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=SJ8C9WC8))
> 
> 🏷️ #📝/重点

^KEYSJ8C9WC8

> <span class="highlight" style="background-color: #e56eee">GPIO 口的电平翻转函数</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=NJU9U7NA))
> 
> 🏷️ #📝/重点

^KEYNJU9U7NA

> <span class="highlight" style="background-color: #e56eee">GPIO 输出配置步骤</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=LXLQPJMQ))
> 
> 🏷️ #📝/重点

^KEYLXLQPJMQ

> <span class="highlight" style="background-color: #e56eee">使能对应 GPIO 时钟</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=BTCGQ7AB))
> 
> 🏷️ #📝/重点

^KEYBTCGQ7AB

> <span class="highlight" style="background-color: #e56eee">在使用任何外设之前，我们都要先使能其时钟</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=WWXJ4AD9))
> 
> 🏷️ #📝/重点

^KEYWWXJ4AD9

> <span class="highlight" style="background-color: #e56eee">设置对应 GPIO 工作模式（推挽输出）</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=R75YYKC2))
> 
> 🏷️ #📝/重点

^KEYR75YYKC2

> <span class="highlight" style="background-color: #e56eee">函数 HAL_GPIO_Init 设置实现</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=XIE8Q3TH))
> 
> 🏷️ #📝/重点

^KEYXIE8Q3TH

> <span class="highlight" style="background-color: #e56eee">控制 GPIO 引脚输出高低电平</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=WDJHU98J))
> 
> 🏷️ #📝/重点

^KEYWDJHU98J

> <span class="highlight" style="background-color: #e56eee">HAL_GPIO_WritePin</span> ([p201](zotero://open-pdf/library/items/JFGTX7CT?page=201&annotation=GCHJBRAN))
> 
> 🏷️ #📝/重点

^KEYGCHJBRAN

> <span class="highlight" style="background-color: #f19837">13.3.3 程序解析</span> ([p202](zotero://open-pdf/library/items/JFGTX7CT?page=202&annotation=YK8RN4DC))
> 
> 🏷️ #📝/标题

^KEYYK8RN4DC

> <span class="highlight" style="background-color: #e56eee">led 驱动代码</span> ([p202](zotero://open-pdf/library/items/JFGTX7CT?page=202&annotation=TJXNTDPP))
> 
> 🏷️ #📝/重点

^KEYTJXNTDPP

> <span class="highlight" style="background-color: #e56eee">LED 灯引脚宏定义</span> ([p202](zotero://open-pdf/library/items/JFGTX7CT?page=202&annotation=4LTX2PB4))
> 
> 🏷️ #📝/重点

^KEY4LTX2PB4

> <span class="highlight" style="background-color: #e56eee">这里的时钟使能函数宏定义，使用了 do{ }while(0)结构，是为了避免在某些使用 场景出错的问题</span> ([p202](zotero://open-pdf/library/items/JFGTX7CT?page=202&annotation=8F7FPKPJ))
> 
> 🏷️ #📝/重点

^KEY8F7FPKPJ

> <span class="highlight" style="background-color: #e56eee">LED 灯操作函数宏定义</span> ([p202](zotero://open-pdf/library/items/JFGTX7CT?page=202&annotation=VGNC22LK))
> 
> 🏷️ #📝/重点

^KEYVGNC22LK

> <span class="highlight" style="background-color: #e56eee">再解析 led.c 的程序</span> ([p203](zotero://open-pdf/library/items/JFGTX7CT?page=203&annotation=HLSUVH3Q))
> 
> 🏷️ #📝/重点

^KEYHLSUVH3Q

> <span class="highlight" style="background-color: #e56eee">main.c 代码</span> ([p203](zotero://open-pdf/library/items/JFGTX7CT?page=203&annotation=FKBZ4ZBA))
> 
> 🏷️ #📝/重点

^KEYFKBZ4ZBA

> <span class="highlight" style="background-color: #f19837">13.4 下载验证</span> ([p204](zotero://open-pdf/library/items/JFGTX7CT?page=204&annotation=BXH82LRR))
> 
> 🏷️ #📝/标题

^KEYBXH82LRR

> <span class="highlight" style="background-color: #f19837">第十五章 按键输入实验</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=L4U9PSHK))
> 
> 🏷️ #📝/标题

^KEYL4U9PSHK

> <span class="highlight" style="background-color: #f19837">15.1 按键与输入数据寄存器简介</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=CDQQ68KS))
> 
> 🏷️ #📝/标题

^KEYCDQQ68KS

> <span class="highlight" style="background-color: #f19837">15.1.1 独立按键简介</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=AVL66ILU))
> 
> 🏷️ #📝/标题

^KEYAVL66ILU

> <span class="highlight" style="background-color: #e56eee">常态下，独立按键是断开的， 按下的时候才闭合。每个独立按键会单独占用一个 IO 口，通过 IO 口的高低电平判断按键的状 态。</span>
> 
> 按键工作原理 ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=MNCCDQCI))
> 
> 🏷️ #📝/重点

^KEYMNCCDQCI

> <span class="highlight" style="background-color: #e56eee">软件消抖</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=UY5W48IU))
> 
> 🏷️ #📝/重点

^KEYUY5W48IU

> <span class="highlight" style="background-color: #e56eee">延时消抖</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=836MXY78))
> 
> 🏷️ #📝/重点

^KEY836MXY78

> <span class="highlight" style="background-color: #e56eee">检测到按键按下后，一般进行 10ms 延时</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=D4PLXX6Q))
> 
> 🏷️ #📝/重点

^KEYD4PLXX6Q

> <span class="highlight" style="background-color: #e56eee">待延时过后再检测按键状态，如果没有按下，那我们就判断这 是抖动或者干扰造成的；如果还是按下，那么我们就认为这是按键真的按下了。</span>
> 
> 延时消抖方法 ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=I7G7VYBB))
> 
> 🏷️ #📝/重点

^KEYI7G7VYBB

> <span class="highlight" style="background-color: #f19837">15.1.2 GPIO 端口输入数据寄存器（IDR）</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=NUXUQXT7))
> 
> 🏷️ #📝/标题

^KEYNUXUQXT7

> <span class="highlight" style="background-color: #e56eee">该寄存器用于存储 GPIOx 的输入状态，它连接到施密特触发器上，IO 口外部的电平信号 经过触发器后，模拟信号就被转化成 0 和 1 这样的数字信号，并存储到该寄存器中。</span> ([p209](zotero://open-pdf/library/items/JFGTX7CT?page=209&annotation=6W2TL4VQ))
> 
> 🏷️ #📝/重点

^KEY6W2TL4VQ

> <span class="highlight" style="background-color: #e56eee">低 16 位有效，分别对应每一组 GPIO 的 16 个引脚。当 CPU 访问该寄存器，如果 对应的某位为 0(IDRy=0)，则说明该 IO 口输入的是低电平，如果是 1(IDRy=1)，则表示输入的 是高电平，y=0~15。</span> ([p210](zotero://open-pdf/library/items/JFGTX7CT?page=210&annotation=LI43WVR8))
> 
> 🏷️ #📝/重点

^KEYLI43WVR8

> <span class="highlight" style="background-color: #f19837">15.2 硬件设计</span> ([p210](zotero://open-pdf/library/items/JFGTX7CT?page=210&annotation=TF5KPFUS))
> 
> 🏷️ #📝/标题

^KEYTF5KPFUS

> <span class="highlight" style="background-color: #e56eee">KEY0、KEY1 和 KEY2 是低电平有效的，而 KEY_UP 则是高电平有 效的，并且外部都没有上下拉电阻，所以需要在 STM32F103 内部设置上下拉，来确定设置空闲 电平状态。</span> ([p210](zotero://open-pdf/library/items/JFGTX7CT?page=210&annotation=8MNILLVS))
> 
> 🏷️ #📝/重点

^KEY8MNILLVS

> <span class="highlight" style="background-color: #f19837">15.3 程序设计</span> ([p211](zotero://open-pdf/library/items/JFGTX7CT?page=211&annotation=4PQBCRS5))
> 
> 🏷️ #📝/标题

^KEY4PQBCRS5

> <span class="highlight" style="background-color: #f19837">15.3.1 HAL_GPIO_ReadPin 函数</span> ([p211](zotero://open-pdf/library/items/JFGTX7CT?page=211&annotation=ZGRVEQFT))
> 
> 🏷️ #📝/标题

^KEYZGRVEQFT

> <span class="highlight" style="background-color: #f19837">15.3.3 程序解析</span> ([p212](zotero://open-pdf/library/items/JFGTX7CT?page=212&annotation=TZQM2LCP))
> 
> 🏷️ #📝/标题

^KEYTZQM2LCP

> <span class="highlight" style="background-color: #e56eee">按键驱动代码</span> ([p212](zotero://open-pdf/library/items/JFGTX7CT?page=212&annotation=HPGVWF2W))
> 
> 🏷️ #📝/重点

^KEYHPGVWF2W

> <span class="highlight" style="background-color: #e56eee">按键引脚定义</span> ([p212](zotero://open-pdf/library/items/JFGTX7CT?page=212&annotation=6HAMQ3DR))
> 
> 🏷️ #📝/重点

^KEY6HAMQ3DR

> <span class="image#e56eee">null</span>在头文件中，将对 GPIO 的操作利用宏定义封装成对应外设的操作 ([p212](zotero://open-pdf/library/items/JFGTX7CT?page=212&annotation=BLYC6CW9))

^KEYBLYC6CW9

> <span class="highlight" style="background-color: #e56eee">KEY0 和 KEY1 是低电平有效的（即一端接地），所以我们要设置为内 部上拉，而 KEY_UP 是高电平有效的（即一端接电源），所以我们要设置为内部下拉。</span>
> 
> 低电平有效：按键按下时，串口的输入为低电平；没按下时，按键的输入为高电平。 ([p213](zotero://open-pdf/library/items/JFGTX7CT?page=213&annotation=EKKLXACV))
> 
> 🏷️ #📝/重点

^KEYEKKLXACV

> <span class="highlight" style="background-color: #e56eee">key_scan</span>
> 
> 该函数需要放在 while 函数里不断执行 ([p213](zotero://open-pdf/library/items/JFGTX7CT?page=213&annotation=NUY9VWD7))
> 
> 🏷️ #📝/重点

^KEYNUY9VWD7

> <span class="highlight" style="background-color: #e56eee">static</span>
> 
> 注意：这里时静态局部变量，函数结束后不会被销毁；
> 
> 通过这个变量可以记录当前是否按下按键。 ([p213](zotero://open-pdf/library/items/JFGTX7CT?page=213&annotation=X5YVURE5))
> 
> 🏷️ #📝/重点

^KEYX5YVURE5

> <span class="highlight" style="background-color: #e56eee">keyval</span>
> 
> 需要返回的值，通过该值可以知道哪个键被按下 ([p213](zotero://open-pdf/library/items/JFGTX7CT?page=213&annotation=7S98SFF2))
> 
> 🏷️ #📝/重点

^KEY7S98SFF2

> <span class="highlight" style="background-color: #e56eee">null</span>
> 
> 不满足 if 的情况：
> 
> 1、松开标志为0；
> 
> 2、没有任何一个键按下 ([p213](zotero://open-pdf/library/items/JFGTX7CT?page=213&annotation=VGKSG8G8))

^KEYVGKSG8G8

> <span class="image#e56eee">null</span>越往下，优先级越高 ([p213](zotero://open-pdf/library/items/JFGTX7CT?page=213&annotation=RM4NNC3S))

^KEYRM4NNC3S

> <span class="highlight" style="background-color: #e56eee">当 mode 为 0 的时候，key_scan 函数将不支持连续按</span> ([p214](zotero://open-pdf/library/items/JFGTX7CT?page=214&annotation=YVRZJ6AE))
> 
> 🏷️ #📝/重点

^KEYYVRZJ6AE

> <span class="highlight" style="background-color: #e56eee">当 mode 为 1 的时候，key_scan 函数将支持连续按</span> ([p214](zotero://open-pdf/library/items/JFGTX7CT?page=214&annotation=M8PKZHRU))
> 
> 🏷️ #📝/重点

^KEYM8PKZHRU

> <span class="highlight" style="background-color: #e56eee">同时还有一点要注意的是，该函数的按键扫描 是有优先级的，最优先的是 KEY_UP，第二优先的是 KEY0，最后是按键 KEY2</span> ([p214](zotero://open-pdf/library/items/JFGTX7CT?page=214&annotation=Z2DPHSP2))
> 
> 🏷️ #📝/重点

^KEYZ2DPHSP2

> <span class="highlight" style="background-color: #e56eee">delay_ms(10);</span>
> 
> 按键消抖，当检测到没有按键按下时，延时10ms，再次检测。
> 
> 正因为这里有延时10ms，所以在按键扫描函数里，当检测到没有按下按键的时候，没有进行延时消抖。 ([p214](zotero://open-pdf/library/items/JFGTX7CT?page=214&annotation=9U3L938F))
> 
> 🏷️ #📝/重点

^KEY9U3L938F

> <span class="highlight" style="background-color: #f19837">第十六章 外部中断实验</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=A5M9759B))
> 
> 🏷️ #📝/标题

^KEYA5M9759B

> <span class="highlight" style="background-color: #f19837">16.1 NVIC 和 EXTI 简介</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=XYFUGGDY))
> 
> 🏷️ #📝/标题

^KEYXYFUGGDY

> <span class="highlight" style="background-color: #f19837">16.1.1 NVIC 简介</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=PTNZYFZW))
> 
> 🏷️ #📝/标题

^KEYPTNZYFZW

> <span class="highlight" style="background-color: #e56eee">NVIC 即嵌套向量中断控制器</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=W6IXKUHK))
> 
> 🏷️ #📝/重点

^KEYW6IXKUHK

> <span class="highlight" style="background-color: #e56eee">它 是内核的器件</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=FTHNCYPR))
> 
> 🏷️ #📝/重点

^KEYFTHNCYPR

> <span class="highlight" style="background-color: #e56eee">M3 内核都 是支持 256 个中断，其中包含了 16 个系统中断和 240 个外部中断，并且具有 256 级的可编程 中断设置。</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=K6HGZWFX))
> 
> 🏷️ #📝/重点

^KEYK6HGZWFX

> <span class="highlight" style="background-color: #e56eee">STM32F103ZET6 的系统中 断有 10 个，外部中断有 60 个。</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=4XCKQHVW))
> 
> 🏷️ #📝/重点

^KEY4XCKQHVW

> <span class="highlight" style="background-color: #f19837">16.1.1.1 NVIC 寄存器</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=69L5FJQ8))
> 
> 🏷️ #📝/标题

^KEY69L5FJQ8

> <span class="highlight" style="background-color: #e56eee">NVIC 相关的寄存器定义了可以在 core_cm3.h 文件中找到。</span> ([p216](zotero://open-pdf/library/items/JFGTX7CT?page=216&annotation=PX4PTNM2))
> 
> 🏷️ #📝/重点

^KEYPX4PTNM2

> <span class="highlight" style="background-color: #e56eee">ISER[8]</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=KDFQ4QF7))
> 
> 🏷️ #📝/重点

^KEYKDFQ4QF7

> <span class="highlight" style="background-color: #e56eee">这是一个中断使能寄存器组</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=9STIVS9E))
> 
> 🏷️ #📝/重点

^KEY9STIVS9E

> <span class="highlight" style="background-color: #e56eee">CM3 内核支持 256 个中断，这里用 8 个 32 位寄存器来控制，每个位控制一个中断</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=9QXQKMHZ))
> 
> 🏷️ #📝/重点

^KEY9QXQKMHZ

> <span class="highlight" style="background-color: #e56eee">。ISER[0]的 bit0~31 分别对应中 断 0~31；ISER[1]的 bit0~27 对应中断 32~59，这样总共 60 个中断就可以分别对应上了</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=BKEC3HMP))
> 
> 🏷️ #📝/重点

^KEYBKEC3HMP

> <span class="highlight" style="background-color: #e56eee">你要使 能某个中断，必须设置相应的 ISER 位为 1</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=F3M6AICB))
> 
> 🏷️ #📝/重点

^KEYF3M6AICB

> <span class="highlight" style="background-color: #e56eee">ICER[8]</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=6Y4AYSKW))
> 
> 🏷️ #📝/重点

^KEY6Y4AYSKW

> <span class="highlight" style="background-color: #e56eee">中断除能寄存器组</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=5HLHJU72))
> 
> 🏷️ #📝/重点

^KEY5HLHJU72

> <span class="highlight" style="background-color: #e56eee">NVIC 的这些寄 存器都是写 1 有效的，写 0 是无效的</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=CCLLAYIE))
> 
> 🏷️ #📝/重点

^KEYCCLLAYIE

> <span class="highlight" style="background-color: #e56eee">ISPR[8]</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=T6GUZ4T2))
> 
> 🏷️ #📝/重点

^KEYT6GUZ4T2

> <span class="highlight" style="background-color: #e56eee">中断使能挂起控制寄存器组</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=VJNJ7VGX))
> 
> 🏷️ #📝/重点

^KEYVJNJ7VGX

> <span class="highlight" style="background-color: #e56eee">每 个位对应的中断和 ISER 是一样的。通过置 1，可以将正在进行的中断挂起，而执行同级或更高 级别的中断。</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=4MGV553T))
> 
> 🏷️ #📝/重点

^KEY4MGV553T

> <span class="highlight" style="background-color: #e56eee">ICPR[8]</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=KFAIXK2T))
> 
> 🏷️ #📝/重点

^KEYKFAIXK2T

> <span class="highlight" style="background-color: #e56eee">中断解挂控制寄存器组</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=YM2SNTGE))
> 
> 🏷️ #📝/重点

^KEYYM2SNTGE

> <span class="highlight" style="background-color: #e56eee">可以将挂起的中断解挂</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=7Z8KHQHW))
> 
> 🏷️ #📝/重点

^KEY7Z8KHQHW

> <span class="highlight" style="background-color: #e56eee">IABR[8]</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=FB9SBG3Q))
> 
> 🏷️ #📝/重点

^KEYFB9SBG3Q

> <span class="highlight" style="background-color: #e56eee">中断激活标志位寄存器组</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=CY8G95NP))
> 
> 🏷️ #📝/重点

^KEYCY8G95NP

> <span class="highlight" style="background-color: #e56eee">如果为 1，则表示该位所对应的中断正在被执行。这是一个只读寄 存器，通过它可以知道当前在执行的中断是哪一个。在中断执行完了由硬件自动清零</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=VZGQUUTK))
> 
> 🏷️ #📝/重点

^KEYVZGQUUTK

> <span class="highlight" style="background-color: #e56eee">IP [240]</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=6E5SF9XK))
> 
> 🏷️ #📝/重点

^KEY6E5SF9XK

> <span class="highlight" style="background-color: #e56eee">中断优先级控制的寄存器组</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=YLWJL9WQ))
> 
> 🏷️ #📝/重点

^KEYYLWJL9WQ

> <span class="highlight" style="background-color: #e56eee">IP 寄存器组由 240 个 8bit 的寄存器组成</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=M37GML4C))
> 
> 🏷️ #📝/重点

^KEYM37GML4C

> <span class="highlight" style="background-color: #e56eee">只用到了其中的 60 个</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=B3BA4BCB))
> 
> 🏷️ #📝/重点

^KEYB3BA4BCB

> <span class="highlight" style="background-color: #e56eee">IP[59]~IP[0]分别对应中断 59~0</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=7VFEPPII))
> 
> 🏷️ #📝/重点

^KEY7VFEPPII

> <span class="highlight" style="background-color: #e56eee">只用了高 4 位。这 4 位，又分为抢占优先级和子优先级</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=HYV5RX3B))
> 
> 🏷️ #📝/重点

^KEYHYV5RX3B

> <span class="highlight" style="background-color: #e56eee">抢占优先级在前，子 优先级在后。</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=VVAENS8S))
> 
> 🏷️ #📝/重点

^KEYVVAENS8S

> <span class="highlight" style="background-color: #e56eee">SCB->AIRCR 中的中断分组设置</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=TC56VYGX))
> 
> 🏷️ #📝/重点

^KEYTC56VYGX

> <span class="highlight" style="background-color: #f19837">16.1.1.2 中断优先级</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=KCYI43B4))
> 
> 🏷️ #📝/标题

^KEYKCYI43B4

> <span class="highlight" style="background-color: #e56eee">抢占式优先级和响应优先级</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=Z9HC2LB6))
> 
> 🏷️ #📝/重点

^KEYZ9HC2LB6

> <span class="highlight" style="background-color: #e56eee">响应优先级也称子优先级</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=8V4JIGX5))
> 
> 🏷️ #📝/重点

^KEY8V4JIGX5

> <span class="highlight" style="background-color: #e56eee">抢占优先级：抢占优先级高的中断可以打断正在执行的抢占优先级低的中断。 响应优先级：抢占优先级相同，响应优先级高的中断不能打断响应优先级低的中断</span> ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=TJDCQ9YS))
> 
> 🏷️ #📝/重点

^KEYTJDCQ9YS

> <span class="highlight" style="background-color: #e56eee">还有一种情况就是当两个或者多个中断的抢占式优先级和响应优先级相同时，那么就遵循 自然优先级，看中断向量表的中断排序，数值越小，优先级越高。</span>
> 
> 自然优先级 ([p217](zotero://open-pdf/library/items/JFGTX7CT?page=217&annotation=4JQMR3E5))
> 
> 🏷️ #📝/重点

^KEY4JQMR3E5

> <span class="highlight" style="background-color: #e56eee">只使用了高 四位[7:4]，低四位取零，这样以至于最多只有 16 级中断嵌套，即 2^4=16。</span>
> 
> 这个是指中断优先级控制寄存器的高四位，只有当分配情况为 0：4 或 4：0时，才会有16个中断优先级。 ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=29R6G8MV))
> 
> 🏷️ #📝/重点

^KEY29R6G8MV

> <span class="highlight" style="background-color: #e56eee">分为 5 个组</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=3R3A9J8K))
> 
> 🏷️ #📝/重点

^KEY3R3A9J8K

> <span class="highlight" style="background-color: #e56eee">SCB->AIRCR 寄存器的 bit10~8 来定义</span>
> 
> 通过该寄存器的 10~8 位控制分组 ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=S972VTT9))
> 
> 🏷️ #📝/重点

^KEYS972VTT9

> <span class="highlight" style="background-color: #e56eee">bit[7：4]</span>
> 
> 这个是指中断优先级控制寄存器的高四位 ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=XTM4NGYI))
> 
> 🏷️ #📝/重点

^KEYXTM4NGYI

> <span class="highlight" style="background-color: #e56eee">3：1</span>
> 
> 这个是指中断优先级控制寄存器的高四位中，有 3 位分给抢占优先级，有 1 位分给相应优先级。这样，你可以设置抢占优先级为 0~7，响应优先级为 0~1. ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=R3DQJAKK))
> 
> 🏷️ #📝/重点

^KEYR3DQJAKK

> <span class="highlight" style="background-color: #e56eee">例如优先级分组设置为 3，那么此时所有的 60 个中断，每个中断的中断优先寄存器的高四位中的最高 3 位是抢占优先 级，低 1 位是响应优先级。每个中断，你可以设置抢占优先级为 0~7，响应优先级为 1 或 0。</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=2WMTVEIY))
> 
> 🏷️ #📝/重点

^KEY2WMTVEIY

> <span class="highlight" style="background-color: #e56eee">数值越小所代表的优先级就越高</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=E52BRA9G))
> 
> 🏷️ #📝/重点

^KEYE52BRA9G

> <span class="highlight" style="background-color: #f19837">16.1.1.3 NVIC 相关函数</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=VDPXZYUN))
> 
> 🏷️ #📝/标题

^KEYVDPXZYUN

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_SetPriorityGrouping 函数</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=EDFLZI7M))
> 
> 🏷️ #📝/重点

^KEYEDFLZI7M

> <span class="highlight" style="background-color: #e56eee">用于设置中断优先级分组</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=6FRXQENQ))
> 
> 🏷️ #📝/重点

^KEY6FRXQENQ

> <span class="highlight" style="background-color: #e56eee">这个函数在一个工程里基本只调用一次，而且是在程序 HAL 库初始化函数里面已经被调 用，后续就不会再调用了</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=7FYA2WQA))
> 
> 🏷️ #📝/重点

^KEY7FYA2WQA

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_SetPriority 函数</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=KVR7BLNZ))
> 
> 🏷️ #📝/重点

^KEYKVR7BLNZ

> <span class="highlight" style="background-color: #e56eee">用于设置中断的抢占优先级和响应优先级（子优先级）</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=VCJGL47Q))
> 
> 🏷️ #📝/重点

^KEYVCJGL47Q

> <span class="highlight" style="background-color: #e56eee">形参 1 是中断号</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=76Q2PRTN))
> 
> 🏷️ #📝/重点

^KEY76Q2PRTN

> <span class="highlight" style="background-color: #e56eee">形参 2 是抢占优先级</span> ([p218](zotero://open-pdf/library/items/JFGTX7CT?page=218&annotation=CYEW3A59))
> 
> 🏷️ #📝/重点

^KEYCYEW3A59

> <span class="highlight" style="background-color: #e56eee">形参 3 是响应优先级</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=IUJABVX9))
> 
> 🏷️ #📝/重点

^KEYIUJABVX9

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_EnableIRQ 函数</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=GG6MZ52J))
> 
> 🏷️ #📝/重点

^KEYGG6MZ52J

> <span class="highlight" style="background-color: #e56eee">用于使能中断。</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=8FC9HSIY))
> 
> 🏷️ #📝/重点

^KEY8FC9HSIY

> <span class="highlight" style="background-color: #e56eee">形参 IRQn 是中断号，可以选择范围：IRQn_Type 定义的枚举类型，定义在 stm32f103xe.h</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=F2DRRK43))
> 
> 🏷️ #📝/重点

^KEYF2DRRK43

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_DisableIRQ 函数</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=IAEGXLSZ))
> 
> 🏷️ #📝/重点

^KEYIAEGXLSZ

> <span class="highlight" style="background-color: #e56eee">用于中断失能。</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=KSX476P4))
> 
> 🏷️ #📝/重点

^KEYKSX476P4

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_SystemReset 函数</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=TXW6Y7UI))
> 
> 🏷️ #📝/重点

^KEYTXW6Y7UI

> <span class="highlight" style="background-color: #e56eee">用于软件复位系统。</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=3AM74U8T))
> 
> 🏷️ #📝/重点

^KEY3AM74U8T

> <span class="highlight" style="background-color: #f19837">16.1.2 EXTI 简介</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=YZWEY5MC))
> 
> 🏷️ #📝/标题

^KEYYZWEY5MC

> <span class="highlight" style="background-color: #e56eee">EXTI 即是外部中断和事件控制器</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=I8QA7BAD))
> 
> 🏷️ #📝/重点

^KEYI8QA7BAD

> <span class="highlight" style="background-color: #e56eee">由 20 个产生事件/中断请求的边沿检测器组成</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=8IY7K47S))
> 
> 🏷️ #📝/重点

^KEY8IY7K47S

> <span class="highlight" style="background-color: #e56eee">一条输入线都可以独立地配置输入类型（脉冲或挂起）和对应的触发事件（上升沿或下降沿或 者双边沿都触发）</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=IK6LLE68))
> 
> 🏷️ #📝/重点

^KEYIK6LLE68

> <span class="highlight" style="background-color: #e56eee">每个输入线都可以独立地被屏蔽</span> ([p219](zotero://open-pdf/library/items/JFGTX7CT?page=219&annotation=Y4RK8YML))
> 
> 🏷️ #📝/重点

^KEYY4RK8YML

> <span class="highlight" style="background-color: #e56eee">有两条主线，一条是由输入线到 NVIC 中断控制器，一条是由 输入线到脉冲发生器。这就恰恰是 EXTI 的两大部分功能，产生中断与产生事件，两者从硬件 上就存在不同。</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=66UYQQ5P))
> 
> 🏷️ #📝/重点

^KEY66UYQQ5P

> <span class="highlight" style="background-color: #e56eee">输入线</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=L6WVCU4S))
> 
> 🏷️ #📝/重点

^KEYL6WVCU4S

> <span class="highlight" style="background-color: #e56eee">设置为任何一个 GPIO 口，或者是一些外 设的事件</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=4XSVUUH5))
> 
> 🏷️ #📝/重点

^KEY4XSVUUH5

> <span class="highlight" style="background-color: #e56eee">边沿检测电路</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=PNGZV323))
> 
> 🏷️ #📝/重点

^KEYPNGZV323

> <span class="highlight" style="background-color: #e56eee">边沿检测电路，上升沿触发选择寄存器(EXTI_RTSR)和 下降沿触发选择寄存器(EXTI_FTSR)</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=Z45HFPSW))
> 
> 🏷️ #📝/重点

^KEYZ45HFPSW

> <span class="highlight" style="background-color: #e56eee">或门电路</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=RVRELWBT))
> 
> 🏷️ #📝/重点

^KEYRVRELWBT

> <span class="highlight" style="background-color: #e56eee">两个信号输入端分别是软件中断事件寄存器(EXTI_SWIER) 和边沿检测电路的输入信号</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=NJ45G392))
> 
> 🏷️ #📝/重点

^KEYNJ45G392

> <span class="highlight" style="background-color: #e56eee">与门电</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=44PNGJD5))
> 
> 🏷️ #📝/重点

^KEY44PNGJD5

> <span class="highlight" style="background-color: #e56eee">两个信号输入端分别是中断屏蔽寄存器(EXTI_IMR)和标号② 电路输出信号</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=24T5I2RS))
> 
> 🏷️ #📝/重点

^KEY24T5I2RS

> <span class="highlight" style="background-color: #e56eee">假如中断屏蔽寄存器(EXTI_IMR)设置为 1 时，最终标号③电路输出的信号才由标号 ②电路输出信号决定，这样子就可以简单控制 EXTI_IMR 来实现中断的目的</span>
> 
> 重点 ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=667ES38L))
> 
> 🏷️ #📝/重点

^KEY667ES38L

> <span class="highlight" style="background-color: #e56eee">事件屏蔽寄存器(EXTI_EMR)</span> ([p220](zotero://open-pdf/library/items/JFGTX7CT?page=220&annotation=PAKK689V))
> 
> 🏷️ #📝/重点

^KEYPAKK689V

> <span class="highlight" style="background-color: #e56eee">如 果 EXTI_EMR 寄存器设置为 1，最终标号④电路输出信号就由标号③电路输出的信号决定，这 样子就可以简单的控制 EXTI_EMR 来实现是否产生事件的目的。</span>
> 
> 重点 ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=544JV5M3))
> 
> 🏷️ #📝/重点

^KEY544JV5M3

> <span class="highlight" style="background-color: #e56eee">产生中断线路目的使把输入信号输入到 NVIC，进一步运行中断服务函数，实现功能。而产 生事件线路目的是传输一个脉冲信号给其他外设使用，属于硬件级功能。</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=V6JXC9RX))
> 
> 🏷️ #📝/重点

^KEYV6JXC9RX

> <span class="highlight" style="background-color: #e56eee">EXTI 支持 19 个外部中断/事件请求，这些都是信息输入端</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=6DIAPIMN))
> 
> 🏷️ #📝/重点

^KEY6DIAPIMN

> <span class="highlight" style="background-color: #e56eee">EXTI 线 0~15：对应外部 IO 口的输入中断</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=SBE3P5HG))
> 
> 🏷️ #📝/重点

^KEYSBE3P5HG

> <span class="highlight" style="background-color: #e56eee">STM32F1 供给 IO 口使用的中断线只有 16 个</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=I8AAVGC6))
> 
> 🏷️ #📝/重点

^KEYI8AAVGC6

> <span class="highlight" style="background-color: #e56eee">把 GPIO 管脚 GPIOx.0~GPIOx.15(x=A,B,C,D,E,F,G)分别对应中 断线 0~15</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=8EBLVHBY))
> 
> 🏷️ #📝/重点

^KEY8EBLVHBY

> <span class="highlight" style="background-color: #e56eee">每个中断线对应了最多 9 个 IO 口</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=3FW6UREC))
> 
> 🏷️ #📝/重点

^KEY3FW6UREC

> <span class="highlight" style="background-color: #e56eee">中断线每次只能连接到 1 个 IO 口上</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=A49FHMUC))
> 
> 🏷️ #📝/重点

^KEYA49FHMUC

> <span class="highlight" style="background-color: #e56eee">GPIO 和中断线映射关系是在寄存器 AFIO_EXTICR1 ~ AFIO_EXTICR4 中配置的</span>
> 
> 该寄存器决定着该中断线连接着哪个端口的 IO 口 ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=MG33XXWX))
> 
> 🏷️ #📝/重点

^KEYMG33XXWX

> <span class="highlight" style="background-color: #e56eee">AFIO_EXTICR1 寄存器配置 EXTI0 到 EXTI3 线</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=FMEGZLUW))
> 
> 🏷️ #📝/重点

^KEYFMEGZLUW

> <span class="highlight" style="background-color: #e56eee">AFIO_EXTICR2 寄存器配置 EXTI4 到 EXTI7 线</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=VA8S7YQV))
> 
> 🏷️ #📝/重点

^KEYVA8S7YQV

> <span class="highlight" style="background-color: #f19837">16.2 硬件设计</span> ([p221](zotero://open-pdf/library/items/JFGTX7CT?page=221&annotation=IEKQQN6E))
> 
> 🏷️ #📝/标题

^KEYIEKQQN6E

> <span class="highlight" style="background-color: #f19837">16.3 程序设计</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=V9VMD5LV))
> 
> 🏷️ #📝/标题

^KEYV9VMD5LV

> <span class="highlight" style="background-color: #f19837">16.3.1 EXTI 的 HAL 库驱动</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=Y5KD52WK))
> 
> 🏷️ #📝/标题

^KEYY5KD52WK

> <span class="highlight" style="background-color: #e56eee">HAL 库的 EXTI 外部中断的设置功能整合 到 HAL_GPIO_Init 函数里面，而不是单独独立一个文件。</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=HS2FC67R))
> 
> 🏷️ #📝/重点

^KEYHS2FC67R

> <span class="highlight" style="background-color: #e56eee">KEY0、KEY1 和 KEY2 是低电平有效的，程序设计为按键按下触发中断，所以我们要选择 下降沿触发检测，而 KEY_UP 是高电平有效的，那么就应该选择上升沿触发检测。</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=28FGLQHG))
> 
> 🏷️ #📝/重点

^KEY28FGLQHG

> <span class="highlight" style="background-color: #e56eee">EXTI 外部中断配置步骤</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=8MWPWDH2))
> 
> 🏷️ #📝/重点

^KEY8MWPWDH2

> <span class="highlight" style="background-color: #e56eee">使能对应 GPIO 口时钟</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=479U2QC8))
> 
> 🏷️ #📝/重点

^KEY479U2QC8

> <span class="highlight" style="background-color: #e56eee">设置 GPIO 工作模式，触发条件，开启 AFIO 时钟，设置 IO 口与中断线的映射关系</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=348CKATS))
> 
> 🏷️ #📝/重点

^KEY348CKATS

> <span class="highlight" style="background-color: #e56eee">这些步骤 HAL 库全部封装在 HAL_GPIO_Init 函数里面，我们只需要设置好对应的参数， 再调用 HAL_GPIO_Init 函数即可完成配置。</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=NLFNIBYV))
> 
> 🏷️ #📝/重点

^KEYNLFNIBYV

> <span class="highlight" style="background-color: #e56eee">配置中断优先级（NVIC），并使能中断。</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=FNQLC8N4))
> 
> 🏷️ #📝/重点

^KEYFNQLC8N4

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_SetPriority</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=HW6IX3MK))
> 
> 🏷️ #📝/重点

^KEYHW6IX3MK

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_EnableIRQ</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=NHDG4VJW))
> 
> 🏷️ #📝/重点

^KEYNHDG4VJW

> <span class="highlight" style="background-color: #e56eee">编写中断服务函数。</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=9YS9VP9G))
> 
> 🏷️ #📝/重点

^KEY9YS9VP9G

> <span class="highlight" style="background-color: #e56eee">STM32F1 的 IO 口外部中断函数只有 7 个</span> ([p222](zotero://open-pdf/library/items/JFGTX7CT?page=222&annotation=WHUYHCBZ))
> 
> 🏷️ #📝/重点

^KEYWHUYHCBZ

> <span class="highlight" style="background-color: #e56eee">中断线 0-4，每个中断线对应一个中断函数，中断线 5-9 共用中断函数 EXTI9_5_IRQHandler， 中断线 10-15 共用中断函数 EXTI15_10_IRQHandler</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=6Q3CPF29))
> 
> 🏷️ #📝/重点

^KEY6Q3CPF29

> <span class="highlight" style="background-color: #e56eee">HAL 库把中断处理过程进行了简单封装</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=MQBLSFIS))
> 
> 🏷️ #📝/重点

^KEYMQBLSFIS

> <span class="highlight" style="background-color: #e56eee">编写中断处理回调函数 HAL_GPIO_EXTI_Callback</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=TI35IB9K))
> 
> 🏷️ #📝/重点

^KEYTI35IB9K

> <span class="highlight" style="background-color: #e56eee">提供了一个中断通用入口函数 HAL_GPIO_EXTI_IRQHandler</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=NRKEXXAY))
> 
> 🏷️ #📝/重点

^KEYNRKEXXAY

> <span class="highlight" style="background-color: #e56eee">该函数内部直接调用回调函数 HAL_GPIO_EXTI_Callback</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=4NZ3AAPI))
> 
> 🏷️ #📝/重点

^KEY4NZ3AAPI

> <span class="highlight" style="background-color: #e56eee">通过入口参数 GPIO_Pin 判断中断来自哪个 IO 口，然后清除 相应的中断标志位，最后调用回调函数 HAL_GPIO_EXTI_Callback()实现控制逻辑</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=GA4RKQE3))
> 
> 🏷️ #📝/重点

^KEYGA4RKQE3

> <span class="highlight" style="background-color: #f19837">16.3.2 程序流程图</span> ([p223](zotero://open-pdf/library/items/JFGTX7CT?page=223&annotation=ZGXU59VA))
> 
> 🏷️ #📝/标题

^KEYZGXU59VA

> <span class="highlight" style="background-color: #f19837">16.3.3 程序解析</span> ([p224](zotero://open-pdf/library/items/JFGTX7CT?page=224&annotation=IL37ZNXZ))
> 
> 🏷️ #📝/标题

^KEYIL37ZNXZ

> <span class="highlight" style="background-color: #e56eee">外部中断引脚定义</span> ([p224](zotero://open-pdf/library/items/JFGTX7CT?page=224&annotation=Z3JVH5VS))
> 
> 🏷️ #📝/重点

^KEYZ3JVH5VS

> <span class="highlight" style="background-color: #e56eee">IRQn</span>
> 
> "Interupt ReQuest Number" 的缩写，即中断请求编号 ([p224](zotero://open-pdf/library/items/JFGTX7CT?page=224&annotation=UY24NH6N))
> 
> 🏷️ #📝/重点

^KEYUY24NH6N

> <span class="highlight" style="background-color: #e56eee">EXTI4_IRQHandler</span>
> 
> 中断请求处理函数，__weak类型，定义在启动文件 ([p224](zotero://open-pdf/library/items/JFGTX7CT?page=224&annotation=WR455RGE))
> 
> 🏷️ #📝/重点

^KEYWR455RGE

> <span class="highlight" style="background-color: #e56eee">需要注意的是 EXTI0 到 EXTI4 都是有单独 的 中 断 向 量 ， EXTI5 到 EXTI9 是 公 用 EXTI9_5_IRQn ， EXTI10 到 EXTI15 是 公 用 EXTI15_10_IRQn。</span> ([p224](zotero://open-pdf/library/items/JFGTX7CT?page=224&annotation=2EWCZPLI))
> 
> 🏷️ #📝/重点

^KEY2EWCZPLI

> <span class="highlight" style="background-color: #e56eee">GPIO_MODE_IT_FALLING</span> ([p224](zotero://open-pdf/library/items/JFGTX7CT?page=224&annotation=64QIWEPQ))
> 
> 🏷️ #📝/重点

^KEY64QIWEPQ

> <span class="highlight" style="background-color: #e56eee">GPIO_MODE_IT_RISING</span> ([p225](zotero://open-pdf/library/items/JFGTX7CT?page=225&annotation=7UJH82ZT))
> 
> 🏷️ #📝/重点

^KEY7UJH82ZT

> <span class="highlight" style="background-color: #e56eee">外部中断初始化函数主要做了两件事情，先是调用 IO 口初始化函数 HAL_GPIO_Init 来初 始化 IO 口，然后设置中断优先级并使能中断线。</span>
> 
> “key_inti()”、“led_init()” 和 “exti_init()” 有重复的地方，即都是对 GPIO 进行初始化，但不能省略这些初始化，因为这些初始化中 IO 口选择的模式不一样。 ([p225](zotero://open-pdf/library/items/JFGTX7CT?page=225&annotation=C5JDDDKG))
> 
> 🏷️ #📝/重点

^KEYC5JDDDKG

> <span class="highlight" style="background-color: #e56eee">HAL 库默认先清中断再处理回调，退出时再清一次中断，避免按键抖动误触发 */</span> ([p225](zotero://open-pdf/library/items/JFGTX7CT?page=225&annotation=DM33QDP7))
> 
> 🏷️ #📝/重点

^KEYDM33QDP7

> <span class="highlight" style="background-color: #e56eee">所有的外部中断服务函数里都只调用了同样一个函数 HAL_GPIO_EXTI_IRQHandler，该函 数是外部中断共用入口函数，函数内部会进行中断标志位清零，并且调用中断处理共用回调函 数 HAL_GPIO_EXTI_Callback。但是它们的形参不同，我们的回调函数也是根据形参去判断是 哪个 IO 口的外部中断线被触发。</span>
> 
> 在中断初始化过程中已经将 EXTI 中断线和具体端口的 IO 口对应，所以在中断处理函数所需参数中，不需要给出端口，只需要给出引脚号。
> 
> 对于由GPIO口引发的中断，都采用 HAL_GPIO_EXTI_IRQHandler 外部中断公用处理函数，并都调用中断处理共用回调函数 HAL_GPIO_EXTI_Callback 。那么如何判断是哪个中断口引发的中断呢？这两个函数都是通过传入的引脚号来判断。 ([p226](zotero://open-pdf/library/items/JFGTX7CT?page=226&annotation=P3SWA59X))
> 
> 🏷️ #📝/重点

^KEYP3SWA59X

> <span class="highlight" style="background-color: #e56eee">在前面中断函数的处理过程中都调用了 HAL_GPIO_EXTI_IRQHandler()这个接口</span> ([p226](zotero://open-pdf/library/items/JFGTX7CT?page=226&annotation=R4C38QAT))
> 
> 🏷️ #📝/重点

^KEYR4C38QAT

> <span class="highlight" style="background-color: #e56eee">主要帮我们进行了寄存器操作，清除了中断事件，清除完中断源后，调用中断回调函数 HAL_GPIO_EXTI_Callback，这个接口是一个__weak 的接口，我们通过重新实现这个函数来实 现真正的外部中断控制逻辑。在该函数内部，通过判断 IO 引脚号来确定中断是来自哪个 IO 口， 也就是哪个中断线，然后编写相应的控制逻辑。所以在该函数内部，我们通过 switch 语句判断 IO 口来源</span> ([p227](zotero://open-pdf/library/items/JFGTX7CT?page=227&annotation=U9KPPU5X))
> 
> 🏷️ #📝/重点

^KEYU9KPPU5X

> <span class="highlight" style="background-color: #f19837">第十七章 串口通信实验</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=YHYWG9M7))
> 
> 🏷️ #📝/标题

^KEYYHYWG9M7

> <span class="highlight" style="background-color: #f19837">17.1 串口简介</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=YB6ZRXS5))
> 
> 🏷️ #📝/标题

^KEYYB6ZRXS5

> <span class="highlight" style="background-color: #f19837">17.1.1 数据通信的基础概念</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=ZP5QLWNE))
> 
> 🏷️ #📝/标题

^KEYZP5QLWNE

> <span class="highlight" style="background-color: #e56eee">数据通信方式</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=NC9FT8V3))
> 
> 🏷️ #📝/重点

^KEYNC9FT8V3

> <span class="highlight" style="background-color: #e56eee">串行通信和并行通信两</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=AP7QTI6G))
> 
> 🏷️ #📝/重点

^KEYAP7QTI6G

> <span class="highlight" style="background-color: #e56eee">串行通信的基本特征是数据逐位顺序依次传输</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=UW35QZ34))
> 
> 🏷️ #📝/重点

^KEYUW35QZ34

> <span class="highlight" style="background-color: #e56eee">并行通信是数据各位可以通过多条线同时传输</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=GXNHFZ38))
> 
> 🏷️ #📝/重点

^KEYGXNHFZ38

> <span class="highlight" style="background-color: #e56eee">数据传输方向</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=66QLL4P7))
> 
> 🏷️ #📝/重点

^KEY66QLL4P7

> <span class="highlight" style="background-color: #e56eee">通信又可分为全双工、半双工和单工通信</span> ([p228](zotero://open-pdf/library/items/JFGTX7CT?page=228&annotation=YF2KAWPC))
> 
> 🏷️ #📝/重点

^KEYYF2KAWPC

> <span class="highlight" style="background-color: #e56eee">数据传输仅能沿一个方向，不能实现反方向传输</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=AHVUJJTJ))
> 
> 🏷️ #📝/重点

^KEYAHVUJJTJ

> <span class="highlight" style="background-color: #e56eee">数据传输可以沿着两个方向，但是需要分时进行</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=FLWQVV4C))
> 
> 🏷️ #📝/重点

^KEYFLWQVV4C

> <span class="highlight" style="background-color: #e56eee">数据可以同时进行双向传输</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=PDFU6X25))
> 
> 🏷️ #📝/重点

^KEYPDFU6X25

> <span class="highlight" style="background-color: #e56eee">数据同步方式</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=MIP6RQX4))
> 
> 🏷️ #📝/重点

^KEYMIP6RQX4

> <span class="highlight" style="background-color: #e56eee">同步通信和异步通信</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=4XQJ99A9))
> 
> 🏷️ #📝/重点

^KEY4XQJ99A9

> <span class="highlight" style="background-color: #e56eee">同步通信要求通信双方共用同一时钟信号</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=V7RADEYE))
> 
> 🏷️ #📝/重点

^KEYV7RADEYE

> <span class="highlight" style="background-color: #e56eee">异步通信不需要时钟信号，而是在数据信号中加入开始位和停止位等一些同步信号</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=QH8CGSGE))
> 
> 🏷️ #📝/重点

^KEYQH8CGSGE

> <span class="highlight" style="background-color: #e56eee">某些通信中还需要双方约定传输速率</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=5EXYSYUB))
> 
> 🏷️ #📝/重点

^KEY5EXYSYUB

> <span class="highlight" style="background-color: #e56eee">通信速率</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=8ABE3TEJ))
> 
> 🏷️ #📝/重点

^KEY8ABE3TEJ

> <span class="highlight" style="background-color: #e56eee">通信速率（传输速率）指数据在信道中传输的速度</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=V7J7UYM5))
> 
> 🏷️ #📝/重点

^KEYV7J7UYM5

> <span class="highlight" style="background-color: #e56eee">传 信率和传码率</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=NT6T9A94))
> 
> 🏷️ #📝/重点

^KEYNT6T9A94

> <span class="highlight" style="background-color: #e56eee">传信率</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=KADGJYYG))
> 
> 🏷️ #📝/重点

^KEYKADGJYYG

> <span class="highlight" style="background-color: #e56eee">即每秒钟传输的二进制位数，单位为 bit/s（即比特每秒</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=7QIK97NE))
> 
> 🏷️ #📝/重点

^KEY7QIK97NE

> <span class="highlight" style="background-color: #e56eee">传码率</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=PFW92LUZ))
> 
> 🏷️ #📝/重点

^KEYPFW92LUZ

> <span class="highlight" style="background-color: #e56eee">每秒钟传输的码元个数</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=XUU5S4EC))
> 
> 🏷️ #📝/重点

^KEYXUU5S4EC

> <span class="highlight" style="background-color: #e56eee">单位为 Baud（即波特每秒），因而又称为波特率</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=ATBE3DV3))
> 
> 🏷️ #📝/重点

^KEYATBE3DV3

> <span class="highlight" style="background-color: #e56eee">波 特率被传输的是码元，码元是信号被调制后的概念，每个码元都可以表示一定 bit 的数据信息 量</span>
> 
> 可以是多位组成一个码元 ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=9WZDSKJQ))
> 
> 🏷️ #📝/重点

^KEY9WZDSKJQ

> <span class="highlight" style="background-color: #e56eee">比特率 = 波特率 * log2M</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=WVSZ7NHQ))
> 
> 🏷️ #📝/重点

^KEYWVSZ7NHQ

> <span class="highlight" style="background-color: #e56eee">M 表示码元承载的信息量</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=6K2BXTWM))
> 
> 🏷️ #📝/重点

^KEY6K2BXTWM

> <span class="highlight" style="background-color: #e56eee">也可以理解 M 为码元的进制数</span> ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=NFYBEXA5))
> 
> 🏷️ #📝/重点

^KEYNFYBEXA5

> <span class="highlight" style="background-color: #e56eee">M=2</span>
> 
> 这个是 M=16 ([p229](zotero://open-pdf/library/items/JFGTX7CT?page=229&annotation=ZDJT9DBT))
> 
> 🏷️ #📝/重点

^KEYZDJT9DBT

> <span class="highlight" style="background-color: #f19837">17.1.2 串口通信协议简介</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=UJJG9UFD))
> 
> 🏷️ #📝/标题

^KEYUJJG9UFD

> <span class="highlight" style="background-color: #e56eee">串口通信</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=6ZX5XXWF))
> 
> 🏷️ #📝/重点

^KEY6ZX5XXWF

> <span class="highlight" style="background-color: #e56eee">串行通信方式</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=IZZCA68B))
> 
> 🏷️ #📝/重点

^KEYIZZCA68B

> <span class="highlight" style="background-color: #e56eee">串口按位（bit）发送和接收字节</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=LL77L575))
> 
> 🏷️ #📝/重点

^KEYLL77L575

> <span class="highlight" style="background-color: #e56eee">串口通信协议</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=MH2S9NZD))
> 
> 🏷️ #📝/重点

^KEYMH2S9NZD

> <span class="highlight" style="background-color: #e56eee">规定了数据包的内容，内容包含了起始位、主体数据、校验位及停止位，双 方需要约定一致的数据包格式才能正常收发数据的有关规范</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=SYTQP3LV))
> 
> 🏷️ #📝/重点

^KEYSYTQP3LV

> <span class="highlight" style="background-color: #e56eee">USB 转串口取代了 RS-232 串口</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=SZ2XP2PN))
> 
> 🏷️ #📝/重点

^KEYSZ2XP2PN

> <span class="highlight" style="background-color: #e56eee">在电路中添加一个 USB 转串口芯片</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=J7RVIG5V))
> 
> 🏷️ #📝/重点

^KEYJ7RVIG5V

> <span class="highlight" style="background-color: #e56eee">实现 USB 通信协议和标准 UART 串行通信协议的转换</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=BP4B9K98))
> 
> 🏷️ #📝/重点

^KEYBP4B9K98

> <span class="highlight" style="background-color: #e56eee">CH340C 这个芯片</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=N2KBLJTJ))
> 
> 🏷️ #📝/重点

^KEYN2KBLJTJ

> <span class="highlight" style="background-color: #e56eee">串口通信的协议层</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=EHU4IDIC))
> 
> 🏷️ #📝/重点

^KEYEHU4IDIC

> <span class="highlight" style="background-color: #e56eee">串口通信的数据包由发送设备的 TXD 接口传输到接收设备的 RXD 接口</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=FEVPK9FQ))
> 
> 🏷️ #📝/重点

^KEYFEVPK9FQ

> <span class="highlight" style="background-color: #e56eee">串口通信协议数据包组成可以分为波特率和数据帧格式两部分</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=UVXCERTC))
> 
> 🏷️ #📝/重点

^KEYUVXCERTC

> <span class="highlight" style="background-color: #e56eee">波特率</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=XGGDMN8B))
> 
> 🏷️ #📝/重点

^KEYXGGDMN8B

> <span class="highlight" style="background-color: #e56eee">串口异步通信</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=XE3EDI2L))
> 
> 🏷️ #📝/重点

^KEYXE3EDI2L

> <span class="highlight" style="background-color: #e56eee">不需要时钟信号</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=FJB9M57F))
> 
> 🏷️ #📝/重点

^KEYFJB9M57F

> <span class="highlight" style="background-color: #e56eee">波特率</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=MZ535DKH))
> 
> 🏷️ #📝/重点

^KEYMZ535DKH

> <span class="highlight" style="background-color: #e56eee">决定了数据帧里面每 一个位的时间长度</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=DH2G28HM))
> 
> 🏷️ #📝/重点

^KEYDH2G28HM

> <span class="highlight" style="background-color: #e56eee">两个要通信的设备的波特率一定要设置相同</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=RY46LU6L))
> 
> 🏷️ #📝/重点

^KEYRY46LU6L

> <span class="highlight" style="background-color: #e56eee">数据帧格式</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=LN3LB4MA))
> 
> 🏷️ #📝/重点

^KEYLN3LB4MA

> <span class="highlight" style="background-color: #e56eee">串口通信的数据帧包括起始位、停止位、有效数据位以 及校验位。</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=2JZDZ8DA))
> 
> 🏷️ #📝/重点

^KEY2JZDZ8DA

> <span class="highlight" style="background-color: #e56eee">起始位和停止位</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=YDMNPS8R))
> 
> 🏷️ #📝/重点

^KEYYDMNPS8R

> <span class="highlight" style="background-color: #e56eee">一个数据帧是从起始位开始，直到停止位</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=QGWWGJI8))
> 
> 🏷️ #📝/重点

^KEYQGWWGJI8

> <span class="highlight" style="background-color: #e56eee">数据帧中的起始位是由一个逻辑 0 的数据位表示，而数据帧的停止位可以是 0.5、1、1.5 或 2 个逻辑 1 的数据位表示，只要双方 约定一致即可。</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=FGXAC9NM))
> 
> 🏷️ #📝/重点

^KEYFGXAC9NM

> <span class="highlight" style="background-color: #e56eee">有效数据位</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=XS46M78B))
> 
> 🏷️ #📝/重点

^KEYXS46M78B

> <span class="highlight" style="background-color: #e56eee">起始位之后，就接着是数据位，也称有效数据位</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=K2TZT8PY))
> 
> 🏷️ #📝/重点

^KEYK2TZT8PY

> <span class="highlight" style="background-color: #e56eee">真正需要的数据</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=AGHJVM8U))
> 
> 🏷️ #📝/重点

^KEYAGHJVM8U

> <span class="highlight" style="background-color: #e56eee">有效数据位是低位（LSB）在前，高位（MSB） 在后</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=KT2QFGLX))
> 
> 🏷️ #📝/重点

^KEYKT2QFGLX

> <span class="highlight" style="background-color: #e56eee">校验位</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=3F9NLA8Y))
> 
> 🏷️ #📝/重点

^KEY3F9NLA8Y

> <span class="highlight" style="background-color: #e56eee">校验位一般用来判断接收的数据位有无错误</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=JKPMJZAV))
> 
> 🏷️ #📝/重点

^KEYJKPMJZAV

> <span class="highlight" style="background-color: #e56eee">奇校验</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=NA94KC68))
> 
> 🏷️ #📝/重点

^KEYNA94KC68

> <span class="highlight" style="background-color: #e56eee">有效数据为和校验位中“1”的个数为奇数</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=DQLX9UHD))
> 
> 🏷️ #📝/重点

^KEYDQLX9UHD

> <span class="highlight" style="background-color: #e56eee">偶校验</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=2X6NZF2L))
> 
> 🏷️ #📝/重点

^KEY2X6NZF2L

> <span class="highlight" style="background-color: #e56eee">要求帧数据和校验位中“1”的个数为偶数</span> ([p230](zotero://open-pdf/library/items/JFGTX7CT?page=230&annotation=F5IPK634))
> 
> 🏷️ #📝/重点

^KEYF5IPK634

> <span class="highlight" style="background-color: #e56eee">0 校验</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=443KLZ5J))
> 
> 🏷️ #📝/重点

^KEY443KLZ5J

> <span class="highlight" style="background-color: #e56eee">不管有效数据中的内容是什么，校验位总为“0”，1 校验是校验位总为“1”</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=7YMKEF8I))
> 
> 🏷️ #📝/重点

^KEY7YMKEF8I

> <span class="highlight" style="background-color: #f19837">17.1.3 STM32F1 的串口简介</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=77IUAWMD))
> 
> 🏷️ #📝/标题

^KEY77IUAWMD

> <span class="highlight" style="background-color: #e56eee">STM32F103ZET6 最多可提供 5 路串 口</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=877DLY5E))
> 
> 🏷️ #📝/重点

^KEY877DLY5E

> <span class="highlight" style="background-color: #e56eee">STM32F1 的串口分为两种</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=EF4QYDDG))
> 
> 🏷️ #📝/重点

^KEYEF4QYDDG

> <span class="highlight" style="background-color: #e56eee">USART（即通用同步异步收发器）和 UART（即通用异步收发 器）</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=CBN5IEZK))
> 
> 🏷️ #📝/重点

^KEYCBN5IEZK

> <span class="highlight" style="background-color: #e56eee">裁剪掉了同步通信功能，只剩下异步通信功能</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=R2ZNAT8C))
> 
> 🏷️ #📝/重点

^KEYR2ZNAT8C

> <span class="highlight" style="background-color: #e56eee">需不需要对外提供时钟输出</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=KUSYGLQ3))
> 
> 🏷️ #📝/重点

^KEYKUSYGLQ3

> <span class="highlight" style="background-color: #e56eee">STM32F1 有 3 个 USART 和 2 个 UART</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=XPTZDIAZ))
> 
> 🏷️ #📝/重点

^KEYXPTZDIAZ

> <span class="highlight" style="background-color: #e56eee">USART1 的时钟源来于 APB2 时钟，其最大 频率为 72MHz</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=SXNJ6H8Y))
> 
> 🏷️ #📝/重点

^KEYSXNJ6H8Y

> <span class="highlight" style="background-color: #e56eee">其他 4 个串口的时钟源可以来于 APB1 时钟，其最大频率为 36MHz</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=I3X87U2U))
> 
> 🏷️ #📝/重点

^KEYI3X87U2U

> <span class="highlight" style="background-color: #e56eee">串口输出的是 TTL 电平信号</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=DPTEBH2M))
> 
> 🏷️ #📝/重点

^KEYDPTEBH2M

> <span class="highlight" style="background-color: #e56eee">如果需要 RS-232 标准的信号可使用 MAX3232 芯 片进行转换</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=IQSNVJZW))
> 
> 🏷️ #📝/重点

^KEYIQSNVJZW

> <span class="highlight" style="background-color: #e56eee">通过 USB 转串口芯片 CH340C</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=M3N26BZY))
> 
> 🏷️ #📝/重点

^KEYM3N26BZY

> <span class="highlight" style="background-color: #f19837">17.1.3.1 USART 框图</span> ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=DM62TIWM))
> 
> 🏷️ #📝/标题

^KEYDM62TIWM

> <span class="image#e56eee">null</span>USART框图 ([p231](zotero://open-pdf/library/items/JFGTX7CT?page=231&annotation=32B45UPR))

^KEY32B45UPR

> <span class="highlight" style="background-color: #e56eee">USART 信号引脚</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=PM993ZTR))
> 
> 🏷️ #📝/重点

^KEYPM993ZTR

> <span class="highlight" style="background-color: #e56eee">TX：发送数据输出引脚</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=C9XNFQPT))
> 
> 🏷️ #📝/重点

^KEYC9XNFQPT

> <span class="highlight" style="background-color: #e56eee">RX：接收数据输入引脚</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=WQRRGB47))
> 
> 🏷️ #📝/重点

^KEYWQRRGB47

> <span class="highlight" style="background-color: #e56eee">SCLK：发送器时钟输出，适用于同步传输</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=SGM9QUGG))
> 
> 🏷️ #📝/重点

^KEYSGM9QUGG

> <span class="highlight" style="background-color: #e56eee">SW_RX：数据接收引脚，属于内部引脚</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=YM2JDTSY))
> 
> 🏷️ #📝/重点

^KEYYM2JDTSY

> <span class="highlight" style="background-color: #e56eee">nRTS：发送请求，若是低电平，表示 USART 准备好接收数据</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=9L8HRJUU))
> 
> 🏷️ #📝/重点

^KEY9L8HRJUU

> <span class="highlight" style="background-color: #e56eee">nCTS：清除发送，若是高电平，在当前数据传输结束时阻断下一次的数据发送</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=QU3MMP75))
> 
> 🏷️ #📝/重点

^KEYQU3MMP75

> <span class="highlight" style="background-color: #e56eee">数据寄存器</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=CPL43YRP))
> 
> 🏷️ #📝/重点

^KEYCPL43YRP

> <span class="highlight" style="background-color: #e56eee">USART_DR 包含了已发送或接收到的数据</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=479T56HQ))
> 
> 🏷️ #📝/重点

^KEY479T56HQ

> <span class="highlight" style="background-color: #e56eee">两个寄存器组成</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=NLHDTIGH))
> 
> 🏷️ #📝/重点

^KEYNLHDTIGH

> <span class="highlight" style="background-color: #e56eee">一个专门 给发送用的（TDR），一个专门给接收用的（RDR）</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=JFFEE7LU))
> 
> 🏷️ #📝/重点

^KEYJFFEE7LU

> <span class="highlight" style="background-color: #e56eee">具备读和写的功能</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=TM5QJN49))
> 
> 🏷️ #📝/重点

^KEYTM5QJN49

> <span class="highlight" style="background-color: #e56eee">TDR 寄存器 提供了内部总线和输出移位寄存器之间的并行接口</span>
> 
> 这里的“输出移位寄存器”是图中的“发送移位寄存器” ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=MI5CHTUP))
> 
> 🏷️ #📝/重点

^KEYMI5CHTUP

> <span class="highlight" style="background-color: #e56eee">RDR 寄存器提供了输入移位寄存器和内部 总线之间的并行接口</span>
> 
> 这里的“输入移位寄存器”是图中的“接收移位寄存器” ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=P6BJN5KI))
> 
> 🏷️ #📝/重点

^KEYP6BJN5KI

> <span class="highlight" style="background-color: #e56eee">当进行数据发送操作时，往 USART_DR 中写入数据会自动存储在 TDR 内；当进行读取操作时，向 USART_DR 读取数据会自动提去 RDR 数据。</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=INW6NPVI))
> 
> 🏷️ #📝/重点

^KEYINW6NPVI

> <span class="highlight" style="background-color: #e56eee">低 9 位数据有效</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=J35CHSEI))
> 
> 🏷️ #📝/重点

^KEYJ35CHSEI

> <span class="highlight" style="background-color: #e56eee">USART_DR 的第 9 位数据是否有效跟 USART_CR1 的 M 位设置有关</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=WN5AGGHZ))
> 
> 🏷️ #📝/重点

^KEYWN5AGGHZ

> <span class="highlight" style="background-color: #e56eee">控制器</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=6KNWHG7F))
> 
> 🏷️ #📝/重点

^KEY6KNWHG7F

> <span class="highlight" style="background-color: #e56eee">控制发送的发送器</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=75X4ZG9T))
> 
> 🏷️ #📝/重点

^KEY75X4ZG9T

> <span class="highlight" style="background-color: #e56eee">控制接收的接收器</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=WC9LN5ED))
> 
> 🏷️ #📝/重点

^KEYWC9LN5ED

> <span class="highlight" style="background-color: #e56eee">还有唤醒单元、中断控制等等</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=GSTUAN2K))
> 
> 🏷️ #📝/重点

^KEYGSTUAN2K

> <span class="highlight" style="background-color: #e56eee">时钟与波特率</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=MGKACKCR))
> 
> 🏷️ #📝/重点

^KEYMGKACKCR

> <span class="highlight" style="background-color: #e56eee">为 USART 提供时钟以及配置波特率</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=PWMN42KR))
> 
> 🏷️ #📝/重点

^KEYPWMN42KR

> <span class="highlight" style="background-color: #e56eee">在二进制系统中（串口的数据帧就是二进制的形式）， 波特率与波特率的数值相等</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=5FGELFBL))
> 
> 🏷️ #📝/重点

^KEY5FGELFBL

> <span class="highlight" style="background-color: #e56eee">波特率通过以下公式得出</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=2PQBDNT8))
> 
> 🏷️ #📝/重点

^KEY2PQBDNT8

> <span class="highlight" style="background-color: #e56eee">fck 是给串口的时钟</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=UJSXEM3Z))
> 
> 🏷️ #📝/重点

^KEYUJSXEM3Z

> <span class="highlight" style="background-color: #e56eee">USARTDIV 是一个无符号的定点数，存放在波特率寄存器（USART_BRR）的低 16 位</span>
> 
> baud 和 fck 已知，计算出 USATDIV ，然后设置 USART_BRR 的低16位 ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=4UQ9CS8G))
> 
> 🏷️ #📝/重点

^KEY4UQ9CS8G

> <span class="highlight" style="background-color: #e56eee">DIV_Mantissa[11:0]存放的是 USARTDIV 的整数部分，DIV_Fractionp[3:0]存放的是 USARTDIV 的小数部 分。</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=E8VJQQRD))
> 
> 🏷️ #📝/重点

^KEYE8VJQQRD

> <span class="highlight" style="background-color: #e56eee">小数部分为 0.0625，转化为十六进制即 0.0625*16 = 1，所以 DIV_Fractionp = 0x1</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=HTTSYUIJ))
> 
> 🏷️ #📝/重点

^KEYHTTSYUIJ

> <span class="highlight" style="background-color: #e56eee">USARTDIV 是允许有余数的，我们用四舍五入进行取整</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=42T44BAY))
> 
> 🏷️ #📝/重点

^KEY42T44BAY

> <span class="highlight" style="background-color: #e56eee">导致波特率会有 所偏差</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=EZZPZT89))
> 
> 🏷️ #📝/重点

^KEYEZZPZT89

> <span class="highlight" style="background-color: #f19837">17.1.3.2 USART 寄存器</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=PIP4C7KU))
> 
> 🏷️ #📝/标题

^KEYPIP4C7KU

> <span class="highlight" style="background-color: #e56eee">USART 的配置步骤</span> ([p232](zotero://open-pdf/library/items/JFGTX7CT?page=232&annotation=L7M5Q7LI))
> 
> 🏷️ #📝/重点

^KEYL7M5Q7LI

> <span class="highlight" style="background-color: #e56eee">只要你开启了串口时钟，并 设置相应 IO 口的模式，然后配置一下波特率，数据位长度，奇偶校验位等信息</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=WUGV7LMI))
> 
> 🏷️ #📝/重点

^KEYWUGV7LMI

> <span class="highlight" style="background-color: #e56eee">串口时钟使能</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=YNK4ZMHJ))
> 
> 🏷️ #📝/重点

^KEYYNK4ZMHJ

> <span class="highlight" style="background-color: #e56eee">其时钟由外设时钟使能寄存器控制</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=EYNYAJPX))
> 
> 🏷️ #📝/重点

^KEYEYNYAJPX

> <span class="highlight" style="background-color: #e56eee">串口 1 是在 APB2ENR 寄存器的第 14 位</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=4V6Y8DZ7))
> 
> 🏷️ #📝/重点

^KEY4V6Y8DZ7

> <span class="highlight" style="background-color: #e56eee">其他串口的时钟使能位都在 APB1ENR 寄存器</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=VJTAXABS))
> 
> 🏷️ #📝/重点

^KEYVJTAXABS

> <span class="highlight" style="background-color: #e56eee">串口复位</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=TGXJVPJW))
> 
> 🏷️ #📝/重点

^KEYTGXJVPJW

> <span class="highlight" style="background-color: #e56eee">一般系统刚开始配置外设的时候，都会先执行复位该外设的操作</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=EVPHYYIJ))
> 
> 🏷️ #📝/重点

^KEYEVPHYYIJ

> <span class="highlight" style="background-color: #e56eee">使外设的对应寄存 器恢复到默认值</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=269TIBTP))
> 
> 🏷️ #📝/重点

^KEY269TIBTP

> <span class="highlight" style="background-color: #e56eee">串口 1 的复位就是通过配置 APB2RSTR 寄存器的第 14 位</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=VJ7PQNIS))
> 
> 🏷️ #📝/重点

^KEYVJ7PQNIS

> <span class="highlight" style="background-color: #e56eee">串口波特率设置</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=9AGK3L4M))
> 
> 🏷️ #📝/重点

^KEY9AGK3L4M

> <span class="highlight" style="background-color: #e56eee">波特率寄存器 USART_BRR</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=ZXEJ9ZLE))
> 
> 🏷️ #📝/重点

^KEYZXEJ9ZLE

> <span class="highlight" style="background-color: #e56eee">该寄存器就可以达到 配置不同波特率的目的</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=AJ2RTND8))
> 
> 🏷️ #📝/重点

^KEYAJ2RTND8

> <span class="highlight" style="background-color: #e56eee">串口控制</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=6ZYDJTW6))
> 
> 🏷️ #📝/重点

^KEY6ZYDJTW6

> <span class="highlight" style="background-color: #e56eee">每个串口都有 3 个控制寄存器 USART_CR1~3</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=M3MVCAVL))
> 
> 🏷️ #📝/重点

^KEYM3MVCAVL

> <span class="highlight" style="background-color: #e56eee">USART_CR1</span> ([p233](zotero://open-pdf/library/items/JFGTX7CT?page=233&annotation=JR6QGRV3))
> 
> 🏷️ #📝/重点

^KEYJR6QGRV3

> <span class="highlight" style="background-color: #e56eee">该寄存器的高 18 位没有用到，低 14 位用于串口的功能设置</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=JZ482VGG))
> 
> 🏷️ #📝/重点

^KEYJZ482VGG

> <span class="highlight" style="background-color: #e56eee">UE 为串口使能位， 通过该位置 1，使能串口</span>
> 
> 要和前面的“串口时钟使能”区别开来 ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=MYFB2G6T))
> 
> 🏷️ #📝/重点

^KEYMYFB2G6T

> <span class="highlight" style="background-color: #e56eee">M 为字长，当该位为 0 的时候设置串口为 8 个字长外加 n 个停止位</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=UMFH5ZFW))
> 
> 🏷️ #📝/重点

^KEYUMFH5ZFW

> <span class="highlight" style="background-color: #e56eee">PCE 为校验使能 位，设置为 0，即禁止校验</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=6JFZZFUP))
> 
> 🏷️ #📝/重点

^KEY6JFZZFUP

> <span class="highlight" style="background-color: #e56eee">PS 为校验位选择，设置为 0 为偶校验，否则奇校 验</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=E7V39NIY))
> 
> 🏷️ #📝/重点

^KEYE7V39NIY

> <span class="highlight" style="background-color: #e56eee">TXIE 为发送缓冲区空中断使能位，设置该位为 1</span>
> 
> 这里的“发送缓冲区”应该是指发送数据寄存器TDR. ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=RIFN9ZGZ))
> 
> 🏷️ #📝/重点

^KEYRIFN9ZGZ

> <span class="highlight" style="background-color: #e56eee">TXE</span>
> 
> 这是中断标志位。
> 
> 中断使能位和中断标志位要区分开来 ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=B22V5NWX))
> 
> 🏷️ #📝/重点

^KEYB22V5NWX

> <span class="highlight" style="background-color: #e56eee">TCIE 为发送完成中断使能位，设置该位为 1</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=FGH9MR4W))
> 
> 🏷️ #📝/重点

^KEYFGH9MR4W

> <span class="highlight" style="background-color: #e56eee">RXNEIE 为接收缓冲区非空中断使能，设置该位为 1</span>
> 
> 这里的"接收缓冲区"应该是指接收数据寄存器 ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=PH7B2KRW))
> 
> 🏷️ #📝/重点

^KEYPH7B2KRW

> <span class="highlight" style="background-color: #e56eee">TE 为发送使能位，设置为 1，将开启串口的 发送功能</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=PK3VY4DV))
> 
> 🏷️ #📝/重点

^KEYPK3VY4DV

> <span class="highlight" style="background-color: #e56eee">RE 为接收使能位</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=6FIWT4ZZ))
> 
> 🏷️ #📝/重点

^KEY6FIWT4ZZ

> <span class="highlight" style="background-color: #e56eee">数据发送与接收</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=HCH4UKRL))
> 
> 🏷️ #📝/重点

^KEYHCH4UKRL

> <span class="highlight" style="background-color: #e56eee">发送与接收是通过数据寄存器 USART_DR 来实现的</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=TX64V6HN))
> 
> 🏷️ #📝/重点

^KEYTX64V6HN

> <span class="highlight" style="background-color: #e56eee">双寄存器</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=EY2HXKYF))
> 
> 🏷️ #📝/重点

^KEYEY2HXKYF

> <span class="highlight" style="background-color: #e56eee">TDR 和 RDR</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=WV4K76YG))
> 
> 🏷️ #📝/重点

^KEYWV4K76YG

> <span class="highlight" style="background-color: #e56eee">当向该寄存器写数据的时候，串口就会自动发送，当收到数据的时候，也是 存在该寄存器内</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=5FJBUADE))
> 
> 🏷️ #📝/重点

^KEY5FJBUADE

> <span class="highlight" style="background-color: #e56eee">串口状态</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=CTRE6CHJ))
> 
> 🏷️ #📝/重点

^KEYCTRE6CHJ

> <span class="highlight" style="background-color: #e56eee">串口状态通过状态寄存器 USART_SR 读取</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=96IR94YA))
> 
> 🏷️ #📝/重点

^KEY96IR94YA

> <span class="highlight" style="background-color: #e56eee">RXNE（读数据寄存器非空），当该位被置 1 的时候，就是提示已经有数据被接收到了，并 且可以读出来了。</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=4LQ5J9SB))
> 
> 🏷️ #📝/重点

^KEY4LQ5J9SB

> <span class="highlight" style="background-color: #e56eee">通过读 USART_DR 可以将 该位清零，也可以向该位写 0，直接清除。</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=BWH73RWE))
> 
> 🏷️ #📝/重点

^KEYBWH73RWE

> <span class="highlight" style="background-color: #e56eee">TC（发送完成），当该位被置位的时候，表示 USART_DR 内的数据已经被发送完成了。</span> ([p234](zotero://open-pdf/library/items/JFGTX7CT?page=234&annotation=CRH373CE))
> 
> 🏷️ #📝/重点

^KEYCRH373CE

> <span class="highlight" style="background-color: #e56eee">清零方式</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=TZYQR9AI))
> 
> 🏷️ #📝/重点

^KEYTZYQR9AI

> <span class="highlight" style="background-color: #e56eee">读 USART_SR，写 USART_DR</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=ERGCYRX2))
> 
> 🏷️ #📝/重点

^KEYERGCYRX2

> <span class="highlight" style="background-color: #e56eee">直接向该位写 0</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=JMGASF33))
> 
> 🏷️ #📝/重点

^KEYJMGASF33

> <span class="highlight" style="background-color: #f19837">17.1.4 GPIO 引脚复用功能</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=NV77XSAD))
> 
> 🏷️ #📝/标题

^KEYNV77XSAD

> <span class="highlight" style="background-color: #e56eee">引脚 复用，这样使得引脚除了作为普通的 IO 口之外，还会与一些外设关联起来，作为第二功能使 用，而且一个引脚不单单只有一种复用功能，而是拥有多个第二功能，但是一次只允许一个外 设的复用功能</span>
> 
> 复用功能举例：PB6 复用为发送引脚 TX，PB7 复用为接收引脚 RX。 ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=FAIZF29L))
> 
> 🏷️ #📝/重点

^KEYFAIZF29L

> <span class="highlight" style="background-color: #e56eee">AFIO 寄存器的作用就是复用功能 I/O 和调试配置的，</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=MB43YQTH))
> 
> 🏷️ #📝/重点

^KEYMB43YQTH

> <span class="highlight" style="background-color: #e56eee">共有 6 个 AFIO</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=PGAYF3QZ))
> 
> 🏷️ #📝/重点

^KEYPGAYF3QZ

> <span class="highlight" style="background-color: #e56eee">应先打开 AFIO 时钟</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=HM74QH84))
> 
> 🏷️ #📝/重点

^KEYHM74QH84

> <span class="highlight" style="background-color: #e56eee">该时钟在 RCC_APB2ENR 寄存器 上的位 0 上配置</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=Y8QCJD27))
> 
> 🏷️ #📝/重点

^KEYY8QCJD27

> <span class="highlight" style="background-color: #e56eee">复用重映射和调试 I/O 配置寄存器 AFIO_MAPR 寄存器</span>
> 
> 明白什么是“复用重映射”？
> 
> 默认情况下，PA9 和 PA10 是作为 串口 1 的引脚使用，假如 PA9 和 PA10 被用作其他地方，但还是需要用到串口 1，那么就可以把串口 1 的引脚重映射到 PB6 和 PB7 。“复用重映射”和“IO口复用”不是一个概念 ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=YGTZR2GG))
> 
> 🏷️ #📝/重点

^KEYYGTZR2GG

> <span class="highlight" style="background-color: #e56eee">AFIO_MAPR 寄存器位 2 是对 USART1 的重映射，置 0: 没有重映 像(TX/PA9，RX/PA10)； 置 1: 重映像(TX/PB6，RX/PB7)。默认情况下，PA9 和 PA10 是作为 串口 1 的引脚使用，假如 PA9 和 PA10 被用作其他地方，但还是需要用到串口 1，那么就可以 在 AFIO_MAPR 的位 2 置 1，把串口 1 的引脚重映射到 PB6 和 PB7</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=YS8C8YU8))
> 
> 🏷️ #📝/重点

^KEYYS8C8YU8

> <span class="highlight" style="background-color: #e56eee">串口初始化的过程， 就有点变化，需要初始化 AFIO 时钟，和对 AFIO_MAPR 的第 2 位进行置 1 操作</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=GMM823IX))
> 
> 🏷️ #📝/重点

^KEYGMM823IX

> <span class="highlight" style="background-color: #e56eee">HAL 库关于端口复用相关的代码在 STM32F1xx_hal_gpio_ex.h</span> ([p235](zotero://open-pdf/library/items/JFGTX7CT?page=235&annotation=N76NZ35K))
> 
> 🏷️ #📝/重点

^KEYN76NZ35K

> <span class="highlight" style="background-color: #f19837">17.2 硬件设计</span> ([p236](zotero://open-pdf/library/items/JFGTX7CT?page=236&annotation=4TVMTRLH))
> 
> 🏷️ #📝/标题

^KEY4TVMTRLH

> <span class="highlight" style="background-color: #e56eee">上图中的 P4 的 RXD 和 PA9 用跳线帽连接，以及 TXD 和 PA10 也用 跳线帽连接。</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=6CRIFERS))
> 
> 🏷️ #📝/重点

^KEY6CRIFERS

> <span class="highlight" style="background-color: #f19837">17.3 程序设计</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=Z5HW3H28))
> 
> 🏷️ #📝/标题

^KEYZ5HW3H28

> <span class="highlight" style="background-color: #f19837">17.3.1 USART 的 HAL 库驱动</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=P8L79995))
> 
> 🏷️ #📝/标题

^KEYP8L79995

> <span class="highlight" style="background-color: #e56eee">异步收发器功</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=2QG7U9TT))
> 
> 🏷️ #📝/重点

^KEY2QG7U9TT

> <span class="highlight" style="background-color: #e56eee">STM32F1xx_hal_uart.c</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=7XF9TJ99))
> 
> 🏷️ #📝/重点

^KEY7XF9TJ99

> <span class="highlight" style="background-color: #e56eee">HAL_UART_Init 函数</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=QLM357WW))
> 
> 🏷️ #📝/重点

^KEYQLM357WW

> <span class="highlight" style="background-color: #e56eee">形参 1 是串口的句柄</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=784Z87MZ))
> 
> 🏷️ #📝/重点

^KEY784Z87MZ

> <span class="highlight" style="background-color: #e56eee">结构体类型是 UART_HandleTypeDef</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=PR73IN5Z))
> 
> 🏷️ #📝/重点

^KEYPR73IN5Z

> <span class="highlight" style="background-color: #e56eee">Instance：指向 UART 寄存器基地址</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=6DJN3NFE))
> 
> 🏷️ #📝/重点

^KEY6DJN3NFE

> <span class="highlight" style="background-color: #e56eee">Init：UART 初始化结构体</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=FNHLR8JR))
> 
> 🏷️ #📝/重点

^KEYFNHLR8JR

> <span class="highlight" style="background-color: #e56eee">pTxBuffPtr，TxXferSize，TxXferCount</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=HD9XRSL5))
> 
> 🏷️ #📝/重点

^KEYHD9XRSL5

> <span class="highlight" style="background-color: #e56eee">指向发送数据缓冲区的指针</span>
> 
> 发送数据缓冲区和发送数据寄存器之间的关系：当CPU要发送数据时，通常将数据存储到数据发送缓冲区中。然后，UART控制器会从发送缓冲区中读取数据，并将数据暂存到数据发送寄存器中，最后发送给外部设备。 ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=EJC394UD))
> 
> 🏷️ #📝/重点

^KEYEJC394UD

> <span class="highlight" style="background-color: #e56eee">发送数据的大 小</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=ABSK6MUT))
> 
> 🏷️ #📝/重点

^KEYABSK6MUT

> <span class="highlight" style="background-color: #e56eee">发送数据的个数</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=9B8FRGH4))
> 
> 🏷️ #📝/重点

^KEY9B8FRGH4

> <span class="highlight" style="background-color: #e56eee">pRxBuffPtr，RxXferSize，RxXferCount</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=KPGEXFWL))
> 
> 🏷️ #📝/重点

^KEYKPGEXFWL

> <span class="highlight" style="background-color: #e56eee">指向接收数据缓冲区的指针</span>
> 
> 接收数据缓冲区和接收数据寄存器之间的关系：当UART接收到数据时，数据首先会被存储到数据接收寄存器中。然后，通常会有一个中断或者轮询机制检查数据接收寄存器中是否有新的数据。如果有新的数据，就会将数据从数据接收寄存器中读取出来，并存储到数据接收缓冲区中。这样做的好处是，当CPU准备好处理接收到的数据时，可以从数据接收缓冲区中读取出数据，而不必每次都直接读取数据接收寄存器。 ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=R34EHCJJ))
> 
> 🏷️ #📝/重点

^KEYR34EHCJJ

> <span class="highlight" style="background-color: #e56eee">接受数据的大 小</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=Z7B5HAKS))
> 
> 🏷️ #📝/重点

^KEYZ7B5HAKS

> <span class="highlight" style="background-color: #e56eee">接收数据的个数</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=NFYM4A35))
> 
> 🏷️ #📝/重点

^KEYNFYM4A35

> <span class="highlight" style="background-color: #e56eee">hdmatx，hdmarx</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=H794FRT6))
> 
> 🏷️ #📝/重点

^KEYH794FRT6

> <span class="highlight" style="background-color: #e56eee">配置串口发送接收数据的 DMA 具体参数</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=H9NLKDGE))
> 
> 🏷️ #📝/重点

^KEYH9NLKDGE

> <span class="highlight" style="background-color: #e56eee">Lock</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=7XH5SBIX))
> 
> 🏷️ #📝/重点

^KEY7XH5SBIX

> <span class="highlight" style="background-color: #e56eee">对资源操作增加操作锁保护功能</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=FV4QUQV3))
> 
> 🏷️ #📝/重点

^KEYFV4QUQV3

> <span class="highlight" style="background-color: #e56eee">gState，RxState</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=Z24GTN94))
> 
> 🏷️ #📝/重点

^KEYZ24GTN94

> <span class="highlight" style="background-color: #e56eee">分别是 UART 的发送状态、工作状态的结构体</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=T78D464W))
> 
> 🏷️ #📝/重点

^KEYT78D464W

> <span class="highlight" style="background-color: #e56eee">UART 接受状态的结构</span> ([p237](zotero://open-pdf/library/items/JFGTX7CT?page=237&annotation=D6YBC9JR))
> 
> 🏷️ #📝/重点

^KEYD6YBC9JR

> <span class="highlight" style="background-color: #e56eee">。HAL_UART_StateTypeDef 是一个枚举类型，列出串口在工作过程中的状态值，有些值 只适用于 gState，如 HAL_UART_STATE_BUSY。</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=6DJYSB7A))
> 
> 🏷️ #📝/重点

^KEY6DJYSB7A

> <span class="highlight" style="background-color: #e56eee">ErrorCode</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=CMKH4ZNP))
> 
> 🏷️ #📝/重点

^KEYCMKH4ZNP

> <span class="highlight" style="background-color: #e56eee">主要用于存放串口操作的错误信息</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=V9D2IA6Y))
> 
> 🏷️ #📝/重点

^KEYV9D2IA6Y

> <span class="highlight" style="background-color: #e56eee">UART_InitTypeDef 这个结构体类型</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=4WGIWZLD))
> 
> 🏷️ #📝/重点

^KEY4WGIWZLD

> <span class="highlight" style="background-color: #e56eee">配置 UART 的各个通 信参数，包括波特率，停止位等</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=B5RYCTUX))
> 
> 🏷️ #📝/重点

^KEYB5RYCTUX

> <span class="highlight" style="background-color: #e56eee">BaudRate：波特率设置</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=GR9R97YP))
> 
> 🏷️ #📝/重点

^KEYGR9R97YP

> <span class="highlight" style="background-color: #e56eee">WordLength：数据帧字长</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=MJRPTPL6))
> 
> 🏷️ #📝/重点

^KEYMJRPTPL6

> <span class="highlight" style="background-color: #e56eee">设置为 8 位</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=KSWS4JJG))
> 
> 🏷️ #📝/重点

^KEYKSWS4JJG

> <span class="highlight" style="background-color: #e56eee">StopBits：停止位设置</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=AHSNKFDW))
> 
> 🏷️ #📝/重点

^KEYAHSNKFDW

> <span class="highlight" style="background-color: #e56eee">Parity：奇偶校验控制选择</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=VI68HWG8))
> 
> 🏷️ #📝/重点

^KEYVI68HWG8

> <span class="highlight" style="background-color: #e56eee">Mode：UART 模式选择</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=V3H82RZ2))
> 
> 🏷️ #📝/重点

^KEYV3H82RZ2

> <span class="highlight" style="background-color: #e56eee">只收模式</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=KCU6ARAZ))
> 
> 🏷️ #📝/重点

^KEYKCU6ARAZ

> <span class="highlight" style="background-color: #e56eee">只发模式</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=5C7FCLRR))
> 
> 🏷️ #📝/重点

^KEY5C7FCLRR

> <span class="highlight" style="background-color: #e56eee">收发模式</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=S937FQU2))
> 
> 🏷️ #📝/重点

^KEYS937FQU2

> <span class="highlight" style="background-color: #e56eee">HwFlowCtl：硬件流控制选择</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=HBWBCVHX))
> 
> 🏷️ #📝/重点

^KEYHBWBCVHX

> <span class="highlight" style="background-color: #e56eee">OverSampling：过采样选择</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=NC7RJA6W))
> 
> 🏷️ #📝/重点

^KEYNC7RJA6W

> <span class="highlight" style="background-color: #e56eee">一般选择 16 过采样</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=GQ69SX4U))
> 
> 🏷️ #📝/重点

^KEYGQ69SX4U

> <span class="highlight" style="background-color: #e56eee">函数返回值</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=A4ER3D7B))
> 
> 🏷️ #📝/重点

^KEYA4ER3D7B

> <span class="highlight" style="background-color: #e56eee">HAL_StatusTypeDef 枚举类型的值</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=PL8T97D9))
> 
> 🏷️ #📝/重点

^KEYPL8T97D9

> <span class="highlight" style="background-color: #e56eee">HAL_OK 表示成功，HAL_ERROR 表 示错误，HAL_BUSY 表示忙碌，HAL_TIMEOUT 超时</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=K9FH4IHS))
> 
> 🏷️ #📝/重点

^KEYK9FH4IHS

> <span class="highlight" style="background-color: #e56eee">HAL_UART_Receive_IT 函数</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=HZM4B977))
> 
> 🏷️ #📝/重点

^KEYHZM4B977

> <span class="highlight" style="background-color: #e56eee">开启串口接收中断函数</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=BUS9IRT6))
> 
> 🏷️ #📝/重点

^KEYBUS9IRT6

> <span class="highlight" style="background-color: #e56eee">用于开启以中断的方式接收指定字节。数据接收在中断处理函数里面实现。</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=KIDV8H2M))
> 
> 🏷️ #📝/重点

^KEYKIDV8H2M

> <span class="highlight" style="background-color: #e56eee">UART_HandleTypeDef</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=4E9WB8LV))
> 
> 🏷️ #📝/重点

^KEY4E9WB8LV

> <span class="highlight" style="background-color: #e56eee">要接收的数据地址</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=NT9DFQKG))
> 
> 🏷️ #📝/重点

^KEYNT9DFQKG

> <span class="highlight" style="background-color: #e56eee">要接收的数据大小，以字节为单位</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=DR54IESI))
> 
> 🏷️ #📝/重点

^KEYDR54IESI

> <span class="highlight" style="background-color: #e56eee">HAL_UART_IRQHandler 函数</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=6F57YZZ8))
> 
> 🏷️ #📝/重点

^KEY6F57YZZ8

> <span class="highlight" style="background-color: #e56eee">HAL 库中断处理公共函数</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=A39S78D4))
> 
> 🏷️ #📝/重点

^KEYA39S78D4

> <span class="highlight" style="background-color: #e56eee">UART_HandleTypeDef</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=SQI8B55Y))
> 
> 🏷️ #📝/重点

^KEYSQI8B55Y

> <span class="highlight" style="background-color: #e56eee">串口句柄</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=5XKZF8RQ))
> 
> 🏷️ #📝/重点

^KEY5XKZF8RQ

> <span class="highlight" style="background-color: #e56eee">可以直接在函数 HAL_UART_IRQHandler 的前面或者后面添加新代码，也可以直接在 HAL_UART_IRQHandler 调用的各种回调函数里面执行</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=QAJHEGTC))
> 
> 🏷️ #📝/重点

^KEYQAJHEGTC

> <span class="highlight" style="background-color: #e56eee">回调函数</span> ([p238](zotero://open-pdf/library/items/JFGTX7CT?page=238&annotation=CIEP8PHU))
> 
> 🏷️ #📝/重点

^KEYCIEP8PHU

> <span class="highlight" style="background-color: #e56eee">接收回调函数 HAL_UART_RxCpltCallback</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=FWLSQ2M3))
> 
> 🏷️ #📝/重点

^KEYFWLSQ2M3

> <span class="highlight" style="background-color: #e56eee">在接收回调函数里面 编写我们的接收逻辑代码</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=8XARQICX))
> 
> 🏷️ #📝/重点

^KEY8XARQICX

> <span class="highlight" style="background-color: #e56eee">串口通讯配置步骤</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=9TCZLGMX))
> 
> 🏷️ #📝/重点

^KEY9TCZLGMX

> <span class="highlight" style="background-color: #e56eee">串口参数初始化</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=PP3STC3R))
> 
> 🏷️ #📝/重点

^KEYPP3STC3R

> <span class="highlight" style="background-color: #e56eee">该函数会调用：HAL_UART_MspInit 函数来完成对串口底层的初始化，包括：串口 及 GPIO 时钟使能、GPIO 模式设置、中断设置等</span>
> 
> Msp 全称为 **MCU support package。**带有 MspInit 的函数，它们的作用是进行 MCU 级别硬件初始化设置，并且它们通常会被上一层的初始化函数所调用。
> 
> 这样做的目的是为了把 MCU 相关的硬件 初始化剥夺出来，方便用户代码在不同型号的 MCU 上移植。 ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=N7V55H3G))
> 
> 🏷️ #📝/重点

^KEYN7V55H3G

> <span class="highlight" style="background-color: #e56eee">使能串口和 GPIO 口时钟</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=BF3L347R))
> 
> 🏷️ #📝/重点

^KEYBF3L347R

> <span class="highlight" style="background-color: #e56eee">PA9 和 PA10 作为串口的 TX 和 RX 脚</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=22S7G8CL))
> 
> 🏷️ #📝/重点

^KEY22S7G8CL

> <span class="highlight" style="background-color: #e56eee">GPIO 模式设置</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=6NLDNAKK))
> 
> 🏷️ #📝/重点

^KEY6NLDNAKK

> <span class="highlight" style="background-color: #e56eee">开启串口相关中断，配置串口中断优先级</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=39BP8EA3))
> 
> 🏷️ #📝/重点

^KEY39BP8EA3

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_EnableIRQ 函数使能串口中断</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=HMQZ94CN))
> 
> 🏷️ #📝/重点

^KEYHMQZ94CN

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_SetPriority 函数设置中断优先级</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=EZ928PJN))
> 
> 🏷️ #📝/重点

^KEYEZ928PJN

> <span class="highlight" style="background-color: #e56eee">编写中断服务函数</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=44HA5MC6))
> 
> 🏷️ #📝/重点

^KEY44HA5MC6

> <span class="highlight" style="background-color: #e56eee">串口 1 中断服务函数为：USART1_IRQHandler</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=S3RIZGGH))
> 
> 🏷️ #📝/重点

^KEYS3RIZGGH

> <span class="highlight" style="background-color: #e56eee">串口中断通用处理函数 HAL_UART_IRQHandler</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=3XAYKZUJ))
> 
> 🏷️ #📝/重点

^KEY3XAYKZUJ

> <span class="highlight" style="background-color: #e56eee">调用回调函数 HAL_UART_RxCpltCallback</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=SXFLJG79))
> 
> 🏷️ #📝/重点

^KEYSXFLJG79

> <span class="highlight" style="background-color: #e56eee">串口数据接收和发送</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=K8JKKEKW))
> 
> 🏷️ #📝/重点

^KEYK8JKKEKW

> <span class="highlight" style="background-color: #e56eee">通过读写 USART_DR 寄存器，完成串口数据的接收和发</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=GQZ32ZND))
> 
> 🏷️ #📝/重点

^KEYGQZ32ZND

> <span class="highlight" style="background-color: #e56eee">HAL_UART_Receive 和 HAL_UART_Transmit 两个函数用于串口数据的接收和发送</span> ([p239](zotero://open-pdf/library/items/JFGTX7CT?page=239&annotation=AASKB6YK))
> 
> 🏷️ #📝/重点

^KEYAASKB6YK

> <span class="highlight" style="background-color: #f19837">17.3.3 程序解析</span> ([p240](zotero://open-pdf/library/items/JFGTX7CT?page=240&annotation=4BBYCZNJ))
> 
> 🏷️ #📝/标题

^KEY4BBYCZNJ

> <span class="highlight" style="background-color: #e56eee">USART_REC_LEN 表示最大接收字节数</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=3YRGMVHI))
> 
> 🏷️ #📝/重点

^KEY3YRGMVHI

> <span class="highlight" style="background-color: #e56eee">USART_EN_RX 则是用于使能串口 1 的接收数据</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=B9382J89))
> 
> 🏷️ #📝/重点

^KEYB9382J89

> <span class="highlight" style="background-color: #e56eee">RXBUFFERSIZE 是缓冲大小</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=PERYWZXZ))
> 
> 🏷️ #📝/重点

^KEYPERYWZXZ

> <span class="highlight" style="background-color: #e56eee">接收中断</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=JJA2STEG))
> 
> 🏷️ #📝/重点

^KEYJJA2STEG

> <span class="highlight" style="background-color: #e56eee">aRxbuffer</span>
> 
> 这个指针指向接收缓冲区。
> 
> 所谓的“接收缓存区”是自己定义的一个大小位“RXBUFFERSIZE”的数组。 ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=TQXDSXBJ))
> 
> 🏷️ #📝/重点

^KEYTQXDSXBJ

> <span class="highlight" style="background-color: #e56eee">uartx_handle 是结构体 UART_HandleTypeDef 类型的全局变量</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=MGTGUNKW))
> 
> 🏷️ #📝/重点

^KEYMGTGUNKW

> <span class="highlight" style="background-color: #e56eee">最后一行代码调用函数 HAL_UART_Receive_IT，作用是开启 接收中断，同时设置接收的缓存区以及接收的数据量</span>
> 
> 当接收缓存中的数据满了之后就触发中断读取 ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=R3PVAGV6))
> 
> 🏷️ #📝/重点

^KEYR3PVAGV6

> <span class="highlight" style="background-color: #e56eee">上面的初始化函数只是串口初始化的其中一部分，我们还有一部分初始化需要 HAL_UART_MspInit 函数去完成</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=C4SIAKBX))
> 
> 🏷️ #📝/重点

^KEYC4SIAKBX

> <span class="highlight" style="background-color: #e56eee">UART 底层初始化函数</span> ([p241](zotero://open-pdf/library/items/JFGTX7CT?page=241&annotation=NUEVSA75))
> 
> 🏷️ #📝/重点

^KEYNUEVSA75

> <span class="highlight" style="background-color: #e56eee">首先是调用 if(huart->Instance == USART1)判断是要初始化哪个串口，因为每个串口初始化都会调用 HAL_UART_MspInit 这 个函数，所以需要判断是哪个串口要初始化才做相应的处理。</span>
> 
> 这个跟回调函数差不多 ([p242](zotero://open-pdf/library/items/JFGTX7CT?page=242&annotation=QNDFQEIW))
> 
> 🏷️ #📝/重点

^KEYQNDFQEIW

> <span class="highlight" style="background-color: #e56eee">PA9 和 PA10 需要用做复用功能</span> ([p242](zotero://open-pdf/library/items/JFGTX7CT?page=242&annotation=STJERYU5))
> 
> 🏷️ #📝/重点

^KEYSTJERYU5

> <span class="highlight" style="background-color: #e56eee">推挽式复用</span> ([p242](zotero://open-pdf/library/items/JFGTX7CT?page=242&annotation=LFKDSHXI))
> 
> 🏷️ #📝/重点

^KEYLFKDSHXI

> <span class="highlight" style="background-color: #e56eee">开漏式复用</span> ([p242](zotero://open-pdf/library/items/JFGTX7CT?page=242&annotation=SD39QEFD))
> 
> 🏷️ #📝/重点

^KEYSD39QEFD

> <span class="highlight" style="background-color: #e56eee">因为 PA9 是一个发送管脚，所以模式设置为复用推挽输出，而 PA10 是一 个接收管脚，所以它的模式设置为浮空输入即可</span> ([p242](zotero://open-pdf/library/items/JFGTX7CT?page=242&annotation=JJXQCMNS))
> 
> 🏷️ #📝/重点

^KEYJJXQCMNS

> <span class="highlight" style="background-color: #e56eee">GPIO_MODE_AF_INPUT 实质就是一个 GPIO_MODE_INPUT 浮空输入模式</span> ([p242](zotero://open-pdf/library/items/JFGTX7CT?page=242&annotation=G6XAHHPS))
> 
> 🏷️ #📝/重点

^KEYG6XAHHPS

> <span class="highlight" style="background-color: #e56eee">HAL_UART_RxCpltCallback 函数的定义</span> ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=3BF6SNLN))
> 
> 🏷️ #📝/重点

^KEY3BF6SNLN

> <span class="highlight" style="background-color: #e56eee">g_usart_rx_sta & 0X3FFF</span>
> 
> 只取 g_usart_rx_sta 的 0~13 位，表示接收到的有效字节数 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=6R7DD9YZ))
> 
> 🏷️ #📝/重点

^KEY6R7DD9YZ

> <span class="highlight" style="background-color: #e56eee">g_rx_buffer,</span>
> 
> 这里写的有点错误，文章有时用 g_rx_buffer 来表达接收缓存区，有时用 aRxBuffer 来表示 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=GQ77JIXN))
> 
> 🏷️ #📝/重点

^KEYGQ77JIXN

> <span class="highlight" style="background-color: #e56eee">RxXferSize 为 1</span>
> 
> UART 接收数据大小，由这个决定接收多少个字符后，RXNE才置 1 ，然后产生中断，处理缓存中的字符。 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=N7DSU6FR))
> 
> 🏷️ #📝/重点

^KEYN7DSU6FR

> <span class="highlight" style="background-color: #e56eee">每当串口 1 接收到一个字符后触 发接收完成中断</span> ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=GTUAFM7H))
> 
> 🏷️ #📝/重点

^KEYGTUAFM7H

> <span class="highlight" style="background-color: #e56eee">g_rx_buffer</span>
> 
> 自定义的一个数组充当接收缓存区 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=FC89L27S))
> 
> 🏷️ #📝/重点

^KEYFC89L27S

> <span class="highlight" style="background-color: #e56eee">由于我们设置了缓存大小为 1，而且 RxXferSize=1，所以每次接 受一个字符，会直接保存到 RxXferSize[0]中，我们直接通过读取 RxXferSize[0]的值就是本次接 收到的字符。</span>
> 
> 接收缓存的大小由 RXBUFFERSIZE 控制，这里 RXBUFFERSIZE 设为 1 。
> 
> RxXferSize[0]是指缓存。 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=KRMU9FMK))
> 
> 🏷️ #📝/重点

^KEYKRMU9FMK

> <span class="highlight" style="background-color: #e56eee">通过这个函数，配合一个数组 g_usart_rx_buf， 一个接收状态寄存器 g_usart_rx_sta</span> ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=4HK8UISG))
> 
> 🏷️ #📝/重点

^KEY4HK8UISG

> <span class="highlight" style="background-color: #e56eee">实现对串口数据的接收管理</span> ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=292RI9EV))
> 
> 🏷️ #📝/重点

^KEY292RI9EV

> <span class="highlight" style="background-color: #e56eee">数组 g_usart_rx_buf 的大小 由 USART_REC_LEN 定义</span>
> 
> 最后接收到的所有有效字符都存放在 g_usart_rx_buf 数组中 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=JXEDJGSV))
> 
> 🏷️ #📝/重点

^KEYJXEDJGSV

> <span class="highlight" style="background-color: #e56eee">g_usart_rx_sta 是一个接收状态寄存器</span>
> 
> 通过这个变量知道接收是否完成以及接收的字符个数 ([p243](zotero://open-pdf/library/items/JFGTX7CT?page=243&annotation=VFUNPPYU))
> 
> 🏷️ #📝/重点

^KEYVFUNPPYU

> <span class="highlight" style="background-color: #e56eee">当接收到从电脑发过来的数据，把接收到的数据保存在数组 g_usart_rx_buf 中，同时在接 收状态寄存器（g_usart_rx_sta）中计数接收到的有效数据个数，当收到回车（回车的表示由 2 个 字节组成：0X0D 和 0X0A）的第一个字节 0X0D 时，计数器将不再增加，等待 0X0A 的到来， 而如果 0X0A 没有来到，则认为这次接收失败，重新开始下一次接收。如果顺利接收到 0X0A， 则标记 g_usart_rx_sta 的第 15 位，这样完成一次接收，并等待该位被其他程序清除，从而开始 下一次的接收，而如果迟迟没有收到 0X0D，那么在接收数据超过 USART_REC_LEN 的时候， 则会丢弃前面的数据，重新接收。</span> ([p244](zotero://open-pdf/library/items/JFGTX7CT?page=244&annotation=KS7YYPW5))
> 
> 🏷️ #📝/重点

^KEYKS7YYPW5

> <span class="highlight" style="background-color: #e56eee">在回调函数后面调用了 UART_Receive_IT 函数。该函数在这里的主要作用是重 新开启接收完成中断。</span>
> 
> 串口中断公共处理函数中会有清中断操作，所以要重新开启接收完成中断。
> 
> 注意：“关中断”和“中断除能”不是一样的 ([p244](zotero://open-pdf/library/items/JFGTX7CT?page=244&annotation=5RK2S3DU))
> 
> 🏷️ #📝/重点

^KEY5RK2S3DU

> <span class="highlight" style="background-color: #e56eee">第一条是调用 HAL 串口发送函数 HAL_UART_Transmit 来发送一段字符到串口。第二条是我们发送一个字节之后，要检测这个数 据是否已经被发送完成了。</span> ([p245](zotero://open-pdf/library/items/JFGTX7CT?page=245&annotation=8F38YDJS))
> 
> 🏷️ #📝/重点

^KEY8F38YDJS

> <span class="highlight" style="background-color: #e56eee">每次发送数 据后，XCOM 都会自动多发一个回车(0X0D+0X0A)。</span> ([p245](zotero://open-pdf/library/items/JFGTX7CT?page=245&annotation=GRVXMGKG))
> 
> 🏷️ #📝/重点

^KEYGRVXMGKG

> <span class="highlight" style="background-color: #f19837">第十八章 独立看门狗（IWDG）实验</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=SCBNAJDJ))
> 
> 🏷️ #📝/标题

^KEYSCBNAJDJ

> <span class="highlight" style="background-color: #e56eee">独立看门狗（IWDG）和窗口看门狗（WWDG）</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=QDHXQFI8))
> 
> 🏷️ #📝/重点

^KEYQDHXQFI8

> <span class="highlight" style="background-color: #f19837">18.1 IWDG 简介</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=FD66P7F2))
> 
> 🏷️ #📝/标题

^KEYFD66P7F2

> <span class="highlight" style="background-color: #e56eee">独立看门狗本质上是一个定时器，这个定时器有一个输出端，可以输出复位信号</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=TRWXXRCU))
> 
> 🏷️ #📝/重点

^KEYTRWXXRCU

> <span class="highlight" style="background-color: #e56eee">是一个 12 位的递减计数器，当计数器的值减到 0 的时候，就会产生一个复位信号</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=VZFTXBLF))
> 
> 🏷️ #📝/重点

^KEYVZFTXBLF

> <span class="highlight" style="background-color: #e56eee">如果在计 数没减到 0 之前，重置计数器的值的话，那么就不会产生复位信号，这个动作我们称为喂狗。</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=FTKUVM7H))
> 
> 🏷️ #📝/重点

^KEYFTKUVM7H

> <span class="highlight" style="background-color: #e56eee">看门狗功能由 VDD 电压域供电，在停止模式和待机模式下仍然可以工作。</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=B6A4Z8YV))
> 
> 🏷️ #📝/重点

^KEYB6A4Z8YV

> <span class="highlight" style="background-color: #f19837">18.1.1 IWDG 框图</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=4EK34AYV))
> 
> 🏷️ #📝/标题

^KEY4EK34AYV

> <span class="highlight" style="background-color: #e56eee">WDG 有一个输入（时钟 LSI），经过一个 8 位的可编程预分 频器提供时钟给一个 12 位递减计数器，满足条件就会输出一个复位信号</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=CM79DABW))
> 
> 🏷️ #📝/重点

^KEYCM79DABW

> <span class="highlight" style="background-color: #e56eee">40Khz 低速时钟（LSI）驱动</span>
> 
> 因此不需要时钟使能 ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=BNYRNP9E))
> 
> 🏷️ #📝/重点

^KEYBNYRNP9E

> <span class="highlight" style="background-color: #e56eee">即使主时钟发生故 障，它也仍然有效</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=7CBQSF6N))
> 
> 🏷️ #📝/重点

^KEY7CBQSF6N

> <span class="highlight" style="background-color: #e56eee">看门狗的时钟是一个内部 RC 时钟，所以并不是准确的 40Khz，而是在 30~60Khz 之间的一个可变化的时钟，只是我们在估算的时候，以 40Khz 的频率 来计算，看门狗对时间的要求不是很精确，所以，时钟有些偏差，都是可以接受的。</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=TYTNF3IC))
> 
> 🏷️ #📝/重点

^KEYTYTNF3IC

> <span class="highlight" style="background-color: #f19837">18.1.2 IWDG 寄存器</span> ([p246](zotero://open-pdf/library/items/JFGTX7CT?page=246&annotation=X3AS9D8D))
> 
> 🏷️ #📝/标题

^KEYX3AS9D8D

> <span class="highlight" style="background-color: #e56eee">键寄存器（IWDG_KR）</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=M7Z8XDCN))
> 
> 🏷️ #📝/重点

^KEYM7Z8XDCN

> <span class="highlight" style="background-color: #e56eee">是独立看门狗的控制寄存器</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=WHS44PK2))
> 
> 🏷️ #📝/重点

^KEYWHS44PK2

> <span class="highlight" style="background-color: #e56eee">键寄存器(IWDG_KR)中写入 0xCCCC，开始启用独立看门狗</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=69GU6GKB))
> 
> 🏷️ #📝/重点

^KEY69GU6GKB

> <span class="highlight" style="background-color: #e56eee">只要键寄存器 IWDG_KR 中被写入 0xAAAA，IWDG_RLR 中的值就会被重新加载到 计数器中从而避免产生看门狗复位。</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=JMIYPZ83))
> 
> 🏷️ #📝/重点

^KEYJMIYPZ83

> <span class="highlight" style="background-color: #e56eee">IWDG_PR 和 IWDG_RLR 寄存器具有写保护功能。要修改这两个寄存器的值，必须先向 IWDG_KR 寄存器中写入 0x5555。将其他值写入这个寄存器将会打乱操作顺序，寄存器将重新 被保护。重装载操作(即写入 0xAAAA)也会启动写保护功能。</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=22A347NV))
> 
> 🏷️ #📝/重点

^KEY22A347NV

> <span class="highlight" style="background-color: #e56eee">预分频寄存器（IWDG_PR）</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=TAUNRT5C))
> 
> 🏷️ #📝/重点

^KEYTAUNRT5C

> <span class="highlight" style="background-color: #e56eee">该寄存器用来设置看门狗时钟（LSI）的分频系数，最低为 4，最高位 256，该寄存器是一 个 32 位的寄存器，但是我们只用了最低 3 位，其他都是保留位。</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=8H5G3VH3))
> 
> 🏷️ #📝/重点

^KEY8H5G3VH3

> <span class="highlight" style="background-color: #e56eee">重载寄存器（IWDG_RLR）</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=NYMUSXIB))
> 
> 🏷️ #📝/重点

^KEYNYMUSXIB

> <span class="highlight" style="background-color: #e56eee">用来保存重装载到计数器中的值</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=4EC3DK9A))
> 
> 🏷️ #📝/重点

^KEY4EC3DK9A

> <span class="highlight" style="background-color: #e56eee">有低 12 位 是有效的。</span> ([p247](zotero://open-pdf/library/items/JFGTX7CT?page=247&annotation=WAF2WDZJ))
> 
> 🏷️ #📝/重点

^KEYWAF2WDZJ

> <span class="highlight" style="background-color: #f19837">18.3 程序设计</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=BFNZJZY8))
> 
> 🏷️ #📝/标题

^KEYBFNZJZY8

> <span class="highlight" style="background-color: #f19837">18.3.1 IWDG 的 HAL 库驱动</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=LHZSGB68))
> 
> 🏷️ #📝/标题

^KEYLHZSGB68

> <span class="highlight" style="background-color: #e56eee">HAL_IWDG_Init 函数</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=JNBT6KCJ))
> 
> 🏷️ #📝/重点

^KEYJNBT6KCJ

> <span class="highlight" style="background-color: #e56eee">形参 1 是 IWDG 句柄</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=2DP9Q2K2))
> 
> 🏷️ #📝/重点

^KEY2DP9Q2K2

> <span class="highlight" style="background-color: #e56eee">Instance：指向 IWDG 寄存器基地址。</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=2ZCU5VDR))
> 
> 🏷️ #📝/重点

^KEY2ZCU5VDR

> <span class="highlight" style="background-color: #e56eee">Init：IWDG 初始化结构体</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=NGJRHVB6))
> 
> 🏷️ #📝/重点

^KEYNGJRHVB6

> <span class="highlight" style="background-color: #e56eee">IWDG_InitTypeDef</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=LKWYC2IJ))
> 
> 🏷️ #📝/重点

^KEYLKWYC2IJ

> <span class="highlight" style="background-color: #e56eee">Prescaler：预分频系数，IWDG_PRESCALER_4 到 IWDG_PRESCALER_256</span>
> 
> 对应的实际值是 0~8 ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=2YZHIWG6))
> 
> 🏷️ #📝/重点

^KEY2YZHIWG6

> <span class="highlight" style="background-color: #e56eee">Window：窗口值</span>
> 
> 上述代码里好像没写这个成员变量 ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=GNC522VB))
> 
> 🏷️ #📝/重点

^KEYGNC522VB

> <span class="highlight" style="background-color: #e56eee">HAL_IWDG_Refresh 函数</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=69KPGRB9))
> 
> 🏷️ #📝/重点

^KEY69KPGRB9

> <span class="highlight" style="background-color: #e56eee">独立看门狗的喂狗函数</span> ([p248](zotero://open-pdf/library/items/JFGTX7CT?page=248&annotation=F27I7CWB))
> 
> 🏷️ #📝/重点

^KEYF27I7CWB

> <span class="highlight" style="background-color: #e56eee">用于把重装载寄存器的值重载到计数器中</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=SRF2TJ7S))
> 
> 🏷️ #📝/重点

^KEYSRF2TJ7S

> <span class="highlight" style="background-color: #e56eee">形参 1 是</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=EH8FKCBC))
> 
> 🏷️ #📝/重点

^KEYEH8FKCBC

> <span class="highlight" style="background-color: #e56eee">IWDG 句柄</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=63EAS847))
> 
> 🏷️ #📝/重点

^KEY63EAS847

> <span class="highlight" style="background-color: #e56eee">取消写保护和设置预分频系数以及重装载值在 HAL 库中是通 过函数 HAL_IWDG_Init 实现的。</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=I7YZNZDN))
> 
> 🏷️ #📝/重点

^KEYI7YZNZDN

> <span class="highlight" style="background-color: #e56eee">Tout=((4×2^prer) ×rlr) /40</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=7IQQIGX9))
> 
> 🏷️ #📝/重点

^KEY7IQQIGX9

> <span class="highlight" style="background-color: #e56eee">看门狗的时钟不是准确的 40Khz，所以在喂狗的时候，最好不要太晚了，否则，有可能发生看 门狗复位。</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=YSA7BZM5))
> 
> 🏷️ #📝/重点

^KEYYSA7BZM5

> <span class="highlight" style="background-color: #e56eee">在 HAL 中重载计数值的函数是 HAL_IWDG_Refresh</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=BW9YBDW3))
> 
> 🏷️ #📝/重点

^KEYBW9YBDW3

> <span class="highlight" style="background-color: #e56eee">启动独立看门狗是通过宏定义标识符来实现的</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=9XYEJLGG))
> 
> 🏷️ #📝/重点

^KEY9XYEJLGG

> <span class="highlight" style="background-color: #e56eee">调用宏定义标识符__HAL_IWDG_START 即可实现看门狗使能</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=Z9AMILGE))
> 
> 🏷️ #📝/重点

^KEYZ9AMILGE

> <span class="highlight" style="background-color: #e56eee">实际上，当我 们调用了看门狗初始化函数 HAL_IWDG_Init 之后，在内部已经调用了该宏启动看门狗。</span> ([p249](zotero://open-pdf/library/items/JFGTX7CT?page=249&annotation=LXYM4RGG))
> 
> 🏷️ #📝/重点

^KEYLXYM4RGG

> <span class="highlight" style="background-color: #e56eee">主要设置预分频数和重装载寄存器的值</span> ([p250](zotero://open-pdf/library/items/JFGTX7CT?page=250&annotation=5H4QJPPA))
> 
> 🏷️ #📝/重点

^KEY5H4QJPPA

> <span class="highlight" style="background-color: #e56eee">只要你在一秒钟之内，有一 次写 0XAAAA 到 IWDG_KR，就不会导致看门狗复位（当然写入多次也是可以的）。</span> ([p251](zotero://open-pdf/library/items/JFGTX7CT?page=251&annotation=ZQ5JAM83))
> 
> 🏷️ #📝/重点

^KEYZQ5JAM83

> <span class="highlight" style="background-color: #f19837">第十九章 窗口门狗（WWDG）实验</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=F9QQJDB4))
> 
> 🏷️ #📝/标题

^KEYF9QQJDB4

> <span class="highlight" style="background-color: #f19837">19.1 WWDG 简介</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=TKE2KJMX))
> 
> 🏷️ #📝/标题

^KEYTKE2KJMX

> <span class="highlight" style="background-color: #e56eee">窗口看门狗（WWDG）通常被用来监测由外部干扰或不可预见的逻辑条件造成的应用程序 背离正常的运行序列而产生的软件故障</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=BYZXSGLE))
> 
> 🏷️ #📝/重点

^KEYBYZXSGLE

> <span class="highlight" style="background-color: #e56eee">递减计数器</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=RJB2GZZ4))
> 
> 🏷️ #📝/重点

^KEYRJB2GZZ4

> <span class="highlight" style="background-color: #e56eee">复位条件不一样</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=JUBXEXFP))
> 
> 🏷️ #📝/重点

^KEYJUBXEXFP

> <span class="highlight" style="background-color: #e56eee">产生复位信号有两个条件</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=FP959U8V))
> 
> 🏷️ #📝/重点

^KEYFP959U8V

> <span class="highlight" style="background-color: #e56eee">当递减计数器的数值从 0x40 减到 0x3F 时（T6 位跳变到 0）。</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=SSVLYZAF))
> 
> 🏷️ #📝/重点

^KEYSSVLYZAF

> <span class="highlight" style="background-color: #e56eee">当喂狗的时候如果计数器的值大于 W[6:0]时，此数值在 WWDG_CFR 寄存器定义。</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=K7KTSE29))
> 
> 🏷️ #📝/重点

^KEYK7KTSE29

> <span class="highlight" style="background-color: #e56eee">当计数器的值减到 0x40 时还不喂狗的话，到下一个计数就会 产生复位，这个值称为窗口的下限值，是固定的值，不能改变</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=CSTKL3IU))
> 
> 🏷️ #📝/重点

^KEYCSTKL3IU

> <span class="highlight" style="background-color: #e56eee">同 的是窗口看门狗的计数器的值在减到某一个数之前喂狗的话也会产生复位，这个值叫窗口的上 限，上限值 W[6:0]由用户设置</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=HYN5FQPP))
> 
> 🏷️ #📝/重点

^KEYHYN5FQPP

> <span class="highlight" style="background-color: #f19837">19.1.1 WWDG 框图</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=N2W8D73Z))
> 
> 🏷️ #📝/标题

^KEYN2W8D73Z

> <span class="highlight" style="background-color: #e56eee">来自 RCC 的 PCLK1 输入时钟</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=2YSV2UFW))
> 
> 🏷️ #📝/重点

^KEY2YSV2UFW

> <span class="highlight" style="background-color: #e56eee">经过一个 4096 的分频器(</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=DQCYT9R9))
> 
> 🏷️ #📝/重点

^KEYDQCYT9R9

> <span class="highlight" style="background-color: #e56eee">再经过一个分频系数可选（1、2、4、8）的可编程预分频器</span> ([p252](zotero://open-pdf/library/items/JFGTX7CT?page=252&annotation=2VBRX2RZ))
> 
> 🏷️ #📝/重点

^KEY2VBRX2RZ

> <span class="highlight" style="background-color: #e56eee">W[6:0] 是 WWDG_CFR 寄存器的低 7 位， 用于与递减计数器 T[6:0]比较的窗口值，也就是我们说的上限值，由用户设置</span> ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=8PI8C7RN))
> 
> 🏷️ #📝/重点

^KEY8PI8C7RN

> <span class="highlight" style="background-color: #e56eee">当 T[6:0]>W[6:0]是不允许刷新 T[6:0] 的值，即不允许喂狗，否则会产生复位</span> ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=FNN23S4N))
> 
> 🏷️ #📝/重点

^KEYFNN23S4N

> <span class="highlight" style="background-color: #e56eee">只有在 W[6:0]这个写反了 ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=GNYHC5KM))
> 
> 🏷️ #📝/重点

^KEYGNYHC5KM

> <span class="highlight" style="background-color: #e56eee">即 T6 位为 0 这一刻，也会产生复位</span> ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=5IEPEJI7))
> 
> 🏷️ #📝/重点

^KEY5IEPEJI7

> <span class="highlight" style="background-color: #e56eee">窗口看门狗的超时公式</span>
> 
> “超时时间”是指到达窗口下限值所花的时间 ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=TYI6CH7S))
> 
> 🏷️ #📝/重点

^KEYTYI6CH7S

> <span class="highlight" style="background-color: #e56eee">4096</span>
> 
> 4096分频器 ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=N8EIQBBQ))
> 
> 🏷️ #📝/重点

^KEYN8EIQBBQ

> <span class="highlight" style="background-color: #e56eee">T[5:0] + 1</span>
> 
> 计算的范围为：计数器的低 6 位 + 1 ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=YTACAMFD))
> 
> 🏷️ #📝/重点

^KEYYTACAMFD

> <span class="highlight" style="background-color: #e56eee">19.1.2 WWDG 寄存器</span> ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=VWGSYV2T))
> 
> 🏷️ #📝/重点

^KEYVWGSYV2T

> <span class="highlight" style="background-color: #e56eee">控制寄存器（WWDG_CR）</span> ([p253](zotero://open-pdf/library/items/JFGTX7CT?page=253&annotation=HNSZVRPU))
> 
> 🏷️ #📝/重点

^KEYHNSZVRPU

> <span class="highlight" style="background-color: #e56eee">该寄存器只有低八位有效，其中 T[6：0]用来存储看门狗的计数器的值，随时更新的，每隔 （4096×2^ WDGTB[2:0]）PCLK 个周期减 1</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=SXHU8NH4))
> 
> 🏷️ #📝/重点

^KEYSXHU8NH4

> <span class="highlight" style="background-color: #e56eee">WDGA 位则是看门狗的激活位，该位由软件置 1，启动看门狗，并且一定要注意的是该位 一旦设置，就只能在硬件复位后才能清零了。</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=IEAFSG5H))
> 
> 🏷️ #📝/重点

^KEYIEAFSG5H

> <span class="highlight" style="background-color: #e56eee">配置寄存器（WWDG_CFR）</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=2JL8SPJB))
> 
> 🏷️ #📝/重点

^KEY2JL8SPJB

> <span class="highlight" style="background-color: #e56eee">EWI 位是提前唤醒中断，如果该位置 1，当递减计数器等于 0x40 时产生提 前唤醒中断，我们就可以及时喂狗以避免 WWDG 复位</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=GSZHYH84))
> 
> 🏷️ #📝/重点

^KEYGSZHYH84

> <span class="highlight" style="background-color: #e56eee">如果该位设置，并开启了中断，则会产生中 断，我们可以在中断里面向 WWDG_CR 重新写入计数器的值，来达到喂狗的目的</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=B7AKZ6DY))
> 
> 🏷️ #📝/重点

^KEYB7AKZ6DY

> <span class="highlight" style="background-color: #e56eee">必须在不大于 1 个窗口看门狗计数周期的时间</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=GGG272FL))
> 
> 🏷️ #📝/重点

^KEYGGG272FL

> <span class="highlight" style="background-color: #e56eee">内重新写 WWDG_CR</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=V7YJTD2S))
> 
> 🏷️ #📝/重点

^KEYV7YJTD2S

> <span class="highlight" style="background-color: #e56eee">状态寄存器（WWDG_SR）</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=F4UZFFDA))
> 
> 🏷️ #📝/重点

^KEYF4UZFFDA

> <span class="highlight" style="background-color: #e56eee">当计数器值达到 0x40 时，此位由硬件置 1</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=B45VZKYD))
> 
> 🏷️ #📝/重点

^KEYB45VZKYD

> <span class="highlight" style="background-color: #e56eee">它必须通过软件写 0 来清除。对此位写 1 无效</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=J8XZWPAE))
> 
> 🏷️ #📝/重点

^KEYJ8XZWPAE

> <span class="highlight" style="background-color: #e56eee">即 使中断未被使能，在计数器的值达到 0x40 的时候，此位也会被置</span> ([p254](zotero://open-pdf/library/items/JFGTX7CT?page=254&annotation=DW95946R))
> 
> 🏷️ #📝/重点

^KEYDW95946R

> <span class="highlight" style="background-color: #f19837">19.2 硬件设计</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=RWHKJD37))
> 
> 🏷️ #📝/标题

^KEYRWHKJD37

> <span class="highlight" style="background-color: #f19837">19.3 程序设计</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=2ZRJWV2J))
> 
> 🏷️ #📝/标题

^KEY2ZRJWV2J

> <span class="highlight" style="background-color: #f19837">19.3.1 WWDG 的 HAL 库驱动</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=VE63JL44))
> 
> 🏷️ #📝/标题

^KEYVE63JL44

> <span class="highlight" style="background-color: #e56eee">HAL_WWDG_Init 函数</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=9TZEEPAI))
> 
> 🏷️ #📝/重点

^KEY9TZEEPAI

> <span class="highlight" style="background-color: #e56eee">形参 1 是 WWDG 句柄</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=CEBXC8AM))
> 
> 🏷️ #📝/重点

^KEYCEBXC8AM

> <span class="highlight" style="background-color: #e56eee">Instance：指向 WWDG 寄存器基地址</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=TURNXUSY))
> 
> 🏷️ #📝/重点

^KEYTURNXUSY

> <span class="highlight" style="background-color: #e56eee">Init：WWDG 初始化结构体</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=BVGANBXT))
> 
> 🏷️ #📝/重点

^KEYBVGANBXT

> <span class="highlight" style="background-color: #e56eee">Prescaler：预分频系数</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=FUBN5TMG))
> 
> 🏷️ #📝/重点

^KEYFUBN5TMG

> <span class="highlight" style="background-color: #e56eee">Window：窗口值，即上限值</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=UEQXFKW7))
> 
> 🏷️ #📝/重点

^KEYUEQXFKW7

> <span class="highlight" style="background-color: #e56eee">Counter：计数器值，用于保存要设置计数器的值</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=NRIYU9YD))
> 
> 🏷️ #📝/重点

^KEYNRIYU9YD

> <span class="highlight" style="background-color: #e56eee">EWIMode：提前唤醒中断使能</span> ([p255](zotero://open-pdf/library/items/JFGTX7CT?page=255&annotation=GZ2RJGIA))
> 
> 🏷️ #📝/重点

^KEYGZ2RJGIA

> <span class="highlight" style="background-color: #e56eee">HAL_WWDG_Refresh 函数</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=VTQJSBN4))
> 
> 🏷️ #📝/重点

^KEYVTQJSBN4

> <span class="highlight" style="background-color: #e56eee">往 CR 寄存器重写 Counte 这个预先保存的计数器值</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=YBHHTNKP))
> 
> 🏷️ #📝/重点

^KEYYBHHTNKP

> <span class="highlight" style="background-color: #e56eee">形参 1 是</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=G3QT77KQ))
> 
> 🏷️ #📝/重点

^KEYG3QT77KQ

> <span class="highlight" style="background-color: #e56eee">WWDG 句柄</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=4ECGSFGT))
> 
> 🏷️ #📝/重点

^KEY4ECGSFGT

> <span class="highlight" style="background-color: #e56eee">使能 WWDG 时钟</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=M9ERSFMG))
> 
> 🏷️ #📝/重点

^KEYM9ERSFMG

> <span class="highlight" style="background-color: #e56eee">而 WWDG 使用的是 PCLK1 的 时钟，需要先使能时钟</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=XFVBM3DX))
> 
> 🏷️ #📝/重点

^KEYXFVBM3DX

> <span class="highlight" style="background-color: #e56eee">设置窗口值，分频数和计数器初始值</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=LA8PJ8D4))
> 
> 🏷️ #📝/重点

^KEYLA8PJ8D4

> <span class="highlight" style="background-color: #e56eee">开启 WWDG</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=QGIZSL3N))
> 
> 🏷️ #📝/重点

^KEYQGIZSL3N

> <span class="highlight" style="background-color: #e56eee">使能中断通道并配置优先级</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=NK2H23K8))
> 
> 🏷️ #📝/重点

^KEYNK2H23K8

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_EnableIRQ 函数使能，通过 HAL_NVIC_SetPriority 函数设置优先级</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=3GH55YYC))
> 
> 🏷️ #📝/重点

^KEY3GH55YYC

> <span class="highlight" style="background-color: #e56eee">看门狗提供了 MSP 回调函数 HAL_WWDG_MspInit</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=JRNTYGVZ))
> 
> 🏷️ #📝/重点

^KEYJRNTYGVZ

> <span class="highlight" style="background-color: #e56eee">编写中断服务函数</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=CA9FGD36))
> 
> 🏷️ #📝/重点

^KEYCA9FGD36

> <span class="highlight" style="background-color: #e56eee">喂狗要快</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=K4YJRKCZ))
> 
> 🏷️ #📝/重点

^KEYK4YJRKCZ

> <span class="highlight" style="background-color: #e56eee">在中断服务函数里面也要将状态 寄存器的 EWIF 位清空</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=TG6Z9JC8))
> 
> 🏷️ #📝/重点

^KEYTG6Z9JC8

> <span class="highlight" style="background-color: #e56eee">重写</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=6FCTQMJY))
> 
> 🏷️ #📝/重点

^KEY6FCTQMJY

> <span class="highlight" style="background-color: #e56eee">回调函数</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=F83L2RVD))
> 
> 🏷️ #📝/重点

^KEYF83L2RVD

> <span class="highlight" style="background-color: #e56eee">中断处理共用函数 HAL_WWDG_IRQHandler</span> ([p256](zotero://open-pdf/library/items/JFGTX7CT?page=256&annotation=GQ7IKX56))
> 
> 🏷️ #📝/重点

^KEYGQ7IKX56

> <span class="highlight" style="background-color: #e56eee">用 HAL_WWDG_MspInit 函数来编写窗口看门狗中断的初始化代码</span> ([p257](zotero://open-pdf/library/items/JFGTX7CT?page=257&annotation=BSYTDHXZ))
> 
> 🏷️ #📝/重点

^KEYBSYTDHXZ

> <span class="highlight" style="background-color: #e56eee">HAL_WWDG_MspInit 函数会被 HAL_WWDG_Init 函数调用</span> ([p258](zotero://open-pdf/library/items/JFGTX7CT?page=258&annotation=RZFJTXU9))
> 
> 🏷️ #📝/重点

^KEYRZFJTXU9

> <span class="highlight" style="background-color: #e56eee">WWDG_IRQHandler 函数是窗口看门狗中断服务函</span> ([p258](zotero://open-pdf/library/items/JFGTX7CT?page=258&annotation=MGT99MSA))
> 
> 🏷️ #📝/重点

^KEYMGT99MSA

> <span class="highlight" style="background-color: #e56eee">调用 HAL 库 的中断处理函数 HAL_WWDG_IRQHandler</span> ([p258](zotero://open-pdf/library/items/JFGTX7CT?page=258&annotation=SX3CPWAM))
> 
> 🏷️ #📝/重点

^KEYSX3CPWAM

> <span class="highlight" style="background-color: #e56eee">回调函数</span> ([p258](zotero://open-pdf/library/items/JFGTX7CT?page=258&annotation=FXQDN5DQ))
> 
> 🏷️ #📝/重点

^KEYFXQDN5DQ

> <span class="highlight" style="background-color: #e56eee">可由前面的公式得到窗口上限时间 Twwdg=4096×8×（0x7F0x5F）/36MHz=29.12ms，窗口下限时间 Twwdg=4096×8×（0x7F-0x3F）/36MHz=58.25ms，即 喂狗的窗口区间为 29.12~58.25ms</span> ([p258](zotero://open-pdf/library/items/JFGTX7CT?page=258&annotation=9CD8VJPK))
> 
> 🏷️ #📝/重点

^KEY9CD8VJPK

> <span class="highlight" style="background-color: #f19837">第二十章 基本定时器实验</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=SCK96KH7))
> 
> 🏷️ #📝/标题

^KEYSCK96KH7

> <span class="highlight" style="background-color: #e56eee">2 个基本定时器（TIM6 和 TIM7）、4 个通用定时 器（TIM2~TIM5）、2 个高级控制定时器（TIM1 和 TIM8）</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=KZY2BSRL))
> 
> 🏷️ #📝/重点

^KEYKZY2BSRL

> <span class="highlight" style="background-color: #e56eee">定时器彼此完全独立，不共享 任何资源</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=XT2AQH2T))
> 
> 🏷️ #📝/重点

^KEYXT2AQH2T

> <span class="highlight" style="background-color: #f19837">20.1 基本定时器简介</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=NVLU5VXR))
> 
> 🏷️ #📝/标题

^KEYNVLU5VXR

> <span class="highlight" style="background-color: #e56eee">两个基本定时器 TIM6 和 TIM7</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=6QFHTRP7))
> 
> 🏷️ #📝/重点

^KEY6QFHTRP7

> <span class="highlight" style="background-color: #e56eee">功能完全相同，资源是完全独立的， 可以同时使用</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=KS6D5FF4))
> 
> 🏷️ #📝/重点

^KEYKS6D5FF4

> <span class="highlight" style="background-color: #e56eee">16 位自动重载递增计数器，16 位可编程预分频器，预分频系 数 1~65536，用于对计数器时钟频率进行分频，还可以触发 DAC 的同步电路，以及生成中断 /DMA 请求。</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=AV5BW2US))
> 
> 🏷️ #📝/重点

^KEYAV5BW2US

> <span class="highlight" style="background-color: #f19837">20.1.1 基本定时器框图</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=3TLVFQ3Q))
> 
> 🏷️ #📝/标题

^KEY3TLVFQ3Q

> <span class="highlight" style="background-color: #e56eee">定时器的核心就是计算器，要实现计数功能</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=6LD6UIHE))
> 
> 🏷️ #📝/重点

^KEY6LD6UIHE

> <span class="highlight" style="background-color: #e56eee">基本定时器时钟挂 载在 APB1 总线</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=KRC9FF4Q))
> 
> 🏷️ #📝/重点

^KEYKRC9FF4Q

> <span class="highlight" style="background-color: #e56eee">但是基本定时器时钟不是直接由 APB1 总 线直接提供，而是先经过一个倍频器</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=VVY3DQHR))
> 
> 🏷️ #📝/重点

^KEYVVY3DQHR

> <span class="highlight" style="background-color: #e56eee">当 APB1 的预分频器系数为 1 时，这个倍频器系数为 1， 即定时器的时钟频率等于 APB1 总线时钟频率；当 APB1 的预分频器系数≥2 分频时，这个倍 频 器 系 数 就 为 2 ， 即 定 时 器 的 时 钟 频 率 等 于 APB1 总 线 时 钟 频 率 的 两 倍</span> ([p259](zotero://open-pdf/library/items/JFGTX7CT?page=259&annotation=9N75W8HG))
> 
> 🏷️ #📝/重点

^KEY9N75W8HG

> <span class="highlight" style="background-color: #e56eee">已经设置 APB1 总线时钟频率为 36M，APB1 总线的预分频 器分频系数是 2，所以挂载在 APB1 总线的定时器时钟频率为 72Mhz</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=L9L29BRV))
> 
> 🏷️ #📝/重点

^KEYL9L29BRV

> <span class="highlight" style="background-color: #e56eee">控制器除了控制定时器复位、使能、计数等功能之外，还可以用于触发 DAC 转换</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=V2DV8UV9))
> 
> 🏷️ #📝/重点

^KEYV2DV8UV9

> <span class="highlight" style="background-color: #e56eee">计数器寄存器(TIMx_CNT)、预分频器寄存器(TIMx_PSC)、自动重载寄存器 (TIMx_ARR)</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=43RJRMX6))
> 
> 🏷️ #📝/重点

^KEY43RJRMX6

> <span class="highlight" style="background-color: #e56eee">16 位有效数字，即可设置值范围是 0~65535</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=VJW2IW8Z))
> 
> 🏷️ #📝/重点

^KEYVJW2IW8Z

> <span class="highlight" style="background-color: #e56eee">预分频器 PSC</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=CNAWEQUM))
> 
> 🏷️ #📝/重点

^KEYCNAWEQUM

> <span class="highlight" style="background-color: #e56eee">输入 CK_PSC 来源于控制器部分， 实际上就是来自于内部时钟（CK_INT），即 2 倍的 APB1 总线时钟频率（72MHz）</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=MCD9SDA5))
> 
> 🏷️ #📝/重点

^KEYMCD9SDA5

> <span class="highlight" style="background-color: #e56eee">输出 CK_CNT 是分频后的时钟，它是计数器实际的计数时钟</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=6F8TUP5Y))
> 
> 🏷️ #📝/重点

^KEY6F8TUP5Y

> <span class="highlight" style="background-color: #e56eee">CK_CNT</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=D9CN5HD4))
> 
> 🏷️ #📝/重点

^KEYD9CN5HD4

> <span class="highlight" style="background-color: #e56eee">fCK_CNT= fCK_PSC / (PSC[15:0]+1)</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=SHHLKLF8))
> 
> 🏷️ #📝/重点

^KEYSHHLKLF8

> <span class="highlight" style="background-color: #e56eee">预分频器寄存器(TIMx_PSC)可以在运行过程中修改它的数值</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=7IKCLCG5))
> 
> 🏷️ #📝/重点

^KEY7IKCLCG5

> <span class="highlight" style="background-color: #e56eee">新的预分频数值将在 下一个更新事件时起作用</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=VZ9Q6F6K))
> 
> 🏷️ #📝/重点

^KEYVZ9Q6F6K

> <span class="highlight" style="background-color: #e56eee">我们可以把预分频系数写入预分频器寄存器(TIMx_PSC)， 但是预分频器寄存器只是起到缓存数据的作用，只有等到更新事件发生时，预分频器寄存器的 值才会被自动写入其影子寄存器中，这时才真正起作用。</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=JFRD9LNE))
> 
> 🏷️ #📝/重点

^KEYJFRD9LNE

> <span class="highlight" style="background-color: #e56eee">不同点在于自动重载寄存器是否具有 缓冲作用还受到 ARPE 位的控制，当该位置 0 时，ARR 寄存器不进行缓冲，我们写入新的 ARR 值时，该值会马上被写入 ARR 影子寄存器中，从而直接生效；当该位置 1 时，ARR 寄存器进 行缓冲，我们写入新的 ARR 值时，该值不会马上被写入 ARR 影子寄存器中，而是要等到更新 事件发生才会被写入 ARR 影子寄存器，这时才生效</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=93SB2WBX))
> 
> 🏷️ #📝/重点

^KEY93SB2WBX

> <span class="highlight" style="background-color: #e56eee">更新事件的产生有两种情况，一是由软件产生，将 TIMx_EGR 寄存器的位 UG 置 1，产生更新事件后，硬件会自动将 UG 位清零。二是由硬件产生，满足以下条件即可： 计数器的值等于自动重装载寄存器影子寄存器的值。</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=SZ2Y5M9D))
> 
> 🏷️ #📝/重点

^KEYSZ2Y5M9D

> <span class="highlight" style="background-color: #e56eee">当寄存器（TIMx_CR1）的 CEN 位置 1，即使能定时器，每来一个 CK_CNT 脉冲，TIMx_CNT 的值就会递增加 1</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=B46BVRL9))
> 
> 🏷️ #📝/重点

^KEYB46BVRL9

> <span class="highlight" style="background-color: #e56eee">当 TIMx_CNT 值 与 TIMx_ARR 的设定值相等时，TIMx_CNT 的值就会被自动清零并且会生成更新事件</span>
> 
> 准确来说是和 TIMx_ARR 影子寄存器的值相等。
> 
> 注意：这一时刻会产生“更新事件” ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=B7QV5L28))
> 
> 🏷️ #📝/重点

^KEYB7QV5L28

> <span class="highlight" style="background-color: #e56eee">然后下一个 CK_CNT 脉冲到来，TIMx_CNT 的值就会递增加 1，如此循环</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=M3FZE6PY))
> 
> 🏷️ #📝/重点

^KEYM3FZE6PY

> <span class="highlight" style="background-color: #e56eee">TIMx_CNT 等于 TIMx_ARR 时，我们称之为定时器溢出，因为是递增计数，故而又称为定时器上溢</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=G8GJS52B))
> 
> 🏷️ #📝/重点

^KEYG8GJS52B

> <span class="highlight" style="background-color: #e56eee">定时器溢 出就伴随着更新事件的发生</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=GKZCCC8H))
> 
> 🏷️ #📝/重点

^KEYGKZCCC8H

> <span class="highlight" style="background-color: #e56eee">预分频寄存器和自动重载寄存器的值就可以控制定时器更新事 件发生的时间</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=L48BP48K))
> 
> 🏷️ #📝/重点

^KEYL48BP48K

> <span class="highlight" style="background-color: #e56eee">当计数器的 值等于自动重载寄存器的值时就会生成更新事件，硬件自动置位相关更新事件的标志位</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=GRAT33AR))
> 
> 🏷️ #📝/重点

^KEYGRAT33AR

> <span class="highlight" style="background-color: #e56eee">更新中断标志位</span>
> 
> 该位置 1 ，产生“更新中断” ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=HMJV23QK))
> 
> 🏷️ #📝/重点

^KEYHMJV23QK

> <span class="highlight" style="background-color: #e56eee">比如我们需要一个 500ms 周期的定时器更新中断</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=DK5LZK88))
> 
> 🏷️ #📝/重点

^KEYDK5LZK88

> <span class="highlight" style="background-color: #e56eee">写入预分频寄存器的值为 7199</span>
> 
> 因为是从 0 开始 ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=SLT5X9M3))
> 
> 🏷️ #📝/重点

^KEYSLT5X9M3

> <span class="highlight" style="background-color: #e56eee">设置自动重载寄存器的值 为 4999</span>
> 
> 同样也是从 0 开始 ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=ZGW9XLC3))
> 
> 🏷️ #📝/重点

^KEYZGW9XLC3

> <span class="highlight" style="background-color: #e56eee">更新中断使能位 UIE 置 1，CEN 位也要置 1</span> ([p260](zotero://open-pdf/library/items/JFGTX7CT?page=260&annotation=WWZ5TFT8))
> 
> 🏷️ #📝/重点

^KEYWWZ5TFT8

> <span class="highlight" style="background-color: #f19837">20.1.2 TIM6/TIM7 寄存器</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=GPFA3Z8F))
> 
> 🏷️ #📝/标题

^KEYGPFA3Z8F

> <span class="highlight" style="background-color: #e56eee">控制寄存器 1（TIMx_CR1）</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=5WN32DCN))
> 
> 🏷️ #📝/重点

^KEY5WN32DCN

> <span class="highlight" style="background-color: #e56eee">位 0（CEN）用于使能或者禁止计数器</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=SHCV9FYI))
> 
> 🏷️ #📝/重点

^KEYSHCV9FYI

> <span class="highlight" style="background-color: #e56eee">还有位 7（APRE）用于控制自动重载寄存器 ARR 是否具有缓冲作用</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=VN57TH84))
> 
> 🏷️ #📝/重点

^KEYVN57TH84

> <span class="highlight" style="background-color: #e56eee">DMA/中断使能寄存器（TIMx_DIER）</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=N2S5G9UG))
> 
> 🏷️ #📝/重点

^KEYN2S5G9UG

> <span class="highlight" style="background-color: #e56eee">该寄存器位 0（UIE）用于使能或者禁止更新中断</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=S9EQ54FJ))
> 
> 🏷️ #📝/重点

^KEYS9EQ54FJ

> <span class="highlight" style="background-color: #e56eee">位 8（UDE）用于使能或者禁止更新 DMA 请求</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=SJP9BMKN))
> 
> 🏷️ #📝/重点

^KEYSJP9BMKN

> <span class="highlight" style="background-color: #e56eee">状态寄存器（TIMx_SR）</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=6KNDJX2Y))
> 
> 🏷️ #📝/重点

^KEY6KNDJX2Y

> <span class="highlight" style="background-color: #e56eee">该寄存器位 0（UIF）是中断更新的标志位</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=T6TCQTC5))
> 
> 🏷️ #📝/重点

^KEYT6TCQTC5

> <span class="highlight" style="background-color: #e56eee">当发生中断时由硬件置 1，然后就会执行中断 服务函数，需要软件去清零</span> ([p261](zotero://open-pdf/library/items/JFGTX7CT?page=261&annotation=2F7D6AU5))
> 
> 🏷️ #📝/重点

^KEY2F7D6AU5

> <span class="highlight" style="background-color: #e56eee">不把该位清零，那么系统就会一直进入中断服务函数</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=43SJH2CT))
> 
> 🏷️ #📝/重点

^KEY43SJH2CT

> <span class="highlight" style="background-color: #e56eee">计数器寄存器（TIMx_CNT）</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=KFI69SGW))
> 
> 🏷️ #📝/重点

^KEYKFI69SGW

> <span class="highlight" style="background-color: #e56eee">位[15:0]就是计数器的实时的计数</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=PWEU75TW))
> 
> 🏷️ #📝/重点

^KEYPWEU75TW

> <span class="highlight" style="background-color: #e56eee">预分频寄存器（TIMx_PSC）</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=8W2PVIPI))
> 
> 🏷️ #📝/重点

^KEY8W2PVIPI

> <span class="highlight" style="background-color: #e56eee">写入的数值范围是 0 到 65535，分频系数范围：1 到 65536</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=CVEIE8TW))
> 
> 🏷️ #📝/重点

^KEYCVEIE8TW

> <span class="highlight" style="background-color: #e56eee">自动重载寄存器（TIMx_ARR）</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=S3T3F4US))
> 
> 🏷️ #📝/重点

^KEYS3T3F4US

> <span class="highlight" style="background-color: #e56eee">由 APRE 位设置是否进行缓冲</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=DGJB7W2W))
> 
> 🏷️ #📝/重点

^KEYDGJB7W2W

> <span class="highlight" style="background-color: #e56eee">计数器的值会和 ARR 寄存器影子寄存器进 行比较</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=MJ73WIQL))
> 
> 🏷️ #📝/重点

^KEYMJ73WIQL

> <span class="highlight" style="background-color: #f19837">20.1.3 基本定时器中断应用</span> ([p262](zotero://open-pdf/library/items/JFGTX7CT?page=262&annotation=WWJVV5MH))
> 
> 🏷️ #📝/标题

^KEYWWJVV5MH

> <span class="highlight" style="background-color: #f19837">20.2 硬件设计</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=25GEHVGN))
> 
> 🏷️ #📝/标题

^KEY25GEHVGN

> <span class="highlight" style="background-color: #f19837">20.3 程序设计</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=FZETITB7))
> 
> 🏷️ #📝/标题

^KEYFZETITB7

> <span class="highlight" style="background-color: #f19837">20.3.1 定时器的 HAL 库驱动</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=6PPSJHCU))
> 
> 🏷️ #📝/标题

^KEY6PPSJHCU

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_Base_Init 函数</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=67IWQ4UE))
> 
> 🏷️ #📝/重点

^KEY67IWQ4UE

> <span class="highlight" style="background-color: #e56eee">形参 1 是 TIM_HandleTypeDef 结构体类型指针变量（亦称定时器句柄）</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=PATR2AP9))
> 
> 🏷️ #📝/重点

^KEYPATR2AP9

> <span class="highlight" style="background-color: #e56eee">Instance：指向定时器寄存器基地址</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=546L82AJ))
> 
> 🏷️ #📝/重点

^KEY546L82AJ

> <span class="highlight" style="background-color: #e56eee">Init：定时器初始化结构体</span> ([p263](zotero://open-pdf/library/items/JFGTX7CT?page=263&annotation=3Q4DQCJJ))
> 
> 🏷️ #📝/重点

^KEY3Q4DQCJJ

> <span class="highlight" style="background-color: #e56eee">Prescaler：预分频系数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=E46GA6N9))
> 
> 🏷️ #📝/重点

^KEYE46GA6N9

> <span class="highlight" style="background-color: #e56eee">CounterMode：计数器计数模式</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=FF5QXPQE))
> 
> 🏷️ #📝/重点

^KEYFF5QXPQE

> <span class="highlight" style="background-color: #e56eee">基本定时器只能向上计数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=23JLSP9P))
> 
> 🏷️ #📝/重点

^KEY23JLSP9P

> <span class="highlight" style="background-color: #e56eee">Period：自动重载值</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=8QBRUWEB))
> 
> 🏷️ #📝/重点

^KEY8QBRUWEB

> <span class="highlight" style="background-color: #e56eee">ClockDivision：时钟分频因子</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=9UQPA8NG))
> 
> 🏷️ #📝/重点

^KEY9UQPA8NG

> <span class="highlight" style="background-color: #e56eee">基本定时器没有此功能</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=XH69PP3G))
> 
> 🏷️ #📝/重点

^KEYXH69PP3G

> <span class="highlight" style="background-color: #e56eee">AutoReloadPreload：自动重载预装载使能</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=3GS5XC67))
> 
> 🏷️ #📝/重点

^KEY3GS5XC67

> <span class="highlight" style="background-color: #e56eee">ARPE 位</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=6QZMK9E6))
> 
> 🏷️ #📝/重点

^KEY6QZMK9E6

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_Base_Start_IT 函数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=M24D4IAJ))
> 
> 🏷️ #📝/重点

^KEYM24D4IAJ

> <span class="highlight" style="background-color: #e56eee">更新定时器中断和使能定时器的函数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=SUYMNXUL))
> 
> 🏷️ #📝/重点

^KEYSUYMNXUL

> <span class="highlight" style="background-color: #e56eee">调用了__HAL_TIM_ENABLE_IT 和__HAL_TIM_ENABLE 两个函数宏定义</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=IV6JQNZ3))
> 
> 🏷️ #📝/重点

^KEYIV6JQNZ3

> <span class="highlight" style="background-color: #e56eee">更新定时器中断和使能定时器的宏定义</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=7HUVZB4C))
> 
> 🏷️ #📝/重点

^KEY7HUVZB4C

> <span class="highlight" style="background-color: #e56eee">定时器中断配置步骤</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=IJMPMFGY))
> 
> 🏷️ #📝/重点

^KEYIJMPMFGY

> <span class="highlight" style="background-color: #e56eee">开启定时器时钟</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=QU5RU24Q))
> 
> 🏷️ #📝/重点

^KEYQU5RU24Q

> <span class="highlight" style="background-color: #e56eee">通过宏定义标识符</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=7397F2S4))
> 
> 🏷️ #📝/重点

^KEY7397F2S4

> <span class="highlight" style="background-color: #e56eee">__HAL_RCC_TIMx_CLK_ENABLE();</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=D68SF9X3))
> 
> 🏷️ #📝/重点

^KEYD68SF9X3

> <span class="highlight" style="background-color: #e56eee">初始化定时器参数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=ZZX7SJ2G))
> 
> 🏷️ #📝/重点

^KEYZZX7SJ2G

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_Base_Init</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=NPLZWE6Y))
> 
> 🏷️ #📝/重点

^KEYNPLZWE6Y

> <span class="highlight" style="background-color: #e56eee">通过 HAL_TIM_Base_Start_IT 函数使能定时器更新中断和开启定时器计数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=LFBPLBDJ))
> 
> 🏷️ #📝/重点

^KEYLFBPLBDJ

> <span class="highlight" style="background-color: #e56eee">通过 HAL_NVIC_EnableIRQ 函数使能定时器中断，通过 HAL_NVIC_SetPriority 函数设置 中断优先级。</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=CS8JCFQ2))
> 
> 🏷️ #📝/重点

^KEYCS8JCFQ2

> <span class="highlight" style="background-color: #e56eee">定时器中断服务函数为：TIMx_IRQHandler</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=5BFB69HK))
> 
> 🏷️ #📝/重点

^KEY5BFB69HK

> <span class="highlight" style="background-color: #e56eee">定时器中断公共处理函数 HAL_TIM_IRQHandler</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=8K8ZGAN4))
> 
> 🏷️ #📝/重点

^KEY8K8ZGAN4

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PeriodElapsedCallback 等一些回调函数</span> ([p264](zotero://open-pdf/library/items/JFGTX7CT?page=264&annotation=H9NA7YED))
> 
> 🏷️ #📝/重点

^KEYH9NA7YED

> <span class="highlight" style="background-color: #f19837">20.3.3 程序解析</span> ([p265](zotero://open-pdf/library/items/JFGTX7CT?page=265&annotation=4D76G9IH))
> 
> 🏷️ #📝/标题

^KEY4D76G9IH

> <span class="highlight" style="background-color: #e56eee">Tout= ((arr+1)*(psc+1))/Tclk</span> ([p266](zotero://open-pdf/library/items/JFGTX7CT?page=266&annotation=R6CR37GT))
> 
> 🏷️ #📝/重点

^KEYR6CR37GT

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_Base_MspInit 函数用于存放 GPIO、NVIC 和时钟相关的代码</span>
> 
> 用于底层初始化 ([p266](zotero://open-pdf/library/items/JFGTX7CT?page=266&annotation=486HRIVU))
> 
> 🏷️ #📝/重点

^KEY486HRIVU

> <span class="highlight" style="background-color: #e56eee">更新中断回调函数是所有定时器公用的</span> ([p267](zotero://open-pdf/library/items/JFGTX7CT?page=267&annotation=8YG9XTSJ))
> 
> 🏷️ #📝/重点

^KEY8YG9XTSJ

> <span class="highlight" style="background-color: #e56eee">就需要在更新中断回调函数中对定时器 寄存器基地址进行判断</span> ([p267](zotero://open-pdf/library/items/JFGTX7CT?page=267&annotation=ETV39DMG))
> 
> 🏷️ #📝/重点

^KEYETV39DMG

> <span class="highlight" style="background-color: #f19837">第二十一章 通用定时器实验</span> ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=MKK9R5HH))
> 
> 🏷️ #📝/标题

^KEYMKK9R5HH

> <span class="highlight" style="background-color: #e56eee">有 4 个通用 定时器（TIM2~TIM5）</span> ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=BQ8XVSAT))
> 
> 🏷️ #📝/重点

^KEYBQ8XVSAT

> <span class="highlight" style="background-color: #e56eee">通用定时器中断实验、通用定时器 PWM 输出实验、通用 定时器输入捕获实验和通用定时器脉冲计数实验</span> ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=QDP9DV4J))
> 
> 🏷️ #📝/重点

^KEYQDP9DV4J

> <span class="highlight" style="background-color: #e56eee">21.4 通用定时器输入捕获实验 21.5 通用定时器脉冲计数实验</span> ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=DZE9QAGK))
> 
> 🏷️ #📝/重点

^KEYDZE9QAGK

> <span class="highlight" style="background-color: #f19837">21.1 通用定时器简介</span> ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=9KZYJZFE))
> 
> 🏷️ #📝/标题

^KEY9KZYJZFE

> <span class="image#e56eee">null</span>定时器基本特性 ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=FW7A65NN))

^KEYFW7A65NN

> <span class="highlight" style="background-color: #e56eee">在基本定时器的基础上，添加了一些其他功</span> ([p268](zotero://open-pdf/library/items/JFGTX7CT?page=268&annotation=P65WVESH))
> 
> 🏷️ #📝/重点

^KEYP65WVESH

> <span class="highlight" style="background-color: #e56eee">通用定时器时钟可以选择下面四类时钟源之一</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=JDUQHQKM))
> 
> 🏷️ #📝/重点

^KEYJDUQHQKM

> <span class="highlight" style="background-color: #e56eee">内部时钟(CK_INT)</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=HAESQ2AU))
> 
> 🏷️ #📝/重点

^KEYHAESQ2AU

> <span class="highlight" style="background-color: #e56eee">外部时钟模式 1</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=B8B8B3PR))
> 
> 🏷️ #📝/重点

^KEYB8B8B3PR

> <span class="highlight" style="background-color: #e56eee">即只能来自于通道 1 或者通道 2</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=NWMCTSBP))
> 
> 🏷️ #📝/重点

^KEYNWMCTSBP

> <span class="highlight" style="background-color: #e56eee">外部时钟模式 2</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=YRVLLBDM))
> 
> 🏷️ #📝/重点

^KEYYRVLLBDM

> <span class="highlight" style="background-color: #e56eee">内部触发输入(ITRx)</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=69V7W4DN))
> 
> 🏷️ #📝/重点

^KEY69V7W4DN

> <span class="highlight" style="background-color: #e56eee">通用定时器时钟源设置方法</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=DJM7PUYG))
> 
> 🏷️ #📝/重点

^KEYDJM7PUYG

> <span class="highlight" style="background-color: #e56eee">内部时钟（CK_INT）</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=CPAA6EWW))
> 
> 🏷️ #📝/重点

^KEYCPAA6EWW

> <span class="highlight" style="background-color: #e56eee">挂载在 APB1 总线上</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=FW8AJNPS))
> 
> 🏷️ #📝/重点

^KEYFW8AJNPS

> <span class="highlight" style="background-color: #e56eee">，这 些定时器的内部时钟(CK_INT)实际上来自于 APB1 总线提供的时钟</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=3TPX8AWY))
> 
> 🏷️ #📝/重点

^KEY3TPX8AWY

> <span class="highlight" style="background-color: #e56eee">这些定时器时钟源频率为 72MHz</span> ([p269](zotero://open-pdf/library/items/JFGTX7CT?page=269&annotation=XAKNNXQV))
> 
> 🏷️ #📝/重点

^KEYXAKNNXQV

> <span class="highlight" style="background-color: #e56eee">高级定时器 TIM1 和 TIM8 是挂载在 APB2 总线上的</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=3S9ZXFJN))
> 
> 🏷️ #📝/重点

^KEY3S9ZXFJN

> <span class="highlight" style="background-color: #e56eee">TIM1 和 TIM8 时钟源频率为 72MHz</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=QE7BXH3Z))
> 
> 🏷️ #📝/重点

^KEYQE7BXH3Z

> <span class="highlight" style="background-color: #e56eee">外部时钟模式 1</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=M2CUZYN7))
> 
> 🏷️ #📝/重点

^KEYM2CUZYN7

> <span class="highlight" style="background-color: #e56eee">时钟信号来自芯片外部</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=AVWVSKEK))
> 
> 🏷️ #📝/重点

^KEYAVWVSKEK

> <span class="highlight" style="background-color: #e56eee">时钟源进入定时器的流程 如下：外部时钟源信号→IO→TIMx_CH1（或者 TIMx_CH2）</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=QF7AU3KS))
> 
> 🏷️ #📝/重点

^KEYQF7AU3KS

> <span class="highlight" style="background-color: #e56eee">外部时钟模 式 1 下，时钟源信号只能从 CH1 或者 CH2 输入到定时器，CH3 和 CH4 都是不可以的</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=SHK6CRTS))
> 
> 🏷️ #📝/重点

^KEYSHK6CRTS

> <span class="highlight" style="background-color: #e56eee">从 IO 到 TIMx_CH1（或者 TIMx_CH2），就需要我们配置 IO 的复用功能</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=ABERRXNJ))
> 
> 🏷️ #📝/重点

^KEYABERRXNJ

> <span class="image#e56eee">null</span>外部时钟模式 1 框图 ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=5ECCVYCZ))

^KEY5ECCVYCZ

> <span class="highlight" style="background-color: #e56eee">时 钟源信号用 TI2 表示</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=TAMQEK57))
> 
> 🏷️ #📝/重点

^KEYTAMQEK57

> <span class="highlight" style="background-color: #e56eee">滤波器</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=TY3U8LA5))
> 
> 🏷️ #📝/重点

^KEYTY3U8LA5

> <span class="highlight" style="background-color: #e56eee">ICF[3:0]位来设置滤波方式</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=J54C9QYV))
> 
> 🏷️ #📝/重点

^KEYJ54C9QYV

> <span class="highlight" style="background-color: #e56eee">边沿检测器</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=BSLBDSRQ))
> 
> 🏷️ #📝/重点

^KEYBSLBDSRQ

> <span class="highlight" style="background-color: #e56eee">由 CC2P 位来设置检测的边沿，可以上升沿或者下降沿检测</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=RELVSBT3))
> 
> 🏷️ #📝/重点

^KEYRELVSBT3

> <span class="highlight" style="background-color: #e56eee">触发输入选择器</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=E2UFJIBI))
> 
> 🏷️ #📝/重点

^KEYE2UFJIBI

> <span class="highlight" style="background-color: #e56eee">TS[4:0]位来选择 TRGI（触发输入信号）的来源</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=N2VZZTTL))
> 
> 🏷️ #📝/重点

^KEYN2VZZTTL

> <span class="highlight" style="background-color: #e56eee">TI1F_ED、TI1FP1 和 TI2FP2 三个触发输入信号</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=KDQ4A78V))
> 
> 🏷️ #📝/重点

^KEYKDQ4A78V

> <span class="highlight" style="background-color: #e56eee">TI1F_ED 表示来 自于 CH1，并且没有经过边沿检测器过滤的信号</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=BGBXTDI4))
> 
> 🏷️ #📝/重点

^KEYBGBXTDI4

> <span class="highlight" style="background-color: #e56eee">双边沿信号，即上升沿或者 下降沿都是有效的</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=4JGCMZ54))
> 
> 🏷️ #📝/重点

^KEY4JGCMZ54

> <span class="highlight" style="background-color: #e56eee">TI1FP1 表示来自 CH1 并经过边沿检测器后的信号，可以是上升沿或者下 降沿</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=4I2S39QU))
> 
> 🏷️ #📝/重点

^KEY4I2S39QU

> <span class="highlight" style="background-color: #e56eee">TI2FP2 表示来自 CH2 并经过边沿检测器后的信号，可以是上升沿或者下降沿。</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=8VSKZHI2))
> 
> 🏷️ #📝/重点

^KEY8VSKZHI2

> <span class="highlight" style="background-color: #e56eee">CH2 为例，那只能选择 TI2FP2</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=4JDLNRS4))
> 
> 🏷️ #📝/重点

^KEY4JDLNRS4

> <span class="highlight" style="background-color: #e56eee">是 CH1 为例，那就可以选择 TI1F_ED 或者 TI1FP1</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=8R2PZEF6))
> 
> 🏷️ #📝/重点

^KEY8R2PZEF6

> <span class="highlight" style="background-color: #e56eee">从模式选择器</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=E2RJQ25B))
> 
> 🏷️ #📝/重点

^KEYE2RJQ25B

> <span class="highlight" style="background-color: #e56eee">CK_PSC 需要经过定时器的预分 频器分频后，最终就能到达计数器进行计数了</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=TQYNDSQK))
> 
> 🏷️ #📝/重点

^KEYTQYNDSQK

> <span class="highlight" style="background-color: #e56eee">外部时钟模式 2（ETR）</span> ([p270](zotero://open-pdf/library/items/JFGTX7CT?page=270&annotation=YWW3TPLF))
> 
> 🏷️ #📝/重点

^KEYYWW3TPLF

> <span class="highlight" style="background-color: #e56eee">内部触发输入（ITRx）</span> ([p271](zotero://open-pdf/library/items/JFGTX7CT?page=271&annotation=GH7ARISU))
> 
> 🏷️ #📝/重点

^KEYGH7ARISU

> <span class="highlight" style="background-color: #e56eee">使用一个定时器作为另一个定时器的预分频器，即实现定时器的级联</span> ([p271](zotero://open-pdf/library/items/JFGTX7CT?page=271&annotation=JP3RKP4C))
> 
> 🏷️ #📝/重点

^KEYJP3RKP4C

> <span class="highlight" style="background-color: #e56eee">最常用的还是内部时钟</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=KPJTL6VJ))
> 
> 🏷️ #📝/重点

^KEYKPJTL6VJ

> <span class="highlight" style="background-color: #e56eee">从模式控制器、编码器接口和触发控制器（TRGO）</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=CZDVNJ9N))
> 
> 🏷️ #📝/重点

^KEYCZDVNJ9N

> <span class="highlight" style="background-color: #e56eee">从模式控制器可以控制 计数器复位、启动、递增/递减、计数</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=T9D5BL5E))
> 
> 🏷️ #📝/重点

^KEYT9D5BL5E

> <span class="highlight" style="background-color: #e56eee">编码器接口针对编码器计数</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=W2EFP6PZ))
> 
> 🏷️ #📝/重点

^KEYW2EFP6PZ

> <span class="highlight" style="background-color: #e56eee">触发控制器用来提供触发 信号给别的外设</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=58RF6GPW))
> 
> 🏷️ #📝/重点

^KEY58RF6GPW

> <span class="highlight" style="background-color: #e56eee">计数器寄存器(TIMx_CNT)、预分频器寄存器(TIMx_PSC)、自动重载寄存器 (TIMx_ARR)</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=3DMACZCL))
> 
> 🏷️ #📝/重点

^KEY3DMACZCL

> <span class="highlight" style="background-color: #e56eee">通用定时器的计数模式有三种：递增计数模式、递减计数模式和中心对齐模式</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=8KF2NT8C))
> 
> 🏷️ #📝/重点

^KEY8KF2NT8C

> <span class="highlight" style="background-color: #e56eee">TIM2 和 TIM5 的计数器是 32 位的</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=A28CRF23))
> 
> 🏷️ #📝/重点

^KEYA28CRF23

> <span class="highlight" style="background-color: #e56eee">由于是递减计数，故而称为定时器下溢</span>
> 
> 递减计数和递增计数原理一样 ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=NSLY78A6))
> 
> 🏷️ #📝/重点

^KEYNSLY78A6

> <span class="highlight" style="background-color: #e56eee">中心对齐模式</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=SNG2G88Z))
> 
> 🏷️ #📝/重点

^KEYSNG2G88Z

> <span class="highlight" style="background-color: #e56eee">计数器先从 0 开始递增计数， 直到计数器的值等于自动重载寄存器影子寄存器的值减 1 时，定时器上溢，同时生成更新事件， 然后从自动重载寄存器影子寄存器的值开始递减计算，直到计数值等于 1 时，定时器下溢，同 时生成更新事件，然后又从 0 开始递增计数，依此循环。</span>
> 
> 中心对齐模式 ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=TXJGHIRS))
> 
> 🏷️ #📝/重点

^KEYTXJGHIRS

> <span class="highlight" style="background-color: #e56eee">计数模式的设置请参考 TIMx_CR1 寄存器的位 CMS 和位 DIR</span> ([p272](zotero://open-pdf/library/items/JFGTX7CT?page=272&annotation=RLNGRGM3))
> 
> 🏷️ #📝/重点

^KEYRLNGRGM3

> <span class="highlight" style="background-color: #e56eee">我们还可以通过 UG 位产生软件更新事件</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=H6S94AE2))
> 
> 🏷️ #📝/重点

^KEYH6S94AE2

> <span class="highlight" style="background-color: #e56eee">TIMx_CH1~ TIMx_CH4 表示定时器的 4 个通道</span>
> 
> 外部时钟模式 1 下，外部时钟源通过 CH1 和 CH2 进入定时器 ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=49UFJT8K))
> 
> 🏷️ #📝/重点

^KEY49UFJT8K

> <span class="highlight" style="background-color: #e56eee">IO 端口通 过复用功能与这些通道相连</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=9GM4UC4J))
> 
> 🏷️ #📝/重点

^KEY9GM4UC4J

> <span class="highlight" style="background-color: #e56eee">将需要测量的信号输入到相应的 IO 端口</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=H8RWDBHD))
> 
> 🏷️ #📝/重点

^KEYH8RWDBHD

> <span class="highlight" style="background-color: #e56eee">输入捕获部分可以对输入的信号的上升沿，下降沿或者双边沿进行捕获</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=RH3E6GLW))
> 
> 🏷️ #📝/重点

^KEYRH3E6GLW

> <span class="highlight" style="background-color: #e56eee">常见的测量 有：测量输入信号的脉冲宽度、测量 PWM 输入信号的频率和占空比等</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=7S8VG7VN))
> 
> 🏷️ #📝/重点

^KEY7S8VG7VN

> <span class="highlight" style="background-color: #e56eee">测量高电平脉冲宽度的工作原理</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=N32MEJ2J))
> 
> 🏷️ #📝/重点

^KEYN32MEJ2J

> <span class="highlight" style="background-color: #e56eee">先要设置输入捕 获的边沿检测极性</span>
> 
> 从这可以知道，所谓的“捕获”即当检测到输入信号满足相应的特性时，就将此时计数器的值保存起来。 ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=T3V9UPEJ))
> 
> 🏷️ #📝/重点

^KEYT3V9UPEJ

> <span class="highlight" style="background-color: #e56eee">我们设置上升沿检测，那么当检测到上升沿时，定时器会把计数器 CNT 的值锁存到相应的捕获/比较寄存器 TIMx_CCRy 里，y=1~4</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=7A9Q7B9M))
> 
> 🏷️ #📝/重点

^KEY7A9Q7B9M

> <span class="highlight" style="background-color: #e56eee">然后我们再设置边沿检测为下降 沿检测，当检测到下降沿时，定时器会把计数器 CNT 的值再次锁存到相应的捕获/比较寄存器 TIMx_CCRy</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=MPWUHY5B))
> 
> 🏷️ #📝/重点

^KEYMPWUHY5B

> <span class="highlight" style="background-color: #e56eee">最后，我们将前后两次锁存的 CNT 的值相减，就可以算出高电平脉冲期间内 计数器的计数个数，再根据定时器的计数频率就可以计算出这个高电平脉冲的时间</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=NEYK9HDQ))
> 
> 🏷️ #📝/重点

^KEYNEYK9HDQ

> <span class="highlight" style="background-color: #e56eee">如果要测 量的高电平脉宽时间长度超过定时器的溢出时间周期，就会发生溢出，这时候我们还需要做定 时器溢出的额外处理</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=F3RAM48H))
> 
> 🏷️ #📝/重点

^KEYF3RAM48H

> <span class="highlight" style="background-color: #e56eee">通道 1 输入捕获为例</span>
> 
> 要和外部时钟模式 1 区分开来，两者的原理框图比较相像。 ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=ZER5Z9QC))
> 
> 🏷️ #📝/重点

^KEYZER5Z9QC

> <span class="highlight" style="background-color: #e56eee">滤波器</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=4L99XT4Q))
> 
> 🏷️ #📝/重点

^KEY4L99XT4Q

> <span class="highlight" style="background-color: #e56eee">边沿检测器</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=LAVCMEKE))
> 
> 🏷️ #📝/重点

^KEYLAVCMEKE

> <span class="highlight" style="background-color: #e56eee">可以上升沿或者下降沿检测</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=T2AQCVEB))
> 
> 🏷️ #📝/重点

^KEYT2AQCVEB

> <span class="highlight" style="background-color: #e56eee">输入捕获映射选择器</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=PJLC2ZXH))
> 
> 🏷️ #📝/重点

^KEYPJLC2ZXH

> <span class="highlight" style="background-color: #e56eee">IC1 映射到 TI1、TI2 还是 TRC</span>
> 
> 选择需要捕获的输入来源 ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=WW3SKBRY))
> 
> 🏷️ #📝/重点

^KEYWW3SKBRY

> <span class="highlight" style="background-color: #e56eee">输入捕获 1 预分频器</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=VM8D6SQJ))
> 
> 🏷️ #📝/重点

^KEYVM8D6SQJ

> <span class="highlight" style="background-color: #e56eee">把 CC1E 位置 1，使能输入捕获，IC1PS 就是分频后的捕获信号</span> ([p273](zotero://open-pdf/library/items/JFGTX7CT?page=273&annotation=FUFCLMSJ))
> 
> 🏷️ #📝/重点

^KEYFUFCLMSJ

> <span class="highlight" style="background-color: #e56eee">左边没有阴影部分就是输入捕获功能部分了</span> ([p274](zotero://open-pdf/library/items/JFGTX7CT?page=274&annotation=2RMA4MNC))
> 
> 🏷️ #📝/重点

^KEY2RMA4MNC

> <span class="highlight" style="background-color: #e56eee">捕获/比较预装载寄存器</span> ([p274](zotero://open-pdf/library/items/JFGTX7CT?page=274&annotation=S9RCLN44))
> 
> 🏷️ #📝/重点

^KEYS9RCLN44

> <span class="highlight" style="background-color: #e56eee">以通道 1 为例，那么它就是 CCR1 寄存器，通道 2、 通道 3、通道 4 就分别对应 CCR2、CCR3、CCR4。</span>
> 
> 捕获/比较寄存器 ([p274](zotero://open-pdf/library/items/JFGTX7CT?page=274&annotation=NY6ZZRGP))
> 
> 🏷️ #📝/重点

^KEYNY6ZZRGP

> <span class="highlight" style="background-color: #e56eee">那么程序员就可以读取 CCR1 寄 存器，得到计数器的计数值</span> ([p274](zotero://open-pdf/library/items/JFGTX7CT?page=274&annotation=W9RU3GQG))
> 
> 🏷️ #📝/重点

^KEYW9RU3GQG

> <span class="highlight" style="background-color: #e56eee">右边没有 阴影部分就是输出比较功能部分了</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=UZBI9VU6))
> 
> 🏷️ #📝/重点

^KEYUZBI9VU6

> <span class="highlight" style="background-color: #e56eee">以通道 1 输出比较功能为例</span>
> 
> 输入捕获和输出比较是两个不相干的功能。
> 
> 输出比较功能：以通道 1 输出比较功能为例，比较计数器的值和 CCR1 的影子寄存器的值，根据比较结果输出相应的电平信号。 ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=78VUXN2R))
> 
> 🏷️ #📝/重点

^KEY78VUXN2R

> <span class="highlight" style="background-color: #e56eee">首先程序员写 CCR1 寄存器，即写入比较值。这个比较值需要转移到对应的捕获/比较影子 寄存器后才会真正生效</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=PEGCV6Y2))
> 
> 🏷️ #📝/重点

^KEYPEGCV6Y2

> <span class="highlight" style="background-color: #e56eee">当 CCR1 寄存器的值转移到其影子寄存器后，新的值就会和计数器的值进行比较，它们的 比较结果将会通过第⑥部分影响定时器的输出</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=9E9EP93U))
> 
> 🏷️ #📝/重点

^KEY9E9EP93U

> <span class="highlight" style="background-color: #e56eee">oc1ref 是输出参考信号，高电平有效，为高电平时称之为有效电平，为低电平时称之为无 效电平。</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=CTYYBLSD))
> 
> 🏷️ #📝/重点

^KEYCTYYBLSD

> <span class="highlight" style="background-color: #e56eee">一般来说，当计数器的值和捕获/比较寄存器的值相等时，输出参考信号 oc1ref 的极性就会 根据我们选择的输出比较模式而改变。如果开启了比较中断，还会发生比较中断</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=72JAQDQQ))
> 
> 🏷️ #📝/重点

^KEY72JAQDQQ

> <span class="highlight" style="background-color: #f19837">21.2 通用定时器中断实验</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=LTVXSWG7))
> 
> 🏷️ #📝/标题

^KEYLTVXSWG7

> <span class="highlight" style="background-color: #f19837">21.2.1 TIM2/TIM3/TIM4/TIM5 寄存器</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=WK67YY3H))
> 
> 🏷️ #📝/标题

^KEYWK67YY3H

> <span class="highlight" style="background-color: #e56eee">控制寄存器 1（TIMx_CR1）</span> ([p275](zotero://open-pdf/library/items/JFGTX7CT?page=275&annotation=LZN6UT5W))
> 
> 🏷️ #📝/重点

^KEYLZN6UT5W

> <span class="highlight" style="background-color: #e56eee">位 7（APRE）用于控制自动重载寄存 器是否进行缓冲</span> ([p276](zotero://open-pdf/library/items/JFGTX7CT?page=276&annotation=WH7HSG6Y))
> 
> 🏷️ #📝/重点

^KEYWH7HSG6Y

> <span class="highlight" style="background-color: #e56eee">CMS[1:0]位，用于设置边沿对齐模式还是中心对齐模式</span>
> 
> “边沿对齐模式”包括递增计数模式和递减计数模式 ([p276](zotero://open-pdf/library/items/JFGTX7CT?page=276&annotation=SU3V267E))
> 
> 🏷️ #📝/重点

^KEYSU3V267E

> <span class="highlight" style="background-color: #e56eee">DIR 位，用于控制定时器的计数方向</span> ([p276](zotero://open-pdf/library/items/JFGTX7CT?page=276&annotation=FK4Z9ER9))
> 
> 🏷️ #📝/重点

^KEYFK4Z9ER9

> <span class="highlight" style="background-color: #e56eee">CEN 位，用于使能计数器的工作</span> ([p276](zotero://open-pdf/library/items/JFGTX7CT?page=276&annotation=5YE8UL38))
> 
> 🏷️ #📝/重点

^KEY5YE8UL38

> <span class="highlight" style="background-color: #e56eee">从模式控制寄存器（TIMx_SMCR）</span> ([p276](zotero://open-pdf/library/items/JFGTX7CT?page=276&annotation=G82FKXQQ))
> 
> 🏷️ #📝/重点

^KEYG82FKXQQ

> <span class="highlight" style="background-color: #e56eee">SMS[2:0]位，用于从模式选择</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=NZ4UPTM7))
> 
> 🏷️ #📝/重点

^KEYNZ4UPTM7

> <span class="highlight" style="background-color: #e56eee">其实就是选择计数器输入时钟的来源</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=4I6YVQEI))
> 
> 🏷️ #📝/重点

^KEY4I6YVQEI

> <span class="highlight" style="background-color: #e56eee">DMA/中断使能寄存器（TIMx_DIER）</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=L8BP69AH))
> 
> 🏷️ #📝/重点

^KEYL8BP69AH

> <span class="highlight" style="background-color: #e56eee">用于使能/失能触发 DMA 请求、捕获/比较中断以及更新中断</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=HCKNSLQ3))
> 
> 🏷️ #📝/重点

^KEYHCKNSLQ3

> <span class="highlight" style="background-color: #e56eee">只用到更新 中断，所以把位 0（UIE）置 1 即可</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=FSKNMN3H))
> 
> 🏷️ #📝/重点

^KEYFSKNMN3H

> <span class="highlight" style="background-color: #e56eee">状态寄存器（TIMx_SR）</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=DGYC5TRS))
> 
> 🏷️ #📝/重点

^KEYDGYC5TRS

> <span class="highlight" style="background-color: #e56eee">该寄存器都是一些中断标志位，比如更新中断标志位、捕获/比较中断标志位等</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=BJ3U5M89))
> 
> 🏷️ #📝/重点

^KEYBJ3U5M89

> <span class="highlight" style="background-color: #e56eee">计数寄存器（TIMx_CNT</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=3F4984U9))
> 
> 🏷️ #📝/重点

^KEY3F4984U9

> <span class="highlight" style="background-color: #e56eee">TIM2/TIM3/TIM4/TIM5 的计数寄存器都是 16 位有效的</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=5Z8XKDQA))
> 
> 🏷️ #📝/重点

^KEY5Z8XKDQA

> <span class="highlight" style="background-color: #e56eee">预分频寄存器（TIMx_PSC）</span> ([p277](zotero://open-pdf/library/items/JFGTX7CT?page=277&annotation=DNPR33LG))
> 
> 🏷️ #📝/重点

^KEYDNPR33LG

> <span class="highlight" style="background-color: #e56eee">定时器的预分频寄存器都是 16 位的</span> ([p278](zotero://open-pdf/library/items/JFGTX7CT?page=278&annotation=X7WU4PKJ))
> 
> 🏷️ #📝/重点

^KEYX7WU4PKJ

> <span class="highlight" style="background-color: #e56eee">自动重载寄存器（TIMx_ARR）</span> ([p278](zotero://open-pdf/library/items/JFGTX7CT?page=278&annotation=TUDDLG7G))
> 
> 🏷️ #📝/重点

^KEYTUDDLG7G

> <span class="highlight" style="background-color: #e56eee">自动重载寄存器是低 16 位有效。该寄存器可以由 APRE 位设置是否进行缓冲。</span> ([p278](zotero://open-pdf/library/items/JFGTX7CT?page=278&annotation=693P7IUB))
> 
> 🏷️ #📝/重点

^KEY693P7IUB

> <span class="highlight" style="background-color: #f19837">21.2.2 硬件设计</span> ([p278](zotero://open-pdf/library/items/JFGTX7CT?page=278&annotation=DK56PGJL))
> 
> 🏷️ #📝/标题

^KEYDK56PGJL

> <span class="highlight" style="background-color: #f19837">21.2.3 程序设计</span> ([p278](zotero://open-pdf/library/items/JFGTX7CT?page=278&annotation=5JKD3565))
> 
> 🏷️ #📝/标题

^KEY5JKD3565

> <span class="highlight" style="background-color: #f19837">21.2.3.1 程序流程图</span> ([p278](zotero://open-pdf/library/items/JFGTX7CT?page=278&annotation=LRVKMNNW))
> 
> 🏷️ #📝/标题

^KEYLRVKMNNW

> <span class="highlight" style="background-color: #f19837">21.2.3.2 程序解析</span> ([p279](zotero://open-pdf/library/items/JFGTX7CT?page=279&annotation=4C4YWDMT))
> 
> 🏷️ #📝/标题

^KEY4C4YWDMT

> <span class="highlight" style="background-color: #e56eee">GTIM_TIMX_INT</span>
> 
> "GTIM" 代表 "General Timer"；
> 
> "TIMX" 则是指具体的某个定时器，其中 "X" 代表该定时器的编号；
> 
> “INT”代表着中断的意思，因为这里要求定时器实现更新中断的作用 ([p279](zotero://open-pdf/library/items/JFGTX7CT?page=279&annotation=35AQ8VMA))
> 
> 🏷️ #📝/重点

^KEY35AQ8VMA

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_Base_Init</span>
> 
> 定时器基础模式初始化，此时定时器主要实现一个更新中断的功能。后面还有定时器PWM输出模式初始化，此时的定时器用于实现输出PWM脉冲。 ([p279](zotero://open-pdf/library/items/JFGTX7CT?page=279&annotation=6IX6R888))
> 
> 🏷️ #📝/重点

^KEY6IX6R888

> <span class="highlight" style="background-color: #e56eee">HAL_NVIC_EnableIRQ(GTIM_TIMX_INT_IRQn);</span>
> 
> 需要使能两次中断，以下是GPT给出的解释，不一定正确：
> 
> 1\. \`HAL_NVIC_EnableIRQ(GTIM_TIMX_INT_IRQn);\` 这个函数是用来使能特定的中断线，让 CPU 知道当定时器中断事件发生时应该跳转到哪个中断服务程序（ISR）来处理。它是针对 CPU 的中断控制器的。
> 
> 2\. \`HAL_TIM_Base_Start_IT(&g_timx_handle);\` 这个函数是启用定时器的中断功能，告诉定时器开始以中断方式工作。当定时器的计数器达到预设的值时，定时器会产生中断信号。这个函数是针对定时器的中断功能的。
> 
> 简单来说，第一个函数是告诉 CPU 应该如何处理定时器中断，而第二个函数是告诉定时器开始产生中断。它们是两个不同的步骤，都是使能定时器中断所必需的。 ([p279](zotero://open-pdf/library/items/JFGTX7CT?page=279&annotation=37R2JYP5))
> 
> 🏷️ #📝/重点

^KEY37R2JYP5

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_Base_Start_IT(&g_timx_handle);</span> ([p279](zotero://open-pdf/library/items/JFGTX7CT?page=279&annotation=XY4AUY2V))
> 
> 🏷️ #📝/重点

^KEYXY4AUY2V

> <span class="highlight" style="background-color: #e56eee">__HAL_TIM_GET_FLAG(&g_timx_handle, TIM_FLAG_UPDATE) != RESET</span>
> 
> __HAL_TIM_GET_FLAG(&g_timx_handle, TIM_FLAG_UPDATE): 这个宏是用来获取定时器更新中断标志位的状态。
> 
> &g_timx_handle 是指向定时器句柄的指针
> 
> TIM_FLAG_UPDATE 是定时器更新中断标志位的宏定义(在头文件中定义)。
> 
> RESET 表示置 0 (在头文件中定义)。 ([p280](zotero://open-pdf/library/items/JFGTX7CT?page=280&annotation=2FE68J8K))
> 
> 🏷️ #📝/重点

^KEY2FE68J8K

> <span class="highlight" style="background-color: #e56eee">在一个项目中，用到多个定时器相 关中断时，建议大家使用这种方式来处理代码，这样方便代码的管理。</span> ([p280](zotero://open-pdf/library/items/JFGTX7CT?page=280&annotation=PGXQWGQ5))
> 
> 🏷️ #📝/重点

^KEYPGXQWGQ5

> <span class="highlight" style="background-color: #f19837">21.3 通用定时器 PWM 输出实验</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=ZLQ6NZEV))
> 
> 🏷️ #📝/标题

^KEYZLQ6NZEV

> <span class="highlight" style="background-color: #e56eee">脉冲宽度调制(PWM)</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=UUJEG9CZ))
> 
> 🏷️ #📝/重点

^KEYUUJEG9CZ

> <span class="highlight" style="background-color: #e56eee">在计数器频率固定时，PWM 频率或者周期由自动重载寄存器（TIMx_ARR）的值决定，其占空 比由捕获/比较寄存器（TIMx_CCRx）的值决定。</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=LVG7WMYC))
> 
> 🏷️ #📝/重点

^KEYLVG7WMYC

> <span class="highlight" style="background-color: #e56eee">递增计数模式</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=V2SDJVU7))
> 
> 🏷️ #📝/重点

^KEYV2SDJVU7

> <span class="highlight" style="background-color: #e56eee">纵轴是计数器的计数值 CNT</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=EBJP3ALL))
> 
> 🏷️ #📝/重点

^KEYEBJP3ALL

> <span class="highlight" style="background-color: #e56eee">横轴表示时</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=7GUBUGEK))
> 
> 🏷️ #📝/重点

^KEY7GUBUGEK

> <span class="highlight" style="background-color: #e56eee">当 CNT\=CCRx 时，IO 输出高电平（逻辑 1）；当 CNT=ARR 时，定时器溢出，CNT 的值被清零，然后继续递增，依次循环</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=VB4KWYC6))
> 
> 🏷️ #📝/重点

^KEYVB4KWYC6

> <span class="highlight" style="background-color: #e56eee">改 变 CCRx 的值，就可以改变 PWM 的占空比，改变 ARR 的值，就可以改变 PWM 的频率</span> ([p281](zotero://open-pdf/library/items/JFGTX7CT?page=281&annotation=LVUKXRNP))
> 
> 🏷️ #📝/重点

^KEYLVUKXRNP

> <span class="highlight" style="background-color: #e56eee">TIM6 和 TIM7</span>
> 
> 基本定时器，没有输出比较功能 ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=CW6QVQRD))
> 
> 🏷️ #📝/重点

^KEYCW6QVQRD

> <span class="highlight" style="background-color: #e56eee">其他的定时器都可以用来产生 PWM 输出</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=B5QJ45NK))
> 
> 🏷️ #📝/重点

^KEYB5QJ45NK

> <span class="highlight" style="background-color: #f19837">21.3.1 TIM2/TIM3/TIM4/TIM5 寄存器</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=VIHZ3E37))
> 
> 🏷️ #📝/标题

^KEYVIHZ3E37

> <span class="highlight" style="background-color: #e56eee">捕获 /比较模式寄存 器 （TIMx_CCMR1/2）、捕获/比较使能寄存器（TIMx_CCER）、捕获/比较寄存器（TIMx_CCR1~4）。</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=R645M8HU))
> 
> 🏷️ #📝/重点

^KEYR645M8HU

> <span class="highlight" style="background-color: #e56eee">捕获/比较模式寄存器 1/2（TIMx_CCMR1/2）</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=BB68ZXRY))
> 
> 🏷️ #📝/重点

^KEYBB68ZXRY

> <span class="highlight" style="background-color: #e56eee">该寄存器一般有 2 个： TIMx _CCMR1 和 TIMx _CCMR2。TIMx_CCMR1 控制 CH1 和 CH2，而 TIMx_CCMR2 控制 CH3 和 CH4</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=X735URYY))
> 
> 🏷️ #📝/重点

^KEYX735URYY

> <span class="highlight" style="background-color: #e56eee">OC2M[2:0]就是对应着通道 2 的模式设置，此部分由 3 位组成。总共可以配置成 8 种 模式</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=KUR4BKVQ))
> 
> 🏷️ #📝/重点

^KEYKUR4BKVQ

> <span class="highlight" style="background-color: #e56eee">PWM 模式，所以这 3 位必须设置为 110 或者 111，分别对应 PWM 模式 1 和 PWM 模式 2。这两种 PWM 模式的区别就是输出有效电平的极性相反</span>
> 
> 110：PWM模式1－ 在向上/向下计数时，一旦TIMx_CNT < TIMx_CCR2时通道2为有效电平，否则为无效电平；
> 
> 111：PWM模式2－ 在向上/向下计数时，一旦TIMx_CNT这里写的区别是“输出有效电平的极性相反”是错误的，就是两种不同模式。 ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=R34VEYQF))
> 
> 🏷️ #📝/重点

^KEYR34VEYQF

> <span class="highlight" style="background-color: #e56eee">位 OC2PE</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=PIVKRZL2))
> 
> 🏷️ #📝/重点

^KEYPIVKRZL2

> <span class="highlight" style="background-color: #e56eee">控制 CCR2 寄存器是否进行缓冲</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=CATBN4R4))
> 
> 🏷️ #📝/重点

^KEYCATBN4R4

> <span class="highlight" style="background-color: #e56eee">影子寄存器才是真正起作用的寄存器</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=ZZK37MXX))
> 
> 🏷️ #📝/重点

^KEYZZK37MXX

> <span class="highlight" style="background-color: #e56eee">CC2S[1:0]用于设置通道 2 的方向（输 入/输出）默认设置为 0，就是设置通道作为输出使用</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=QPAUXBSE))
> 
> 🏷️ #📝/重点

^KEYQPAUXBSE

> <span class="highlight" style="background-color: #e56eee">捕获/比较使能寄存器（TIMx_CCER）</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=XAE3G9BH))
> 
> 🏷️ #📝/重点

^KEYXAE3G9BH

> <span class="highlight" style="background-color: #e56eee">CC2E 位，该位是 通道 2 输入/输出使能位</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=T5B34P4X))
> 
> 🏷️ #📝/重点

^KEYT5B34P4X

> <span class="highlight" style="background-color: #e56eee">CC2P 位是设置通道 2 的输出极性，我们默认设置 0。</span>
> 
> 决定有效电平是高电平还是低电平。默认是高电平有效 ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=38KANP26))
> 
> 🏷️ #📝/重点

^KEY38KANP26

> <span class="highlight" style="background-color: #e56eee">捕获/比较寄存器 1/2/3/4（TIMx_CCR1/2/3/4）</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=USGECNNG))
> 
> 🏷️ #📝/重点

^KEYUSGECNNG

> <span class="highlight" style="background-color: #e56eee">对应 4 个通道 CH1~CH4</span> ([p282](zotero://open-pdf/library/items/JFGTX7CT?page=282&annotation=87YZ28GP))
> 
> 🏷️ #📝/重点

^KEY87YZ28GP

> <span class="highlight" style="background-color: #e56eee">修改这个寄存器的值，就可以控制 PWM 的占空比了</span> ([p283](zotero://open-pdf/library/items/JFGTX7CT?page=283&annotation=W2EDHTCZ))
> 
> 🏷️ #📝/重点

^KEYW2EDHTCZ

> <span class="highlight" style="background-color: #f19837">21.3.2 硬件设计</span> ([p283](zotero://open-pdf/library/items/JFGTX7CT?page=283&annotation=9MYJZIC9))
> 
> 🏷️ #📝/标题

^KEY9MYJZIC9

> <span class="highlight" style="background-color: #f19837">21.3.3 程序设计</span> ([p283](zotero://open-pdf/library/items/JFGTX7CT?page=283&annotation=HV87UTRR))
> 
> 🏷️ #📝/标题

^KEYHV87UTRR

> <span class="highlight" style="background-color: #f19837">21.3.3.1 定时器的 HAL 库驱动</span> ([p283](zotero://open-pdf/library/items/JFGTX7CT?page=283&annotation=SW5PFHE4))
> 
> 🏷️ #📝/标题

^KEYSW5PFHE4

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_Init 函数</span> ([p283](zotero://open-pdf/library/items/JFGTX7CT?page=283&annotation=P3G2EMGJ))
> 
> 🏷️ #📝/重点

^KEYP3G2EMGJ

> <span class="highlight" style="background-color: #e56eee">为什么 HAL 库要提供这个函数而不直接让我们使用 HAL_TIM_Base_Init 函 数 呢 ？ 这 是 因 为 HAL 库 为 定 时 器 的 针 对 PWM 输 出 定 义 了 单 独 的 MSP 回 调 函 数 HAL_TIM_PWM_MspInit，所以当我们调用 HAL_TIM_PWM_Init 进行 PWM 初始化之后，该</span> ([p283](zotero://open-pdf/library/items/JFGTX7CT?page=283&annotation=SXXXS44S))
> 
> 🏷️ #📝/重点

^KEYSXXXS44S

> <span class="highlight" style="background-color: #e56eee">数内部会调用 MSP 回调函数 HAL_TIM_PWM_MspInit。当我们使用 HAL_TIM_Base_Init 初始 化定时器参数的时候，它内部调用的回调函数是 HAL_TIM_Base_MspInit，这里大家注意区分</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=9CPFL2Q5))
> 
> 🏷️ #📝/重点

^KEY9CPFL2Q5

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_ConfigChannel 函数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=7I6IEYVU))
> 
> 🏷️ #📝/重点

^KEY7I6IEYVU

> <span class="highlight" style="background-color: #e56eee">形参 1 是 TIM_HandleTypeDef 结构体类型指针变量，用于配置定时器基本参数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=87I9D87U))
> 
> 🏷️ #📝/重点

^KEY87I9D87U

> <span class="highlight" style="background-color: #e56eee">形参 2 是 TIM_OC_InitTypeDef 结构体类型指针变量，用于配置定时器的输出比较参数。</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=HC2XKZX7))
> 
> 🏷️ #📝/重点

^KEYHC2XKZX7

> <span class="highlight" style="background-color: #e56eee">成员变量 OCMode 用来设置模式，这里我们设置为 PWM 模式 1</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=SCH8DT8Q))
> 
> 🏷️ #📝/重点

^KEYSCH8DT8Q

> <span class="highlight" style="background-color: #e56eee">成员变量 Pulse 用来设置捕获比较值</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=ZNG3DZIV))
> 
> 🏷️ #📝/重点

^KEYZNG3DZIV

> <span class="highlight" style="background-color: #e56eee">成员变量 TIM_OCPolarity 用来设置输出极性</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=LAQZ2JZW))
> 
> 🏷️ #📝/重点

^KEYLAQZ2JZW

> <span class="highlight" style="background-color: #e56eee">形参 3 是定时器通道，范围：TIM_CHANNEL_1 到 TIM_CHANNEL_4。这里我们使用的 是定时器 3 的通道 2，所以取值为 TIM_CHANNEL_2 即可</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=ZWN695UL))
> 
> 🏷️ #📝/重点

^KEYZWN695UL

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_Start 函数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=J8FHMTB3))
> 
> 🏷️ #📝/重点

^KEYJ8FHMTB3

> <span class="highlight" style="background-color: #e56eee">定时器的 PWM 输出启动函数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=73YMGV6R))
> 
> 🏷️ #📝/重点

^KEY73YMGV6R

> <span class="highlight" style="background-color: #e56eee">形参 1 是 TIM_HandleTypeDef 结构体类型指针变量</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=TNVATF7Q))
> 
> 🏷️ #📝/重点

^KEYTNVATF7Q

> <span class="highlight" style="background-color: #e56eee">形参 2 是定时器通道</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=4XQ9GEQL))
> 
> 🏷️ #📝/重点

^KEY4XQ9GEQL

> <span class="highlight" style="background-color: #e56eee">HAL 库也同样 提供了单独使能定时器的输出通道函数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=VXD3VPVT))
> 
> 🏷️ #📝/重点

^KEYVXD3VPVT

> <span class="highlight" style="background-color: #e56eee">TIM_CCxChannelCmd</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=56UXHSB8))
> 
> 🏷️ #📝/重点

^KEY56UXHSB8

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_Start 函数内部也调用了该函数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=BEPNDJII))
> 
> 🏷️ #📝/重点

^KEYBEPNDJII

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_ConfigClockSource 函数</span> ([p284](zotero://open-pdf/library/items/JFGTX7CT?page=284&annotation=I423Y86L))
> 
> 🏷️ #📝/重点

^KEYI423Y86L

> <span class="highlight" style="background-color: #e56eee">形参 1 是 TIM_HandleTypeDef 结构体类型指针变量</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=7FFZPLB6))
> 
> 🏷️ #📝/重点

^KEY7FFZPLB6

> <span class="highlight" style="background-color: #e56eee">形参 2 是 TIM_ClockConfigTypeDef 结构体类型指针变量，用于配置定时器时钟源参数</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=X8GQDC5U))
> 
> 🏷️ #📝/重点

^KEYX8GQDC5U

> <span class="highlight" style="background-color: #e56eee">该函数主要配置 TIMx_SMCR 寄存器</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=NDHHIATF))
> 
> 🏷️ #📝/重点

^KEYNDHHIATF

> <span class="highlight" style="background-color: #e56eee">默认情况下，定时器的时钟源是内部时钟。本实验 就是使用内部时钟的，所以我们不用对时钟源就行初始化，默认即可</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=32FAFG6D))
> 
> 🏷️ #📝/重点

^KEY32FAFG6D

> <span class="highlight" style="background-color: #e56eee">后面的定时器初始化凡是用到内部时钟我们都没有去初始化</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=WD3FNX34))
> 
> 🏷️ #📝/重点

^KEYWD3FNX34

> <span class="highlight" style="background-color: #e56eee">定时器 PWM 输出模式配置步骤</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=27AMFJBM))
> 
> 🏷️ #📝/重点

^KEY27AMFJBM

> <span class="highlight" style="background-color: #e56eee">开启 TIMx 和通道输出的 GPIO 时钟，配置该 IO 口的复用功能输出</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=23NNQNX3))
> 
> 🏷️ #📝/重点

^KEY23NNQNX3

> <span class="highlight" style="background-color: #e56eee">默认用到定时器 3 通 道 2，对应 IO 是 PB5</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=WMNNGFFA))
> 
> 🏷️ #📝/重点

^KEYWMNNGFFA

> <span class="highlight" style="background-color: #e56eee">IO 口复用功能是通过函数 HAL_GPIO_Init 来配置的</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=84EGGB4L))
> 
> 🏷️ #📝/重点

^KEY84EGGB4L

> <span class="highlight" style="background-color: #e56eee">初始化 TIMx，设置 TIMx 的 ARR 和 PSC 等参数</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=FRFUCSMJ))
> 
> 🏷️ #📝/重点

^KEYFRFUCSMJ

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_Init</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=DSMHJS6L))
> 
> 🏷️ #📝/重点

^KEYDSMHJS6L

> <span class="highlight" style="background-color: #e56eee">：HAL_TIM_PWM_MspInit</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=B32KREZE))
> 
> 🏷️ #📝/重点

^KEYB32KREZE

> <span class="highlight" style="background-color: #e56eee">定时器和 GPIO 时钟使能、GPIO 初始化、中断使能以及优先级设置等代码</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=WLFZYF62))
> 
> 🏷️ #📝/重点

^KEYWLFZYF62

> <span class="highlight" style="background-color: #e56eee">设置 TIMx_CHy 的 PWM 模式，输出比较极性，比较值等参数</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=3FVPLW9L))
> 
> 🏷️ #📝/重点

^KEY3FVPLW9L

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_ConfigChannel</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=97QH3FHX))
> 
> 🏷️ #📝/重点

^KEY97QH3FHX

> <span class="highlight" style="background-color: #e56eee">使能 TIMx，使能 TIMx 的 CHy 输出</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=6DJ9UYVP))
> 
> 🏷️ #📝/重点

^KEY6DJ9UYVP

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_PWM_Start</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=H6NCHFUE))
> 
> 🏷️ #📝/重点

^KEYH6NCHFUE

> <span class="highlight" style="background-color: #e56eee">修改 TIM3_CCR2 来控制占空比</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=WBBVPHCZ))
> 
> 🏷️ #📝/重点

^KEYWBBVPHCZ

> <span class="highlight" style="background-color: #e56eee">HAL 库中提供一个修改占空比的宏定义</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=7ALFZ53S))
> 
> 🏷️ #📝/重点

^KEY7ALFZ53S

> <span class="highlight" style="background-color: #e56eee">__HAL_TIM_SET_COMPARE</span> ([p285](zotero://open-pdf/library/items/JFGTX7CT?page=285&annotation=PMUEVRMN))
> 
> 🏷️ #📝/重点

^KEYPMUEVRMN

> <span class="highlight" style="background-color: #f19837">21.3.3.2 程序流程图</span> ([p286](zotero://open-pdf/library/items/JFGTX7CT?page=286&annotation=9XDXYJPD))
> 
> 🏷️ #📝/标题

^KEY9XDXYJPD

> <span class="highlight" style="background-color: #f19837">21.3.3.3 程序解析</span> ([p286](zotero://open-pdf/library/items/JFGTX7CT?page=286&annotation=74Q9FAQ3))
> 
> 🏷️ #📝/标题

^KEY74Q9FAQ3

> <span class="highlight" style="background-color: #e56eee">GTIM_TIMX_PWM_CHY_GPIO_PORT</span>
> 
> “CHY” 代表定时器通道编号，其中“CH”表示通道“Channel”，“Y”通常表示通道号。 ([p286](zotero://open-pdf/library/items/JFGTX7CT?page=286&annotation=HXCYDYA8))
> 
> 🏷️ #📝/重点

^KEYHXCYDYA8

> <span class="highlight" style="background-color: #e56eee">因为我们 LED0 接在 PB5 上, 必须通过开启 TIM3 的部分重映射功能, 才能将 TIM3_CH2 输出到 PB5 上</span>
> 
> 复用功能（Alternate functions）：同一个 IO 可以作为多个外设的引脚，除了主功能外，可以具有多个功能。
> 
> 复用功能包括：默认复用功能（default）和重映射功能(remap)。在使用复用功能之前要打开复用时钟。
> 
> 默认复用功能： IO 可以作为多个外设的引脚，具有多个功能；
> 
> 重映射：将一个引脚功能重新定义到其他引脚，即多个引脚有同一个功能。
> 
> 重映射可分为：部分重映射和完全重映射。比如定时器3的PWM输出，默认是PA6、PA7、PB0、PB1，部分重映射是将PA6、PA7映射为PB4、PB5，完全重映射是全部映射为PC6、PC7、PC8、PC9. ([p286](zotero://open-pdf/library/items/JFGTX7CT?page=286&annotation=D4TJ9RGL))
> 
> 🏷️ #📝/重点

^KEYD4TJ9RGL

> <span class="highlight" style="background-color: #e56eee">第一部分是定时器 3 输出通道 2 对应的 IO 口的宏定义</span> ([p287](zotero://open-pdf/library/items/JFGTX7CT?page=287&annotation=GCR5P5RB))
> 
> 🏷️ #📝/重点

^KEYGCR5P5RB

> <span class="highlight" style="background-color: #e56eee">第二部分是定时器 3 的部分重映射功能的宏定义</span> ([p287](zotero://open-pdf/library/items/JFGTX7CT?page=287&annotation=7VFVE4JW))
> 
> 🏷️ #📝/重点

^KEY7VFVE4JW

> <span class="highlight" style="background-color: #e56eee">第三部分则是定时器 3 输出通道 2 的相应宏 定义</span> ([p287](zotero://open-pdf/library/items/JFGTX7CT?page=287&annotation=E6BRXBIP))
> 
> 🏷️ #📝/重点

^KEYE6BRXBIP

> <span class="highlight" style="background-color: #e56eee">__HAL_TIM_SET_COMPARE</span>
> 
> HAL 库提供直接修改比较值的函数 ([p288](zotero://open-pdf/library/items/JFGTX7CT?page=288&annotation=KYMWNCPS))
> 
> 🏷️ #📝/重点

^KEYKYMWNCPS

> <span class="image#e56eee">null</span>展示了如何计算输出PWM的频率和占空比 ([p288](zotero://open-pdf/library/items/JFGTX7CT?page=288&annotation=7VB2T9QJ))

^KEY7VB2T9QJ

> <span class="highlight" style="background-color: #e56eee">占空比是指在一个周期内，高电平时间相对 于总时间所占的比例</span> ([p288](zotero://open-pdf/library/items/JFGTX7CT?page=288&annotation=5IYEV3CC))
> 
> 🏷️ #📝/重点

^KEY5IYEV3CC

> <span class="highlight" style="background-color: #f19837">21.4 通用定时器输入捕获实验</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=NM2B82V6))
> 
> 🏷️ #📝/标题

^KEYNM2B82V6

> <span class="highlight" style="background-color: #e56eee">输入捕获模式可以用来测量脉冲宽度或者测量频率。</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=G6N4TBLV))
> 
> 🏷️ #📝/重点

^KEYG6N4TBLV

> <span class="highlight" style="background-color: #e56eee">首先设置定时器通道 x 为上升沿捕获</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=8LEXQZGZ))
> 
> 🏷️ #📝/重点

^KEY8LEXQZGZ

> <span class="highlight" style="background-color: #e56eee">打开捕获中断</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=QFF27DAR))
> 
> 🏷️ #📝/重点

^KEYQFF27DAR

> <span class="highlight" style="background-color: #e56eee">在捕获中断里将计数器值清零，并设置通道 x 为下降沿捕获</span>
> 
> 第一次捕获中断里干的事情 ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=QKKPZFG7))
> 
> 🏷️ #📝/重点

^KEYQKKPZFG7

> <span class="highlight" style="background-color: #e56eee">捕获事件发生时，计数器的值会被锁存到捕获/比较寄存器 中</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=RMEXTAZY))
> 
> 🏷️ #📝/重点

^KEYRMEXTAZY

> <span class="highlight" style="background-color: #e56eee">在捕获中断里，我们读取捕获/比较寄存器就可 以获取到高电平脉冲时间内，计数器计数的个数，从而可以算出高电平脉冲的时间</span>
> 
> 这是第二次捕获中断里干的事情 ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=3IAHM82T))
> 
> 🏷️ #📝/重点

^KEY3IAHM82T

> <span class="highlight" style="background-color: #e56eee">t1 到 t2 时间段，定时器可能会产生 N 次溢出</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=ZUQDATVN))
> 
> 🏷️ #📝/重点

^KEYZUQDATVN

> <span class="highlight" style="background-color: #e56eee">计数器计数的个数计算方法为：N*（ARR+1）+ CCRx2，CCRx2 表示 t2 时间 点，捕获/比较寄存器的值</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=QYNY226C))
> 
> 🏷️ #📝/重点

^KEYQYNY226C

> <span class="highlight" style="background-color: #e56eee">除了 TIM6 和 TIM7，其他定时器都有输入捕获功能</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=KAGRQZZG))
> 
> 🏷️ #📝/重点

^KEYKAGRQZZG

> <span class="highlight" style="background-color: #e56eee">输入捕获，简 单的说就是通过检测 TIMx_CHy 上的边沿信号，在边沿信号发生跳变（比如上升沿/下降沿） 时，会发生捕获事件，将当前定时器的值（TIMx_CNT）锁存到对应通道的捕获/比较寄存器 （TIMx_CCRy）里，完成一次捕获</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=QYDVR2NE))
> 
> 🏷️ #📝/重点

^KEYQYDVR2NE

> <span class="highlight" style="background-color: #f19837">21.4.1 TIM2/TIM3/TIM4/TIM5 寄存器</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=7856SI9C))
> 
> 🏷️ #📝/标题

^KEY7856SI9C

> <span class="highlight" style="background-color: #e56eee">捕获/比较模式寄存器 1/2（TIMx_CCMR1/2）</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=IB5N79TX))
> 
> 🏷️ #📝/重点

^KEYIB5N79TX

> <span class="highlight" style="background-color: #e56eee">定时器 5 通道 1 输入</span> ([p290](zotero://open-pdf/library/items/JFGTX7CT?page=290&annotation=G6UT3H43))
> 
> 🏷️ #📝/重点

^KEYG6UT3H43

> <span class="highlight" style="background-color: #e56eee">TIMx_CCMR1 寄存器对应于通道 1 和通道 2 的设置，CCMR2 寄存器对应通道 3 和通道 4</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=LA3I2AI5))
> 
> 🏷️ #📝/重点

^KEYLA3I2AI5

> <span class="highlight" style="background-color: #e56eee">其中 CC1S[1:0]，这两个位用于 CCR1 的通道配置</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=HILH3IRD))
> 
> 🏷️ #📝/重点

^KEYHILH3IRD

> <span class="highlight" style="background-color: #e56eee">输入捕获 1 预分频器 IC1PSC[1:0]</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=I46JCNB2))
> 
> 🏷️ #📝/重点

^KEYI46JCNB2

> <span class="highlight" style="background-color: #e56eee">1 次边沿就触发 1 次捕获，所 以选择 00 就行了</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=IDG4IEGR))
> 
> 🏷️ #📝/重点

^KEYIDG4IEGR

> <span class="highlight" style="background-color: #e56eee">输入捕获 1 滤波器 IC1F[3:0]</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=RDDL6TKA))
> 
> 🏷️ #📝/重点

^KEYRDDL6TKA

> <span class="highlight" style="background-color: #e56eee">设置输入采样频率和数字滤波器长度</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=7GAVE2UI))
> 
> 🏷️ #📝/重点

^KEY7GAVE2UI

> <span class="highlight" style="background-color: #e56eee">假设 IC1F[3:0]=0011，并设置 IC1 映射到 TI1 上。表示以 fCK_INT 为采样频率，当连续 8 次都是 采样到 TI1 为高电平或者低电平，滤波器才输出一个有效输出边沿。当 8 次采样中有高有低， 那就保持原来的输出，这样可以滤除高频干扰信号，从而达到滤波的效果</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=Q26RW5T5))
> 
> 🏷️ #📝/重点

^KEYQ26RW5T5

> <span class="highlight" style="background-color: #e56eee">捕获/比较使能寄存器（TIMx_CCER）</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=NWLZS9EG))
> 
> 🏷️ #📝/重点

^KEYNWLZS9EG

> <span class="highlight" style="background-color: #e56eee">开 关和极性</span> ([p291](zotero://open-pdf/library/items/JFGTX7CT?page=291&annotation=KDIGGDI2))
> 
> 🏷️ #📝/重点

^KEYKDIGGDI2

> <span class="highlight" style="background-color: #e56eee">CC1P</span> ([p292](zotero://open-pdf/library/items/JFGTX7CT?page=292&annotation=ALGBYNMJ))
> 
> 🏷️ #📝/重点

^KEYALGBYNMJ

> <span class="highlight" style="background-color: #e56eee">保留默认设置值 0，即高电平触发捕获</span> ([p292](zotero://open-pdf/library/items/JFGTX7CT?page=292&annotation=M44MX7DJ))
> 
> 🏷️ #📝/重点

^KEYM44MX7DJ

> <span class="highlight" style="background-color: #e56eee">需要用到中断来处理捕获数据，所以必须开启通道 1 的捕获比 较中断，即 CC1IE 设置为 1。同时我们还需要在定时器溢出中断中累计定时器溢出的次数，所 以还需要使能定时器的更新中断，即 UIE 置 1。</span> ([p292](zotero://open-pdf/library/items/JFGTX7CT?page=292&annotation=ETZBWGBB))
> 
> 🏷️ #📝/重点

^KEYETZBWGBB

> <span class="highlight" style="background-color: #f19837">21.4.2 硬件设计</span> ([p292](zotero://open-pdf/library/items/JFGTX7CT?page=292&annotation=H9BIY7UQ))
> 
> 🏷️ #📝/标题

^KEYH9BIY7UQ

> <span class="highlight" style="background-color: #f19837">21.4.3 程序设计</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=LNGJ6E2W))
> 
> 🏷️ #📝/标题

^KEYLNGJ6E2W

> <span class="highlight" style="background-color: #f19837">21.4.3.1 定时器的 HAL 库驱动</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=FFKHYBMI))
> 
> 🏷️ #📝/标题

^KEYFFKHYBMI

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_Init 函数</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=AX36AH9E))
> 
> 🏷️ #📝/重点

^KEYAX36AH9E

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_ConfigChannel 函数</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=HYX9MAPR))
> 
> 🏷️ #📝/重点

^KEYHYX9MAPR

> <span class="highlight" style="background-color: #e56eee">形参 1 是 TIM_HandleTypeDef 结构体类型指针变量</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=LN7AN6R9))
> 
> 🏷️ #📝/重点

^KEYLN7AN6R9

> <span class="highlight" style="background-color: #e56eee">形参 2 是 TIM_IC_InitTypeDef 结构体类型指针变量</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=7ZWYAYYI))
> 
> 🏷️ #📝/重点

^KEY7ZWYAYYI

> <span class="highlight" style="background-color: #e56eee">成员变量 ICSelection 用来设置映射 关系，我们配置 IC1 直接映射在 TI1 上，选择 TIM_ICSELECTION_DIRECTTI（另外还有两个 输 入 通 道 TIM_ICSELECTION_INDIRECTTI 和 TIM_ICSELECTION_TRC ）</span>
> 
> IC1 是指输入捕获通道1 ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=JGLEQX5N))
> 
> 🏷️ #📝/重点

^KEYJGLEQX5N

> <span class="highlight" style="background-color: #e56eee">形参 3 是定时器通道</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=IZFZ5GCB))
> 
> 🏷️ #📝/重点

^KEYIZFZ5GCB

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_Start_IT 函数</span> ([p293](zotero://open-pdf/library/items/JFGTX7CT?page=293&annotation=IQNYTT53))
> 
> 🏷️ #📝/重点

^KEYIQNYTT53

> <span class="highlight" style="background-color: #e56eee">用于启动定时器的输入捕获模式，且开启输入捕获中断</span> ([p294](zotero://open-pdf/library/items/JFGTX7CT?page=294&annotation=VBWRB6MS))
> 
> 🏷️ #📝/重点

^KEYVBWRB6MS

> <span class="highlight" style="background-color: #e56eee">如果我们不需要开启输入捕获中断</span> ([p294](zotero://open-pdf/library/items/JFGTX7CT?page=294&annotation=HLVS8YLI))
> 
> 🏷️ #📝/重点

^KEYHLVS8YLI

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_Start</span> ([p294](zotero://open-pdf/library/items/JFGTX7CT?page=294&annotation=E45LFVGF))
> 
> 🏷️ #📝/重点

^KEYE45LFVGF

> <span class="highlight" style="background-color: #e56eee">定时器输入捕获模式配置步骤</span> ([p294](zotero://open-pdf/library/items/JFGTX7CT?page=294&annotation=6WZYXXSQ))
> 
> 🏷️ #📝/重点

^KEY6WZYXXSQ

> <span class="highlight" style="background-color: #e56eee">通过__HAL_TIM_ENABLE_IT 函数使能定时器更新中断</span> ([p294](zotero://open-pdf/library/items/JFGTX7CT?page=294&annotation=9MGVTWPR))
> 
> 🏷️ #📝/重点

^KEY9MGVTWPR

> <span class="highlight" style="background-color: #e56eee">如果脉宽比较长，那么定时器就 会溢出，对溢出必须做处理，否则结果就不准了</span> ([p294](zotero://open-pdf/library/items/JFGTX7CT?page=294&annotation=R76W7369))
> 
> 🏷️ #📝/重点

^KEYR76W7369

> <span class="highlight" style="background-color: #f19837">21.4.3.3 程序解析</span> ([p295](zotero://open-pdf/library/items/JFGTX7CT?page=295&annotation=5FLT3QXM))
> 
> 🏷️ #📝/标题

^KEY5FLT3QXM

> <span class="image#e56eee">null</span>由于需要用到通道的输入捕获功能，故需要对通道进行设置。 ([p296](zotero://open-pdf/library/items/JFGTX7CT?page=296&annotation=YITADGW2))

^KEYYITADGW2

> <span class="highlight" style="background-color: #e56eee">__HAL_TIM_ENABLE_IT(</span> ([p296](zotero://open-pdf/library/items/JFGTX7CT?page=296&annotation=BB8HXKE9))
> 
> 🏷️ #📝/重点

^KEYBB8HXKE9

> <span class="highlight" style="background-color: #e56eee">GPIO_MODE_AF_PP</span>
> 
> 使用的是 IO 口的复用功能，所以使用复用推挽输出 ([p296](zotero://open-pdf/library/items/JFGTX7CT?page=296&annotation=2I47YPQG))
> 
> 🏷️ #📝/重点

^KEY2I47YPQG

> <span class="highlight" style="background-color: #e56eee">g_timxchy_cap_sta，是用来记录捕获状态</span> ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=8IE6LKHB))
> 
> 🏷️ #📝/重点

^KEY8IE6LKHB

> <span class="image#e56eee">null</span> ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=6FFQBUGT))

^KEY6FFQBUGT

> <span class="highlight" style="background-color: #e56eee">g_timxchy_cap_sta 的位[5:0]是用于记录捕获高电平定时器溢出次数，总共 6 位</span> ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=MXQZ56R4))
> 
> 🏷️ #📝/重点

^KEYMXQZ56R4

> <span class="highlight" style="background-color: #e56eee">g_timxchy_cap_val，则用来记录捕获到下降沿的时候，TIM5_CNT 寄存器的值</span> ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=XUKTXJKE))
> 
> 🏷️ #📝/重点

^KEYXUKTXJKE

> <span class="highlight" style="background-color: #e56eee">g_timxchy_cap_sta & 0X40</span>
> 
> 当该值等于 1 时，说明此前已经捕捉到了上升沿，并在上一次的捕获中断处理函数中设置了下降沿捕获。所以此次发生发生的捕获中断应该是由下降沿触发的。 ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=QI2KEFSB))
> 
> 🏷️ #📝/重点

^KEYQI2KEFSB

> <span class="highlight" style="background-color: #e56eee">配置 TIM5 通道 1 上升沿捕获</span>
> 
> 要重新设置上升沿捕获，以便开始下一轮的脉冲宽度测量。 ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=PDUCV55U))
> 
> 🏷️ #📝/重点

^KEYPDUCV55U

> <span class="highlight" style="background-color: #e56eee">还未开始,第一次捕获上升沿</span>
> 
> 说明此前还没有捕获到上升沿，而此次是第一次捕获上升沿。 ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=JTFNY5IE))
> 
> 🏷️ #📝/重点

^KEYJTFNY5IE

> <span class="highlight" style="background-color: #e56eee">下降沿捕获</span>
> 
> 捕获到上升沿后要设置位下降沿捕获 ([p297](zotero://open-pdf/library/items/JFGTX7CT?page=297&annotation=6KLZ74NN))
> 
> 🏷️ #📝/重点

^KEY6KLZ74NN

> <span class="highlight" style="background-color: #e56eee">(g_timxchy_cap_sta & 0X3F) == 0X3F</span>
> 
> 已经达到了最大溢出次数 ([p298](zotero://open-pdf/library/items/JFGTX7CT?page=298&annotation=JSMND2ME))
> 
> 🏷️ #📝/重点

^KEYJSMND2ME

> <span class="highlight" style="background-color: #e56eee">这样，我们就完成一次高电平捕获了，只要 g_timxchy_cap_sta 的第 7 位一直为 1，那么就 不会进行第二次捕获，我们在 main 函数处理完捕获数据后，将 g_timxchy_cap_sta 置零，就可 以开启第二次捕获。</span> ([p298](zotero://open-pdf/library/items/JFGTX7CT?page=298&annotation=LF3HY56M))
> 
> 🏷️ #📝/重点

^KEYLF3HY56M

> <span class="highlight" style="background-color: #e56eee">开启下一次捕获</span> ([p299](zotero://open-pdf/library/items/JFGTX7CT?page=299&annotation=VAAZ3RLL))
> 
> 🏷️ #📝/重点

^KEYVAAZ3RLL

> <span class="highlight" style="background-color: #f19837">21.5 通用定时器脉冲计数实验</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=LQWC6IW3))
> 
> 🏷️ #📝/标题

^KEYLQWC6IW3

> <span class="highlight" style="background-color: #e56eee">使用外 部时钟模式 1：外部输入引脚 (TIx)作为定时器的时钟源</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=H5QSDPK3))
> 
> 🏷️ #📝/重点

^KEYH5QSDPK3

> <span class="highlight" style="background-color: #e56eee">关于这个外部输入引脚(TIx)，我们使 用 WK_UP 按键按下产生的高电平脉冲作为定时器的计数器时钟，每按下一次按键产生一次高 电平脉冲，计数器加一</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=UZV55EL8))
> 
> 🏷️ #📝/重点

^KEYUZV55EL8

> <span class="highlight" style="background-color: #e56eee">外部时钟模式 1 的外部输入引脚只能是通道 1 或者通道 2 对应的 IO</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=6PK8KEAW))
> 
> 🏷️ #📝/重点

^KEY6PK8KEAW

> <span class="highlight" style="background-color: #e56eee">外部时钟源信号通过通道 1 输入后，接下来我们 用 TI1 表示该信号</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=CGL98DWT))
> 
> 🏷️ #📝/重点

^KEYCGL98DWT

> <span class="highlight" style="background-color: #e56eee">从模式选择为外部时钟模式 1</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=PN87TEAP))
> 
> 🏷️ #📝/重点

^KEYPN87TEAP

> <span class="highlight" style="background-color: #e56eee">这时候外部时钟源信 号就会到达时基单元的预分频器，后面就是经过分频后就作为计数器的计数时钟了</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=7NE7837V))
> 
> 🏷️ #📝/重点

^KEY7NE7837V

> <span class="highlight" style="background-color: #f19837">21.5.1 TIM2/TIM3/TIM4/TIM5 寄存器</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=YWBHLD32))
> 
> 🏷️ #📝/标题

^KEYYWBHLD32

> <span class="highlight" style="background-color: #e56eee">捕获/比较模式寄存器 1/2</span> ([p300](zotero://open-pdf/library/items/JFGTX7CT?page=300&annotation=XR6CICCP))
> 
> 🏷️ #📝/重点

^KEYXR6CICCP

> <span class="highlight" style="background-color: #e56eee">也就是配置 IC1 映射在 TI1 上， 即 CCR1 对应 TIMx_CH1。</span> ([p301](zotero://open-pdf/library/items/JFGTX7CT?page=301&annotation=96YCNMEC))
> 
> 🏷️ #📝/重点

^KEY96YCNMEC

> <span class="highlight" style="background-color: #e56eee">我们是 1 次高电平脉冲就触发 1 次计数</span> ([p301](zotero://open-pdf/library/items/JFGTX7CT?page=301&annotation=DEMKUCDH))
> 
> 🏷️ #📝/重点

^KEYDEMKUCDH

> <span class="highlight" style="background-color: #e56eee">让外部引脚脉冲信号作为定时器的时钟源，所以位[2:0]我们设置的值是 111， 即外部时钟模式 1</span> ([p302](zotero://open-pdf/library/items/JFGTX7CT?page=302&annotation=9UZX26YG))
> 
> 🏷️ #📝/重点

^KEY9UZX26YG

> <span class="highlight" style="background-color: #e56eee">TIMx_CH1 对应 TI1FP1，TIMx_CH2 则对应 TI2FP2</span> ([p302](zotero://open-pdf/library/items/JFGTX7CT?page=302&annotation=CTHDEXBT))
> 
> 🏷️ #📝/重点

^KEYCTHDEXBT

> <span class="highlight" style="background-color: #f19837">21.5.2 硬件设计</span> ([p303](zotero://open-pdf/library/items/JFGTX7CT?page=303&annotation=A6SEN8FY))
> 
> 🏷️ #📝/标题

^KEYA6SEN8FY

> <span class="highlight" style="background-color: #f19837">21.5.3 程序设计</span> ([p303](zotero://open-pdf/library/items/JFGTX7CT?page=303&annotation=T7UFX6ID))
> 
> 🏷️ #📝/标题

^KEYT7UFX6ID

> <span class="highlight" style="background-color: #f19837">21.5.3.1 定时器的 HAL 库驱动</span> ([p303](zotero://open-pdf/library/items/JFGTX7CT?page=303&annotation=98PBABLX))
> 
> 🏷️ #📝/标题

^KEY98PBABLX

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_SlaveConfigSynchro 函数</span>
> 
> 用来配置定时器时钟源，当时钟源选择外部时钟 1 模式时，需要使用该函数；当时钟源选择内部时钟时，不需要使用该函数。 ([p303](zotero://open-pdf/library/items/JFGTX7CT?page=303&annotation=WF93BBIZ))
> 
> 🏷️ #📝/重点

^KEYWF93BBIZ

> <span class="highlight" style="background-color: #e56eee">形参 2 是 TIM_SlaveConfigTypeDef 结构体类型指针变量，用于配置定时器的从模式。</span> ([p303](zotero://open-pdf/library/items/JFGTX7CT?page=303&annotation=WYG3Y8PL))
> 
> 🏷️ #📝/重点

^KEYWYG3Y8PL

> <span class="highlight" style="background-color: #e56eee">触发</span>
> 
> 这里的“触发”是指触发计数器的一次计数，可以是上升沿触发、下降沿触发、上升或下降沿触发 ([p303](zotero://open-pdf/library/items/JFGTX7CT?page=303&annotation=3QTXAQIK))
> 
> 🏷️ #📝/重点

^KEY3QTXAQIK

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_MspInit 函数，我们可以通过后者存放定时器和 GPIO 时钟使能、GPIO 初始化、中断使能和优先级设置等代码</span> ([p304](zotero://open-pdf/library/items/JFGTX7CT?page=304&annotation=D4GNLV7F))
> 
> 🏷️ #📝/重点

^KEYD4GNLV7F

> <span class="highlight" style="background-color: #e56eee">通过 HAL_TIM_IC_ConfigChannel 函数来设置定 时器某个通道为输入捕获通道，包括映射关系，输入滤波和输入分频等</span> ([p304](zotero://open-pdf/library/items/JFGTX7CT?page=304&annotation=V2KZGEZK))
> 
> 🏷️ #📝/重点

^KEYV2KZGEZK

> <span class="highlight" style="background-color: #e56eee">GTIM_TIMX_CNT</span>
> 
> GTIM_TIMX_CNT中的CNT是指"count"计数的意思 ([p305](zotero://open-pdf/library/items/JFGTX7CT?page=305&annotation=QFWNHIB5))
> 
> 🏷️ #📝/重点

^KEYQFWNHIB5

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_Init</span>
> 
> 定时器初始化，此时定时器的通道作为输入通道使用 ([p306](zotero://open-pdf/library/items/JFGTX7CT?page=306&annotation=KURHI6D8))
> 
> 🏷️ #📝/重点

^KEYKURHI6D8

> <span class="highlight" style="background-color: #e56eee">HAL_GPIO_Init</span>
> 
> 定时器输入通道对应 IO 口初始化 ([p306](zotero://open-pdf/library/items/JFGTX7CT?page=306&annotation=7C3TW35K))
> 
> 🏷️ #📝/重点

^KEY7C3TW35K

> <span class="image#e56eee">null</span>当定时器的时钟源选择“外部时钟 1 模式”时，需要对定时器的从模式进行配置。这是相比于“输入捕获”和“输出比骄傲”程序中多出来的部分。
> 
> 如果对这一块不熟悉，可以看“外部时钟模式 1 框图” ([p306](zotero://open-pdf/library/items/JFGTX7CT?page=306&annotation=9EH6XABN))

^KEY9EH6XABN

> <span class="highlight" style="background-color: #e56eee">TI1FP1 作为触发输入源</span>
> 
> 有TI1F_ED、TI1FP1 和 TI2FP2 三个触发输入信号。 ([p306](zotero://open-pdf/library/items/JFGTX7CT?page=306&annotation=WLURTJSI))
> 
> 🏷️ #📝/重点

^KEYWLURTJSI

> <span class="highlight" style="background-color: #e56eee">null</span>
> 
> 由于不需要用到通道的输入捕获和输出比较功能，因此不需要对通道进行配置 ([p306](zotero://open-pdf/library/items/JFGTX7CT?page=306&annotation=DK57RWQA))

^KEYDK57RWQA

> <span class="highlight" style="background-color: #e56eee">HAL_TIM_IC_Start</span>
> 
> 只需要使能通道输入，不需要使能捕获中断 ([p306](zotero://open-pdf/library/items/JFGTX7CT?page=306&annotation=J4FU2N7T))
> 
> 🏷️ #📝/重点

^KEYJ4FU2N7T

> <span class="image#e56eee">null</span>由更新中断触发的定时器中断 ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=2IPZ6B6X))

^KEY2IPZ6B6X

> <span class="highlight" style="background-color: #e56eee">使用__HAL_TIM_GET_FLAG 函数宏获取更新更新中断标志位</span> ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=WPEKLECZ))
> 
> 🏷️ #📝/重点

^KEYWPEKLECZ

> <span class="highlight" style="background-color: #e56eee">最后调用__HAL_TIM_CLEAR_IT 函数宏 清除更新中断标志位</span> ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=X72RDWFX))
> 
> 🏷️ #📝/重点

^KEYX72RDWFX

> <span class="highlight" style="background-color: #e56eee">第一个是获取当前计数值函数</span> ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=WTQPGA6H))
> 
> 🏷️ #📝/重点

^KEYWTQPGA6H

> <span class="highlight" style="background-color: #e56eee">第二个自定义功能函数是重启计数器函数</span> ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=4CE7HCM9))
> 
> 🏷️ #📝/重点

^KEY4CE7HCM9

> <span class="highlight" style="background-color: #e56eee">__HAL_TIM_DISABLE</span> ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=FKF6FQ57))
> 
> 🏷️ #📝/重点

^KEYFKF6FQ57

> <span class="highlight" style="background-color: #e56eee">__HAL_TIM_ENABLE</span> ([p307](zotero://open-pdf/library/items/JFGTX7CT?page=307&annotation=FD5TNHWQ))
> 
> 🏷️ #📝/重点

^KEYFD5TNHWQ

> <span class="highlight" style="background-color: #f19837">第二十四章 OLED 显示实验</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=AK2RAT8D))
> 
> 🏷️ #📝/标题

^KEYAK2RAT8D

> <span class="highlight" style="background-color: #f19837">24.1 OLED 简介</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=IENJ9U5A))
> 
> 🏷️ #📝/标题

^KEYIENJ9U5A

> <span class="highlight" style="background-color: #e56eee">OLED 显示模块</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=24FTVW5I))
> 
> 🏷️ #📝/重点

^KEY24FTVW5I

> <span class="highlight" style="background-color: #e56eee">有以下特点</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=9EQY6PJP))
> 
> 🏷️ #📝/重点

^KEY9EQY6PJP

> <span class="highlight" style="background-color: #e56eee">6800、8080 两种并行接口方式、4 线 SPI 接口方式以及 IIC 接口方式</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=3NBG5L8Z))
> 
> 🏷️ #📝/重点

^KEY3NBG5L8Z

> <span class="highlight" style="background-color: #e56eee">该模块不和 5.0V 接口兼容</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=4SLCMVFM))
> 
> 🏷️ #📝/重点

^KEY4SLCMVFM

> <span class="highlight" style="background-color: #e56eee">以下 4 种模式通过模块的 BS1 和 BS2 设置</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=NC3BNK2E))
> 
> 🏷️ #📝/重点

^KEYNC3BNK2E

> <span class="highlight" style="background-color: #e56eee">正点原子 OLED 模块默认设置是：BS1 和 BS2 接 VCC，即使用 8080 并口方式</span> ([p357](zotero://open-pdf/library/items/JFGTX7CT?page=357&annotation=X229ZIC8))
> 
> 🏷️ #📝/重点

^KEYX229ZIC8

> <span class="highlight" style="background-color: #e56eee">总共有 16 个管脚</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=SBEDYCFL))
> 
> 🏷️ #📝/重点

^KEYSBEDYCFL

> <span class="highlight" style="background-color: #e56eee">我们只用了 15 条，有一个是悬空的</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=9NTM76S2))
> 
> 🏷️ #📝/重点

^KEY9NTM76S2

> <span class="highlight" style="background-color: #e56eee">电源和地线占了 2 条</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=LC7C2ABP))
> 
> 🏷️ #📝/重点

^KEYLC7C2ABP

> <span class="highlight" style="background-color: #e56eee">在不同模式下， 我们需要的信号线数量是不同的</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=5EPBCQXY))
> 
> 🏷️ #📝/重点

^KEY5EPBCQXY

> <span class="highlight" style="background-color: #e56eee">在 8080 模式下，需要全部 13 条</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=H2PPG649))
> 
> 🏷️ #📝/重点

^KEYH2PPG649

> <span class="highlight" style="background-color: #e56eee">在 IIC 模式下，仅需要 2 条线就够了</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=3E8PHM6Q))
> 
> 🏷️ #📝/重点

^KEY3E8PHM6Q

> <span class="highlight" style="background-color: #e56eee">有一条是共同的，那就是复位线 RST</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=4RSX8F42))
> 
> 🏷️ #📝/重点

^KEY4RSX8F42

> <span class="highlight" style="background-color: #e56eee">RST 上的低电平，将导致 OLED 复位，在每次初始化之前，都应该复位一下 OLED 模块。</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=VCXABZ7Q))
> 
> 🏷️ #📝/重点

^KEYVCXABZ7Q

> <span class="highlight" style="background-color: #e56eee">控制器是 SSD1306</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=CYQ46F8B))
> 
> 🏷️ #📝/重点

^KEYCYQ46F8B

> <span class="highlight" style="background-color: #f19837">24.1.1 硬件驱动接口模式</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=RZ8P3MP8))
> 
> 🏷️ #📝/标题

^KEYRZ8P3MP8

> <span class="highlight" style="background-color: #e56eee">8080 并行接口</span>
> 
> 这里的 8 表示： 8 位并行传输 ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=FX6RW7A8))
> 
> 🏷️ #📝/重点

^KEYFX6RW7A8

> <span class="highlight" style="background-color: #e56eee">需要如下一些信号线</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=9JRUN5QP))
> 
> 🏷️ #📝/重点

^KEY9JRUN5QP

> <span class="highlight" style="background-color: #e56eee">模块的 8080 并口写的过程为</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=ADGQCPFP))
> 
> 🏷️ #📝/重点

^KEYADGQCPFP

> <span class="highlight" style="background-color: #e56eee">拉低 WR 的电平准备写入数据</span> ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=45AUDZ5I))
> 
> 🏷️ #📝/重点

^KEY45AUDZ5I

> <span class="highlight" style="background-color: #e56eee">在这个上升沿，使数据写入到 SSD1306 里面</span>
> 
> 并行写数据，即 8 位数据同时写入 ([p358](zotero://open-pdf/library/items/JFGTX7CT?page=358&annotation=STMMS2FH))
> 
> 🏷️ #📝/重点

^KEYSTMMS2FH

> <span class="highlight" style="background-color: #e56eee">模块的 8080 并口读的过程为</span> ([p359](zotero://open-pdf/library/items/JFGTX7CT?page=359&annotation=JNB7D8AW))
> 
> 🏷️ #📝/重点

^KEYJNB7D8AW

> <span class="highlight" style="background-color: #e56eee">在 RD 的上升沿，使数据锁存到数据线</span>
> 
> 数据来源于 SSD1360 ([p359](zotero://open-pdf/library/items/JFGTX7CT?page=359&annotation=8Q5VW2SB))
> 
> 🏷️ #📝/重点

^KEY8Q5VW2SB

> <span class="highlight" style="background-color: #e56eee">在 8080 方式下读数据操作的时候，我们有时候（例如读显存的时候）需要一个假读命</span> ([p359](zotero://open-pdf/library/items/JFGTX7CT?page=359&annotation=4LNE8P47))
> 
> 🏷️ #📝/重点

^KEY4LNE8P47

> <span class="highlight" style="background-color: #e56eee">使得微控制器的操作频率和显存的操作频率相匹配</span> ([p359](zotero://open-pdf/library/items/JFGTX7CT?page=359&annotation=TP4WM5EP))
> 
> 🏷️ #📝/重点

^KEYTP4WM5EP

> <span class="highlight" style="background-color: #e56eee">这里的假读，其实就是第一个读到的字节丢弃不要，从第二个开始， 才是我们真正要读的数据</span> ([p359](zotero://open-pdf/library/items/JFGTX7CT?page=359&annotation=YQSIGAK9))
> 
> 🏷️ #📝/重点

^KEYYQSIGAK9

> <span class="highlight" style="background-color: #e56eee">在发送了列地址之后，开始读数据，第一个是 Dummy Read，也就是假读，我 们从第二个开始，才算是真正有效的数据</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=EIBF6E9G))
> 
> 🏷️ #📝/重点

^KEYEIBF6E9G

> <span class="highlight" style="background-color: #e56eee">SPI 方式的驱动</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=ITU3IV44))
> 
> 🏷️ #📝/重点

^KEYITU3IV44

> <span class="highlight" style="background-color: #e56eee">把代码中的 宏 OLED_MODE 设置为 0</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=RTM657VY))
> 
> 🏷️ #📝/重点

^KEYRTM657VY

> <span class="highlight" style="background-color: #e56eee">对于硬件，则需要查看 PCB 背面的电阻设置以确定当前使用的 是否为 SPI 模式：</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=IG4D48KG))
> 
> 🏷️ #📝/重点

^KEYIG4D48KG

> <span class="highlight" style="background-color: #e56eee">D2 需要悬空，其他引脚可以接到 GND</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=SUIINN7Y))
> 
> 🏷️ #📝/重点

^KEYSUIINN7Y

> <span class="highlight" style="background-color: #e56eee">在 4 线串行模式下，只能往模块写数据而 不能读数据</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=E5943F9Z))
> 
> 🏷️ #📝/重点

^KEYE5943F9Z

> <span class="highlight" style="background-color: #e56eee">SPI 模式下，每个数据长度均为 8 位</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=YHFN73TE))
> 
> 🏷️ #📝/重点

^KEYYHFN73TE

> <span class="highlight" style="background-color: #e56eee">在 SCLK 的上升沿，数据从 SDIN 移入到 SSD1306</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=QUQLJ5A5))
> 
> 🏷️ #📝/重点

^KEYQUQLJ5A5

> <span class="highlight" style="background-color: #e56eee">高位在前的</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=4LEWGXNF))
> 
> 🏷️ #📝/重点

^KEY4LEWGXNF

> <span class="highlight" style="background-color: #f19837">24.1.2 OLED 显存</span>
> 
> ![[正点原子_[正点] HAL库视_KEY-CS2N8HD9#^KEYYNY8IGTD | itemKey="8LNDR3NH" page="2" annotation="YNY8IGTD"]] ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=BZR7TK6H))
> 
> 🏷️ #📝/标题

^KEYBZR7TK6H

> <span class="highlight" style="background-color: #e56eee">null</span>
> 
> 对于这部分的学习看不懂先看相应的视频及文档 ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=WB7NALIV))

^KEYWB7NALIV

> <span class="highlight" style="background-color: #e56eee">SSD1306 的显存总共为 128*64bit 大小</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=7VQY4M92))
> 
> 🏷️ #📝/重点

^KEY7VQY4M92

> <span class="highlight" style="background-color: #e56eee">分为了 8 页</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=TQC55CC8))
> 
> 🏷️ #📝/重点

^KEYTQC55CC8

> <span class="highlight" style="background-color: #e56eee">SSD1306 的每页包含了 128 个字节，总共 8 页</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=NM4BNC8G))
> 
> 🏷️ #📝/重点

^KEYNM4BNC8G

> <span class="highlight" style="background-color: #e56eee">当 GRAM 的写入模式为页模式时，需要设置低字节起始的列地址（0x00~0x0F）和高字</span> ([p360](zotero://open-pdf/library/items/JFGTX7CT?page=360&annotation=JZPGK4BE))
> 
> 🏷️ #📝/重点

^KEYJZPGK4BE

> <span class="highlight" style="background-color: #e56eee">节的起始列地址（0x10~0x1F）</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=EPBJHRAA))
> 
> 🏷️ #📝/重点

^KEYEPBJHRAA

> <span class="highlight" style="background-color: #e56eee">写入列地 址在写完一字节后自动按列增长</span>
> 
> 再一页中，按列写入数据（一列代表一个字节），写完之后，列指针自动加一。当列指针到达最后一列时，如果没有换页，则列指针会回到第一列，覆盖原来已写数据。 ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=C8KKC9GF))
> 
> 🏷️ #📝/重点

^KEYC8KKC9GF

> <span class="highlight" style="background-color: #e56eee">如果我们使用只写方式操作模块， 那么，每次要写 8 个点，这样，我们在画点的时候，就必须把要设置的点所在的字节的每个位 都搞清楚当前的状态（0/1？），否则写入的数据就会覆盖掉之前的状态，结果就是有些不需要 显示的点，显示出来了，或者该显示的没有显示了</span>
> 
> 先把要设置的点所在字节读出来，然后通过与或操作修改需要设置的位，然后再将该字节写进去，即：读 -> 修改 -> 写。
> 
> 如果不把该字节读出来再修改，而是直接写入数据，会将其他位的原本状态覆盖掉。 ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=6R7IXYYQ))
> 
> 🏷️ #📝/重点

^KEY6R7IXYYQ

> <span class="highlight" style="background-color: #e56eee">但是这样需要能读 GRAM，对于 4 线 SPI 模式/IIC 模式，模块是不支持 读的，而且读→改→写的方式速度也比较慢</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=H4FVT9HE))
> 
> 🏷️ #📝/重点

^KEYH4FVT9HE

> <span class="highlight" style="background-color: #e56eee">我们采用的办法是在 STM32F103 的内部建立一个虚拟的 OLED 的 GRAM</span>
> 
> 注意：GRAM 是显存，真实位于 SSD1306 控制器中。32内部虚拟的 GRAM 是 SRAM 中的一段内存空间，与 SSD1306 控制器中 GRAM 显存对应，相当于真是 GRAM 的副本。 ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=IVES5PZD))
> 
> 🏷️ #📝/重点

^KEYIVES5PZD

> <span class="highlight" style="background-color: #e56eee">每次修改时，只修改 STM32F103 上的 GRAM（实际上就是 SRAM），在 修改完成后一次性把 STM3F103 上的 GRAM 写入到 OLED 的 GRAM</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=NS44Q83I))
> 
> 🏷️ #📝/重点

^KEYNS44Q83I

> <span class="highlight" style="background-color: #e56eee">对于那些 SRAM 很小的单片机（比如 51 系列）不太友好</span>
> 
> 占用 1 KB 的内存空间 ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=2HUDZPRC))
> 
> 🏷️ #📝/重点

^KEY2HUDZPRC

> <span class="highlight" style="background-color: #e56eee">每次都写入全屏，屏 幕刷新率会变低。</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=6NEZTAAW))
> 
> 🏷️ #📝/重点

^KEY6NEZTAAW

> <span class="image#e56eee">null</span>SSD1306常用命令表 ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=HQ7RGFC7))

^KEYHQ7RGFC7

> <span class="highlight" style="background-color: #e56eee">第 0 个命令为 0X81，用于设置对比度的，这个命令包含了两个字节</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=3ND2VVYW))
> 
> 🏷️ #📝/重点

^KEY3ND2VVYW

> <span class="highlight" style="background-color: #e56eee">第一个 0X81 为命令</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=CBV87LN5))
> 
> 🏷️ #📝/重点

^KEYCBV87LN5

> <span class="highlight" style="background-color: #e56eee">随后发送的一个字节为要设置的对比度的值。这个值设置得越大屏幕就越亮</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=SW2JVVP8))
> 
> 🏷️ #📝/重点

^KEYSW2JVVP8

> <span class="highlight" style="background-color: #e56eee">第 1 个命令为 0XAE/0XAF。0XAE 为关闭显示命令；0XAF 为开启显示命令</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=ITQEFRMU))
> 
> 🏷️ #📝/重点

^KEYITQEFRMU

> <span class="highlight" style="background-color: #e56eee">第 2 个命令为 0X8D，该指令也包含 2 个字节</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=VQU6BVRP))
> 
> 🏷️ #📝/重点

^KEYVQU6BVRP

> <span class="highlight" style="background-color: #e56eee">第一个为命令字</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=W3TEZ2P8))
> 
> 🏷️ #📝/重点

^KEYW3TEZ2P8

> <span class="highlight" style="background-color: #e56eee">第二个为设置值，第二 个字节的 BIT2 表示电荷泵的开关状态，该位为 1，则开启电荷泵，为 0 则关闭</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=YU5VHLBR))
> 
> 🏷️ #📝/重点

^KEYYU5VHLBR

> <span class="highlight" style="background-color: #e56eee">在模块初始化 的时候，这个必须要开启，否则是看不到屏幕显示的</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=2MR4MQ4W))
> 
> 🏷️ #📝/重点

^KEY2MR4MQ4W

> <span class="highlight" style="background-color: #e56eee">第 3 个命令为 0XB0~B7</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=NWIXYMZ3))
> 
> 🏷️ #📝/重点

^KEYNWIXYMZ3

> <span class="highlight" style="background-color: #e56eee">该命令用于设置页地址，其低三位的值对应着 GRAM 的页地址</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=DF6AUVEZ))
> 
> 🏷️ #📝/重点

^KEYDF6AUVEZ

> <span class="highlight" style="background-color: #e56eee">第 4 个指令为 0X00~0X0F</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=FAY2BVR5))
> 
> 🏷️ #📝/重点

^KEYFAY2BVR5

> <span class="highlight" style="background-color: #e56eee">起始列地址低四位</span>
> 
> 完整的列地址需要两条指令 ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=Q8NQHX9Y))
> 
> 🏷️ #📝/重点

^KEYQ8NQHX9Y

> <span class="highlight" style="background-color: #e56eee">第 6 个指令为 0X10~0X1F</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=J8PGT9FV))
> 
> 🏷️ #📝/重点

^KEYJ8PGT9FV

> <span class="highlight" style="background-color: #e56eee">起始列地址高四位</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=97T4E3YK))
> 
> 🏷️ #📝/重点

^KEY97T4E3YK

> <span class="highlight" style="background-color: #e56eee">参考 SSD1306 datasheet 的第 28 页</span> ([p361](zotero://open-pdf/library/items/JFGTX7CT?page=361&annotation=596NB86N))
> 
> 🏷️ #📝/重点

^KEY596NB86N

> <span class="image#e56eee">null</span> ([p363](zotero://open-pdf/library/items/JFGTX7CT?page=363&annotation=Y2GJX2PR))

^KEYY2GJX2PR

> <span class="highlight" style="background-color: #e56eee">oledfont.h 头文件存放的是 ASCII 字符集</span> ([p364](zotero://open-pdf/library/items/JFGTX7CT?page=364&annotation=6RXLH2CL))
> 
> 🏷️ #📝/重点

^KEY6RXLH2CL

> <span class="image#e56eee">null</span>要看懂字符集库：
> 
> 12 * 12 大小的字符集库中，每一行表示一个字符。对于每一行，每两个连续的字节（共16位，即两页，每一位控制对应像素点是否起作用）控制点阵中的一列像素点；
> 
> 16 * 16大小的字符集库中，每一行代表一个字符。对于每一行，每两个连续的字节（共16位，即两页，每一位控制对应像素点是否起作用）控制点阵中的一列像素点；
> 
> 24 * 24 大小的字符集库中，每一行代表一个字符。对于每一行，每三个连续的字节（共24位，即三页，每一位控制对应像素点是否起作用）控制点阵中的一列像素点； ([p365](zotero://open-pdf/library/items/JFGTX7CT?page=365&annotation=XRYZP2MN))

^KEYXRYZP2MN

> <span class="highlight" style="background-color: #e56eee">如果最后不足 8 个点就补满 8 位</span> ([p366](zotero://open-pdf/library/items/JFGTX7CT?page=366&annotation=THUPVCSG))
> 
> 🏷️ #📝/重点

^KEYTHUPVCSG

> <span class="highlight" style="background-color: #e56eee">从上到下，从左到右，高位在前</span> ([p366](zotero://open-pdf/library/items/JFGTX7CT?page=366&annotation=TIFSYUFH))
> 
> 🏷️ #📝/重点

^KEYTIFSYUFH

> <span class="highlight" style="background-color: #e56eee">对应汉字大小为 12*12、16*16 和 24*24，字符的只有汉字的 一半大</span> ([p366](zotero://open-pdf/library/items/JFGTX7CT?page=366&annotation=PMHZZCTH))
> 
> 🏷️ #📝/重点

^KEYPMHZZCTH

> <span class="highlight" style="background-color: #e56eee">每个 12*6 的字符占用 12 个字节，每个 16*8 的字符占用 16 个字节，每个 24*12 的 字符占用 36 个字节</span> ([p366](zotero://open-pdf/library/items/JFGTX7CT?page=366&annotation=KVPNVJNF))
> 
> 🏷️ #📝/重点

^KEYKVPNVJNF

> <span class="highlight" style="background-color: #e56eee">宏定义 OLED_MODE 来决定使用 4 线串行模式（0）还是并行 8080 模式（1）</span> ([p366](zotero://open-pdf/library/items/JFGTX7CT?page=366&annotation=55GJA3PS))
> 
> 🏷️ #📝/重点

^KEY55GJA3PS

> <span class="highlight" style="background-color: #e56eee">向 OLED 写入选择命令或者数据的宏定义</span> ([p366](zotero://open-pdf/library/items/JFGTX7CT?page=366&annotation=U44ZF3Y2))
> 
> 🏷️ #📝/重点

^KEYU44ZF3Y2

> <span class="image#e56eee">null</span>同时对多个引脚进行设置 ([p367](zotero://open-pdf/library/items/JFGTX7CT?page=367&annotation=URX6JBH5))

^KEYURX6JBH5

> <span class="highlight" style="background-color: #e56eee">OLED_RS</span>
> 
> 该引脚也叫 DC 引脚，用于决定发送的是数据还是命令。
> 
> 当该引脚为低电平时，发送命令；反之，发送数据。 ([p367](zotero://open-pdf/library/items/JFGTX7CT?page=367&annotation=BBGPPA8W))
> 
> 🏷️ #📝/重点

^KEYBBGPPA8W

> <span class="highlight" style="background-color: #e56eee">内存地址模式</span>
> 
> 三种内存地址模式 ([p367](zotero://open-pdf/library/items/JFGTX7CT?page=367&annotation=NJA24UU9))
> 
> 🏷️ #📝/重点

^KEYNJA24UU9

> <span class="highlight" style="background-color: #e56eee">00，列地址模式;01，行地址模式;10,页地址模式;默认 10</span> ([p367](zotero://open-pdf/library/items/JFGTX7CT?page=367&annotation=LHNDW6B3))
> 
> 🏷️ #📝/重点

^KEYLHNDW6B3

> <span class="highlight" style="background-color: #e56eee">段重定义设置,bit0</span>
> 
> 位 0 用于设置段重映射 ([p367](zotero://open-pdf/library/items/JFGTX7CT?page=367&annotation=USCE5QBZ))
> 
> 🏷️ #📝/重点

^KEYUSCE5QBZ

> <span class="highlight" style="background-color: #e56eee">设置 COM 扫描方向;bit3</span>
> 
> 位 3 用于设置 COM 扫描方向 ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=LINX2NV5))
> 
> 🏷️ #📝/重点

^KEYLINX2NV5

> <span class="highlight" style="background-color: #e56eee">0,普通模式;</span>
> 
> 普通模式： COM0 -> COM[N-1] ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=7UICK4ZB))
> 
> 🏷️ #📝/重点

^KEY7UICK4ZB

> <span class="highlight" style="background-color: #e56eee">1,重定义模式 COM[N-1]->COM0;</span> ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=WCTYXE8L))
> 
> 🏷️ #📝/重点

^KEYWCTYXE8L

> <span class="highlight" style="background-color: #e56eee">后面的就是一些初始化序列了，我们按照厂家提供的资料来做就可以</span> ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=Q8A44JW6))
> 
> 🏷️ #📝/重点

^KEYQ8A44JW6

> <span class="highlight" style="background-color: #e56eee">因为 OLED 是无背光的，在初始化之后，我们把显存都清空了，所以我们 在屏幕上是看不到任何内容的，就像没通电一样，不要以为这就是初始化失败，要写入数据模 块才会显示的</span> ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=9UJRKSJZ))
> 
> 🏷️ #📝/重点

^KEY9UJRKSJZ

> <span class="highlight" style="background-color: #e56eee">oled_refresh_gram 更新显存到 OLED 函数，该函数的作用是把我们在程 序中定义的二维数组 g_oled_gram 的值一次性刷新到 OLED 的显存 GRAM 中</span> ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=AITKJRR7))
> 
> 🏷️ #📝/重点

^KEYAITKJRR7

> <span class="highlight" style="background-color: #e56eee">8 表示有 64 行</span>
> 
> 8 表示有 8 个字节，每个字节表示 8 个像素，因此有 8 x8 = 64 行 ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=F4S6EW8F))
> 
> 🏷️ #📝/重点

^KEYF4S6EW8F

> <span class="highlight" style="background-color: #e56eee">g_oled_gram[0][0],包含了第一列,第 1~8 行的数据. g_oled_gram[0][0].0,即表示坐标 * (0,0)</span>
> 
> 注意这个二维数组的表示含义。
> 
> g_oled_gram[0][0].0
> 
> 第一个 0 表示第 1 列；
> 
> 第二个 0 表示第 1 页；
> 
> 第三个 0 表示该页中的第 1 位。 ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=5XVSSQP8))
> 
> 🏷️ #📝/重点

^KEY5XVSSQP8

> <span class="highlight" style="background-color: #e56eee">g_oled_gram[128][8]</span>
> 
> 注意这个数组定义，是列在前，页在后。数组里位的存放和实际像素点的位置是倒的。 ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=QNN3NPPI))
> 
> 🏷️ #📝/重点

^KEYQNN3NPPI

> <span class="highlight" style="background-color: #e56eee">。在操作的时候我们只需要先修改该数组的值， 然后再通过调用 oled_refresh_gram 函数把数组的值一次性刷新到 OLED 的 GRAM 上即可</span> ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=ITID5EHV))
> 
> 🏷️ #📝/重点

^KEYITID5EHV

> <span class="image#e56eee">null</span>一页一页地把数据刷进 GRAM ([p368](zotero://open-pdf/library/items/JFGTX7CT?page=368&annotation=ZWWZIH7X))

^KEYZWWZIH7X

> <span class="highlight" style="background-color: #e56eee">先设置页地址，然后写入列地址（也就是纵坐标），然后从 0 开始写 入 128 个字节，写满该页，最后循环把 8 页的内容都写入，就实现了整个从 STM32 显存到 OLED 显存的拷贝</span> ([p369](zotero://open-pdf/library/items/JFGTX7CT?page=369&annotation=BMSZ9JSS))
> 
> 🏷️ #📝/重点

^KEYBMSZ9JSS

> <span class="highlight" style="background-color: #e56eee">向 OLED 写入一个字节</span>
> 
> 8080并口模式下的写操作 ([p369](zotero://open-pdf/library/items/JFGTX7CT?page=369&annotation=SGYZLEW6))
> 
> 🏷️ #📝/重点

^KEYSGYZLEW6

> <span class="highlight" style="background-color: #e56eee">cmd: 数据/命令标志 0,表示命令;1,表示数据;</span> ([p369](zotero://open-pdf/library/items/JFGTX7CT?page=369&annotation=357B8WC7))
> 
> 🏷️ #📝/重点

^KEY357B8WC7

> <span class="highlight" style="background-color: #e56eee">oled_data_out(data);</span>
> 
> 往数据线 D0~D7  写入数据 ([p369](zotero://open-pdf/library/items/JFGTX7CT?page=369&annotation=7XEMPTGF))
> 
> 🏷️ #📝/重点

^KEY7XEMPTGF

> <span class="highlight" style="background-color: #e56eee">向 GPIOC 的低位输出一次数据即可实现并 口数据输出。</span> ([p369](zotero://open-pdf/library/items/JFGTX7CT?page=369&annotation=E2PIZIDD))
> 
> 🏷️ #📝/重点

^KEYE2PIZIDD

> <span class="highlight" style="background-color: #e56eee">g_oled_gram [128][8]二维数组中的 128 代表列数（x 坐标），而 8 代表的是页，每页又包含 8 行，总共 64 行（y 坐标），从高到低对应行数从小到大</span> ([p370](zotero://open-pdf/library/items/JFGTX7CT?page=370&annotation=MRFF86GU))
> 
> 🏷️ #📝/重点

^KEYMRFF86GU

> <span class="highlight" style="background-color: #e56eee">一个通用的在点（x，y）置 1 表达式为</span> ([p370](zotero://open-pdf/library/items/JFGTX7CT?page=370&annotation=JYN93U4S))
> 
> 🏷️ #📝/重点

^KEYJYN93U4S

> <span class="highlight" style="background-color: #e56eee">OLED_GRAM [x][y/8] |= 1<<(y%8)；</span> ([p370](zotero://open-pdf/library/items/JFGTX7CT?page=370&annotation=CQAFEE8K))
> 
> 🏷️ #📝/重点

^KEYCQAFEE8K

> <span class="highlight" style="background-color: #e56eee">OLED 画点函数</span>
> 
> 这个画点函数是修改 stm32 里虚拟GRAM数组的值，当修改完成之后，将这个虚拟数组一页一页的刷进控制器。 ([p370](zotero://open-pdf/library/items/JFGTX7CT?page=370&annotation=6IIA4YHP))
> 
> 🏷️ #📝/重点

^KEY6IIA4YHP

> <span class="highlight" style="background-color: #e56eee">(size / 8 + ((size % 8) ? 1 : 0)) * (size / 2)</span>
> 
> 这是计算字体的一个字符所占的字节数：首先将其除以8，因为8个bit组成一个字节。然后我们使用(size % 8)是否为0的条件来判断是否需要进一步增加一个字节。还需要乘以列数来考虑完整的字符表示。因为字符的宽度（即列数）通常是高度的一半，所以我们使用size/2来计算字符的列数。 ([p371](zotero://open-pdf/library/items/JFGTX7CT?page=371&annotation=UVBXFP46))
> 
> 🏷️ #📝/重点

^KEYUVBXFP46

> <span class="image#e56eee">null</span>扫描的方式：从上到下，从左到右。
> 
> 这里的“扫描”是指在点阵里的画点顺序，要和 “将虚拟 GRAM 刷新到 OLED 的GRAM”操作区分开来。只有执行完扫描操作，才能执行刷新操作。 ([p371](zotero://open-pdf/library/items/JFGTX7CT?page=371&annotation=AD6UBZBP))

^KEYAD6UBZBP

> <span class="image#e56eee">null</span>不断的显示 ASCII 字符及对应的码值 ([p372](zotero://open-pdf/library/items/JFGTX7CT?page=372&annotation=X2PM8CAV))

^KEYX2PM8CAV

> <span class="highlight" style="background-color: #f19837">第二十五章 TFTLCD（MCU 屏）实验</span> ([p374](zotero://open-pdf/library/items/JFGTX7CT?page=374&annotation=QTVCNNSH))
> 
> 🏷️ #📝/标题

^KEYQTVCNNSH

> <span class="highlight" style="background-color: #f19837">25.1 TFTLCD 简介</span> ([p374](zotero://open-pdf/library/items/JFGTX7CT?page=374&annotation=JU67R3GT))
> 
> 🏷️ #📝/标题

^KEYJU67R3GT

> <span class="highlight" style="background-color: #f19837">25.1.1 TFTLCD 简介</span> ([p374](zotero://open-pdf/library/items/JFGTX7CT?page=374&annotation=BUEIL7QB))
> 
> 🏷️ #📝/标题

^KEYBUEIL7QB

> <span class="highlight" style="background-color: #e56eee">液晶显示器，即 Liquid Crystal Display</span> ([p374](zotero://open-pdf/library/items/JFGTX7CT?page=374&annotation=NXPSADER))
> 
> 🏷️ #📝/重点

^KEYNXPSADER

> <span class="highlight" style="background-color: #e56eee">由于液晶本身不会发光，加上液晶本身的特性等原因，使得液晶屏的成像角受限，我们从 屏幕的的一侧可能无法看清液晶的显示内容</span> ([p374](zotero://open-pdf/library/items/JFGTX7CT?page=374&annotation=6VGUCTX4))
> 
> 🏷️ #📝/重点

^KEY6VGUCTX4

> <span class="highlight" style="background-color: #e56eee">该模块支持 65K 色显示， 显示分辨率为 320×240，接口为 16 位的 8080 并口，自带触摸功能</span> ([p374](zotero://open-pdf/library/items/JFGTX7CT?page=374&annotation=6TN9HMNE))
> 
> 🏷️ #📝/重点

^KEY6TN9HMNE

> <span class="highlight" style="background-color: #e56eee">正点原子 TFTLCD 模块采用 16 位的并方式与外部连接</span> ([p375](zotero://open-pdf/library/items/JFGTX7CT?page=375&annotation=IMA36335))
> 
> 🏷️ #📝/重点

^KEYIMA36335

> <span class="image#e56eee">null</span> ([p375](zotero://open-pdf/library/items/JFGTX7CT?page=375&annotation=35RBL3ZH))

^KEY35RBL3ZH

> <span class="highlight" style="background-color: #e56eee">液晶显示控制器</span> ([p375](zotero://open-pdf/library/items/JFGTX7CT?page=375&annotation=IJANXUU6))
> 
> 🏷️ #📝/重点

^KEYIJANXUU6

> <span class="highlight" style="background-color: #e56eee">控制 LCD 显示的过程，就是按其显示驱动芯片的时序，把色彩和位置信息 正确地写入对应的寄存器</span> ([p375](zotero://open-pdf/library/items/JFGTX7CT?page=375&annotation=W9D5DC2M))
> 
> 🏷️ #📝/重点

^KEYW9D5DC2M

> <span class="highlight" style="background-color: #f19837">25.1.2 液晶显示控制器</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=6SQ4BAG2))
> 
> 🏷️ #📝/标题

^KEY6SQ4BAG2

> <span class="highlight" style="background-color: #e56eee">以 ILI9341 控制器</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=XYSL26HT))
> 
> 🏷️ #📝/重点

^KEYXYSL26HT

> <span class="highlight" style="background-color: #e56eee">ILI9341 液晶控制器自带显存，可配置支持 8/9/16/18 位的总线中的一种，可以通过 3/4 线 串行协议或 8080 并口驱动</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=IRRNITCF))
> 
> 🏷️ #📝/重点

^KEYIRRNITCF

> <span class="highlight" style="background-color: #e56eee">电路配置为 8080 并口方式</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=AWHQDDNM))
> 
> 🏷️ #📝/重点

^KEYAWHQDDNM

> <span class="highlight" style="background-color: #e56eee">其显 存总大小为 172800（240*320*18/8），即 18 位模式（26 万色）下的显存量</span>
> 
> 每个像素点由 18 位组成 ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=RH3LFAQG))
> 
> 🏷️ #📝/重点

^KEYRH3LFAQG

> <span class="highlight" style="background-color: #e56eee">在 16 位模式下， ILI9341 采用 RGB565 格式存储颜色数据</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=XP3A3DEC))
> 
> 🏷️ #📝/重点

^KEYXP3A3DEC

> <span class="highlight" style="background-color: #e56eee">ILI9341</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=UGFTDGAL))
> 
> 🏷️ #📝/重点

^KEYUGFTDGAL

> <span class="highlight" style="background-color: #e56eee">对外的 数据线使用 DB0-DB15 连接 MCU 的 D0-D15 实现 16 位颜色的传输</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=MIV4H5H5))
> 
> 🏷️ #📝/重点

^KEYMIV4H5H5

> <span class="highlight" style="background-color: #e56eee">MCU 的 16 位数据，最低 5 位代表蓝色，中间 6 位为绿色，最高 5 位为红色。数值越 大，表示该颜色越深</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=FCRETEH9))
> 
> 🏷️ #📝/重点

^KEYFCRETEH9

> <span class="highlight" style="background-color: #e56eee">ILI9341 所有的指令都是 8 位的（高 8 位无效），且参数 除了读写 GRAM 的时候是 16 位，其他操作参数，都是 8 位的。</span> ([p376](zotero://open-pdf/library/items/JFGTX7CT?page=376&annotation=HDFBVLXH))
> 
> 🏷️ #📝/重点

^KEYHDFBVLXH

> <span class="highlight" style="background-color: #e56eee">需要控制片选 CSX 拉低（标注为①），之后对其它的控制线的电平才有效</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=2IWUQAIM))
> 
> 🏷️ #📝/重点

^KEY2IWUQAIM

> <span class="highlight" style="background-color: #e56eee">需要数据线在入电平拉高后再操持一段 时间以便数据被正确采样</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=9YHPZ4JZ))
> 
> 🏷️ #📝/重点

^KEY9YHPZ4JZ

> <span class="highlight" style="background-color: #e56eee">0xD3，0x36，0x2A，0x2B，0x2C，0x2E 等 6 条指令</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=DDHUEG6T))
> 
> 🏷️ #📝/重点

^KEYDDHUEG6T

> <span class="highlight" style="background-color: #e56eee">指令 0xD3，是读 ID4 指令，用于读取 LCD 控制器的 ID</span>
> 
> "是读 ID 指令" ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=FLF5FDFG))
> 
> 🏷️ #📝/重点

^KEYFLF5FDFG

> <span class="image#e56eee">null</span>这一列表示接收发送该数据或指令时，三个引脚的状态。 ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=RV9B9AUI))

^KEYRV9B9AUI

> <span class="highlight" style="background-color: #e56eee">D3H</span>
> 
> 最后的 H 表示十六进制 ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=YBZRIP3Y))
> 
> 🏷️ #📝/重点

^KEYYBZRIP3Y

> <span class="highlight" style="background-color: #e56eee">0xD3 指令后面跟了 4 个参数，最后 2 个参数，读出来是 0x93 和 0x41</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=YIDLY7H5))
> 
> 🏷️ #📝/重点

^KEYYIDLY7H5

> <span class="highlight" style="background-color: #e56eee">刚好是我们控制器 ILI9341 的数字部分</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=S7HXT5F4))
> 
> 🏷️ #📝/重点

^KEYS7HXT5F4

> <span class="highlight" style="background-color: #e56eee">通过该指令，即可判别所用的 LCD 驱动器是什 么型号</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=SRZFAXFU))
> 
> 🏷️ #📝/重点

^KEYSRZFAXFU

> <span class="highlight" style="background-color: #e56eee">可以根据控制器的型号去执行对应驱动 IC 的初始化代码，从而 兼容不同驱动 IC 的屏，使得一个代码支持多款 LCD</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=Z9F8M42E))
> 
> 🏷️ #📝/重点

^KEYZ9F8M42E

> <span class="highlight" style="background-color: #e56eee">0x36，这是存储访问控制指令，可以控制 ILI9341 存储器的读写方向</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=XEM55YIC))
> 
> 🏷️ #📝/重点

^KEYXEM55YIC

> <span class="highlight" style="background-color: #e56eee">在连续写 GRAM 的时候，可以控制 GRAM 指针的增长方向，从而控制显示方式</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=CEBSNISD))
> 
> 🏷️ #📝/重点

^KEYCEBSNISD

> <span class="highlight" style="background-color: #e56eee">主要关注：MY、MX、MV 这三个 位，通过这三个位的设置，我们可以控制整个 ILI9341 的全部扫描方向</span> ([p377](zotero://open-pdf/library/items/JFGTX7CT?page=377&annotation=2DAY8NEJ))
> 
> 🏷️ #📝/重点

^KEY2DAY8NEJ

> <span class="highlight" style="background-color: #e56eee">实验中，我们默认使用从左到右，从上到下的扫描方式</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=KFKKBBYH))
> 
> 🏷️ #📝/重点

^KEYKFKKBBYH

> <span class="highlight" style="background-color: #e56eee">接下来看指令：0x2A，这是列地址设置指令</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=XUYPBJCZ))
> 
> 🏷️ #📝/重点

^KEYXUYPBJCZ

> <span class="highlight" style="background-color: #e56eee">该指令带有 4 个参数，实际上是 2 个坐标值： SC 和 EC，即列地址的起始值和结束值</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=3PDB48AU))
> 
> 🏷️ #📝/重点

^KEY3PDB48AU

> <span class="highlight" style="background-color: #e56eee">SC 必须小于等于 EC，且 0≤SC/EC≤239</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=ZQ29VF6P))
> 
> 🏷️ #📝/重点

^KEYZQ29VF6P

> <span class="highlight" style="background-color: #e56eee">一般在设 置 x 坐标的时候，我们只需要带 2 个参数即可，也就是设置 SC 即可，因为如果 EC 没有变化， 我们只需要设置一次即可（在初始化 ILI9341 的时候设置），从而提高速度。</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=LBC2F6FN))
> 
> 🏷️ #📝/重点

^KEYLBC2F6FN

> <span class="highlight" style="background-color: #e56eee">指令：0X2B，是页地址设置指令，在从左到右，从上到下的扫描方式 （默认）下面，该指令用于设置纵坐标（y 坐标）</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=GUA8Z2PE))
> 
> 🏷️ #📝/重点

^KEYGUA8Z2PE

> <span class="highlight" style="background-color: #e56eee">设置 y 坐标，该指令带有 4 个参数，实际上是 2 个坐标值： SP 和 EP，即页地址的起始值和结束值</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=VDI98DMC))
> 
> 🏷️ #📝/重点

^KEYVDI98DMC

> <span class="highlight" style="background-color: #e56eee">SP 必须小于等于 EP，且 0≤SP/EP≤319</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=WVT66JVC))
> 
> 🏷️ #📝/重点

^KEYWVT66JVC

> <span class="highlight" style="background-color: #e56eee">一般在设置 y 坐标的时候，我们只需要带 2 个参数即可，也就是设置 SP 即可</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=GRK3VAXN))
> 
> 🏷️ #📝/重点

^KEYGRK3VAXN

> <span class="highlight" style="background-color: #e56eee">0X2C，该指令是写 GRAM 指令</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=NS42KW6B))
> 
> 🏷️ #📝/重点

^KEYNS42KW6B

> <span class="highlight" style="background-color: #e56eee">支持连续写</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=GMZYPPZ5))
> 
> 🏷️ #📝/重点

^KEYGMZYPPZ5

> <span class="highlight" style="background-color: #e56eee">我们可以连续写入 LCD GRAM 值，而 GRAM 的地址将根据 MY/MX/MV 设置的扫描方向进行自增。例如：假设 设置的是从左到右，从上到下的扫描方式，那么设置好起始坐标（通过 SC，SP 设置）后，每 写入一个颜色值，GRAM 地址将会自动自增 1（SC++），如果碰到 EC，则回到 SC，同时 SP++， 一直到坐标：EC，EP 结束，期间无需再次设置的坐标，从而大大提高写入速度。</span>
> 
> 写入GRAM 的方式 ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=GJDJN9CN))
> 
> 🏷️ #📝/重点

^KEYGJDJN9CN

> <span class="highlight" style="background-color: #e56eee">0X2E，该指令是读 GRAM 指令</span> ([p378](zotero://open-pdf/library/items/JFGTX7CT?page=378&annotation=5H2QNZPA))
> 
> 🏷️ #📝/重点

^KEY5H2QNZPA

> <span class="highlight" style="background-color: #f19837">第二十六章 USMART 调试组件实验</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=3XQCPIA5))
> 
> 🏷️ #📝/标题

^KEY3XQCPIA5

> <span class="highlight" style="background-color: #e56eee">USMART 最主要的功能 就是通过串口调用单片机里面的函数，并执行，对我们调试代码是很有帮助的</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=8H6FGVRZ))
> 
> 🏷️ #📝/重点

^KEY8H6FGVRZ

> <span class="highlight" style="background-color: #f19837">26.1 USMART 调试组件简介</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=SMYW9B9I))
> 
> 🏷️ #📝/标题

^KEYSMYW9B9I

> <span class="highlight" style="background-color: #e56eee">通过串口助手 调用程序里面的任何函数，并执行</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=W2L8ZBU4))
> 
> 🏷️ #📝/重点

^KEYW2L8ZBU4

> <span class="highlight" style="background-color: #e56eee">你可以随意更改函数的输入参数</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=4WDEJK9W))
> 
> 🏷️ #📝/重点

^KEY4WDEJK9W

> <span class="highlight" style="background-color: #e56eee">单个函数最多支持 10 个输入参数，并 支持函数返回值显示</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=EF6RAUW5))
> 
> 🏷️ #📝/重点

^KEYEF6RAUW5

> <span class="highlight" style="background-color: #e56eee">而利用 USMART，则只需要在串口调试助手里面输入函数及参数，然后直接串口发送给单片机，就执 行了一次参数调整</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=ERNZXRIX))
> 
> 🏷️ #📝/重点

^KEYERNZXRIX

> <span class="highlight" style="background-color: #e56eee">参数类型</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=FD4FPX36))
> 
> 🏷️ #📝/重点

^KEYFD4FPX36

> <span class="highlight" style="background-color: #e56eee">10 或者 16 进制数字、字 符串指针</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=G5BKC5RE))
> 
> 🏷️ #📝/重点

^KEYG5BKC5RE

> <span class="highlight" style="background-color: #e56eee">函数指针</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=38TUS5ER))
> 
> 🏷️ #📝/重点

^KEY38TUS5ER

> <span class="highlight" style="background-color: #e56eee">对于不能直接调用的，你只需要重写一个函数，把影响调用的 参数去掉即可，这个重写后的函数，即可以被 USMART 调用了</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=7JS9EERS))
> 
> 🏷️ #📝/重点

^KEY7JS9EERS

> <span class="highlight" style="background-color: #e56eee">USMART 的实现流程</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=5F9D47UP))
> 
> 🏷️ #📝/重点

^KEY5F9D47UP

> <span class="highlight" style="background-color: #e56eee">第一步，添加需要调用的函数</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=SALE5MUZ))
> 
> 🏷️ #📝/重点

^KEYSALE5MUZ

> <span class="highlight" style="background-color: #e56eee">第二步，初始化串口</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=LIXA3XND))
> 
> 🏷️ #📝/重点

^KEYLIXA3XND

> <span class="highlight" style="background-color: #e56eee">第三步，初始化 USMART</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=IDR6SG8B))
> 
> 🏷️ #📝/重点

^KEYIDR6SG8B

> <span class="highlight" style="background-color: #e56eee">第四步，轮询 usmart_scan 函数，处理串口数据</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=2X5VSSFW))
> 
> 🏷️ #📝/重点

^KEY2X5VSSFW

> <span class="highlight" style="background-color: #e56eee">包含 8 个文件</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=HLGJMVSU))
> 
> 🏷️ #📝/重点

^KEYHLGJMVSU

> <span class="highlight" style="background-color: #e56eee">每个文件的作用如表</span> ([p404](zotero://open-pdf/library/items/JFGTX7CT?page=404&annotation=BQS2J3ZT))
> 
> 🏷️ #📝/重点

^KEYBQS2J3ZT

> <span class="image#e56eee">null</span>主要修改这三个文件 ([p405](zotero://open-pdf/library/items/JFGTX7CT?page=405&annotation=FHBTL7Q4))

^KEYFHBTL7Q4

> <span class="highlight" style="background-color: #e56eee">USMART 驱动代码</span> ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=66M6AG5Q))
> 
> 🏷️ #📝/重点

^KEY66M6AG5Q

> <span class="highlight" style="background-color: #e56eee">USMART 的移植非常简单，我们只需要修改 usmart_port.c 里面的 5 个函数即可完成移植</span>
> 
> 主要修改定时器和串口 ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=IPM5WCUZ))
> 
> 🏷️ #📝/重点

^KEYIPM5WCUZ

> <span class="highlight" style="background-color: #e56eee">第一个函数，USMART 输入数据流获取函数</span> ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=JLMBFDDG))
> 
> 🏷️ #📝/重点

^KEYJLMBFDDG

> <span class="highlight" style="background-color: #e56eee">通过 SYSTEM 文件夹默认的串口接收来实现输入数据流获取</span> ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=DVG7SNVY))
> 
> 🏷️ #📝/重点

^KEYDVG7SNVY

> <span class="highlight" style="background-color: #e56eee">SYSTEM 文件夹里 面的串口接收函数，最大可以一次接收 200 字节，用于从串口接收函数名和参数等</span> ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=NASUL9KJ))
> 
> 🏷️ #📝/重点

^KEYNASUL9KJ

> <span class="highlight" style="background-color: #e56eee">第二个是 usmart_timx_init 函数</span> ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=4MU8JCMT))
> 
> 🏷️ #📝/重点

^KEY4MU8JCMT

> <span class="highlight" style="background-color: #e56eee">该函数只有在：USMART_ENTIMX_SCAN 值为 1 时，才需要实现，用于定时器初始化</span>
> 
> 一般来说都需要使用定时器 ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=M4AHTLAE))
> 
> 🏷️ #📝/重点

^KEYM4AHTLAE

> <span class="highlight" style="background-color: #e56eee">利用定时器完成对 usmart_scan 函数的周期性调用，并实现函数运行时间计时（runtime）功能</span> ([p406](zotero://open-pdf/library/items/JFGTX7CT?page=406&annotation=QRKQWR6X))
> 
> 🏷️ #📝/重点

^KEYQRKQWR6X

> <span class="highlight" style="background-color: #e56eee">该函数有一个参数 tclk，就是用于定时器初始化。注意：这里的 tclk 是指所选 TIM 的时钟 频率，而非系统主频！</span> ([p407](zotero://open-pdf/library/items/JFGTX7CT?page=407&annotation=ETYFNGG3))
> 
> 🏷️ #📝/重点

^KEYETYFNGG3

> <span class="highlight" style="background-color: #e56eee">USMART_ENTIMX_SCAN 是在 usmart_port.h 里面定义的一个是否使能定时器中断 扫描的宏定义</span> ([p407](zotero://open-pdf/library/items/JFGTX7CT?page=407&annotation=TQILT4E8))
> 
> 🏷️ #📝/重点

^KEYTQILT4E8

> <span class="highlight" style="background-color: #e56eee">如果要使用函数执行时间统计功能（runtime 1），则必须设置 USMART_ENTIMX_SCAN 为 1。另外，为了让统计时间精确到 0.1ms，定时器的计数时钟频 率必须设置为 10Khz，否则时间就不是 0.1ms 了</span> ([p407](zotero://open-pdf/library/items/JFGTX7CT?page=407&annotation=VD55NT2P))
> 
> 🏷️ #📝/重点

^KEYVD55NT2P

> <span class="highlight" style="background-color: #e56eee">服务 USMART 的函数执行时间统计功能</span> ([p407](zotero://open-pdf/library/items/JFGTX7CT?page=407&annotation=ULWPW8RF))
> 
> 🏷️ #📝/重点

^KEYULWPW8RF

> <span class="highlight" style="background-color: #e56eee">usmart_timx_reset_time 函数在每次 USMART 调用函数之前执行，清除定时器的计数器</span> ([p407](zotero://open-pdf/library/items/JFGTX7CT?page=407&annotation=T4DB5A94))
> 
> 🏷️ #📝/重点

^KEYT4DB5A94

> <span class="highlight" style="background-color: #e56eee">调用 usmart_timx_get_time 获取计数器值，从而得到整个函数的运行时 间</span> ([p407](zotero://open-pdf/library/items/JFGTX7CT?page=407&annotation=98K8VUZQ))
> 
> 🏷️ #📝/重点

^KEY98K8VUZQ

> <span class="highlight" style="background-color: #e56eee">USMART 的函数执行时间统计功能，最多可以统计定时器溢 出 1 次的时间，对 STM32F103 的 TIM4 来说，该定时器是 16 位的，最大计数是 65535，而由 于我们定时器设置的是 0.1ms 一个计时周期（10Khz），所以最长计时时间是</span> ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=A2SPIP8J))
> 
> 🏷️ #📝/重点

^KEYA2SPIP8J

> <span class="highlight" style="background-color: #e56eee">65535 * 2 * 0.1ms = 13.1 秒</span> ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=Y5AM9IY6))
> 
> 🏷️ #📝/重点

^KEYY5AM9IY6

> <span class="highlight" style="background-color: #e56eee">该函数主要用于周期性调用 usmart 扫描函数（实际函数：usmart_scan）， 完成对输入数据流的处理。同时，清除定时器的 CNT 值，并设置自动重装载值</span> ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=5CSNCYPX))
> 
> 🏷️ #📝/重点

^KEY5CSNCYPX

> <span class="highlight" style="background-color: #e56eee">usmart 同外部的 互交，一般是通过 usmart_dev 结构体实现，所以 usmart_init 和 usmart_scan 的调用分别是通过： usmart_dev.init 和 usmart_dev.scan 实现的</span> ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=55TD6XE4))
> 
> 🏷️ #📝/重点

^KEY55TD6XE4

> <span class="highlight" style="background-color: #e56eee">在 usmart_config.c 文件里 面添加 想要 被 USMART 调用 的函 数</span>
> 
> 这个是我们需要做的事情 ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=RKNI9NDR))
> 
> 🏷️ #📝/重点

^KEYRKNI9NDR

> <span class="highlight" style="background-color: #e56eee">添加函数很简单，只要把函数所在头文件添加进来，并把函数名按上图所示的方式</span> ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=3R3RQ8HN))
> 
> 🏷️ #📝/重点

^KEY3R3RQ8HN

> <span class="highlight" style="background-color: #e56eee">增加即可，默认我们添加了两个函数：delay_ms 和 delay_us。</span> ([p408](zotero://open-pdf/library/items/JFGTX7CT?page=408&annotation=75XGXGYZ))
> 
> 🏷️ #📝/重点

^KEY75XGXGYZ

> <span class="highlight" style="background-color: #e56eee">第二个函数 test_fun 则是测试 USMART 对函数参 数的支持的</span> ([p409](zotero://open-pdf/library/items/JFGTX7CT?page=409&annotation=GU9FWNA5))
> 
> 🏷️ #📝/重点

^KEYGU9FWNA5

> <span class="highlight" style="background-color: #e56eee">test_fun 的第一个参数是函数</span>
> 
> 在串口助手中需要获取函数的 id ，从而作为第一个参数的值 ([p409](zotero://open-pdf/library/items/JFGTX7CT?page=409&annotation=E2LGYE35))
> 
> 🏷️ #📝/重点

^KEYE2LGYE35

> <span class="highlight" style="background-color: #e56eee">list、id、help、hex、dec、？和 runtime 都属于 usmart 自带的系统命令，点击后方的 数字按钮，即可发送对应的指令</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=RVGCV3S6))
> 
> 🏷️ #📝/重点

^KEYRVGCV3S6

> <span class="highlight" style="background-color: #e56eee">list，该命令用于打印所有 usmart 可调用函数</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=AXUDHC5K))
> 
> 🏷️ #📝/重点

^KEYAXUDHC5K

> <span class="highlight" style="background-color: #e56eee">id，该指令用于获取各个函数的入口地址</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=HMHZBMQG))
> 
> 🏷️ #📝/重点

^KEYHMHZBMQG

> <span class="highlight" style="background-color: #e56eee">help（或者‘?’也可以），发送该指令后，串口将打印 usmart 使用的帮助信息</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=MFP9HSXW))
> 
> 🏷️ #📝/重点

^KEYMFP9HSXW

> <span class="highlight" style="background-color: #e56eee">hex 和 dec，这两个指令可以带参数，也可以不带参数</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=Q3MTEI8D))
> 
> 🏷️ #📝/重点

^KEYQ3MTEI8D

> <span class="highlight" style="background-color: #e56eee">当不带参数的时候，hex 和 dec 分 别用于设置串口显示数据格式为 16 进制/10 进制</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=R32GTZU7))
> 
> 🏷️ #📝/重点

^KEYR32GTZU7

> <span class="highlight" style="background-color: #e56eee">当带参数的时候，hex 和 dec 就执行进制转 换，比如输入：hex 1234，串口将打印：HEX:0X4D2</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=DNRHCGHJ))
> 
> 🏷️ #📝/重点

^KEYDNRHCGHJ

> <span class="highlight" style="background-color: #e56eee">runtime 指令，用于函数执行时间统计功能的开启和关闭</span> ([p410](zotero://open-pdf/library/items/JFGTX7CT?page=410&annotation=CUPQ4MPB))
> 
> 🏷️ #📝/重点

^KEYCUPQ4MPB

> <span class="highlight" style="background-color: #e56eee">因为 usmart 默认设置的是 hex 显示，所以看到串口打印的参数都是 16 进制格式的</span> ([p411](zotero://open-pdf/library/items/JFGTX7CT?page=411&annotation=7ZHJZ4DX))
> 
> 🏷️ #📝/重点

^KEY7ZHJZ4DX

> <span class="highlight" style="background-color: #e56eee">要调用带有函数参数的函数，就必须先得到函数参 数的入口地址（id），通过输入 id 指令，我们可以得到 led_set 的函数入口地址是：0X0800321D， 所以，我们在串口输入：test_fun(0X0800321D,0)，就可以控制 LED1 亮了</span> ([p411](zotero://open-pdf/library/items/JFGTX7CT?page=411&annotation=HTLE6IG4))
> 
> 🏷️ #📝/重点

^KEYHTLE6IG4

> <span class="highlight" style="background-color: #f19837">第二十九章 DMA 实验</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=XSJLQ9RA))
> 
> 🏷️ #📝/标题

^KEYXSJLQ9RA

> <span class="highlight" style="background-color: #f19837">29.1 DMA 简介</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=EIKK464H))
> 
> 🏷️ #📝/标题

^KEYEIKK464H

> <span class="highlight" style="background-color: #e56eee">DMA，全称为：Direct Memory Access，即直接存储器访问</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=4KMIEUFW))
> 
> 🏷️ #📝/重点

^KEY4KMIEUFW

> <span class="highlight" style="background-color: #e56eee">DMA 传输方式无需 CPU 直接 控制传输，也没有中断处理方式那样保留现场和恢复现场的过程，通过硬件为 RAM 与 I/O 设 备开辟一条直接传送数据的通路，能使 CPU 的效率大为提高。</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=EGAAI3KT))
> 
> 🏷️ #📝/重点

^KEYEGAAI3KT

> <span class="highlight" style="background-color: #e56eee">内部有 2 个 DMA 控制器(DMA2 仅存大容量产品中)</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=QEN4T4N8))
> 
> 🏷️ #📝/重点

^KEYQEN4T4N8

> <span class="highlight" style="background-color: #e56eee">DMA1 有 7 个通道。 DMA2 有 5 个通道</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=CSCL95GW))
> 
> 🏷️ #📝/重点

^KEYCSCL95GW

> <span class="highlight" style="background-color: #e56eee">每个通道专门用来管理来自于一个或多个外设对存储器访问的请求</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=VV2NLK6W))
> 
> 🏷️ #📝/重点

^KEYVV2NLK6W

> <span class="highlight" style="background-color: #e56eee">还有 一个仲裁器来协调各个 DMA 请求的优先权</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=Q7GFNVS3))
> 
> 🏷️ #📝/重点

^KEYQ7GFNVS3

> <span class="highlight" style="background-color: #e56eee">每个通道都直接连接专用的硬件 DMA 请求，每个通道都同样支持软件触发</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=VU9A9JDP))
> 
> 🏷️ #📝/重点

^KEYVU9A9JDP

> <span class="highlight" style="background-color: #e56eee">七个请求间的优先权可以通过软件编程设置(共有四级：很高、高、中等和低)，假如在相 等优先权时由硬件决定(请求 0 优先于请求 1，依此类推)</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=3DBSS3L4))
> 
> 🏷️ #📝/重点

^KEY3DBSS3L4

> <span class="highlight" style="background-color: #e56eee">有 3 个事件标志</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=3WFSIGWK))
> 
> 🏷️ #📝/重点

^KEY3WFSIGWK

> <span class="highlight" style="background-color: #e56eee">DMA 半传输，DMA 传输完成和 DMA 传输出错</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=3UPKMP9L))
> 
> 🏷️ #📝/重点

^KEY3UPKMP9L

> <span class="highlight" style="background-color: #e56eee">这 3 个事 件标志逻辑或成为一个单独的中断请求</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=3WZXDWUR))
> 
> 🏷️ #📝/重点

^KEY3WZXDWUR

> <span class="highlight" style="background-color: #e56eee">可编程的数据传输数目：最大为 65536</span> ([p454](zotero://open-pdf/library/items/JFGTX7CT?page=454&annotation=RZEDRLI7))
> 
> 🏷️ #📝/重点

^KEYRZEDRLI7

> <span class="highlight" style="background-color: #e56eee">如果外设想要通过 DMA 来传输数据，必须先给 DMA 控制器发送 DMA 请求，DMA 收到 请求信号之后，控制器会给外设一个应答信号，当外设应答后且 DMA 控制器收到应答信号之 后，就会启动 DMA 的传输，直到传输完毕</span> ([p455](zotero://open-pdf/library/items/JFGTX7CT?page=455&annotation=ZJ7CZHRA))
> 
> 🏷️ #📝/重点

^KEYZJ7CZHRA

> <span class="highlight" style="background-color: #e56eee">DMA 具有 12 个独立可编程的通道</span> ([p456](zotero://open-pdf/library/items/JFGTX7CT?page=456&annotation=9QPAVH43))
> 
> 🏷️ #📝/重点

^KEY9QPAVH43

> <span class="highlight" style="background-color: #e56eee">虽然每个通道可以接收多个外设的请求，但是同一时 间只能接收一个，不能同时接收多个</span> ([p456](zotero://open-pdf/library/items/JFGTX7CT?page=456&annotation=JX2LW59X))
> 
> 🏷️ #📝/重点

^KEYJX2LW59X

> <span class="highlight" style="background-color: #e56eee">4 个等级：非常高，高，中和低四个优先级</span> ([p456](zotero://open-pdf/library/items/JFGTX7CT?page=456&annotation=H58NNZMD))
> 
> 🏷️ #📝/重点

^KEYH58NNZMD

> <span class="highlight" style="background-color: #e56eee">编号越 低优先权越高，比如通道 0 高于通道 1</span> ([p456](zotero://open-pdf/library/items/JFGTX7CT?page=456&annotation=W8G6TRUC))
> 
> 🏷️ #📝/重点

^KEYW8G6TRUC

> <span class="highlight" style="background-color: #e56eee">DMA1 控制器拥有 高于 DMA2 控制器的优先级</span> ([p456](zotero://open-pdf/library/items/JFGTX7CT?page=456&annotation=NT3R3DVF))
> 
> 🏷️ #📝/重点

^KEYNT3R3DVF

> <span class="highlight" style="background-color: #e56eee">我们常用的是 TCIFx 位，即通道 DMA 传输完成 与否的标志。注意此寄存器为只读寄存器，所以在这些位被置位之后，只能通过其他的操作来 清除</span> ([p457](zotero://open-pdf/library/items/JFGTX7CT?page=457&annotation=CGZEWVW7))
> 
> 🏷️ #📝/重点

^KEYCGZEWVW7

> <span class="highlight" style="background-color: #e56eee">用来清除 DMA_ISR 的对应位的，通过写 0 清除。在 DMA_ISR 被置位后，我 们必须通过向该寄存器对应的位写 0 来清除</span> ([p457](zotero://open-pdf/library/items/JFGTX7CT?page=457&annotation=BGRSXCNT))
> 
> 🏷️ #📝/重点

^KEYBGRSXCNT

> <span class="highlight" style="background-color: #e56eee">该寄存器控制着 DMA 通道 x 的每次传输所要传输的数据量。其设置范围为 0~65535</span> ([p457](zotero://open-pdf/library/items/JFGTX7CT?page=457&annotation=ESHXTHLV))
> 
> 🏷️ #📝/重点

^KEYESHXTHLV

> <span class="highlight" style="background-color: #e56eee">该寄存器的值随着传输的进行而减少，当该寄存器的值为 0 的时候就代表此次数据传输已经 全部发送完成</span> ([p457](zotero://open-pdf/library/items/JFGTX7CT?page=457&annotation=IM6GBEPJ))
> 
> 🏷️ #📝/重点

^KEYIM6GBEPJ

> <span class="highlight" style="background-color: #e56eee">可以通过这个寄存器的值来获取当前 DMA 传输的进度</span> ([p457](zotero://open-pdf/library/items/JFGTX7CT?page=457&annotation=KKLXEYVZ))
> 
> 🏷️ #📝/重点

^KEYKKLXEYVZ

> <span class="highlight" style="background-color: #e56eee">用来存储 STM32 外设的地址</span> ([p459](zotero://open-pdf/library/items/JFGTX7CT?page=459&annotation=YCYMFIAC))
> 
> 🏷️ #📝/重点

^KEYYCYMFIAC

> <span class="highlight" style="background-color: #e56eee">用来存放存储器的地址</span> ([p459](zotero://open-pdf/library/items/JFGTX7CT?page=459&annotation=ECDEEXJB))
> 
> 🏷️ #📝/重点

^KEYECDEEXJB

> <span class="highlight" style="background-color: #e56eee">HAL_DMA_Init 函数</span> ([p459](zotero://open-pdf/library/items/JFGTX7CT?page=459&annotation=LNFN39PI))
> 
> 🏷️ #📝/重点

^KEYLNFN39PI

> <span class="highlight" style="background-color: #e56eee">Instance：是用来设置寄存器基地址</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=4FUFBAAS))
> 
> 🏷️ #📝/重点

^KEY4FUFBAAS

> <span class="highlight" style="background-color: #e56eee">HAL 库为了处理各类外设的 DMA 请求，在调用相关函数之前，需要调用一个宏定义标识 符，来连接 DMA 和外设句柄</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=64FYLD3X))
> 
> 🏷️ #📝/重点

^KEY64FYLD3X

> <span class="highlight" style="background-color: #e56eee">例如要使用串口 DMA 发送，所以方式为</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=93EY4N7Z))
> 
> 🏷️ #📝/重点

^KEY93EY4N7Z

> <span class="highlight" style="background-color: #e56eee">__HAL_LINKDMA(&g_uart1_handler, hdmatx, g_dma_handle);</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=SF6P5R85))
> 
> 🏷️ #📝/重点

^KEYSF6P5R85

> <span class="highlight" style="background-color: #e56eee">g_uart1_handler 是串口初始化句柄</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=ZHJZ3QEL))
> 
> 🏷️ #📝/重点

^KEYZHJZ3QEL

> <span class="highlight" style="background-color: #e56eee">g_dma_handle 是 DMA 初始化句柄</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=YYTKY6N8))
> 
> 🏷️ #📝/重点

^KEYYYTKY6N8

> <span class="highlight" style="background-color: #e56eee">hdmatx 是外设句柄结构体的成员变量，在这里实际就是 g_uart1_handler 的成员变 量</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=GSW8FI94))
> 
> 🏷️ #📝/重点

^KEYGSW8FI94

> <span class="highlight" style="background-color: #e56eee">在 HAL 库中，任何一个可以使用 DMA 的外设，它的初始化结构体句柄都会有一个</span> ([p460](zotero://open-pdf/library/items/JFGTX7CT?page=460&annotation=PLYJF8YP))
> 
> 🏷️ #📝/重点

^KEYPLYJF8YP

> <span class="highlight" style="background-color: #e56eee">DMA_HandleTypeDef 指针类型的成员变量，是 HAL 库用来做相关指向的。hdmatx 就是 DMA_HandleTypeDef 结构体指针类型</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=Z5BZK5CX))
> 
> 🏷️ #📝/重点

^KEYZ5BZK5CX

> <span class="highlight" style="background-color: #e56eee">这句话的含义就是把 g_uart1_handler 句柄的成员变量 hdmatx 和 DMA 句柄 g_dma_handle 连接起来，是纯软件处理，没有任何硬件操作</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=2ELG45JY))
> 
> 🏷️ #📝/重点

^KEY2ELG45JY

> <span class="highlight" style="background-color: #e56eee">在 HAL 库中操作该寄 存器来使能串口 DMA 发送的函数为 HAL_UART_Transmit_DMA</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=WSEDPTFZ))
> 
> 🏷️ #📝/重点

^KEYWSEDPTFZ

> <span class="highlight" style="background-color: #e56eee">调用该函数后会开启相应的 DMA 中断</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=KNUXF9ZQ))
> 
> 🏷️ #📝/重点

^KEYKNUXF9ZQ

> <span class="highlight" style="background-color: #e56eee">提供了对串口的 DMA 发送的停止，暂停，继续等操作函数：</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=WQXUP232))
> 
> 🏷️ #📝/重点

^KEYWQXUP232

> <span class="highlight" style="background-color: #e56eee">UART_HandleTypeDef *huart</span>
> 
> 注意这个参数是串口外设句柄指针 ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=6TU8AED6))
> 
> 🏷️ #📝/重点

^KEY6TU8AED6

> <span class="highlight" style="background-color: #e56eee">查询 DMA 传输通道的状态</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=3LP7XK6H))
> 
> 🏷️ #📝/重点

^KEY3LP7XK6H

> <span class="highlight" style="background-color: #e56eee">获取当前传输剩余数据量</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=CENPS999))
> 
> 🏷️ #📝/重点

^KEYCENPS999

> <span class="highlight" style="background-color: #e56eee">设置对应的 DMA 数据流传输的数据量大小</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=NRKYP3PP))
> 
> 🏷️ #📝/重点

^KEYNRKYP3PP

> <span class="highlight" style="background-color: #e56eee">DMA 中断对于每个通道都有一个中断服务函数</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=RGDJVRMA))
> 
> 🏷️ #📝/重点

^KEYRGDJVRMA

> <span class="highlight" style="background-color: #e56eee">比如 DMA1_Channel4 的中断服务函数为 DMA1_Channel4_IRQHandler</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=P2F8QRCE))
> 
> 🏷️ #📝/重点

^KEYP2F8QRCE

> <span class="highlight" style="background-color: #e56eee">通用 DMA 中断处理函数 HAL_DMA_IRQHandler</span> ([p461](zotero://open-pdf/library/items/JFGTX7CT?page=461&annotation=U98FCHYJ))
> 
> 🏷️ #📝/重点

^KEYU98FCHYJ

> <span class="highlight" style="background-color: #e56eee">main 函数的流程大致是</span> ([p465](zotero://open-pdf/library/items/JFGTX7CT?page=465&annotation=4QFQV4JB))
> 
> 🏷️ #📝/重点

^KEY4QFQV4JB

> <span class="highlight" style="background-color: #f19837">第三十章 ADC 实验</span> ([p467](zotero://open-pdf/library/items/JFGTX7CT?page=467&annotation=XR3L3E59))
> 
> 🏷️ #📝/标题

^KEYXR3L3E59

> <span class="highlight" style="background-color: #f19837">第三十五章 IIC 实验</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=JNUE6YGF))
> 
> 🏷️ #📝/标题

^KEYJNUE6YGF

> <span class="highlight" style="background-color: #f19837">35.1 IIC 及 24C02 介绍</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=RUILQPTQ))
> 
> 🏷️ #📝/标题

^KEYRUILQPTQ

> <span class="highlight" style="background-color: #f19837">35.1.1 IIC 简介</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=UXNRBQKE))
> 
> 🏷️ #📝/标题

^KEYUXNRBQKE

> <span class="highlight" style="background-color: #e56eee">总线由数据线 SDA 和时钟线 SCL 构成的串行总线</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=MCHJF24F))
> 
> 🏷️ #📝/重点

^KEYMCHJF24F

> <span class="highlight" style="background-color: #e56eee">数据线用来传输数据</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=SPLMKJR5))
> 
> 🏷️ #📝/重点

^KEYSPLMKJR5

> <span class="highlight" style="background-color: #e56eee">时钟线用来 同步数据收发。</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=ENZL6EJY))
> 
> 🏷️ #📝/重点

^KEYENZL6EJY

> <span class="highlight" style="background-color: #e56eee">总线上每一个器件都有一个唯一的地址识别</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=A3UZB3U7))
> 
> 🏷️ #📝/重点

^KEYA3UZB3U7

> <span class="highlight" style="background-color: #e56eee">只需要知道器件的地址，根据时 序就可以实现微控制器与器件之间的通信</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=ZX9TKQFZ))
> 
> 🏷️ #📝/重点

^KEYZX9TKQFZ

> <span class="highlight" style="background-color: #e56eee">数据线 SDA 和时钟线 SCL 都是双向线路，都通过一个电流源或上拉电阻连接到正的电 压，所以当总线空闲的时候，这两条线路都是高电平</span>
> 
> SDA 线对应的 IO 口都是开漏输出模式。SCL 线对应的 IO 口都是推挽输出模式。
> 
> 开漏输出模式的线与功能：多个信号线直接连接在一起，只有当所有信号全部为高电平时，合在一起的总线为高电平；只要有任意一个或者多个信号为低电平，则总线为低电平。
> 
> SCL 总线只能由主机拉低； SDA 总线主机和从机都能拉低，故从机也能给主机发送数据。
> 
> 当所有设备都没有拉低总线时，两条总线处于空闲状态，都是高电平。
> 
> 当有一个机器要向外发送数据时，可以拉低和松开自身的 SDA 信号线，从而拉低和松开总线 SDA 信号线，进而拉低和松开其他机器的 SDA 信号线，从完成数据的传输。
> 
> 由于“线与”功能，可以将总线 SDA 和 SCL 想象成两根杆，若干个机器的 SDA 和 SCL想象成若干个人的两只手握在两根杆上。当杆处于高位时，所有人的手都是伸直的；当杆处于低位时，所有人的手都是弯曲的。同一时刻只能一个人单独操作 SDA 这根杆，而 SCL 杆由主机控制拉低和松开，
> 
> 如果一个人想要向另一个人发送据，则发送人按照一定的顺序拉低和松开 SDA 杆。由于杆子的存在，接收人握着 SDA 杆的手会跟着发送人的手做相同动作，这就是发送数据。
> 
> 当发完数据后，发送人握着 SDA 杆的手伸直松开，接收人拉低和松开SDA 杆，以让发送人接收到应答，这就是接收应答。 ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=MXG2GPU5))
> 
> 🏷️ #📝/重点

^KEYMXG2GPU5

> <span class="highlight" style="background-color: #e56eee">传输速率在标准模式下可达 100kbit/s 在快速模式下可达 400kbit/s 在高速 模式下可达 3.4Mbit/s</span> ([p548](zotero://open-pdf/library/items/JFGTX7CT?page=548&annotation=MV4EFZX7))
> 
> 🏷️ #📝/重点

^KEYMV4EFZX7

> <span class="highlight" style="background-color: #e56eee">当 SCL 为高电平期间，SDA 由高到低的跳变</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=K3WRR2RI))
> 
> 🏷️ #📝/重点

^KEYK3WRR2RI

> <span class="highlight" style="background-color: #e56eee">起始信号是一种电平跳变时序信号，而不是 一个电平信号</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=VK4R4NFJ))
> 
> 🏷️ #📝/重点

^KEYVK4R4NFJ

> <span class="highlight" style="background-color: #e56eee">在起始信号产生后，总线就处于被占用状态，准备数据传 输。</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=AS9CQR9A))
> 
> 🏷️ #📝/重点

^KEYAS9CQR9A

> <span class="highlight" style="background-color: #e56eee">当 SCL 为高电平期间，SDA 由低到高的跳变</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=UFNZNXF5))
> 
> 🏷️ #📝/重点

^KEYUFNZNXF5

> <span class="highlight" style="background-color: #e56eee">在停止信号发出后，总线就处于空闲状态。</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=ZGA8US7P))
> 
> 🏷️ #📝/重点

^KEYZGA8US7P

> <span class="highlight" style="background-color: #e56eee">发送器每发送一个字节，就在时钟脉冲 9 期间释放数据线，由接收器反馈一个应答信号</span>
> 
> 此时总线的拉低权在于接收器 ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=DIVKD9R4))
> 
> 🏷️ #📝/重点

^KEYDIVKD9R4

> <span class="highlight" style="background-color: #e56eee">低电平时，规定为有效应答位</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=2YW76SNL))
> 
> 🏷️ #📝/重点

^KEY2YW76SNL

> <span class="highlight" style="background-color: #e56eee">高电平时，规定为非应答位</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=K2DY68I4))
> 
> 🏷️ #📝/重点

^KEYK2DY68I4

> <span class="highlight" style="background-color: #e56eee">接收器是主机，则在它 收到最后一个字节后，发送一个 NACK 信号，以通知被控发送器结束数据发送，并释放 SDA 线，以便主机接收器发送一个停止信号</span>
> 
> 这里的“释放 SDA 线”是指从机释放。 ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=D7RLR6CY))
> 
> 🏷️ #📝/重点

^KEYD7RLR6CY

> <span class="highlight" style="background-color: #e56eee">时钟信号为高电平期间，数据线上的数据必须保持稳定，只有在 时钟线上的信号为低电平期间，数据线上的高电平或低电平状态才允许变化</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=ME2ZBLKH))
> 
> 🏷️ #📝/重点

^KEYME2ZBLKH

> <span class="highlight" style="background-color: #e56eee">在 SCL 串行 时钟的配合下，在 SDA 上逐位地串行传送每一位数据</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=Q79FWYFR))
> 
> 🏷️ #📝/重点

^KEYQ79FWYFR

> <span class="highlight" style="background-color: #e56eee">数据位的传输是边沿触发</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=TPEZ79RL))
> 
> 🏷️ #📝/重点

^KEYTPEZ79RL

> <span class="highlight" style="background-color: #e56eee">总线的 SDA 和 SCL 两条信号线同时处于高电平时，规定为总线的空闲状态</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=NPPBSGEY))
> 
> 🏷️ #📝/重点

^KEYNPPBSGEY

> <span class="highlight" style="background-color: #e56eee">截止状态，即释放总线，由两条信号线各自的上拉电阻把电平拉 高。</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=RPHIN7KX))
> 
> 🏷️ #📝/重点

^KEYRPHIN7KX

> <span class="highlight" style="background-color: #e56eee">从机地址+0(写操作)组成的 8bit 数据</span> ([p549](zotero://open-pdf/library/items/JFGTX7CT?page=549&annotation=NWFSIHIM))
> 
> 🏷️ #📝/重点

^KEYNWFSIHIM

> <span class="highlight" style="background-color: #e56eee">检验是否是自己的设备的地址，假如是自己的设备地址，那么从机就会发出应答信号</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=32D9KX6C))
> 
> 🏷️ #📝/重点

^KEY32D9KX6C

> <span class="highlight" style="background-color: #e56eee">IIC 总线上传送的数据信号 是广义的，既包括地址信号，又包括真正的数据信号</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=68QYLR2T))
> 
> 🏷️ #📝/重点

^KEY68QYLR2T

> <span class="highlight" style="background-color: #e56eee">发送从机地址+1(读操作)组成的 8bit 数据，从机接收到数据验 证是否是自身的地址</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=NPEXT6WA))
> 
> 🏷️ #📝/重点

^KEYNPEXT6WA

> <span class="highlight" style="background-color: #e56eee">在验证是自己的设备地址后，从机就会发出应答信号</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=92ZXW6TD))
> 
> 🏷️ #📝/重点

^KEY92ZXW6TD

> <span class="highlight" style="background-color: #e56eee">向主机返 回 8bit 数据，发送完之后从机就会等待主机的应答信号</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=2URYLUS5))
> 
> 🏷️ #📝/重点

^KEY2URYLUS5

> <span class="highlight" style="background-color: #f19837">35.1.2 24C02 简介</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=CJS5XJ74))
> 
> 🏷️ #📝/标题

^KEYCJS5XJ74

> <span class="highlight" style="background-color: #e56eee">2K bit 的串行 EEPROM 存储器</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=CUDNCKZX))
> 
> 🏷️ #📝/重点

^KEYCUDNCKZX

> <span class="highlight" style="background-color: #e56eee">内部含有 256 个字节</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=KRA2WUX6))
> 
> 🏷️ #📝/重点

^KEYKRA2WUX6

> <span class="highlight" style="background-color: #e56eee">一个 8 字节的页写缓冲器</span>
> 
> 24C02 的页大小是 1 字节 ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=8D7EVN6S))
> 
> 🏷️ #📝/重点

^KEY8D7EVN6S

> <span class="highlight" style="background-color: #e56eee">通信方式 IIC，通过其 SCL 和 SDA 与其他设备通信</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=BC6KT3HC))
> 
> 🏷️ #📝/重点

^KEYBC6KT3HC

> <span class="highlight" style="background-color: #e56eee">WP 引脚是写保护引脚，接高电平只读，接地允许读和写</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=GYR6MV8Z))
> 
> 🏷️ #📝/重点

^KEYGYR6MV8Z

> <span class="highlight" style="background-color: #e56eee">24C02 的设备地址是包括 不可编程部分和可编程部分</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=5ZJ9IIMU))
> 
> 🏷️ #📝/重点

^KEY5ZJ9IIMU

> <span class="highlight" style="background-color: #e56eee">可编程部分是根据上图的硬件引脚 A0、A1 和 A2 所决定</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=QP7AEVQU))
> 
> 🏷️ #📝/重点

^KEYQP7AEVQU

> <span class="highlight" style="background-color: #e56eee">设备 地址最后一位用于设置数据的传输方向，即读操作/写操作，0 是写操作，1 是读操作</span> ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=HNC376ZL))
> 
> 🏷️ #📝/重点

^KEYHNC376ZL

> <span class="highlight" style="background-color: #e56eee">，A0、A1 和 A2 均接地处理，所以 24C02 设备的读操作地址为：0xA1； 写操作地址为：0xA0</span>
> 
> 读操作地址：10100001；
> 
> 写操作地址：10100000； ([p550](zotero://open-pdf/library/items/JFGTX7CT?page=550&annotation=NKK2IPPA))
> 
> 🏷️ #📝/重点

^KEYNKK2IPPA

> <span class="highlight" style="background-color: #e56eee">2 个字节数据，该字节数据是 24C02 的内存地址</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=YNZR97ED))
> 
> 🏷️ #📝/重点

^KEYYNZR97ED

> <span class="highlight" style="background-color: #e56eee">第 3 字节数据，这里的数据即是写入在第 2 字节内存地址的数据</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=7T3TUF7R))
> 
> 🏷️ #📝/重点

^KEY7T3TUF7R

> <span class="highlight" style="background-color: #e56eee">24C02 有页写入时序</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=UM4FPFEY))
> 
> 🏷️ #📝/重点

^KEYUM4FPFEY

> <span class="highlight" style="background-color: #e56eee">单字节写时序时，每次写入数据时都需要先写入设备的内存地址才能实现</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=8ARZADQI))
> 
> 🏷️ #📝/重点

^KEY8ARZADQI

> <span class="highlight" style="background-color: #e56eee">在页写时序 中，只需要告诉 24C02 第一个内存地址 1，后面数据会按照顺序写入到内存地址 2，内存地址 3 等</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=2X2QG4CI))
> 
> 🏷️ #📝/重点

^KEY2X2QG4CI

> <span class="highlight" style="background-color: #e56eee">24C02 每次只能 8bit 数据，所以它的页大小也 就是 1 字节</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=MKC4UPZ5))
> 
> 🏷️ #📝/重点

^KEYMKC4UPZ5

> <span class="image#e56eee">null</span>读数据过程 ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=KFGQJKGB))

^KEYKFGQJKGB

> <span class="highlight" style="background-color: #e56eee">读取数据的过程是一个复合的时序，其中包含写时序和读时序</span> ([p551](zotero://open-pdf/library/items/JFGTX7CT?page=551&annotation=7LLHKDS4))
> 
> 🏷️ #📝/重点

^KEY7LLHKDS4

> <span class="highlight" style="background-color: #e56eee">SCL 推挽输出 SDA 开漏输出</span> ([p552](zotero://open-pdf/library/items/JFGTX7CT?page=552&annotation=P2WIZTUV))
> 
> 🏷️ #📝/重点

^KEYP2WIZTUV

> <span class="highlight" style="background-color: #e56eee">SDA 线的 GPIO 模式使用开漏输出模式</span> ([p552](zotero://open-pdf/library/items/JFGTX7CT?page=552&annotation=AR8Y6JLN))
> 
> 🏷️ #📝/重点

^KEYAR8Y6JLN

> <span class="highlight" style="background-color: #e56eee">SCL 线的 GPIO 模式使用推挽输出模式</span> ([p552](zotero://open-pdf/library/items/JFGTX7CT?page=552&annotation=7RK25DIY))
> 
> 🏷️ #📝/重点

^KEY7RK25DIY

> <span class="highlight" style="background-color: #e56eee">IIC 底层驱动代码</span> ([p554](zotero://open-pdf/library/items/JFGTX7CT?page=554&annotation=MG2UP9HK))
> 
> 🏷️ #📝/重点

^KEYMG2UP9HK

> <span class="highlight" style="background-color: #e56eee">STM32F103 必须要外接上拉电阻</span> ([p554](zotero://open-pdf/library/items/JFGTX7CT?page=554&annotation=LWBWG6ZC))
> 
> 🏷️ #📝/重点

^KEYLWBWG6ZC

> <span class="highlight" style="background-color: #e56eee">IIC_SCL(0); /* 钳住 I2C 总线，准备发送或接收数据 */</span>
> 
> 这步比较重要，拉低 SCL 线，准备接收或发送数据 ([p555](zotero://open-pdf/library/items/JFGTX7CT?page=555&annotation=GTXB5LB3))
> 
> 🏷️ #📝/重点

^KEYGTXB5LB3

> <span class="highlight" style="background-color: #e56eee">时钟 信号是通过主机发出的</span> ([p557](zotero://open-pdf/library/items/JFGTX7CT?page=557&annotation=Q44FMZXE))
> 
> 🏷️ #📝/重点

^KEYQ44FMZXE

> <span class="highlight" style="background-color: #e56eee">每一次循环开始前都需要 对 receive 进行左移 1 位操作，那么 receive 的 bit0 位每一次赋值前都是空的，用来存放最新接 收到的数据位</span> ([p557](zotero://open-pdf/library/items/JFGTX7CT?page=557&annotation=MXX7L6D9))
> 
> 🏷️ #📝/重点

^KEYMXX7L6D9

> <span class="highlight" style="background-color: #e56eee">上面提及到应答信号和非应答信号是在读时序中发生的</span> ([p557](zotero://open-pdf/library/items/JFGTX7CT?page=557&annotation=RUMBPD77))
> 
> 🏷️ #📝/重点

^KEYRUMBPD77

> <span class="highlight" style="background-color: #e56eee">此外在写时序中也存在有一个信 号响应，当发送完 8bit 数据后，这里是一个等待从机应答信号的操作</span> ([p557](zotero://open-pdf/library/items/JFGTX7CT?page=557&annotation=RWXR8LAG))
> 
> 🏷️ #📝/重点

^KEYRWXR8LAG

> <span class="image#e56eee">null</span>这里有一个等待应答的过程 ([p558](zotero://open-pdf/library/items/JFGTX7CT?page=558&annotation=MS2N4JZZ))

^KEYMS2N4JZZ

> <span class="highlight" style="background-color: #e56eee">需要等待以及处理接收从机发送过来的响应信号或者非响应信号， 一般就是在 iic_send_byte 函数后面调用</span> ([p558](zotero://open-pdf/library/items/JFGTX7CT?page=558&annotation=IA3KRP2J))
> 
> 🏷️ #📝/重点

^KEYIA3KRP2J

> <span class="highlight" style="background-color: #e56eee">在这个等待读取的过程中加入了超时判 断，假如超过这个时间没有接收到数据，那么主机直接发出停止信号，跳出循环，返回等于 1 的变量</span> ([p558](zotero://open-pdf/library/items/JFGTX7CT?page=558&annotation=Z9NWEJAA))
> 
> 🏷️ #📝/重点

^KEYZ9NWEJAA

> <span class="highlight" style="background-color: #e56eee">为了使代码功能更加健全，所以在 24cxx.h 中宏定义了不同容量大小的 24C 系列型号</span> ([p559](zotero://open-pdf/library/items/JFGTX7CT?page=559&annotation=4YFCX29H))
> 
> 🏷️ #📝/重点

^KEY4YFCX29H

> <span class="highlight" style="background-color: #e56eee">在 24cxx.c 文件中，读/写操作函数对于不同容量大小的 24Cxx 芯片都有相对应的代码块解 决处理</span> ([p559](zotero://open-pdf/library/items/JFGTX7CT?page=559&annotation=ZESN77H5))
> 
> 🏷️ #📝/重点

^KEYZESN77H5

> <span class="highlight" style="background-color: #e56eee">在 AT24CXX 指定地址写入一个数据</span> ([p559](zotero://open-pdf/library/items/JFGTX7CT?page=559&annotation=NXJ8PIM3))
> 
> 🏷️ #📝/重点

^KEYNXJ8PIM3

> <span class="image#e56eee">null</span>高位地址用于确定较大的存储单元，如页或块，而低位地址用于在块或页内定位具体的数据位置。
> 
> 如果一个EEPROM有8页，每页256字节，那么a8/a9/a10（三个高地址）决定了页号（000，001，010，……，111），再加上低位地址（8位）用来确定页内的具体位置。
> 
> 三位高地址和八位低地址（共11位地址模式）一共可以确定 2048 个字节位置。
> 
> 对于 24C16 （容量为  2047 个字节）以下的存储器型号，采用 11 位地址来寻址。在 I2C通信中，先发送器件的地址，更改器件地址的 bit1~bit3 位来表示 11 位地址的高 3 位（bit0 用来表示读/写操作）。随后发送一个字节来表示 11 位地址的低 8 位。这样 11 位地址就发送给存储器，然后进行读和写操作。
> 
> 对于 24C16 以上的存储器型号，采用 16 位地址来寻址（即高 8 位 + 低 8 位）。在 I2C通信中，先发送器件的地址（不需要更改器件地址的 bit1~bit3），然后发送高 8 位地址，接着发送低 8 位地址，最后进行读写操作。 ([p560](zotero://open-pdf/library/items/JFGTX7CT?page=560&annotation=F3NVMPNP))

^KEYF3NVMPNP

> <span class="image#e56eee">null</span>对于读数据，需要重新发送起始信号，并进入接收模式 ([p561](zotero://open-pdf/library/items/JFGTX7CT?page=561&annotation=59CT3HU6))

^KEY59CT3HU6

> <span class="highlight" style="background-color: #e56eee">这里利用的是 EEPROM 芯片掉电不丢失的特性，在第一次写入了某个值之</span> ([p561](zotero://open-pdf/library/items/JFGTX7CT?page=561&annotation=MEQHCUTH))
> 
> 🏷️ #📝/重点

^KEYMEQHCUTH

> <span class="highlight" style="background-color: #e56eee">后，再去读一下是否写入成功，这种方式去检测芯片是否正常工作</span> ([p562](zotero://open-pdf/library/items/JFGTX7CT?page=562&annotation=WR5C8GT2))
> 
> 🏷️ #📝/重点

^KEYWR5C8GT2

> <span class="highlight" style="background-color: #e56eee">这两个函数都是调用前面的单字节操作函数去实现的，利用 for 循环，连续调用单字 节操作函数去实现</span> ([p562](zotero://open-pdf/library/items/JFGTX7CT?page=562&annotation=I4VLKK3D))
> 
> 🏷️ #📝/重点

^KEYI4VLKK3D

> <span class="highlight" style="background-color: #f19837">第三十六章 SPI 实验</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=SYBQGI2Z))
> 
> 🏷️ #📝/标题

^KEYSYBQGI2Z

> <span class="highlight" style="background-color: #f19837">36.1 SPI 及 NOR FLASH 介绍</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=IE3Q42PC))
> 
> 🏷️ #📝/标题

^KEYIE3Q42PC

> <span class="highlight" style="background-color: #f19837">36.1.1 SPI 介绍</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=U97A6JTE))
> 
> 🏷️ #📝/标题

^KEYU97A6JTE

> <span class="highlight" style="background-color: #f19837">36.1.1.1 SPI 框图</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=C5MM7RMD))
> 
> 🏷️ #📝/标题

^KEYC5MM7RMD

> <span class="highlight" style="background-color: #e56eee">Serial Peripheral interface</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=NW5ENGHJ))
> 
> 🏷️ #📝/重点

^KEYNW5ENGHJ

> <span class="highlight" style="background-color: #e56eee">串行外围设备接口</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=FIR9I8F5))
> 
> 🏷️ #📝/重点

^KEYFIR9I8F5

> <span class="highlight" style="background-color: #e56eee">SPI 接口是一种高速的全双 工同步的通信总线</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=Y9842CXY))
> 
> 🏷️ #📝/重点

^KEYY9842CXY

> <span class="highlight" style="background-color: #e56eee">STM32 是有有 3 个 SPI 接口，本实验使用的是 SPI2</span> ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=Q57ST3II))
> 
> 🏷️ #📝/重点

^KEYQ57ST3II

> <span class="image#e56eee">null</span>两个接收缓冲区共用一个移位寄存器 ([p565](zotero://open-pdf/library/items/JFGTX7CT?page=565&annotation=KDWFN8HH))

^KEYKDWFN8HH

> <span class="highlight" style="background-color: #e56eee">MISO（Master In / Slave Out）主设备数据输入，从设备数据输出。 MOSI（Master Out / Slave In）主设备数据输出，从设备数据输入。 SCLK（Serial Clock）时钟信号，由主设备产生。 CS（Chip Select）从设备片选信号，由主设备产生</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=UV2Z9ZJR))
> 
> 🏷️ #📝/重点

^KEYUV2Z9ZJR

> <span class="highlight" style="background-color: #e56eee">在主机和从机都有一个串行移位寄存器</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=GTFXLYWB))
> 
> 🏷️ #📝/重点

^KEYGTFXLYWB

> <span class="highlight" style="background-color: #e56eee">主机通过向它的 SPI 串行寄存 器写入一个字节来发起一次传输。串行移位寄存器通过 MOSI 信号线将字节传送给从机</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=5KA43UVC))
> 
> 🏷️ #📝/重点

^KEY5KA43UVC

> <span class="highlight" style="background-color: #e56eee">从机 也将自己的串行移位寄存器中的内容通过 MISO 信号线返回给主机</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=PYW3EN82))
> 
> 🏷️ #📝/重点

^KEYPYW3EN82

> <span class="highlight" style="background-color: #e56eee">外设的写操作和读操作是同步完成的</span>
> 
> 全双工通信 ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=UE7VMTWH))
> 
> 🏷️ #📝/重点

^KEYUE7VMTWH

> <span class="highlight" style="background-color: #e56eee">如果只是进行写操作，主机只需忽略 接收到的字节</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=WI5IBY3X))
> 
> 🏷️ #📝/重点

^KEYWI5IBY3X

> <span class="highlight" style="background-color: #e56eee">反之，若主机要读取从机的一个字节，就必须发送一个空字节引发从机传输</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=NMVXQDVJ))
> 
> 🏷️ #📝/重点

^KEYNMVXQDVJ

> <span class="highlight" style="background-color: #e56eee">SPI 总线具有三种传输方式：全双工、单工以及半双工传输方式</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=THURIF72))
> 
> 🏷️ #📝/重点

^KEYTHURIF72

> <span class="highlight" style="background-color: #e56eee">SPI 通信协议就具备 4 种工作模式</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=3HA8NNK9))
> 
> 🏷️ #📝/重点

^KEY3HA8NNK9

> <span class="highlight" style="background-color: #e56eee">CPOL，详称 Clock Polarity，就是时钟极性</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=CV2LGL4J))
> 
> 🏷️ #📝/重点

^KEYCV2LGL4J

> <span class="highlight" style="background-color: #e56eee">当主从机没有数据传输的时候即空闲状态， SCL 线的电平状态</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=RXLE6XP9))
> 
> 🏷️ #📝/重点

^KEYRXLE6XP9

> <span class="highlight" style="background-color: #e56eee">CPHA，详称 Clock Phase，就是时钟相位</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=7MJIFHZ8))
> 
> 🏷️ #📝/重点

^KEY7MJIFHZ8

> <span class="highlight" style="background-color: #e56eee">数据的变化和采样都是在时钟边沿上进行的</span>
> 
> SPI 通信是边沿采样数据；
> 
> I2C 通信是高电平采样 ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=6NUUYM3G))
> 
> 🏷️ #📝/重点

^KEY6NUUYM3G

> <span class="highlight" style="background-color: #e56eee">假如我们在第 1 个边沿信号把数据输出了，从机只能从第 2 个边沿信号去 采样这个数据</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=K3LHIZJ5))
> 
> 🏷️ #📝/重点

^KEYK3LHIZJ5

> <span class="highlight" style="background-color: #e56eee">CPHA 实质指的是数据的采样时刻</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=BWMP8PIW))
> 
> 🏷️ #📝/重点

^KEYBWMP8PIW

> <span class="highlight" style="background-color: #e56eee">CPHA = 0 的情况就表示数据的采样是从第 1 个边沿信 号上即奇数边沿，具体是上升沿还是下降沿的问题，是由 CPOL 决定的</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=VRV7VAWQ))
> 
> 🏷️ #📝/重点

^KEYVRV7VAWQ

> <span class="highlight" style="background-color: #e56eee">CPHA = 1 的情况就是表示数据采样是从第 2 个边沿即偶数边沿</span> ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=MDEZZNNT))
> 
> 🏷️ #📝/重点

^KEYMDEZZNNT

> <span class="image#e56eee">null</span>一般采用 工作模式 0 或 3 ([p566](zotero://open-pdf/library/items/JFGTX7CT?page=566&annotation=S34ILRD8))

^KEYS34ILRD8

> <span class="highlight" style="background-color: #f19837">36.1.1.3 SPI 寄存器</span> ([p568](zotero://open-pdf/library/items/JFGTX7CT?page=568&annotation=FKYFUN8L))
> 
> 🏷️ #📝/标题

^KEYFKYFUN8L

> <span class="highlight" style="background-color: #e56eee">SPI 控制寄存器 1（SPI_CR1）</span> ([p568](zotero://open-pdf/library/items/JFGTX7CT?page=568&annotation=WMQ6WHA7))
> 
> 🏷️ #📝/重点

^KEYWMQ6WHA7

> <span class="highlight" style="background-color: #e56eee">主设备模式选择，传输方向，数据格式，时钟极 性、时钟相位和使能等</span> ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=T36RNJWY))
> 
> 🏷️ #📝/重点

^KEYT36RNJWY

> <span class="highlight" style="background-color: #e56eee">SPI 状态寄存器（SPI_SR）</span> ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=NKNE5FYE))
> 
> 🏷️ #📝/重点

^KEYNKNE5FYE

> <span class="highlight" style="background-color: #e56eee">TXE 位和 RXNE 位</span> ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=NAC6YYUJ))
> 
> 🏷️ #📝/重点

^KEYNAC6YYUJ

> <span class="highlight" style="background-color: #e56eee">SPI 数据寄存器（SPI_DR）</span>
> 
> ![[正点原子_[正点] STM32_KEY-L2DMGSFC#^KEYKDWFN8HH | itemKey="JFGTX7CT" page="565" annotation="KDWFN8HH"]]
> 
> 数据寄存器就是移位寄存器 ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=BSW93HK3))
> 
> 🏷️ #📝/重点

^KEYBSW93HK3

> <span class="highlight" style="background-color: #e56eee">SPI 数据寄存器，是一个双寄存器，包括了发送缓存和接收缓存</span>
> 
> 这句话的意思是：发送缓冲区和接收缓冲区分别可以向该寄存器发送数据和读取数据。 ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=QBXQ9V69))
> 
> 🏷️ #📝/重点

^KEYQBXQ9V69

> <span class="highlight" style="background-color: #f19837">36.1.2 NOR FLASH 简介</span> ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=BIN58LDQ))
> 
> 🏷️ #📝/标题

^KEYBIN58LDQ

> <span class="highlight" style="background-color: #f19837">36.1.2.1 FLASH 简介</span> ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=PYJV8S3Q))
> 
> 🏷️ #📝/标题

^KEYPYJV8S3Q

> <span class="highlight" style="background-color: #e56eee">容量大、可重复擦写、按“扇区/块” 擦除、掉电后数据可继续保存的特性</span>
> 
> 能按“扇区/块” 擦除 ([p569](zotero://open-pdf/library/items/JFGTX7CT?page=569&annotation=BWJL69FF))
> 
> 🏷️ #📝/重点

^KEYBWJL69FF

> <span class="highlight" style="background-color: #e56eee">NOR 与 NAND 在数据写入前都需要有擦除操作</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=AKQ59QKH))
> 
> 🏷️ #📝/重点

^KEYAKQ59QKH

> <span class="highlight" style="background-color: #e56eee">但实际上 NOR FLASH 的一个 bit 可以从 1 变成 0，而要从 0 变 1 就要擦除后再写入</span>
> 
> 在往NOR FLASH 中写数据时， 1 可以变成 0，而 0 不可以变成 1。因此擦除操作是将该块中的所有位都变成 1 。 ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=TFZW8T3D))
> 
> 🏷️ #📝/重点

^KEYTFZW8T3D

> <span class="highlight" style="background-color: #e56eee">NAND Flash 这两种情况都需要擦除</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=83AZXGYM))
> 
> 🏷️ #📝/重点

^KEY83AZXGYM

> <span class="highlight" style="background-color: #e56eee">擦除操作的 最小单位为“扇区/块”，这意味着有时候即使只写一字节的数据，则这个“扇区/块”上之前的 数据都可能会被擦除</span>
> 
> 因此擦除之前要将该“扇区/块”中的数据读取出来。 ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=RRSI3FTS))
> 
> 🏷️ #📝/重点

^KEYRRSI3FTS

> <span class="highlight" style="background-color: #e56eee">NOR 的地址线和数据线分开，它可以按“字节”读写数据</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=PIGL5JMD))
> 
> 🏷️ #📝/重点

^KEYPIGL5JMD

> <span class="highlight" style="background-color: #e56eee">假如 NOR 上存储了代码指令，CPU 给 NOR 一个地址，NOR 就能向 CPU 返回一个数 据让 CPU 执行，中间不需要额外的处理操作</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=7JWYMAKV))
> 
> 🏷️ #📝/重点

^KEY7JWYMAKV

> <span class="highlight" style="background-color: #e56eee">因此可以用 NOR FLASH 直接作为嵌入式 MCU 的程序存储空间</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=ZDS3JPGR))
> 
> 🏷️ #📝/重点

^KEYZDS3JPGR

> <span class="highlight" style="background-color: #e56eee">NAND 的数据和地址线共用，只能按“块”来读写数据</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=SUJDJ66U))
> 
> 🏷️ #📝/重点

^KEYSUJDJ66U

> <span class="highlight" style="background-color: #e56eee">代码存储在 NAND 上，可以把它先加载到 RAM 存储器上，再由 CPU 执行</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=R4ET2GZW))
> 
> 🏷️ #📝/重点

^KEYR4ET2GZW

> <span class="highlight" style="background-color: #e56eee">FLASH 也有对应的缺点</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=DHFQDDUK))
> 
> 🏷️ #📝/重点

^KEYDHFQDDUK

> <span class="highlight" style="background-color: #e56eee">一是 FLASH 的使 用寿命，另一个是可能的位反转。</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=FDTJY3QD))
> 
> 🏷️ #📝/重点

^KEYFDTJY3QD

> <span class="highlight" style="background-color: #e56eee">NM25Q128 是一款大容量 SPI FLASH 产品，其容量为 16M</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=GWTU627M))
> 
> 🏷️ #📝/重点

^KEYGWTU627M

> <span class="highlight" style="background-color: #e56eee">将 16M 字节的容量分为 256 个块（Block），每个块大小为 64K 字节，每个块又分为 16 个扇区（Sector），每一个扇区 16 页， 每页 256 个字节，即每个扇区 4K 个字节</span>
> 
> 256个块
> 
> 1 个块包含 16 个扇区
> 
> 1 个扇区包含 16 页（4KB字节，4096个字节）
> 
> 1 页包含 256 个字节
> 
> 总容量为 16M ，故寻址范围为 ： 0X000000 ~ 0XFFFFFF，地址是三个字节。 ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=GH8UXI6J))
> 
> 🏷️ #📝/重点

^KEYGH8UXI6J

> <span class="note" style="background-color: #2ea8e5">note</span>
> 
> ![[正点原子_[正点] HAL库视_KEY-CS2N8HD9#^KEY6RC5PYSI | itemKey="7DE5NPS2" page="23" annotation="6RC5PYSI"]]
> 
> 块、扇、页 ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=Y62AZGMN))

^KEYY62AZGMN

> <span class="highlight" style="background-color: #e56eee">最小擦除单位为一个扇区，也就是每 次必须擦除 4K 个字节</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=BDU3SGRB))
> 
> 🏷️ #📝/重点

^KEYBDU3SGRB

> <span class="highlight" style="background-color: #e56eee">需要给 NM25Q128 开辟一个至少 4K 的缓存区</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=25EZQJNH))
> 
> 🏷️ #📝/重点

^KEY25EZQJNH

> <span class="highlight" style="background-color: #e56eee">芯片必须有 4K 以上 SRAM 才能很好的操作</span> ([p570](zotero://open-pdf/library/items/JFGTX7CT?page=570&annotation=W2GCVGGT))
> 
> 🏷️ #📝/重点

^KEYW2GCVGGT

> <span class="highlight" style="background-color: #e56eee">CS 即片选信号输入，低电平有效</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=5VMK5SEM))
> 
> 🏷️ #📝/重点

^KEY5VMK5SEM

> <span class="highlight" style="background-color: #e56eee">DO 是 MISO 引脚，在 CLK 管脚 的下降沿输出数据</span>
> 
> “下降沿输出数据” 和 “上升沿捕获数据” 决定了主机 SPI 的工作模式 ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=KMPK7TDQ))
> 
> 🏷️ #📝/重点

^KEYKMPK7TDQ

> <span class="highlight" style="background-color: #e56eee">DI 是 MOSI 引脚</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=W5J374HX))
> 
> 🏷️ #📝/重点

^KEYW5J374HX

> <span class="highlight" style="background-color: #e56eee">在 CLK 管脚的上升沿捕获捕获数据</span>
> 
> “下降沿输出数据” 和 “上升沿捕获数据” 决定了主机 SPI 的工作模式 ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=MC6DTFMT))
> 
> 🏷️ #📝/重点

^KEYMC6DTFMT

> <span class="highlight" style="background-color: #e56eee">CLK 是串行时钟引脚</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=S3LQKVLK))
> 
> 🏷️ #📝/重点

^KEYS3LQKVLK

> <span class="highlight" style="background-color: #e56eee">HOLD 是保持管脚，低电平有效。</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=MR4FFNXN))
> 
> 🏷️ #📝/重点

^KEYMR4FFNXN

> <span class="highlight" style="background-color: #f19837">36.1.2.2 NOR FLASH 工作时序</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=F9SHXY9I))
> 
> 🏷️ #📝/标题

^KEYF9SHXY9I

> <span class="highlight" style="background-color: #e56eee">null</span>
> 
> NM25Q128常用指令： ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=ZWSUAFG8))

^KEYZWSUAFG8

> <span class="note" style="background-color: #2ea8e5">note</span>
> 
> ![[正点原子_[正点] HAL库视_KEY-CS2N8HD9#^KEYTFXC2CA2 | itemKey="7DE5NPS2" page="25" annotation="TFXC2CA2"]]
> 
> NM25Q128常用指令 ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=E2JH6BCP))

^KEYE2JH6BCP

> <span class="highlight" style="background-color: #e56eee">指令是 03H</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=VEPE6GV8))
> 
> 🏷️ #📝/重点

^KEYVEPE6GV8

> <span class="highlight" style="background-color: #e56eee">发起读操作时，先把 CS 片选管脚拉低，然后通过 MOSI 引脚把 03H 发送芯片，之后再发送要读取的 24 位地址，这些 数据在 CLK 上升沿时采样。芯片接收完 24 位地址之后，就会把相对应地址的数据在 CLK 引脚 下降沿从 MISO 引脚发送出去。</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=ME44Y4HF))
> 
> 🏷️ #📝/重点

^KEYME44Y4HF

> <span class="highlight" style="background-color: #e56eee">在发送页写指令之前，需要先发送“写使能”指令</span>
> 
> ![[正点原子_[正点] HAL库视_KEY-CS2N8HD9#^KEYIGLMI4RT | itemKey="7DE5NPS2" page="26" annotation="IGLMI4RT"]]
> 
> 执行擦除和写指令之前都要“写使能”指令 ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=G6BYFJUC))
> 
> 🏷️ #📝/重点

^KEYG6BYFJUC

> <span class="highlight" style="background-color: #e56eee">主机拉低 CS 引脚，然后通过 MOSI 引脚把 02H 发送到芯片，接着发送 24 位地址，最后你就可以发送你需要写的字节数据到芯片</span> ([p571](zotero://open-pdf/library/items/JFGTX7CT?page=571&annotation=VVTEN6LD))
> 
> 🏷️ #📝/重点

^KEYVVTEN6LD

> <span class="highlight" style="background-color: #e56eee">扇区擦除指的是将一个扇区擦除，通过前面的介绍也知道，NM25Q128 的扇区大小是 4K 字节。擦除扇区后，扇区的位全置 1，即扇区字节为 FFh</span> ([p572](zotero://open-pdf/library/items/JFGTX7CT?page=572&annotation=LAKKY8VE))
> 
> 🏷️ #📝/重点

^KEYLAKKY8VE

> <span class="highlight" style="background-color: #e56eee">在执行扇区擦除之前，需要 先执行写使能指令</span> ([p572](zotero://open-pdf/library/items/JFGTX7CT?page=572&annotation=MA2CDYU2))
> 
> 🏷️ #📝/重点

^KEYMA2CDYU2

> <span class="highlight" style="background-color: #e56eee">需要注意的是当前 SPI 总线的状态，假如总线状态是 BUSY，那么这 个扇区擦除是无效的，所以在拉低 CS 引脚准备发送数据前，需要先要确定 SPI 总线的状态， 这就需要执行读状态寄存器指令，读取状态寄存器的 BUSY 位，需要等待 BUSY 位为 0，才可 以执行擦除工作</span>
> 
> 这里的数据是指“擦除指令” ([p572](zotero://open-pdf/library/items/JFGTX7CT?page=572&annotation=8SEP9GDU))
> 
> 🏷️ #📝/重点

^KEY8SEP9GDU

> <span class="highlight" style="background-color: #e56eee">主机先拉低 CS 引脚，然后通过 MOSI 引脚发送指令代码 20h 到芯片， 然后接着把 24 位扇区地址发送到芯片，然后需要拉高 CS 引脚，通过读取寄存器状态等待扇区 擦除操作完成</span>
> 
> BUSY 位为 0 ，执行擦除操作，然后再次等待 BUSY 位为 0 。 ([p572](zotero://open-pdf/library/items/JFGTX7CT?page=572&annotation=DBAZW73K))
> 
> 🏷️ #📝/重点

^KEYDBAZW73K

> <span class="highlight" style="background-color: #e56eee">对整个芯片进行擦除的操作，时序比扇区擦除更加简单，不用发送 24bit 地址，只 需要发送指令代码 C7h 到芯片即可实现芯片的擦除</span> ([p572](zotero://open-pdf/library/items/JFGTX7CT?page=572&annotation=HSU8RGJC))
> 
> 🏷️ #📝/重点

^KEYHSU8RGJC

> <span class="highlight" style="background-color: #e56eee">NM25Q128 的 CS、SCK、MISO 和 MOSI 分别连接在 PB12、PB13、PB14 和 PB15 上</span> ([p573](zotero://open-pdf/library/items/JFGTX7CT?page=573&annotation=A886SXC8))
> 
> 🏷️ #📝/重点

^KEYA886SXC8

> <span class="highlight" style="background-color: #f19837">36.3.1 SPI 的 HAL 库驱动</span> ([p573](zotero://open-pdf/library/items/JFGTX7CT?page=573&annotation=UAZFTCQ8))
> 
> 🏷️ #📝/标题

^KEYUAZFTCQ8

> <span class="highlight" style="background-color: #e56eee">HAL_SPI_Init 函数</span> ([p573](zotero://open-pdf/library/items/JFGTX7CT?page=573&annotation=94BBN5NV))
> 
> 🏷️ #📝/重点

^KEY94BBN5NV

> <span class="highlight" style="background-color: #e56eee">形参 1 是 SPI_HandleTypeDef 结构体类型指针变量</span> ([p573](zotero://open-pdf/library/items/JFGTX7CT?page=573&annotation=Z4GQKJDY))
> 
> 🏷️ #📝/重点

^KEYZ4GQKJDY

> <span class="highlight" style="background-color: #e56eee">HAL_SPI_Transmit 函数进行发送数据。</span> ([p574](zotero://open-pdf/library/items/JFGTX7CT?page=574&annotation=4GF663UF))
> 
> 🏷️ #📝/重点

^KEY4GF663UF

> <span class="highlight" style="background-color: #e56eee">HAL_SPI_Receive 函数进行接收数据。</span> ([p574](zotero://open-pdf/library/items/JFGTX7CT?page=574&annotation=2WPI3GVC))
> 
> 🏷️ #📝/重点

^KEY2WPI3GVC

> <span class="highlight" style="background-color: #e56eee">HAL_SPI_TransmitReceive 函数进行发送与接收操作</span> ([p574](zotero://open-pdf/library/items/JFGTX7CT?page=574&annotation=D2B3Q2Z6))
> 
> 🏷️ #📝/重点

^KEYD2B3Q2Z6

> <span class="highlight" style="background-color: #e56eee">设置 SPI 的预分频系数，从而决定了 SPI 的传输速度</span> ([p574](zotero://open-pdf/library/items/JFGTX7CT?page=574&annotation=Q8VIXXJI))
> 
> 🏷️ #📝/重点

^KEYQ8VIXXJI

> <span class="highlight" style="background-color: #e56eee">如果我们需要在程序中偶尔修改速度，那么我们就要通过设置 SPI_CR1 寄存器 来修改</span> ([p574](zotero://open-pdf/library/items/JFGTX7CT?page=574&annotation=9EQ296FB))
> 
> 🏷️ #📝/重点

^KEY9EQ296FB

> <span class="highlight" style="background-color: #e56eee">spi.c 存放 spi 底层驱动代码，norflash.c 文 件存放 W25Q128/NM25Q128 驱动</span> ([p575](zotero://open-pdf/library/items/JFGTX7CT?page=575&annotation=YTUFKW6K))
> 
> 🏷️ #📝/重点

^KEYYTUFKW6K

> <span class="highlight" style="background-color: #e56eee">NOR FLASH 驱 动源码包括两个文件：norflash.c 和 norflash.h</span>
> 
> obsidian://open?vault=Test&file=Excalidraw%2FDrawing%202024-03-15%2014.04.38.excalidraw ([p578](zotero://open-pdf/library/items/JFGTX7CT?page=578&annotation=WHTRATHY))
> 
> 🏷️ #📝/重点

^KEYWHTRATHY

> <span class="highlight" style="background-color: #e56eee">在指定地址开始读取指定长度的数据</span> ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=42N9Y6V5))
> 
> 🏷️ #📝/重点

^KEY42N9Y6V5

> <span class="image#e56eee">null</span>读的时候发送空字节 0XFF（对于FLASH 来说是空字节，因为 1 可擦除，而 0 不可以擦除）以产生 8 个时钟信号。 ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=HUFCMKLX))

^KEYHUFCMKLX

> <span class="highlight" style="background-color: #e56eee">程序就可以开始循环读 数据，其地址就会自动增加，读取完数据后，需要拉高片选信号，结束通信</span> ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=ATWXMUWE))
> 
> 🏷️ #📝/重点

^KEYATWXMUWE

> <span class="highlight" style="background-color: #e56eee">在指定地址开始写入指定长度的数据 , 该函数带擦除操作!</span>
> 
> 配合流程图理解 ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=HJYWUW33))
> 
> 🏷️ #📝/重点

^KEYHJYWUW33

> <span class="highlight" style="background-color: #e56eee">norflash_write</span>
> 
> 该函数里首先对当前要写入的扇区进行擦除，然后调用norflash_write_nocheck 函数对当前扇区写数据。
> 
> 在 norflash_write_nocheck 函数中调用 norflash_write_page 函数对当前所在页写数据。 ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=59M44XDM))
> 
> 🏷️ #📝/重点

^KEY59M44XDM

> <span class="note" style="background-color: #2ea8e5">note</span>
> 
> ![[正点原子_[正点] HAL库视_KEY-CS2N8HD9#^KEYQNY2AG34 | itemKey="RVNX9QJE" page="1" annotation="QNY2AG34"]]
> 
> FLASH 写数据流程图 ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=TDBS3P8M))

^KEYTDBS3P8M

> <span class="image#e56eee">null</span>另一层含义：在该扇区需要写入的字节数量 ([p579](zotero://open-pdf/library/items/JFGTX7CT?page=579&annotation=CHVP5HT4))

^KEYCHVP5HT4

> <span class="highlight" style="background-color: #e56eee">擦除这个扇区</span>
> 
> 擦除的不是整个扇区，而是要写入数据地址的后面部分 ([p580](zotero://open-pdf/library/items/JFGTX7CT?page=580&annotation=SCX4BNSG))
> 
> 🏷️ #📝/重点

^KEYSCX4BNSG

> <span class="image#e56eee">null</span>确定下一个扇区需要写入的字节个数 ([p580](zotero://open-pdf/library/items/JFGTX7CT?page=580&annotation=M83GQNDF))

^KEYM83GQNDF

> <span class="highlight" style="background-color: #e56eee">思路</span> ([p580](zotero://open-pdf/library/items/JFGTX7CT?page=580&annotation=MGWQIAC8))
> 
> 🏷️ #📝/重点

^KEYMGWQIAC8

> <span class="highlight" style="background-color: #e56eee">SPI 在一页(0~65535)内写入少于 256 个字节的数据</span>
> 
> 该函数没有对写入位置进行校验，而且写入的字节数不能超过该页的剩余字数。 ([p581](zotero://open-pdf/library/items/JFGTX7CT?page=581&annotation=CG7UBPBK))
> 
> 🏷️ #📝/重点

^KEYCG7UBPBK

> <span class="highlight" style="background-color: #e56eee">根据传参判断需要获取的是哪个状态寄存器，然后拉低 片选线，调用 spi2_read_write_byte 函数发送该寄存器的命令，然后通过发送一字节空数据获 取读取到的数据，最后拉高片选线，函数返回读取到的值</span> ([p581](zotero://open-pdf/library/items/JFGTX7CT?page=581&annotation=ACYYRY6V))
> 
> 🏷️ #📝/重点

^KEYACYYRY6V

> <span class="highlight" style="background-color: #e56eee">无检验写 SPI FLASH</span>
> 
> 该函数没有对写入位置进行校验，当写满一页要进行换页。 ([p581](zotero://open-pdf/library/items/JFGTX7CT?page=581&annotation=7RCH4N4T))
> 
> 🏷️ #📝/重点

^KEY7RCH4N4T

