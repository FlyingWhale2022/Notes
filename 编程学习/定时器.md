**一、“周期”的概念**

**1. 时钟周期**

​    [时钟周期](https://so.csdn.net/so/search?q=时钟周期&spm=1001.2101.3001.7020)是指**单片机内部时钟震荡器**的一个完整周期，通常以单位时间来衡量。时钟周期的长度由晶振的频率决定，例如，如果晶振频率为12MHz，则每个时钟周期的长度为1/12MHz ≈ 83.33纳秒。

**2. 晶振周期**

​    晶振周期是指**晶振器(一般尤指外部晶振器)**一个完整的振荡周期，也就是晶振器震荡一次所需要的时间。晶振周期的长度由晶振的频率决定，例如，如果晶振频率为12MHz，则每个晶振周期的长度为1/12MHz ≈ 83.33纳秒。

**3. 机器周期**

​    机器周期是指**单片机执行一条指令所需要的时间。在51系列单片机中，一个机器周期通常由12个时钟周期组成。**因此，如果晶振频率为12MHz，则每个机器周期的长度为12 * 83.33纳秒 ≈ 1微秒。

注：时钟周期与晶振周期的区别

​    在51单片机中，时钟周期是指单片机**内部**时钟(晶振)的一个完整周期，而晶振周期是指**外部**晶振器的一个完整周期。**时钟周期是单片机内部运行的基本单位**，决定了指令执行的速度和定时器的计时精度。**晶振周期则是提供给单片机的外部时钟信号**，用于驱动单片机的时钟电路。虽然在一些情况下，时钟周期和晶振周期可以相等，但在实际应用中，它们并不总是相同的。



**二、定时/计数器简介**

　　上面三个概念了解即可，下面来讲讲重头戏，定时器和计数器。**定时器和计数器是单片机内部的同一个模块，通过配置 SFR(特殊功能寄存器)可以实现两种不同的功能，大多数情况下是使用定时器功能**，因此主要来讲定时器功能，计数器功能读者自己了解一下即可。
　　顾名思义，定时器就是用来进行**定时**的。定时器内部有一个寄存器，让它开始计数后，这个寄存器的值每经过一个机器周期就会自动加1，因此，可以把机器周期理解为定时器的计数周期。就像钟表，每经过一秒，数字自动加1，而这个**定时器就是每过一个机器周期的时间，数字自动加1。**还有一个特别注意的地方，就是钟表是加到60后，秒就自动变成0了，这种情况在单片机或计算机里称为**溢出(达到最大值后重新从0开始计数)**。例如16位的定时器，也就是两个字节，最大值就是65535，那么加到65535后，再加1就算溢出，如果有其他位数，道理是一样的，对于51单片机来说，溢出后，这个值会直接变成0。**从某一个初始值开始，经过确定的时间后溢出，这个过程就是定时的含义。**



**三、定时/计数器的相关寄存器**

​    标准的51单片机内部有 T0 和 T1 这两个定时器，T就是 Timer的缩写，现在很多51系列单片机还会增加额外的定时器，在这里只讲定时器0和1。前边提到过，对于单片机的每一个功能模块，都是由它的 SFR，也就是特殊功能寄存器来控制。与定时器有关的特殊功能寄存器，有以下几个，**大家不需要去记忆这些寄存器的名字和作用，只要大概知道就行，用的时候，随时可以查手册，找到每个寄存器的名字和每个寄存器所起到的作用。**

> 注意：通过寄存器控制定时器（不要搞混寄存器和定时器）

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140055.png)

​    为了方便大家理解下面将要介绍的特殊功能寄存器，在此给出**定时器的电路示意图**：

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140476.png)

**1. 定时值存储寄存器**

​    **该类型寄存器是用来存储定时器的计数值的，TH0/TL0用于T0，TH1/TL1用于T1。**

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140639.png)

**2. 定时器控制寄存器TCON —— \**可位寻址\**  (控制定时器的状态，保存T0、T1的溢出和中断标志。)**

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140774.png)

![image-20240107212405790](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140944.png)

​    **TF1：定时器/计数器T1溢出标志。**当定时/计数器最高位产生溢出时，由硬件使其置位，如果中断允许则触发T1中断。进入中断处理后，由内部硬件电路自动清除。**(TF：Timer Flag)**
​    **TR1: 定时/计数器T1的运行控制位。**该位由软件置位或清零，当TR1=1时启动，TR1=0时停止。具体情况如下：当GATE=0，TR1=1时允许T1开始计数；TR1=0时禁止T1计数。当GATE=1，只有在TR1=1且INT1输入高电平时，才允许T1计数。**(TR：Timer Run)**

​    **TF0：定时器/计数器T0溢出标志。**当定时/计数器最高位产生溢出时，由硬件使其置位，如果中断允许则触发T0中断。进入中断处理后，由内部硬件电路自动清除。
​    **TR0: 定时/计数器T0的运行控制位。**该位由软件置位或清零，当TR0=1时启动，TR0=0时停止。具体情况如下：当GATE=0，TR0=1时允许T0开始计数；TR0=0时禁止T0计数。当GATE=1，只有在TR0=1且INT0输入高电平时，才允许T1计数。

​    **IE1：外部中断1(INT1/P3.3)的中断请求标志位。**IE1=1，外部中断向CPU请求中断，当CPU响应该中断时由硬件清“0”。**(IE：Interrupt Enable)**
​    **IT1：外部中断1触发方式控制位。**IT1=0时，外部中断1为低电平触发方式，当INT1(P3.3)输入低电平时，将IE1置1 。当IT1=1时，外部中断1为下降沿触发方式，当INT1(P3.3)输入信号出现下降沿时，将IE1置1。**(IT：Interrupt Type)**

​    **IE0：外部中断0(INT0/P3.2)的中断请求标志位。**IE0=1，外部中断向CPU请求中断，当CPU响应该中断时由硬件清“0”。
​    **IT0：外部中断0触发方式控制位。**IT0=0时，外部中断0为低电平触发方式，当INT0(P3.2)输入低电平时，将IE0置1 。当IT0=1时，外部中断0为下降沿触发方式，当INT0(P3.2)输入信号出现下降沿时，将IE0置1。

​    IE1、IT1、IE0、IT0在后面的“中断”部分才会用到，这里只简单的了解一下即可。

**3. 定时器工作模式寄存器TMOD —— \**不可位寻址\**  (控制定时器的工作模式)**

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140106.png)

注意：标T1的表示控制定时器1的位，标T0的表示控制定时器0的位。

![image-20240107213207153](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140251.png)

(注：有的时候C/T中的T上方会有一横线，那表示“T功能(定时)”低电平有效。)

​    **GATE：门控位。**当GATE位为0时，定时器的启动不受外部引脚的控制，用指令使TCON中的TR1(TR0)置1即可启动对应的定时器1(定时器0)；当GATE位为1时，定时器的启动受外部引脚的控制，用指令使TCON中的TR1(TR0)置1的同时，只有当外部中断INT1(INT0)引脚输入高电平时，才能启动相应的定时器1(定时器0)。 **(INT1对应外部引脚P3.3 INT0对应外部引脚P3.2)**

​    **C/T(Counter/Timer)：定时器/计数器选择位。**该位被清0时用作定时器功能(内部系统时钟)；被置1时用作计数器功能(外部引脚输入)，且为**下降沿**计数加一。 **(T1对应外部引脚P3.5 T0对应外部引脚P3.4)**

​    **M1/M0：工作模式控制位。**定时器0有4种工作方式，而定时器1只有3种工作方式。

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140372.png)

![image-20240107213408717](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140516.png)

​    **① 模式0/模式1：在模式0下，定时器配置为13位的定时/计数器，由TLi的低5位和THi的8位所构成。** TLi低5位溢出向THi进位，当 THi计数溢出，置位TCON中的溢出标志位TFi。**在模式1下，定时器配置为16位的定时/计数器，由TLi的8位和THi的8位所构成。**TLi的8位溢出向THi进位，当 THi计数溢出，置位TCON中的溢出标志位TFi。**(模式0/模式1的操作对于定时器1和定时器0大致是相同的，只有在C/T被置1时(计数)连接的外部脉冲输入引脚不同。)**

​    **② 模式2：TLi的溢出不仅置位TFi，而且将THi中的内容重新装入TLi，THi中的内容由软件预置，重装时THi内容保持不变。(模式2的操作对于定时器1和定时器0是相同的。)**

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140632.png)

​    **③ 模式3：**模式3是为了增加一个附加的8位定时器/计数器而提供的，使单片机具有三个定时器/计数器。**(模式3只适用于定时/计数器0，定时器T1处于模式3时相当于TR1=0， 停止计数，而T0可作为两个定时器用。)**

​    **对定时器1，在模式3时，定时器1停止计数，效果与将TR1设置为0相同。**

​    **对定时器0，此模式下定时器0的TL0及TH0作为2个独立的8位计数器。**

​    **TL0占用定时器0的控制位：C/T、GATE、TR0、INT0及TF0。**

​    **TH0限定为定时器功能(计数器周期)，占用定时器1的TR1及TF1。此时，TH0控制定时器1中断。**　　

![img](https://zbn-picture1-1319009493.cos.ap-chengdu.myqcloud.com/public-pic/202401072140755.png)

